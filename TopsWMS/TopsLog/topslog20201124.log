
**************************************************************************************************************------>2020/11/24 9:18:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:52
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:52
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:52
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:53
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:55
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:57
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:58
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:18:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:19:00
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:24:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:24:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:24:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:24:31
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-23"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:30:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:30:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:30:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:30:54
类型：Query 查询对象：SelIMWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/11/23 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:09
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:31:35
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:13
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:32:24
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:37:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:37:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:37:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:37:15
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:39:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:39:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:39:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:39:59
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:41:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:41:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:41:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:45:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:45:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:45:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:45:19
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:47:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:47:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:47:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:47:49
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:48:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:48:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:48:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:48:58
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:51:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:51:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:51:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:51:23
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:11
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:52:39
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:53:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:53:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:53:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:53:52
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:54:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:54:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:54:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:54:17
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:55:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:55:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:55:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:55:47
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:56:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:56:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:56:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:56:58
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:37
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:57:50
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:58:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:58:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:58:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:58:51
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:11
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:42
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:42
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:43
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:43
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 9:59:46
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:20
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:00:52
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:15
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:27
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"172.20.10.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/86.0.4240.93 Mobile/15E148 Safari/604.1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:27
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"172.20.10.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/86.0.4240.93 Mobile/15E148 Safari/604.1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:27
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"172.20.10.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/86.0.4240.93 Mobile/15E148 Safari/604.1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:28
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"172.20.10.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/86.0.4240.93 Mobile/15E148 Safari/604.1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:31
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:43
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:47
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:03:49
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:21
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:04:32
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:01
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:05:19
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:07:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:07:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:07:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:07:51
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:09
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:08:11
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:42
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:09:53
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:10:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:10:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:10:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:10:44
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:32
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:49
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:12:56
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:08
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:21
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:22
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:37
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @Tab2 where RowId > 1


------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]



------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:13:41
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:43
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:47
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:51
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:15:56
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:02
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:10
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201124101601856"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:13
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:16:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:17:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:17:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:17:13
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:23
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:23
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:23
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:23
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:25
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:44:51
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:14
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:17
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:34
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:35
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:55
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124104535383"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:45:58
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:07
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:20
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:46:53
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:02
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:06
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:07
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:18
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:29
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:47:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:04
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:21
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:42
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:42
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:49:42
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:51:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:52:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:52:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:52:01
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:07
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:15
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:19
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:53:24
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:05
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6FA7F00C-4A4A-4922-8463-D8E783972BA7"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"100"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"B864DF67-67BD-4BAC-8D43-0BDA81875393"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:06
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6FA7F00C-4A4A-4922-8463-D8E783972BA7"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"50"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"50"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"682173F8-4A4B-49E8-BA33-635666089870"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:06
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6FA7F00C-4A4A-4922-8463-D8E783972BA7"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"100"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"B864DF67-67BD-4BAC-8D43-0BDA81875393"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:21
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:36
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 10:54:49
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:14
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:14
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:14
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:17
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:17
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:17
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:17
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:17
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:18
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:36
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:36
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:36
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:36
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:55:38
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_Batch, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrentDetail_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrentDetail_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:56:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:56:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:56:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 13:56:02
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_Batch, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:00:46
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:00:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:00:47
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tListStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:04
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:06
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tListStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:"在库储位货物信息表外键ID"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"在库储位货物信息明细表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_ReportInventoryCurrentDetail_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tListStockInOut"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:"货物出入库记录表"
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货物出入库记录表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:27
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:28
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tListStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:30
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tListPutOnOff"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:"在库储位货物信息表外键ID"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"在库储位货物信息明细表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_ReportInventoryCurrentDetail_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tListPutOnOff"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:"货物上下架记录表 "
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货物上下架记录表 "
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:41
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:01:42
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tListPutOnOff"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:02:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:00
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:02
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:05
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:07
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:10
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:03:18
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:36
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:40
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124140435533"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:44
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:04:57
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:05:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:05:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:05:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:05:10
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:16:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:16:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:16:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:16:26
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:10
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:10
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:15
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 14:25:17
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:04
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:04
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:04
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:40:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:15
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:15
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:17
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:41:22
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:21
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:45:27
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:46:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:46:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:46:09
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:48:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:48:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:48:18
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]

           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:53
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:49:55
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
		   ,tListPutOnOff.s_ListPutOnOff_Batch
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 

           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:21
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:51:23
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
		   ,tListPutOnOff.s_ListPutOnOff_Batch
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:04
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:53:42
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
		   ,tListPutOnOff.s_ListPutOnOff_Batch
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:18
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 15:57:27
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrent_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,s_ListPutOnOff_Batch ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[s_ReportInventoryCurrentDetail_Batch]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
		   ,tListPutOnOff.s_ListPutOnOff_Batch
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:21
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:01:23
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
s_ListPutOnOff_Batch,
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_Batch
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_BatchNumber],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_BatchNumber] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:04
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:04:06
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,s_ListPutOnOff_Batch order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_BatchNumber],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_BatchNumber] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:02
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:05:07
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_BatchNumber],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_BatchNumber] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:02
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:04
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:37
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:38
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"14CCEF9C-7C4B-42EB-9E34-AA1596470BC0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:06:43
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:18:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:18:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:18:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:18:17
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:40
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124161816112"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:19:43
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:20:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:21:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:21:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:21:00
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:21:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:21:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:21:07
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:22:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:22:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:22:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:22:21
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:31:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:31:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:31:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:31:52
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:33:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:33:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:33:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:33:17
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:50
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:53
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:55
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:41:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:00
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:05
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124164159445"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:09
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:22
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:42:30
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:43:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:43:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:43:01
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"20C8CAD3-8044-40CE-B1E7-02172D880939"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:43:01
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"20C8CAD3-8044-40CE-B1E7-02172D880939"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"70"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:43:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:02
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:04
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"20C8CAD3-8044-40CE-B1E7-02172D880939"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:09
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"20C8CAD3-8044-40CE-B1E7-02172D880939"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:44:13
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:21
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:23
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:25
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:34
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124164824323"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:38
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:48:53
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:36
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:49
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EED28669-1F7F-409A-847E-9D59929A2176"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:50
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EED28669-1F7F-409A-847E-9D59929A2176"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"80"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:49:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:51:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:51:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:51:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:51:58
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:52:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:52:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:52:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:52:01
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"EED28669-1F7F-409A-847E-9D59929A2176"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 16:59:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:00
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"EED28669-1F7F-409A-847E-9D59929A2176"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:03
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
and Tab2.s_ListPutOnOff_Batch = Tab.s_ListPutOnOff_Batch
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EED28669-1F7F-409A-847E-9D59929A2176"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:00:07
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:09
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:13
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:28
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:45
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:01:56
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:22
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201124170154594"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:26
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:29
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:32
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:43
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:02:50
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:01
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:04
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:07
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:13
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:15
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:17
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:22
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124170316705"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:25
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:29
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:03:37
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:06:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:06:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:06:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:06:41
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:07:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:07:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:07:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:07:49
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:14
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"786D988D-E24D-47CE-9B4F-A1006A83B28B"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:14
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"786D988D-E24D-47CE-9B4F-A1006A83B28B"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:15
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"786D988D-E24D-47CE-9B4F-A1006A83B28B"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"60"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:34
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:45
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"786D988D-E24D-47CE-9B4F-A1006A83B28B"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:48
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--上架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    s_ReportInventoryCurrentDetail_Batch varchar(max),
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


insert into @TabDetail( 
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    s_ReportInventoryCurrentDetail_Batch,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
tListPutOnOff.n_Space_Id,
s_ListPutOnOff_GoodsProductCode, 
[s_ListPutOnOff_BatchNumber],
isnull(n_ListPutOnOff_LaunchNumber,0),
isnull(n_ListPutOnOff_LaunchOKProductCou,0),
isnull(n_ListPutOnOff_LaunchUnOKProductCou,0),
isnull(n_ListPutOnOff_LaunchReworkProductCou,0),
n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


--判定该货物在该储位明细是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) + Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
and Tab.s_ReportInventoryCurrentDetail_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
where n_ReportInventoryCurrentDetail_state = 1 

 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)


--专用于合并汇总提交上架单据的相同工件批次的记录数量
declare @TabDetail2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max), 
	n_ReportInventoryCurrentDetail_Id varchar(max), 
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ListPutOnOff_Batch varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id, 
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

   
insert into @TabDetail2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ListPutOnOff_Batch,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code,[s_ListPutOnOff_BatchNumber] order by tListPutOnOff.n_ReportInventoryCurrentDetail_Id asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	tListPutOnOff.n_ReportInventoryCurrentDetail_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	[s_ListPutOnOff_BatchNumber],
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id


update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
where RowId = 1 

delete from @Tab2 where RowId > 1



update @TabDetail2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumber,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @TabDetail2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,[s_ListPutOnOff_Batch] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
and Tab2.s_ReportInventoryCurrent_Code = Tab.s_ReportInventoryCurrent_Code
and Tab2.s_ListPutOnOff_Batch = Tab.s_ListPutOnOff_Batch
where RowId = 1

delete from @TabDetail2 where RowId > 1



------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]


--判定该货物在该储位明细是否有记录，没有则新增对应记录


INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]

           ,[s_ReportInventoryCurrentDetail_Code] 
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode] 
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
		   
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color] 
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''

		   ,s_ListPutOnOff_Code 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode] 
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))

           ,[s_ListPutOnOff_BatchNumber]  
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @TabDetail2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id],tListPutOnOff.[n_ReportInventoryCurrentDetail_Id]




------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  

------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrentDetail_Id，因为条码扫描新增的记录的n_ReportInventoryCurrentDetail_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrentDetail_Id。

update tListPutOnOff 
set n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and tReportInventoryCurrentDetail.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrentDetail_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrentDetail_Id = tListPutOnOff.n_ReportInventoryCurrentDetail_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"786D988D-E24D-47CE-9B4F-A1006A83B28B"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:08:52
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:42
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:45
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:47
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:50
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:59
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:11:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:01
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:39
类型：Query 查询对象：SelOnShelfGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @Tab table(
    ProductCode varchar(max),
	ProductName varchar(max)
) 

----塑件PBOM信息
--insert into @Tab(
--ProductCode,
--ProductName
--)
--select  
--s_PlasticParts_Code,s_PlasticParts_Desc 
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock) 
--where n_State = 1
--group by s_PlasticParts_Code,s_PlasticParts_Desc


--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

insert into @Tab(
ProductCode,
ProductName
)
select s_MotherCode,s_Mother_Desc
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1 
group by s_MotherCode,s_Mother_Desc 

select * from @Tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:12:52
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:13
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_Batch, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:13:20
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_Batch, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:18:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:18:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:18:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:18:21
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:28:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:28:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:28:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:28:38
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:42
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"100"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D2278751-9A2D-46F2-B677-4D676AD25895"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:42
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"70"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"30"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"3E16EF15-87E2-4B54-84E0-C039B3989CBB"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:43
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"100"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D2278751-9A2D-46F2-B677-4D676AD25895"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:48
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:32:51
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:33:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:33:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:33:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:33:14
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator]
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（4）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:33:14
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（4）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:38:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:38:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:38:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:38:57
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:11
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:27
类型：Business 业务对象：UpdateOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--下架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

--下架单据明细汇总 将要进行结算 已存在储位记录的货物信息
declare @TabDetail table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrentDetail_BatchNumber varchar(max), 
    n_ReportInventoryCurrentDetail_Number varchar(max),
    n_ReportInventoryCurrentDetail_OKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_UnOKProductCou varchar(max),
    n_ReportInventoryCurrentDetail_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)


insert into @TabDetail
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
	s_ReportInventoryCurrentDetail_BatchNumber,
    n_ReportInventoryCurrentDetail_Number,
    n_ReportInventoryCurrentDetail_OKProductCou,
    n_ReportInventoryCurrentDetail_UnOKProductCou,
    n_ReportInventoryCurrentDetail_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
	s_ListPutOnOff_BatchNumber,
    sum(isnull([n_ListPutOnOff_OffTheShelfNumber],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfUnOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfReworkProductCou],0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrentDetail with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrentDetail_state = 1
and s_ReportInventoryCurrentDetail_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrentDetail_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus,s_ListPutOnOff_BatchNumber


insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull([n_ListPutOnOff_OffTheShelfNumber],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfUnOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfReworkProductCou],0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) - Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 

 

--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrentDetail]
set
n_ReportInventoryCurrentDetail_Number = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number,0) - Tab.n_ReportInventoryCurrentDetail_Number,
n_ReportInventoryCurrentDetail_OKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_OKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrentDetail_OKProductCou else 0 end),
n_ReportInventoryCurrentDetail_UnOKProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_UnOKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrentDetail_UnOKProductCou else 0 end),
n_ReportInventoryCurrentDetail_ReworkProductCou = isnull(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_ReworkProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrentDetail_ReworkProductCou else 0 end), 
s_ReportInventoryCurrentDetail_Updator = @Operator,
d_ReportInventoryCurrentDetail_UpdateTime = getdate()
from tReportInventoryCurrentDetail with(nolock)
inner join @TabDetail Tab on Tab.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
where n_ReportInventoryCurrentDetail_state = 1 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"C99F0A8D-0D19-41FF-A1C9-823CC991D52F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:48:31
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:11
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:14
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:17
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:20
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:23
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:25
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:28
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:36
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201124174927288"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:40
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:43
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:49:48
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:50:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:50:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:50:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:50:51
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,s_ReportInventoryCurrent_SurplusNumber asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:52:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:52:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:52:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:52:55
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','0')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:35
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--仓库库存信息
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)
--未提交的上架单据货物信息
declare @UnSubmitTable table(
	s_ReportInventoryCurrent_Code varchar(max),
    s_ReportInventoryCurrent_GoodsProductCode varchar(max), 
	s_ReportInventoryCurrent_Number int
)

--根据货物编码匹配的仓库中对应产品的库存信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrentDetail_GoodsProductCode, 
s_ReportInventoryCurrentDetail_Code,
(case isnull([n_ReportInventoryCurrentDetail_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrentDetail_Number],0)) end),
s_ReportInventoryCurrentDetail_BatchNumber, 
'',
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrentDetail.n_Space_Id 

where s_ReportInventoryCurrentDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrentDetail_state = 1 and n_Space_state = 1 
and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and tSpace.n_Warehouse_Id = @n_Warehouse_Id 
 
--根据货物编码查询未提交的上架单据的指定货位的数量
insert into @UnSubmitTable(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_Number  
)
select 
s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode,
sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumber
from tListPutOnOff tListPutOnOff with(nolock) 
where n_ListPutOnOff_state = 1 and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tListPutOnOff.n_Warehouse_Id = @n_Warehouse_Id 
and n_ListPutOnOff_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and isnull(s_ListPutOnOff_WhetherToSubmit,0) = 0
group by s_ListPutOnOff_Code,
s_ListPutOnOff_GoodsProductCode
 
--扣减未提交的上架单据的数量，等于实际已存在的库存数量
update @table
set s_ReportInventoryCurrent_SurplusNumber = Convert(int,tab.s_ReportInventoryCurrent_SurplusNumber) - Convert(int,UnSubmitTable.s_ReportInventoryCurrent_Number)
from @table tab
inner join @UnSubmitTable UnSubmitTable on UnSubmitTable.s_ReportInventoryCurrent_Code
 = tab.s_ReportInventoryCurrent_Code and UnSubmitTable.s_ReportInventoryCurrent_GoodsProductCode
 = tab.s_ReportInventoryCurrent_GoodsProductCode

select * from @table
order by isnull(n_Space_ShipmentSequence,0) asc, s_ReportInventoryCurrent_Batch asc,Convert(int,replace(s_ReportInventoryCurrent_SurplusNumber,'---','100000000')) asc

 

--declare @table table(
--s_ReportInventoryCurrent_GoodsProductCode varchar(max),
--s_ReportInventoryCurrent_Code varchar(max),
--s_ReportInventoryCurrent_SurplusNumber varchar(max),
--s_ReportInventoryCurrent_Batch varchar(max), 
--n_ListPutOnOff_Id varchar(max), 
--n_ReportInventoryCurrent_Id varchar(max), 
--n_Space_ShipmentSequence int
--)

----根据货物编码匹配的已占据产品的库位的信息
--insert into @table(
--s_ReportInventoryCurrent_GoodsProductCode,
--s_ReportInventoryCurrent_Code,
--s_ReportInventoryCurrent_SurplusNumber,
--s_ReportInventoryCurrent_Batch, 
--n_ListPutOnOff_Id,
--n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence
--)
--select 
--s_ReportInventoryCurrent_GoodsProductCode, 
--s_ReportInventoryCurrent_Code,
--(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
--s_ListPutOnOff_BatchNumber, 
--'',
--tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
--n_Space_ShipmentSequence 
--from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
--left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
--left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
--= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
--where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
--and tListPutOnOff.n_ListPutOnOff_state = 1
--and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
--and tSpace.n_Warehouse_Id = @n_Warehouse_Id
--order by d_ListPutOnOff_LaunchTime asc  
 
--select * from @table




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:56
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0
 
 set @n_ReportInventoryCurrent_Number = isnull((
 select  
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus),0)

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:54:58
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:02
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:05
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:20
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"A608ABC2-B9E8-4EE9-A0B1-209702E88437"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:24
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:25
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:29
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:31
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:55:33
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:34
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:40
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201124175633932"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:44
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 17:56:45
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:02:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:02:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:02:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:02:07
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:32
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:37
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:40
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:42
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:11:44
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:23
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:30
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
 
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
  

select * from @table 
where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0
order by isnull(n_Space_ShipmentSequence,0) asc,s_ReportInventoryCurrent_SurplusNumber desc

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"70"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS060109"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"40"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()
declare @n_ReportInventoryCurrentDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
		   ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:12:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:01
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:13:29
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:14:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:14:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:06
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:06
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:09
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:29
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:15:43
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:16:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:16:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:16:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:16:33
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:17:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:17:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:17:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:17:40
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:19:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:19:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:19:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:19:14
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:19:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:00
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:04
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:16
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:20:44
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:21:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:21:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:21:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/24 18:21:02
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"69C70886-3BC2-4643-BB58-E07D374D6A7F"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^