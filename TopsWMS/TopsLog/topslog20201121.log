
**************************************************************************************************************------>2020/11/21 9:41:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:46
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:46
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:46
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:47
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:49
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:49
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:49
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:50
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:50
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:52
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:56
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:41:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:43:49
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:47
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:51
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:55
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:45:58
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:11
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:13
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B2175B9E-F720-41A6-AAD5-9BB02B736211"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:16
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:49:19
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B2175B9E-F720-41A6-AAD5-9BB02B736211"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:54:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:54:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 9:54:50
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
left join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode] order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumberSum,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
left join (select 
[s_ListPutOnOff_GoodsProductCode],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumberSum
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode]) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @Tab2 where RowId > 1


------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]



------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B2175B9E-F720-41A6-AAD5-9BB02B736211"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:04
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
left join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode] order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumberSum,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
left join (select 
[s_ListPutOnOff_GoodsProductCode],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumberSum
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],n_ListPutOnOff_LaunchOKProductCou
,n_ListPutOnOff_LaunchUnOKProductCou,n_ListPutOnOff_LaunchReworkProductCou) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @Tab2 where RowId > 1


------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]



------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B2175B9E-F720-41A6-AAD5-9BB02B736211"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:02:08
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:08:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:08:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:08:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:08:56
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:19
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:25
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201121100918567"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:09:30
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:10:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:10:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:10:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:10:55
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:39
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:46
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"120"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:50
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:11:56
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:02
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270002"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"130"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:09
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:15
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:21
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"74481891911270001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"150"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:27
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:32
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:36
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"160"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:41
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98529941911270014"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:51
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:55
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270014"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"170"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:12:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:00
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98529941911270001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:06
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:12
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"180"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:13:16
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:50
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:54
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:15:57
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:01
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
left join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode] order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumberSum,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
left join (select 
[s_ListPutOnOff_GoodsProductCode],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumberSum
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @Tab2 where RowId > 1


------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]



------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"EB770E4B-FB81-416F-AAB6-A0FF773F898A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:16:05
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:20:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:20:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:20:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:20:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:20:19
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:54
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:22:58
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:11
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:13
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:24
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201121102412882"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:24:27
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:27:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:28:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:28:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:28:48
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"SelOnShelfSingleGoodsInfo"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:28:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:28:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:28:52
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:35:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:35:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:35:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:35:09
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:44:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:45:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:45:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:45:02
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:46:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:46:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:46:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:46:06
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:33
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:51:42
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（6）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"80"
（7）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"200"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:53:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:53:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:53:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:53:01
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:54:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:54:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:54:12
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"80"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"200"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"3CE78F64-94FD-43DA-885F-AE58571AC1EB"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:54:13
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203040019"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"80"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"200"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"3CE78F64-94FD-43DA-885F-AE58571AC1EB"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:54:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:40
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:45
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:53
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"50"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"300"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"1126469B-7FE0-4D88-95B0-EE49CF6A95E0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:54
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"50"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"300"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"1126469B-7FE0-4D88-95B0-EE49CF6A95E0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:57:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:00
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:04
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:18
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 10:58:21
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:18
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:18
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:18
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:18
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:20
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:46
类型：Business 业务对象：UpdateOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--下架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull([n_ListPutOnOff_OffTheShelfNumber],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfUnOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfReworkProductCou],0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) - Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"1323DB38-4BCD-45DB-80CB-5600A182D0A6"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:07:49
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:09
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:52
类型：Business 业务对象：InsertOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"CK20201121131009281"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:10:55
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:10
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:30
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:11:47
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:15:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:15:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:15:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:15:45
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:23
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:19:31
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:28:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:28:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:28:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:28:21
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:05
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:27
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:31
类型：Query 查询对象：SelOnShelfSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max),
	s_ReportInventoryCurrent_SurplusNumber varchar(max),
	s_ReportInventoryCurrent_Batch varchar(max), 
	n_ListPutOnOff_Id varchar(max), 
	n_ReportInventoryCurrent_Id varchar(max), 
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	s_ReportInventoryCurrent_Batch, 
	n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_ReportInventoryCurrent_Number],'0') when '0' then '---' else Convert(varchar(20),isnull([n_ReportInventoryCurrent_Number],0)) end),
s_ListPutOnOff_BatchNumber, 
'',
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
n_Space_ShipmentSequence 
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_ReportInventoryCurrent_Id
 = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tListPutOnOff.n_ListPutOnOff_state = 1
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by d_ListPutOnOff_LaunchTime asc  
 
select * from @table


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:36
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物出库记录以及下架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
declare @n_ListStockInOut_Id varchar(max) = newID() 
 

INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)

	  

--部分下架需要新增多一条入库记录与上架记录

INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,d_ListStockInOut_WarehouseOutTime
           ,n_ListStockInOut_WarehouseOutQuantity
           ,n_ListStockInOut_WarehouseOutOKProductCou
           ,n_ListStockInOut_WarehouseOutUnOKProductCou
           ,n_ListStockInOut_WarehouseOutReworkProductCou
           ,s_ListStockInOut_WarehouseOutOperator
           ,s_ListStockInOut_WarehouseOutClasses
		   ,n_ListStockInOut_WarehouseOutSequence
           ,n_WarehouseOutReason_Id
           ,s_WarehouseOutReason_Name
           ,n_WarehouseOutReason_Type    
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
      VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber 
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 

		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
           ,[s_ListPutOnOff_BatchNumber]
           ,d_ListPutOnOff_OffTheShelfTime
           ,n_ListPutOnOff_OffTheShelfNumber
           ,n_ListPutOnOff_OffTheShelfOKProductCou
           ,n_ListPutOnOff_OffTheShelfUnOKProductCou
           ,n_ListPutOnOff_OffTheShelfReworkProductCou
           ,s_ListPutOnOff_OffTheShelfOperator
           ,s_ListPutOnOff_OffTheShelfClasses
           ,n_ListPutOnOffReason_Id
           ,s_ListPutOnOffReason_Reason
           ,n_ListPutOnOff_OffTheShelfType
           ,n_ListPutOnOff_OffTheShelfSequence 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
      VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_DownNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

  
 
 
--修正单据总数量
update tBillStockInOut 
set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
,s_BillStockInOut_Updator = @Operator
,d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6662B8AE-2552-44EA-83FB-AE77B4BECF25"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"120"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"7AA02A6D-91D2-4C9A-A45B-767C791BCF5E"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:36
类型：Business 业务对象：InsertOnShelfSingleListStockInOut 
说明：执行业务过程[2]：0.新增货物出库记录以及下架记录（整合版本）
***************************************************************************************************************
SQL:
------------------------------------------------------------------------------
----根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
--declare @n_Space_Id varchar(max)
--declare @n_Shopfloor_Id varchar(max)
--declare @n_Warehouse_Id varchar(max)
--declare @n_Rack_Id varchar(max)

--select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
--@n_Rack_Id = n_Rack_Id
--from tSpace with(nolock)
--where s_Space_BarCode = @s_ReportInventoryCurrent_Code
--and n_Space_state = 1
 
----查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
--declare @n_GoodsId varchar(max),
--@n_GoodsName varchar(max)
--,@s_ListStockInOut_SpecificationAndModel varchar(max)
--,@s_ListStockInOut_Unit varchar(max)
--,@s_ListStockInOut_Model varchar(max)
--,@s_ListStockInOut_Color varchar(max)

----查看编码是否是塑件的，如果是则带出该塑件PBOM信息
--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
--,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series+s_Brand,
--@s_ListStockInOut_Color = ''
--from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
--where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

----如果不是，则查询漆件PBOM表
--if(ISNULL(@n_GoodsId,'') = '')
--begin

----查询最后一版的漆件PBOM的信息
--declare @PBOM_Month varchar(10)

--select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where n_State = 1
--group by s_Month
--order by REPLACE(s_Month,'-','') desc

--select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
--,@s_ListStockInOut_SpecificationAndModel = '',
--@s_ListStockInOut_Unit = '根',
--@s_ListStockInOut_Model = s_Series,
--@s_ListStockInOut_Color = s_Color
-- from TopsERP_BIZ.dbo.tPBOM with(nolock)
--where s_Month = @PBOM_Month and n_State = 1
--and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
--order by n_Id desc

--end

-- --获取喷涂下线QA的结果信息ID,批次信息
-- declare @WorkLogId varchar(max),
-- @s_ListStockInOut_BatchNumber varchar(max)

-- --根据货物标识编码查出对应喷涂下线QA的结果信息记录
-- select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
-- from TopsERP_BIZ.dbo.tWorkLog with(nolock)
-- where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
-- and n_State = 1

-- --获取单据编码
-- declare @BillStockInOutCode varchar(max) 

-- select 
-- @BillStockInOutCode = s_BillStockInOut_Code
-- from tBillStockInOut with(nolock)
-- where n_BillStockInOut_Id = @n_BillStockInOut_Id
-- and n_BillStockInOut_state = 1

-------------------------------------------------------------------------------

--declare @n_BillStockInOutDetail_Id varchar(max) = newID() 
--declare @n_ListStockInOut_Id varchar(max) 
--declare @n_ReportInventoryCurrent_Id varchar(max) = newID() 

--select top 1
--@n_ListStockInOut_Id = n_ListStockInOut_Id 
--from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id = @n_ListPutOnOff_Id
--and n_ListPutOnOff_state = 1 


--INSERT INTO [dbo].[tBillStockInOutDetail]
--           ([n_BillStockInOutDetail_Id]
--           ,[s_BillStockInOutDetail_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_ReportInventoryCurrent_Id]
--           ,[s_BillStockInOutDetail_BarCode]
--           ,[n_BillStockInOutDetail_GoodsProductId]
--           ,[s_BillStockInOutDetail_GoodsProductCode]
--           ,[s_BillStockInOutDetail_GoodsProductName]
--           ,[s_BillStockInOutDetail_ExternalCode]
--           ,[s_BillStockInOutDetail_ExternalName]
--           ,[s_BillStockInOutDetail_ECN] 
--           ,[n_BillStockInOutDetail_QualityStatus]
--           ,[s_BillStockInOutDetail_Operator]
--           ,[s_BillStockInOutDetail_Department]
--           ,[s_BillStockInOutDetail_Team]
--           ,[d_BillStockInOutDetail_OperateTime]
--           ,[s_BillStockInOutDetail_Remark]
--           ,[s_BillStockInOutDetail_WhetherToSubmit]
--           ,[f_BillStockInOutDetail_WorkOrderQuantity]
--           ,[f_BillStockInOutDetail_OKProductCou]
--           ,[f_BillStockInOutDetail_UnOKProductCou]
--           ,[f_BillStockInOutDetail_ReworkProductCou]
--           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
--           ,[n_BillStockInOutDetail_IsApproved]
--           ,[n_BillStockInOutDetail_IsFinishedState]
--           ,[n_BillStockInOutDetail_state]
--           ,[s_BillStockInOutDetail_Creator]
--           ,[d_BillStockInOutDetail_CreateTime]
--           ,[s_BillStockInOutDetail_Updator]
--           ,[d_BillStockInOutDetail_UpdateTime]
--           ,[s_BillStockInOutDetail_ReceivePerson]
--           ,[s_BillStockInOutDetail_ReceiveTime]
--           ,[s_BillStockInOutDetail_RejectPerson]
--           ,[s_BillStockInOutDetail_RejectTime])
--     VALUES
--           (@n_BillStockInOutDetail_Id
--           ,@BillStockInOutCode
--           ,@n_Warehouse_Id
--           ,@n_Shopfloor_Id
--           ,@n_Rack_Id
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_BillStockInOut_Id 
--           ,null
--           ,@s_ReportInventoryCurrent_GoodsBarCode
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@n_GoodsName
--           ,''
--           ,@s_ListStockInOut_QualityStatus 
--           ,@Operator
--           ,''
--           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
--           ,getdate()
--           ,''
--           ,0
--           ,@s_ReportInventoryCurrent_DownNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--           ,0
--           ,0
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--           ,null
--           ,null
--           ,null
--           ,null)


----获取下架记录序列 
--declare @ListStockInOut_WarehouseOutSequence int = 0
--set @ListStockInOut_WarehouseOutSequence = isnull((
--select 
--max(n_ListStockInOut_WarehouseOutSequence)
--from tListStockInOut with(nolock)
--where (n_ListStockInOut_Id =@n_ListStockInOut_Id
--or n_ListStockInOut_ParentId = @n_ListStockInOut_Id)
--and n_ListStockInOut_state = 1),0) + 1


----进行完整出库或部分出库的操作 
--update tListStockInOut set    
--    d_ListStockInOut_WarehouseOutTime=getdate(),
--    n_ListStockInOut_WarehouseOutQuantity=isnull(n_ListStockInOut_WarehouseOutQuantity,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListStockInOut_WarehouseOutOKProductCou=isnull(n_ListStockInOut_WarehouseOutOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutUnOKProductCou=isnull(n_ListStockInOut_WarehouseOutUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListStockInOut_WarehouseOutReworkProductCou=isnull(n_ListStockInOut_WarehouseOutReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListStockInOut_WarehouseOutOperator=@Operator,
--    s_ListStockInOut_WarehouseOutClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_WarehouseOutReason_Id='',
--    s_WarehouseOutReason_Name='',
--    n_WarehouseOutReason_Type='',
--    n_ListStockInOut_WarehouseOutSequence=@ListStockInOut_WarehouseOutSequence, 
--    s_ListStockInOut_Updator=@Operator,
--    d_ListStockInOut_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id

 

----进行完整下架或部分下架的操作 
--update tListPutOnOff set  
--    d_ListPutOnOff_OffTheShelfTime=getdate(),
--    n_ListPutOnOff_OffTheShelfNumber=isnull(n_ListPutOnOff_OffTheShelfNumber,0)+ @s_ReportInventoryCurrent_DownNumber,
--    n_ListPutOnOff_OffTheShelfOKProductCou=isnull(n_ListPutOnOff_OffTheShelfOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfUnOKProductCou=isnull(n_ListPutOnOff_OffTheShelfUnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    n_ListPutOnOff_OffTheShelfReworkProductCou=isnull(n_ListPutOnOff_OffTheShelfReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end),
--    s_ListPutOnOff_OffTheShelfOperator=@Operator,
--    s_ListPutOnOff_OffTheShelfClasses=(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
--    n_ListPutOnOffReason_Id='',
--    s_ListPutOnOffReason_Reason='',
--    n_ListPutOnOff_OffTheShelfType='',
--    n_ListPutOnOff_OffTheShelfSequence=@ListStockInOut_WarehouseOutSequence,   
--    s_ListPutOnOff_Updator=@Operator,
--    d_ListPutOnOff_UpdateTime=getdate()
--where n_ListStockInOut_Id=@n_ListStockInOut_Id


----修正单据总数量
--update tBillStockInOut 
--set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_DownNumber
--,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_DownNumber else 0 end)
--,s_BillStockInOut_Updator = @Operator
--,d_BillStockInOut_UpdateTime = getdate()
--where n_BillStockInOut_Id = @n_BillStockInOut_Id 


----判定剩余库存数量是否为0,则可以判定 此次下架是完整下架还是部分下架,不为0则是部分下架
--if(@s_ReportInventoryCurrent_SurplusNumber <> '0')
--begin

--declare @n_ChildListStockInOut_Id varchar(max) = newID()

----部分下架需要新增多一条入库记录与上架记录

--INSERT INTO [dbo].[tListStockInOut]
--           ([n_ListStockInOut_Id]
--           ,[n_ListStockInOut_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,[n_ListStockInOut_WarehousingSequence]
--           ,[n_WarehousingReason_Id]
--           ,[s_WarehousingReason_Name]
--           ,[n_WarehousingReason_Type]  
--           ,[s_ListStockInOut_WhetherToSubmit]
--           ,[n_ListStockInOut_state]
--           ,[s_ListStockInOut_Creator]
--           ,[d_ListStockInOut_CreateTime]
--           ,[s_ListStockInOut_Updator]
--           ,[d_ListStockInOut_UpdateTime])
--     select top 1
-- 	       @n_ChildListStockInOut_Id
--           ,@n_ListStockInOut_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_BillStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListStockInOut_GoodsId]
--           ,[s_ListStockInOut_GoodsProductName]
--           ,[s_ListStockInOut_GoodsProductCode]
--           ,[n_ListStockInOut_GoodsProductId]
--           ,[s_ListStockInOut_ExternalCode]
--           ,[s_ListStockInOut_ExternalName]
--           ,[s_ListStockInOut_ECN]
--           ,[n_APQPStatus_Id]
--           ,[s_APQPStatus_Name]
--           ,[s_ListStockInOut_QualityStatus]
--           ,[s_ListStockInOut_SpecificationAndModel]
--           ,[s_ListStockInOut_Unit]
--           ,[s_ListStockInOut_Model]
--           ,[s_ListStockInOut_Color]
--           ,[s_ListStockInOut_BatchNumber]
--           ,[d_ListStockInOut_WarehousingTime]
--           ,[n_ListStockInOut_WarehousingQuantity]
--           ,[n_ListStockInOut_WarehousingOKProductCou]
--           ,[n_ListStockInOut_WarehousingUnOKProductCou]
--           ,[n_ListStockInOut_WarehousingReworkProductCou]
--           ,[s_ListStockInOut_WarehousingOperator]
--           ,[s_ListStockInOut_WarehousingClasses]
--		   ,isnull([n_ListStockInOut_WarehousingSequence],0) + 1
--           ,''
--           ,''
--           ,''
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListStockInOut tListStockInOut with(nolock)
--where n_ListStockInOut_Id=@n_ListStockInOut_Id
--order by isnull([n_ListStockInOut_WarehousingSequence],0) desc

		   
--INSERT INTO [dbo].[tListPutOnOff]
--           ([n_ListPutOnOff_Id]
--           ,[n_ListPutOnOff_ParentId]
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_ListStockInOut_Id]
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,[n_ListPutOnOff_LaunchSequence] 
--           ,[s_ListPutOnOff_WhetherToSubmit]
--           ,[n_ListPutOnOff_state]
--           ,[s_ListPutOnOff_Creator]
--           ,[d_ListPutOnOff_CreateTime]
--           ,[s_ListPutOnOff_Updator]
--           ,[d_ListPutOnOff_UpdateTime])
--     select 
--           newID()
--           ,@n_ListPutOnOff_Id
--           ,[s_BillStockInOut_Code]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,@n_ChildListStockInOut_Id
--           ,[n_BillStockInOutDetail_Id]
--           ,[n_Bin_Id]
--		   ,n_ReportInventoryCurrent_Id
--           ,[n_ListPutOnOff_GoodsId]
--           ,[s_ListPutOnOff_Code]
--           ,[s_ListPutOnOff_GoodsProductName]
--           ,[s_ListPutOnOff_GoodsProductCode]
--           ,[n_ListPutOnOff_GoodsProductId]
--           ,[s_ListPutOnOff_ExternalCode]
--           ,[s_ListPutOnOff_ExternalName]
--           ,[s_ListPutOnOff_ECN] 
--           ,[s_ListPutOnOff_SpecificationAndModel]
--           ,[s_ListPutOnOff_Unit]
--           ,[s_ListPutOnOff_Model]
--           ,[s_ListPutOnOff_Color]
--           ,[s_ListPutOnOff_BatchNumber]
--           ,[d_ListPutOnOff_LaunchTime]
--           ,[n_ListPutOnOff_LaunchNumber]
--           ,[n_ListPutOnOff_LaunchOKProductCou]
--           ,[n_ListPutOnOff_LaunchUnOKProductCou]
--           ,[n_ListPutOnOff_LaunchReworkProductCou]
--           ,[s_ListPutOnOff_LaunchOperator]
--           ,[s_ListPutOnOff_LaunchClasses]
--           ,[n_LaunchReason_Id]
--           ,[n_LaunchReason_Name]
--           ,[n_ListPutOnOff_LaunchType]
--           ,isnull([n_ListPutOnOff_LaunchSequence],0) + 1
--           ,0
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate()
--	from tListPutOnOff tListPutOnOff with(nolock)
--where n_ListPutOnOff_Id=@n_ListPutOnOff_Id
--order by isnull([n_ListPutOnOff_LaunchSequence],0) desc

--end 
 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:""
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6662B8AE-2552-44EA-83FB-AE77B4BECF25"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_DownNumber" DbType:"String" Value:"120"
（9）ParameterName:"@s_ReportInventoryCurrent_SurplusNumber" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"7AA02A6D-91D2-4C9A-A45B-767C791BCF5E"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:29:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:12
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:30
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:35:43
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6662B8AE-2552-44EA-83FB-AE77B4BECF25"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:25
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:35
类型：Query 查询对象：SelOnShelfSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6662B8AE-2552-44EA-83FB-AE77B4BECF25"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:39
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:36:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:38:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:38:53
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:38:53
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:38:53
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:24
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 13:44:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:01:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:01:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:01:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:01:38
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:41
类型：Query 查询对象：SelOnShelfSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @tab table(
     s_MotherCode varchar(max),
	 s_Mother_Desc varchar(max),
	 s_PartType varchar(max),
	 s_Color varchar(max),
	 s_Brand varchar(max),
	 s_Series varchar(max),
	 n_ReportInventoryCurrent_Number int,
	 n_BillStockInOut_DownNumber int
 )

--根据工件编码获取PBOM的工件信息,并插入相应记录
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  
insert into @tab(
     s_MotherCode,
	 s_Mother_Desc,
	 s_PartType,
	 s_Color,
	 s_Brand,
	 s_Series,
	 n_ReportInventoryCurrent_Number
)
select top 1
s_MotherCode,
s_Mother_Desc = (case when len(s_Mother_Desc) > 25 then SUBSTRING(s_Mother_Desc,0,25)+'......' else s_Mother_Desc end),
s_PartType,
s_Color,
s_Brand,
s_Series,
0
from TopsERP_BIZ.dbo.tPBOM with(nolock) 
where n_State = 1  and s_Month = @Month
and s_MotherCode = @GoodsCode
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 

--查询未提交的下架单据的该产品的下架数
declare @n_BillStockInOut_DownNumber int = 0

set @n_BillStockInOut_DownNumber = isnull((
select 
 sum(f_BillStockInOutDetail_WorkOrderQuantity)
from tBillStockInOut tBillStockInOut with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tBillStockInOutDetail.n_BillStockInOut_Id
where n_BillStockInOut_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
and s_BillStockInOutDetail_GoodsProductCode = @GoodsCode
and tBillStockInOutDetail.n_Warehouse_Id = @n_Warehouse_Id
and isnull(s_BillStockInOut_WhetherToSubmit,'0') = '0'),0)

 
--查询当前仓库的库位存量，并修改相应记录
 declare @n_ReportInventoryCurrent_Number int = 0

 select @n_ReportInventoryCurrent_Number =
 sum(isnull(n_ReportInventoryCurrent_Number,0))
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)   
where n_ReportInventoryCurrent_state = 1 and n_Warehouse_Id = @n_Warehouse_Id
and s_ReportInventoryCurrent_GoodsProductCode = @GoodsCode
and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus

update @tab set n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number
,n_BillStockInOut_DownNumber = @n_BillStockInOut_DownNumber

select * from @tab

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:04:53
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:20
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:20
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:20
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:21
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:33:22
类型：Query 查询对象：SelOnShelfSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_OffTheShelfOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_OffTheShelfTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_OffTheShelfOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"6662B8AE-2552-44EA-83FB-AE77B4BECF25"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:20
类型：Business 业务对象：UpdateOnShelfSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--下架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull([n_ListPutOnOff_OffTheShelfNumber],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfUnOKProductCou],0)),
    sum(isnull([n_ListPutOnOff_OffTheShelfReworkProductCou],0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) - Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) - (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"6662B8AE-2552-44EA-83FB-AE77B4BECF25"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:23
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:34:43
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:20
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Warehouse_Id asc),* from (
SELECT 
--[Columns]      
      [n_Warehouse_Id]
      ,tBlock.s_Block_Name
      ,tShopfloor.s_Shopfloor_Name
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose]
      ,[s_Warehouse_Remark]
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[n_Warehouse_state]=(case n_Warehouse_state when 1 then '正常' else '停用' end)
      ,[s_Warehouse_Creator]
      ,[d_Warehouse_CreateTime]
      ,[s_Warehouse_Updator]
      ,[d_Warehouse_UpdateTime]
--[/Columns]     
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:20
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1      
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
 ) T_RowsCount  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:29
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Rack_Id asc),* from (
SELECT 
--[Columns]
      n_Rack_Id
      ,[s_Block_Name]
      ,[s_Warehouse_Name]
      ,[s_Rack_StorageType]
      ,s_Rack_CodePrefix
      ,[s_Rack_Code]
      ,[n_Rack_SpaceCapacity]
      ,[n_Rack_LayerCapacity] 
      ,[n_Rack_MaximumStorageCapacity]
      ,[n_Rack_QualityLevel]=
      (case isnull([n_Rack_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[f_Rack_Width]
      ,[f_Rack_Height]
      ,[f_Rack_Length]
      ,(case isnull([n_Rack_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) as n_Rack_UsageStatus
      ,[s_Rack_CustomFields1]
      ,[s_Rack_CustomFields2]
      ,[s_Rack_CustomFields3]
      ,[s_Rack_CustomFields4]
      ,[s_Rack_CustomFields5]
      ,[s_Rack_CustomFields6]
      ,[s_Rack_CustomFields7]
      ,[s_Rack_CustomFields8]
      ,[s_Rack_CustomFields9]
      ,[s_Rack_CustomFields10]
      ,[n_Rack_state]=(case n_Rack_state when 1 then '正常' else '停用' end)
      ,[s_Rack_Creator]
      ,[d_Rack_CreateTime]
      ,[s_Rack_Updator]
      ,[d_Rack_UpdateTime]
--[/Columns]
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:29
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:53
类型：Query 查询对象：SelSpaceList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_Space_BarCode asc),* from (
SELECT 
--[Columns]
      [tSpace].[n_Space_Id]
      ,[tSpace].[n_CombinedSpace_Id]  
      ,n_SplitSpace_Id
      ,(case when ISNULL(tCombinedSpace.n_CombinedSpace_Id,'') = '' then 0 else 1 end) as n_CombinedSpace_State
      ,tWarehouse.s_Warehouse_Name
      ,tRack.s_Rack_Code
      ,[s_Space_Code]
      ,[s_Space_BarCode]
      ,[n_Space_BayNumber]
      ,[n_Space_LayerNumber] 
      ,[n_Space_Position]
      ,[n_Space_MaxPosition]
      ,[s_Space_StorageType]
      ,[n_Space_Warehouse]
      ,[n_Space_Width]
      ,[n_Space_Height]
      ,[n_Space_Length]
      ,[n_Space_ShipmentSequence]
      ,[n_Space_QualityLevel]=
      (case isnull([n_Space_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[n_Space_UsageStatus]=(case n_Space_UsageStatus when 1 then '已占用' when 2 then '未完全占用' else '空闲' end)
      ,[s_Space_LocationLock]
      ,[s_Space_OverflowLocation]
      ,[n_Space_RestrictedStorageMaterialType]
      ,[s_Space_CustomFields1]
      ,[s_Space_CustomFields2]
      ,[s_Space_CustomFields3]
      ,[s_Space_CustomFields4]
      ,[s_Space_CustomFields5]
      ,[s_Space_CustomFields6]
      ,[s_Space_CustomFields7]
      ,[s_Space_CustomFields8]
      ,[s_Space_CustomFields9]
      ,[s_Space_CustomFields10]
      ,[n_Space_state]=(case n_Space_state when 1 then '正常' else '停用' end)
      ,[s_Space_Creator]
      ,[d_Space_CreateTime]
      ,[s_Space_Updator]
      ,[d_Space_UpdateTime]
--[/Columns]
  FROM [dbo].[tSpace] with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tSpace.n_Warehouse_Id
left join tCombinedSpace tCombinedSpace with(nolock) on tCombinedSpace.n_Space_Id = tSpace.n_Space_Id
and tCombinedSpace.n_CombinedSpace_state = 1
where tSpace.n_Rack_Id = @n_Rack_Id
and n_Space_BayNumber = (case when isnull(@Space_BayNumber,'') = '' then n_Space_BayNumber else @Space_BayNumber end) 
and [n_Space_LayerNumber] = (case when isnull(@Space_LayerNumber,'') = '' then [n_Space_LayerNumber] else @Space_LayerNumber end) 
and [s_Space_BarCode] like (case when isnull(@Space_BarCode,'') = '' then [s_Space_BarCode] else '%'+@Space_BarCode+'%' end) 
and n_Space_state = (case when isnull(@Space_state,0) = 0 then n_Space_state else @Space_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"C0E41E09-5A4E-4E3D-BBEA-BB19702EB835"
（1）ParameterName:"@Space_BayNumber" DbType:"AnsiString" Value:""
（2）ParameterName:"@Space_LayerNumber" DbType:"AnsiString" Value:""
（3）ParameterName:"@Space_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@Space_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:53
类型：Query 查询对象：SelSpaceList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tSpace] with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tSpace.n_Warehouse_Id
left join tCombinedSpace tCombinedSpace with(nolock) on tCombinedSpace.n_Space_Id = tSpace.n_Space_Id
and tCombinedSpace.n_CombinedSpace_state = 1
where tSpace.n_Rack_Id = @n_Rack_Id
and n_Space_BayNumber = (case when isnull(@Space_BayNumber,'') = '' then n_Space_BayNumber else @Space_BayNumber end) 
and [n_Space_LayerNumber] = (case when isnull(@Space_LayerNumber,'') = '' then [n_Space_LayerNumber] else @Space_LayerNumber end) 
and [s_Space_BarCode] like (case when isnull(@Space_BarCode,'') = '' then [s_Space_BarCode] else '%'+@Space_BarCode+'%' end) 
and n_Space_state = (case when isnull(@Space_state,0) = 0 then n_Space_state else @Space_state end)
 ) T_RowsCount 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"C0E41E09-5A4E-4E3D-BBEA-BB19702EB835"
（1）ParameterName:"@Space_BayNumber" DbType:"AnsiString" Value:""
（2）ParameterName:"@Space_LayerNumber" DbType:"AnsiString" Value:""
（3）ParameterName:"@Space_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@Space_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:35:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:01
类型：Query 查询对象：SelSpaceNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

--基础数据关联查询
  
select top 1 
 s_Block_Code,
 s_Shopfloor_Code,
 s_Warehouse_Code,
 s_Rack_Code
from tRack tRack with(nolock)
left join tWarehouse tWarehouse with(nolock) on tRack.n_Warehouse_Id = tRack.n_Warehouse_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tRack.n_Block_Id
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = tRack.n_Shopfloor_Id
where tRack.n_Rack_Id = @n_Rack_Id 
and n_Warehouse_state = 1 and tRack.n_Rack_state = 1
and n_Block_state = 1 and n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr

--储位编码最大值
declare @Space_MaxCode varchar(max)

select top 1 @Space_MaxCode = s_Space_Code from tSpace with(nolock)
where n_Rack_Id = @n_Rack_Id and n_Space_state = 1
order by Convert(int,s_Space_Code) desc

select Space_MaxCode = isnull(@Space_MaxCode,0) + 1
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"String" Value:"C0E41E09-5A4E-4E3D-BBEA-BB19702EB835"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:03
类型：Query 查询对象：SelSpace 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT  [tSpace].[n_Rack_Id] 
      ,[s_Space_Code]
      ,tRack.s_Rack_CodePrefix
      ,[s_Space_BarCode]
      ,[n_Space_LayerNumber]
      ,[n_Space_BayNumber]
      ,[n_Space_Position]
      ,[n_Space_MaxPosition]
      ,[s_Space_StorageType]
      ,[n_Space_Warehouse]
      ,[n_Space_Width]
      ,[n_Space_Height]
      ,[n_Space_Length]
      ,[n_Space_ShipmentSequence]
      ,[n_Space_QualityLevel] 
      ,[s_Space_LocationLock]
      ,[s_Space_OverflowLocation]
      ,[n_Space_RestrictedStorageMaterialType]
      ,[s_Space_CustomFields1]
      ,[s_Space_CustomFields2]
      ,[s_Space_CustomFields3]
      ,[s_Space_CustomFields4]
      ,[s_Space_CustomFields5]
      ,[s_Space_CustomFields6]
      ,[s_Space_CustomFields7]
      ,[s_Space_CustomFields8]
      ,[s_Space_CustomFields9]
      ,[s_Space_CustomFields10] 
  FROM [dbo].[tSpace] with(nolock)
  left join tRack tRack with(nolock) on tRack.n_Rack_Id = [tSpace].n_Rack_Id 
  where [n_Space_Id] = @Sel_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"AnsiString" Value:"FB3A662E-72AC-4626-AF87-959BDCA1A797"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:36:54
类型：Business 业务对象：UpdateSpace 
说明：执行业务检查：1.*.指定的所属层与所属列位置已存在，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tSpace with(nolock)
where ((n_Space_LayerNumber = @:n_Space_LayerNumber
and n_Space_BayNumber = @:n_Space_BayNumber) and n_Space_Id<>@:Sel_Id) and n_Space_state = 1) 
begin
     select 1
end
 
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_Space_StorageType" DbType:"AnsiString" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_Space_Width" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@n_Space_Height" DbType:"AnsiString" Value:"null"
（5）ParameterName:"@n_Space_Length" DbType:"AnsiString" Value:"null"
（6）ParameterName:"@n_Space_ShipmentSequence" DbType:"AnsiString" Value:""
（7）ParameterName:"@n_Space_QualityLevel" DbType:"AnsiString" Value:"1"
（8）ParameterName:"@s_Space_LocationLock" DbType:"AnsiString" Value:""
（9）ParameterName:"@s_Space_OverflowLocation" DbType:"AnsiString" Value:""
（10）ParameterName:"@n_Space_RestrictedStorageMaterialType" DbType:"AnsiString" Value:""
（11）ParameterName:"@s_Space_CustomFields1" DbType:"AnsiString" Value:""
（12）ParameterName:"@s_Space_CustomFields2" DbType:"AnsiString" Value:""
（13）ParameterName:"@s_Space_CustomFields3" DbType:"AnsiString" Value:""
（14）ParameterName:"@s_Space_CustomFields4" DbType:"AnsiString" Value:""
（15）ParameterName:"@s_Space_CustomFields5" DbType:"AnsiString" Value:""
（16）ParameterName:"@s_Space_CustomFields6" DbType:"AnsiString" Value:""
（17）ParameterName:"@s_Space_CustomFields7" DbType:"AnsiString" Value:""
（18）ParameterName:"@s_Space_CustomFields8" DbType:"AnsiString" Value:""
（19）ParameterName:"@s_Space_CustomFields9" DbType:"AnsiString" Value:""
（20）ParameterName:"@s_Space_CustomFields10" DbType:"AnsiString" Value:""
（21）ParameterName:"@Sel_Id" DbType:"AnsiString" Value:"FB3A662E-72AC-4626-AF87-959BDCA1A797"
（22）ParameterName:"@s_Space_Code" DbType:"AnsiString" Value:"1"
（23）ParameterName:"@s_Space_BarCode" DbType:"AnsiString" Value:"CS010101"
（24）ParameterName:"@n_Space_LayerNumber" DbType:"AnsiString" Value:"1"
（25）ParameterName:"@n_Space_BayNumber" DbType:"AnsiString" Value:"1"
（26）ParameterName:"@n_Space_Position" DbType:"AnsiString" Value:"第1列的第1层"
（27）ParameterName:"@n_Space_MaxPosition" DbType:"AnsiString" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:48
类型：Query 查询对象：SelOnShelfSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:39:49
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:57
类型：Query 查询对象：SelOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:40:58
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"CF9070A1-DE61-44DD-A6BB-0134EA1DDFC9"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:01
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:04
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:12
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:14
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:20
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201121144113732"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:23
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:41:26
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:42:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:42:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:42:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:00
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:01
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:43:41
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-xjczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:24
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:45:31
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:55:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:55:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:55:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:55:57
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:14
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:56:58
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:57:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:57:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:57:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:57:41
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:44
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:58:53
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:59:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:59:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:59:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 14:59:55
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:14
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98833071911270003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:22
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:42
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:42
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:42
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:43
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：3.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010105"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:43
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：4.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010201"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130003"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98833071911270003"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"500"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:00:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:01:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:01
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:02:02
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:03:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:03:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:03:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:03:58
类型：Query 查询对象：SelPutOnOffSingleBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
       ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:27
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:30
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:36
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
left join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode] order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumberSum,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
left join (select 
[s_ListPutOnOff_GoodsProductCode],sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumberSum
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode] ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @Tab2 where RowId > 1


------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]



------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"7D81A649-D44B-4F25-A96F-78AB6D26D611"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:05:39
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:16:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:16:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:16:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:16:56
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:07
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201121151655992"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"Test"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:10
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:17:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:19:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:19:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:19:25
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"1203130003"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:19:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:19:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:19:34
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98529941911270014"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:21:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:21:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:21:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:21:49
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:23:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:23:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:23:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:23:35
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:24:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:24:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:24:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:24:41
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:35
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:36
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:36
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:36
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:39
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203130001"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:39
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:39
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:39
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:39
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:56
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270014"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:56
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010103"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270014"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:57
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：2.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010104"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270014"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:57
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：3.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010105"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270014"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:26:57
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：4.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010201"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203130001"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"98529941911270014"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"400"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:28:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:28:28
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:10
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:10
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:10
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:49
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"98529941911270014"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:30:51
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:33:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:33:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:33:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:33:54
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:44:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:44:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:44:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:44:45
类型：Query 查询对象：SelPutOnOffSingleSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	ListPutOnOff_Id=n_ListPutOnOff_Id,
    ListPutOnOff_Code=s_ListPutOnOff_Code, 
    ListPutOnOff_GoodsProductCode=s_ListPutOnOff_GoodsProductCode,
        ListPutOnOff_GoodsProductName=(case when len(s_ListPutOnOff_GoodsProductName)>30 then SUBSTRING(s_ListPutOnOff_GoodsProductName,0,30)+ '......' else s_ListPutOnOff_GoodsProductName end),  
    ListPutOnOff_LaunchOperator=s_ListPutOnOff_LaunchOperator, 
    ListPutOnOff_LaunchTime=d_ListPutOnOff_LaunchTime,  
    ListPutOnOff_LaunchOKProductCou=n_ListPutOnOff_LaunchOKProductCou,
	ReportInventoryCurrent_Number=isnull(n_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock)
left join tListPutOnOff tListPutOnOff with(nolock) on tListPutOnOff.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on
tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id and tListPutOnOff.s_ListPutOnOff_GoodsProductCode
= tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1
where n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 and n_ListPutOnOff_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:07
类型：Business 业务对象：UpdatePutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.提交已选择的单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1

update tListStockInOut set 
s_ListStockInOut_WhetherToSubmit = 1,
s_ListStockInOut_Updator = @Operator,
d_ListStockInOut_UpdateTime = getdate()
from tListStockInOut tListStockInOut with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListStockInOut.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListStockInOut_state = 1

update tListPutOnOff set 
s_ListPutOnOff_WhetherToSubmit = 1,
s_ListPutOnOff_Updator = @Operator,
d_ListPutOnOff_UpdateTime = getdate()
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock) on tBillStockInOutDetail.n_BillStockInOutDetail_Id
= tListPutOnOff.n_BillStockInOutDetail_Id
where tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_ListPutOnOff_state = 1

 

--上架单据汇总 将要进行结算 已存在储位记录的货物信息
declare @Tab table(
    n_Space_Id varchar(max),
	s_ListStockInOut_GoodsProductCode varchar(max), 
    n_ReportInventoryCurrent_Number varchar(max),
    n_ReportInventoryCurrent_OKProductCou varchar(max),
    n_ReportInventoryCurrent_UnOKProductCou varchar(max),
    n_ReportInventoryCurrent_ReworkProductCou varchar(max),
	n_BillStockInOutDetail_QualityStatus int 
)

insert into @Tab
(
    n_Space_Id,
	s_ListStockInOut_GoodsProductCode, 
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,
    n_ReportInventoryCurrent_ReworkProductCou,
	n_BillStockInOutDetail_QualityStatus 
)
select 
    tListPutOnOff.n_Space_Id,
	s_ListPutOnOff_GoodsProductCode, 
    sum(isnull(n_ListPutOnOff_LaunchNumber,0)),
    sum(isnull(n_ListPutOnOff_LaunchOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchUnOKProductCou,0)),
    sum(isnull(n_ListPutOnOff_LaunchReworkProductCou,0)),
	n_BillStockInOutDetail_QualityStatus 
from tListPutOnOff tListPutOnOff with(nolock)
left join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = n_BillStockInOutDetail_QualityStatus)
group by tListPutOnOff.n_Space_Id, s_ListPutOnOff_GoodsProductCode,n_BillStockInOutDetail_QualityStatus


 
--判定该货物在该储位是否有记录，有则原先记录中修正数量

update [tReportInventoryCurrent]
set
n_ReportInventoryCurrent_Number = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_Number,0) + Tab.n_ReportInventoryCurrent_Number,
n_ReportInventoryCurrent_OKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 1 then Tab.n_ReportInventoryCurrent_OKProductCou else 0 end),
n_ReportInventoryCurrent_UnOKProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 2 then Tab.n_ReportInventoryCurrent_UnOKProductCou else 0 end),
n_ReportInventoryCurrent_ReworkProductCou = isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(n_BillStockInOutDetail_QualityStatus,1) = 3 then Tab.n_ReportInventoryCurrent_ReworkProductCou else 0 end), 
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = getdate()
from tReportInventoryCurrent with(nolock)
inner join @Tab Tab on Tab.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
and Tab.s_ListStockInOut_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and Tab.n_BillStockInOutDetail_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
where n_ReportInventoryCurrent_state = 1 


------------------------------------------------------

--专用于合并汇总提交上架单据的相同工件的记录数量
declare @Tab2 table(
    RowId int,
    n_ListPutOnOff_Id varchar(max),
	n_ReportInventoryCurrent_Id varchar(max),
	s_ListPutOnOff_GoodsProductCode varchar(max),
	s_ReportInventoryCurrent_Code varchar(max), 
	n_ListPutOnOff_LaunchNumber int,
	n_ListPutOnOff_LaunchOKProductCou int,
	n_ListPutOnOff_LaunchUnOKProductCou int,
	n_ListPutOnOff_LaunchReworkProductCou int
)

insert into @Tab2(
    RowId,
    n_ListPutOnOff_Id,
	n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou  
)
select 
    ROW_NUMBER() over(partition by [s_ListPutOnOff_GoodsProductCode],s_ListPutOnOff_Code order by tListPutOnOff.[n_ReportInventoryCurrent_Id] asc) as RowId,
    n_ListPutOnOff_Id,
	tListPutOnOff.n_ReportInventoryCurrent_Id,
	s_ListPutOnOff_GoodsProductCode,
	s_ListPutOnOff_Code,
	n_ListPutOnOff_LaunchNumber,
	n_ListPutOnOff_LaunchOKProductCou,
	n_ListPutOnOff_LaunchUnOKProductCou,
	n_ListPutOnOff_LaunchReworkProductCou 
from tListPutOnOff tListPutOnOff with(nolock)
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock)
on tListPutOnOff.n_BillStockInOutDetail_Id = tBillStockInOutDetail.n_BillStockInOutDetail_Id
where tListPutOnOff.n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOutDetail_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
   

update @Tab2 set
n_ListPutOnOff_LaunchNumber = Tab.n_ListPutOnOff_LaunchNumberSum,
n_ListPutOnOff_LaunchOKProductCou = Tab.n_ListPutOnOff_LaunchOKProductCou,
n_ListPutOnOff_LaunchUnOKProductCou = Tab.n_ListPutOnOff_LaunchUnOKProductCou,
n_ListPutOnOff_LaunchReworkProductCou = Tab.n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 Tab2
inner join (select 
[s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code,sum(n_ListPutOnOff_LaunchNumber) as n_ListPutOnOff_LaunchNumberSum
,sum(n_ListPutOnOff_LaunchOKProductCou) as n_ListPutOnOff_LaunchOKProductCou
,sum(n_ListPutOnOff_LaunchUnOKProductCou) as n_ListPutOnOff_LaunchUnOKProductCou
,sum(n_ListPutOnOff_LaunchReworkProductCou) as n_ListPutOnOff_LaunchReworkProductCou
from @Tab2 group by [s_ListPutOnOff_GoodsProductCode],s_ReportInventoryCurrent_Code ) Tab on Tab2.[s_ListPutOnOff_GoodsProductCode] = Tab.[s_ListPutOnOff_GoodsProductCode] 
where RowId = 1

delete from @Tab2 where RowId > 1


------------------------------------------------------


--判定该货物在该储位是否有记录，没有则新增对应记录

INSERT INTO [dbo].[tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN] 
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color] 
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
select 
           tListPutOnOff.[n_ReportInventoryCurrent_Id]
		   ,tListPutOnOff.[n_Warehouse_Id]
           ,tListPutOnOff.[n_Shopfloor_Id]
           ,tListPutOnOff.[n_Rack_Id]
           ,tListPutOnOff.[n_Space_Id]
           ,tListPutOnOff.[n_CombinedSpace_Id]
           ,tListPutOnOff.[n_SplitSpace_Id]
           ,tListPutOnOff.[n_Bin_Id]
		   ,''
		   ,s_ListPutOnOff_Code
		   ,[s_ListPutOnOff_ECN] 
		   ,n_ListPutOnOff_QualityStatus
           ,[s_ListPutOnOff_GoodsProductName]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,tListPutOnOff.[s_ListPutOnOff_GoodsProductCode]
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchNumber,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchUnOKProductCou,0))
           ,sum(isnull(Tab2.n_ListPutOnOff_LaunchReworkProductCou,0))
           ,[s_ListPutOnOff_BatchNumber] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color] 
           ,1 
		   ,@Operator
           ,getdate() 
		   ,@Operator
           ,getdate()
from 
tListPutOnOff tListPutOnOff with(nolock)
inner join @Tab2 Tab2  
on tListPutOnOff.n_ListPutOnOff_Id = Tab2.n_ListPutOnOff_Id
where not exists(select 1 from tReportInventoryCurrent with(nolock) 
where n_Space_Id = tListPutOnOff.n_Space_Id and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = tListPutOnOff.s_ListPutOnOff_GoodsProductCode
and s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus)
group by tListPutOnOff.[n_Warehouse_Id],tListPutOnOff.[n_Shopfloor_Id],tListPutOnOff.[n_Rack_Id],tListPutOnOff.[n_Space_Id] ,
tListPutOnOff.[n_CombinedSpace_Id],tListPutOnOff.[n_SplitSpace_Id],tListPutOnOff.[n_Bin_Id] 
,s_ListPutOnOff_Code,[s_ListPutOnOff_ECN],n_ListPutOnOff_QualityStatus
,[s_ListPutOnOff_GoodsProductName],tListPutOnOff.[s_ListPutOnOff_GoodsProductCode],[s_ListPutOnOff_BatchNumber],[s_ListPutOnOff_SpecificationAndModel]
,[s_ListPutOnOff_Unit],[s_ListPutOnOff_Model],[s_ListPutOnOff_Color],tListPutOnOff.[n_ReportInventoryCurrent_Id]



------------------------------------------------
--修正对应上架单据出入库记录与上下架记录的n_ReportInventoryCurrent_Id，因为条码扫描新增的记录的n_ReportInventoryCurrent_Id都是默认给随机
--等到提交单据时才给于准确的n_ReportInventoryCurrent_Id。

update tListPutOnOff 
set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
from tListPutOnOff tListPutOnOff with(nolock)
inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
on tListPutOnOff.s_ListPutOnOff_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
and tReportInventoryCurrent.n_Space_Id = tListPutOnOff.n_Space_Id 
and tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus = tListPutOnOff.n_ListPutOnOff_QualityStatus
inner join tBillStockInOutDetail tBillStockInOutDetail with(nolock) 
on tBillStockInOutDetail.n_BillStockInOutDetail_Id = tListPutOnOff.n_BillStockInOutDetail_Id 
where n_ReportInventoryCurrent_state = 1 and n_ListPutOnOff_state = 1
and tBillStockInOutDetail.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1

update tListStockInOut
set n_ReportInventoryCurrent_Id = tListPutOnOff.n_ReportInventoryCurrent_Id
from tListStockInOut tListStockInOut with(nolock)
inner join  tListPutOnOff tListPutOnOff with(nolock) 
on tListStockInOut.n_ListStockInOut_Id = tListPutOnOff.n_ListStockInOut_Id
where tListStockInOut.n_BillStockInOut_Id  = @n_BillStockInOut_Id

------------------------------------------------
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"5F8565C7-7C4A-4C04-9D9B-F890EE354DC2"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 15:45:10
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:22
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:24
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"799697BA-A934-4466-964F-33ED12D1678C"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:04:27
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:28
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:29
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:38
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201121160729466"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:41
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:07:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:28
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:08:37
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:13:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:13:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:13:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:13:14
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:17:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:17:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:17:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:17:43
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),isnull(n_Space_MaxPosition,0) - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:29
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else n_ReportInventoryCurrent_Number end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull(n_ReportInventoryCurrent_Number,0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:35:47
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else n_ReportInventoryCurrent_Number end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:37:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:37:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:37:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:37:05
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else n_ReportInventoryCurrent_Number end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:46:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:46:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:46:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:46:02
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_ReportInventoryCurrent_GoodsProductCode, 
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc


--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:53:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:53:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:53:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:53:20
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:02
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:03
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:07
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:08
类型：Query 查询对象：SelPutOnOffSingleWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:26
类型：Business 业务对象：InsertPutOnOffSingleBillStockInOut 
说明：执行业务过程[1]：0.新增上架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"RK20201121165508314"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:29
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'RK%'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:32
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:48
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:55:55
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:56:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:56:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:56:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:56:01
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:57:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:57:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:57:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:57:42
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:25
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203100002"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:41
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：0.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"100"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:41
类型：Business 业务对象：InsertPutOnOffSingleListStockInOut 
说明：执行业务过程[1]：1.新增货物入库记录以及上架记录
***************************************************************************************************************
SQL:
----------------------------------------------------------------------------
--根据储位编码获取相应的储位ID，仓库ID，车间ID,货架ID
declare @n_Space_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Warehouse_Id varchar(max)
declare @n_Rack_Id varchar(max)

select @n_Space_Id = n_Space_Id,@n_Shopfloor_Id = n_Shopfloor_Id,@n_Warehouse_Id=n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id
from tSpace with(nolock)
where s_Space_BarCode = @s_ReportInventoryCurrent_Code
and n_Space_state = 1
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max),
@n_GoodsName varchar(max)
,@s_ListStockInOut_SpecificationAndModel varchar(max)
,@s_ListStockInOut_Unit varchar(max)
,@s_ListStockInOut_Model varchar(max)
,@s_ListStockInOut_Color varchar(max)

--查看编码是否是塑件的，如果是则带出该塑件PBOM信息
select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_PlasticParts_Desc
,@s_ListStockInOut_SpecificationAndModel = tPlasticPart_PBOM.s_PartNo,
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series+s_Brand,
@s_ListStockInOut_Color = ''
from TopsERP_BIZ.dbo.tPlasticPart_PBOM with(nolock)
where s_PlasticParts_Code = @s_ReportInventoryCurrent_GoodsProductCode

--如果不是，则查询漆件PBOM表
if(ISNULL(@n_GoodsId,'') = '')
begin

--查询最后一版的漆件PBOM的信息
declare @PBOM_Month varchar(10)

select top 1 @PBOM_Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock)
where n_State = 1
group by s_Month
order by REPLACE(s_Month,'-','') desc

select top 1 @n_GoodsId = n_Id,@n_GoodsName = s_Mother_Desc 
,@s_ListStockInOut_SpecificationAndModel = '',
@s_ListStockInOut_Unit = '根',
@s_ListStockInOut_Model = s_Series,
@s_ListStockInOut_Color = s_Color
 from TopsERP_BIZ.dbo.tPBOM with(nolock)
where s_Month = @PBOM_Month and n_State = 1
and s_MotherCode = @s_ReportInventoryCurrent_GoodsProductCode
order by n_Id desc

end

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_ListStockInOut_BatchNumber varchar(max)

 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select @WorkLogId = n_WorkLogId, @s_ListStockInOut_BatchNumber = s_Batch
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @s_ReportInventoryCurrent_GoodsBarCode
 and n_State = 1

 --获取单据编码
 declare @BillStockInOutCode varchar(max) 

 select 
 @BillStockInOutCode = s_BillStockInOut_Code
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1

-----------------------------------------------------------------------------

declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_ListStockInOut_Id varchar(max) = newID()
declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@BillStockInOutCode
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,''
           ,''
           ,''
           ,@n_BillStockInOut_Id 
           ,null
           ,@s_ReportInventoryCurrent_GoodsBarCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null)



INSERT INTO [dbo].[tListStockInOut]
           ([n_ListStockInOut_Id]
           ,[n_ListStockInOut_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListStockInOut_GoodsId]
           ,[s_ListStockInOut_GoodsProductName]
           ,[s_ListStockInOut_GoodsProductCode]
           ,[n_ListStockInOut_GoodsProductId]
           ,[s_ListStockInOut_ExternalCode]
           ,[s_ListStockInOut_ExternalName]
           ,[s_ListStockInOut_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ListStockInOut_QualityStatus]
           ,[s_ListStockInOut_SpecificationAndModel]
           ,[s_ListStockInOut_Unit]
           ,[s_ListStockInOut_Model]
           ,[s_ListStockInOut_Color]
           ,[s_ListStockInOut_BatchNumber]
           ,[d_ListStockInOut_WarehousingTime]
           ,[n_ListStockInOut_WarehousingQuantity]
           ,[n_ListStockInOut_WarehousingOKProductCou]
           ,[n_ListStockInOut_WarehousingUnOKProductCou]
           ,[n_ListStockInOut_WarehousingReworkProductCou]
           ,[s_ListStockInOut_WarehousingOperator]
           ,[s_ListStockInOut_WarehousingClasses]
		   ,[n_ListStockInOut_WarehousingSequence] 
           ,[n_WarehousingReason_Id]
           ,[s_WarehousingReason_Name]
           ,[n_WarehousingReason_Type]  
           ,[s_ListStockInOut_WhetherToSubmit]
           ,[n_ListStockInOut_state]
           ,[s_ListStockInOut_Creator]
           ,[d_ListStockInOut_CreateTime]
           ,[s_ListStockInOut_Updator]
           ,[d_ListStockInOut_UpdateTime])
     VALUES
           (@n_ListStockInOut_Id
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,''
           ,''
           ,@s_ListStockInOut_QualityStatus 
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color  
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,1
		   ,''
           ,''
           ,''
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()) 


		   
INSERT INTO [dbo].[tListPutOnOff]
           ([n_ListPutOnOff_Id]
           ,[n_ListPutOnOff_ParentId]
           ,[s_BillStockInOut_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_ListStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_Bin_Id]
		   ,n_ReportInventoryCurrent_Id
           ,[n_ListPutOnOff_GoodsId]
           ,[s_ListPutOnOff_Code]
           ,[s_ListPutOnOff_GoodsProductName]
           ,[s_ListPutOnOff_GoodsProductCode]
           ,[n_ListPutOnOff_GoodsProductId]
           ,[s_ListPutOnOff_ExternalCode]
           ,[s_ListPutOnOff_ExternalName]
           ,[s_ListPutOnOff_ECN] 
           ,[s_ListPutOnOff_SpecificationAndModel]
           ,[s_ListPutOnOff_Unit]
           ,[s_ListPutOnOff_Model]
           ,[s_ListPutOnOff_Color]
		   ,[n_ListPutOnOff_QualityStatus]
           ,[s_ListPutOnOff_BatchNumber]
           ,[d_ListPutOnOff_LaunchTime]
           ,[n_ListPutOnOff_LaunchNumber]
           ,[n_ListPutOnOff_LaunchOKProductCou]
           ,[n_ListPutOnOff_LaunchUnOKProductCou]
           ,[n_ListPutOnOff_LaunchReworkProductCou]
           ,[s_ListPutOnOff_LaunchOperator]
           ,[s_ListPutOnOff_LaunchClasses] 
           ,[n_LaunchReason_Id]
           ,[n_LaunchReason_Name]
           ,[n_ListPutOnOff_LaunchType]
           ,[n_ListPutOnOff_LaunchSequence] 
           ,[s_ListPutOnOff_WhetherToSubmit]
           ,[n_ListPutOnOff_state]
           ,[s_ListPutOnOff_Creator]
           ,[d_ListPutOnOff_CreateTime]
           ,[s_ListPutOnOff_Updator]
           ,[d_ListPutOnOff_UpdateTime])
     VALUES
           (newID()
           ,''
           ,@s_ReportInventoryCurrent_Code
           ,@n_Warehouse_Id 
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
           ,@n_ListStockInOut_Id 
           ,@n_BillStockInOutDetail_Id 
           ,''
		   ,@n_ReportInventoryCurrent_Id
           ,@WorkLogId
           ,@s_ReportInventoryCurrent_Code
           ,@n_GoodsName
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsId
           ,@s_ReportInventoryCurrent_GoodsProductCode
           ,@n_GoodsName
           ,''
           ,@s_ListStockInOut_SpecificationAndModel 
           ,@s_ListStockInOut_Unit 
           ,@s_ListStockInOut_Model 
           ,@s_ListStockInOut_Color 
		   ,@s_ListStockInOut_QualityStatus
           ,@s_ListStockInOut_BatchNumber
           ,getdate()
           ,@s_ReportInventoryCurrent_UpNumber
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
           ,@Operator
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
 
		   ,''
           ,''
           ,1
           ,1
           
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate())

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @s_ReportInventoryCurrent_UpNumber
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 



----判定该货物在该储位是否有记录，没有则新增一条记录
--if exists(select 1 from tReportInventoryCurrent with(nolock) 
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus)
--begin 
 

--INSERT INTO [dbo].[tReportInventoryCurrent]
--           ([n_ReportInventoryCurrent_Id]
--           ,[n_Warehouse_Id]
--           ,[n_Shopfloor_Id]
--           ,[n_Rack_Id]
--           ,[n_Space_Id]
--           ,[n_CombinedSpace_Id]
--           ,[n_SplitSpace_Id]
--           ,[n_Bin_Id]
--           ,[n_ReportInventoryCurrent_GoodsId]
--           ,[s_ReportInventoryCurrent_Code]
--           ,[s_ReportInventoryCurrent_ECN] 
--           ,[s_ReportInventoryCurrent_QualityStatus]
--           ,[s_ReportInventoryCurrent_GoodsProductName]
--           ,[s_ReportInventoryCurrent_GoodsProductCode]
--           ,[s_ReportInventoryCurrent_ExternalCode]
--           ,[n_ReportInventoryCurrent_Number]
--           ,[n_ReportInventoryCurrent_OKProductCou]
--           ,[n_ReportInventoryCurrent_UnOKProductCou]
--           ,[n_ReportInventoryCurrent_ReworkProductCou]
--           ,[s_ReportInventoryCurrent_BatchNumber]
--           ,[s_ReportInventoryCurrent_SpecificationAndModel]
--           ,[s_ReportInventoryCurrent_Unit]
--           ,[s_ReportInventoryCurrent_Model]
--           ,[s_ReportInventoryCurrent_Color] 
--           ,[n_ReportInventoryCurrent_state]
--           ,[s_ReportInventoryCurrent_Creator]
--           ,[d_ReportInventoryCurrent_CreateTime]
--           ,[s_ReportInventoryCurrent_Updator]
--           ,[d_ReportInventoryCurrent_UpdateTime])
--     VALUES
--           (@n_ReportInventoryCurrent_Id
--           ,@n_Warehouse_Id 
--           ,@n_Shopfloor_Id 
--           ,@n_Rack_Id 
--           ,@n_Space_Id 
--           ,''
--           ,''
--           ,''
--           ,@n_GoodsId
--           ,@s_ReportInventoryCurrent_Code
--           ,''
--           ,@s_ListStockInOut_QualityStatus
--           ,@n_GoodsName
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_GoodsProductCode
--           ,@s_ReportInventoryCurrent_UpNumber
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end)
--           ,(case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end) 
--           ,@s_ListStockInOut_BatchNumber
--           ,@s_ListStockInOut_SpecificationAndModel 
--           ,@s_ListStockInOut_Unit 
--           ,@s_ListStockInOut_Model 
--           ,@s_ListStockInOut_Color 
--           ,1
--           ,@Operator
--           ,getdate()
--           ,@Operator
--           ,getdate())
  

--end
--else
--begin

--update [tReportInventoryCurrent]
--set
--n_ReportInventoryCurrent_Number = isnull(n_ReportInventoryCurrent_Number,0) + @s_ReportInventoryCurrent_UpNumber,
--n_ReportInventoryCurrent_OKProductCou = isnull(n_ReportInventoryCurrent_OKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 1 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_UnOKProductCou = isnull(n_ReportInventoryCurrent_UnOKProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 2 then @s_ReportInventoryCurrent_UpNumber else 0 end),
--n_ReportInventoryCurrent_ReworkProductCou = isnull(n_ReportInventoryCurrent_ReworkProductCou,0) + (case when isnull(@s_ListStockInOut_QualityStatus,1) = 3 then @s_ReportInventoryCurrent_UpNumber else 0 end), 
--s_ReportInventoryCurrent_Updator = @Operator
--d_ReportInventoryCurrent_UpdateTime = getdate()
--where n_Space_Id = @n_Space_Id and n_ReportInventoryCurrent_state = 1
--and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
--and s_ReportInventoryCurrent_QualityStatus = @s_ListStockInOut_QualityStatus 

--end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010102"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1203100002"
（4）ParameterName:"@s_ReportInventoryCurrent_GoodsBarCode" DbType:"String" Value:"84917882009240001"
（5）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"93D1CDF4-FA2D-47A8-ABE5-E9EE5D4FECCA"
（6）ParameterName:"@s_ListStockInOut_QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@s_ReportInventoryCurrent_UpNumber" DbType:"String" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:53
类型：Query 查询对象：SelPutOnOffSingleGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
  
 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 
  

 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode = @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:58:59
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:59:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:59:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:59:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/21 16:59:29
类型：Query 查询对象：SelPutOnOffSingleReportInventoryCurrent 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--库位信息表
declare @table table(
    s_ReportInventoryCurrent_GoodsProductCode varchar(50),
	s_ReportInventoryCurrent_Code varchar(50),
	s_ReportInventoryCurrent_SurplusNumber varchar(50),
	n_Space_ShipmentSequence int
)

--根据货物编码匹配的已占据产品的库位的信息
insert into @table(
    s_ReportInventoryCurrent_GoodsProductCode,
	s_ReportInventoryCurrent_Code,
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
@s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_Code,
(case isnull([n_Space_MaxPosition],'0') when '0' then '---' else Convert(varchar(20),n_Space_MaxPosition - n_ReportInventoryCurrent_Number) end),
n_Space_ShipmentSequence
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id 
where n_ReportInventoryCurrent_state = 1 and n_Space_state = 1
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
group by s_ReportInventoryCurrent_Code,[n_Space_MaxPosition],n_ReportInventoryCurrent_Number,n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc
 

--根据货物编码匹配的未占据产品的库位的信息
insert into @table(
	s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_GoodsProductCode, 
	s_ReportInventoryCurrent_SurplusNumber,
	n_Space_ShipmentSequence
)
select 
s_Space_BarCode,
@s_ReportInventoryCurrent_GoodsProductCode,
(case Convert(varchar(20),isnull([n_Space_MaxPosition],0)) when '0' then '---' else Convert(varchar(20),isnull([n_Space_MaxPosition],0)) end) as n_Space_MaxPosition,
n_Space_ShipmentSequence
from tSpace with(nolock)
where n_Space_state = 1 
and tSpace.n_Warehouse_Id = @n_Warehouse_Id
and not exists (select 1 from @table where s_ReportInventoryCurrent_Code = s_Space_BarCode)
order by n_Space_ShipmentSequence asc

select * from @table where s_ReportInventoryCurrent_SurplusNumber = '---' or Convert(int,s_ReportInventoryCurrent_SurplusNumber) > 0

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1203040019"
（1）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^