
**************************************************************************************************************------>2020/12/12 10:52:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 10:52:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 10:52:33
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务过程[1]：0.新增移库移位记录
***************************************************************************************************************
SQL:
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)

 select 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id
 from tSpace tSpace with(nolock)
 where s_Space_Code = @NewSpaceBarCode
 and n_Space_state = 1
  
  --获取到移位单据的单据编码
  declare @s_BillStockInOut_Code varchar(max)
  select top 1
  @s_BillStockInOut_Code = s_BillStockInOut_Code
  from tBillStockInOut with(nolock)
  where n_BillStockInOut_Id = @n_BillStockInOut_Id 
  and n_BillStockInOut_state = 1

declare @n_BillStockInOutDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity]
           ,[s_BillStockInOutDetail_CustomFields1]
           ,[s_BillStockInOutDetail_CustomFields2]
           ,[s_BillStockInOutDetail_CustomFields3]
           ,[s_BillStockInOutDetail_CustomFields4]
           ,[s_BillStockInOutDetail_CustomFields5]
           ,[s_BillStockInOutDetail_CustomFields6]
           ,[s_BillStockInOutDetail_CustomFields7]
           ,[s_BillStockInOutDetail_CustomFields8]
           ,[s_BillStockInOutDetail_CustomFields9]
           ,[s_BillStockInOutDetail_CustomFields10]
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     select 
	       top 1
	       @n_BillStockInOutDetail_Id
           ,@s_BillStockInOut_Code
           ,tReportInventoryCurrentDetail.n_Warehouse_Id
           ,tReportInventoryCurrentDetail.n_Shopfloor_Id
           ,tReportInventoryCurrentDetail.n_Rack_Id
           ,tReportInventoryCurrentDetail.n_Space_Id
           ,tReportInventoryCurrentDetail.n_CombinedSpace_Id
           ,tReportInventoryCurrentDetail.n_SplitSpace_Id
           ,tReportInventoryCurrentDetail.n_Bin_Id
           ,@n_BillStockInOut_Id
           ,tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
           ,@BarCode
           ,n_ReportInventoryCurrentDetail_GoodsId
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,s_ReportInventoryCurrentDetail_GoodsProductName
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,s_ReportInventoryCurrentDetail_GoodsProductName
           ,s_ReportInventoryCurrentDetail_ECN
           ,tReportInventoryCurrentDetail.n_APQPStatus_Id
           ,tReportInventoryCurrentDetail.s_APQPStatus_Name
           ,s_ReportInventoryCurrentDetail_QualityStatus
           ,@Operator
           ,''
           ,(case when DATEPART(HOUR,getdate()) >= 8 and DATEPART(HOUR,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@SureAmount
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 1 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 2 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 3 then @SureAmount else 0 end) 
           ,0
           ,s_ReportInventoryCurrentDetail_CustomFields1
           ,s_ReportInventoryCurrentDetail_CustomFields2
           ,s_ReportInventoryCurrentDetail_CustomFields3
           ,s_ReportInventoryCurrentDetail_CustomFields4
           ,s_ReportInventoryCurrentDetail_CustomFields5
           ,s_ReportInventoryCurrentDetail_CustomFields6
           ,s_ReportInventoryCurrentDetail_CustomFields7
           ,s_ReportInventoryCurrentDetail_CustomFields8
           ,s_ReportInventoryCurrentDetail_CustomFields9
           ,s_ReportInventoryCurrentDetail_CustomFields10
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
		    where n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id 
		   and n_ReportInventoryCurrentDetail_state = 1
		      
			   


INSERT INTO [dbo].[tRecordTransfer]
           ([n_RecordTransfer_Id]
           ,[n_RecordTransfer_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_RecordTransfer_GoodsId]
           ,[s_BillStockInOut_Code]
           ,[s_RecordTransfer_ExternalCode]
           ,[s_RecordTransfer_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[n_RecordTransfer_QualityStatus]
           ,[s_RecordTransfer_GoodsProductName]
           ,[s_RecordTransfer_GoodsProductCode]
           ,[n_RecordTransfer_Number]
           ,[n_RecordTransfer_OKProductCou]
           ,[n_RecordTransfer_UnOKProductCou]
           ,[n_RecordTransfer_ReworkProductCou] 
           ,[s_RecordTransfer_SpecificationAndModel]
           ,[s_RecordTransfer_Unit]
           ,[s_RecordTransfer_Model]
           ,[s_RecordTransfer_Color]
           ,[s_RecordTransfer_BatchNumber]
           ,[n_TargetWarehouse_Id]
           ,[n_TargetShopfloor_Id]
           ,[n_TargetReck_Id]
           ,[n_TargetSpace_Id]
           ,[n_TargetCombinedSpace_Id]
           ,[n_TargetSplitSpace_Id]
		   ,n_TargetRecordTransfer_Number
		   ,n_TargetRecordTransfer_OKProductCou
		   ,n_TargetRecordTransfer_UnOKProductCou
		   ,n_TargetRecordTransfer_ReworkProductCou
           ,[s_RecordTransfer_CustomFields1]
           ,[s_RecordTransfer_CustomFields2]
           ,[s_RecordTransfer_CustomFields3]
           ,[s_RecordTransfer_CustomFields4]
           ,[s_RecordTransfer_CustomFields5]
           ,[s_RecordTransfer_CustomFields6]
           ,[s_RecordTransfer_CustomFields7]
           ,[s_RecordTransfer_CustomFields8]
           ,[s_RecordTransfer_CustomFields9]
           ,[s_RecordTransfer_CustomFields10]
           ,[n_RecordTransfer_state]
           ,[s_RecordTransfer_Creator]
           ,[d_RecordTransfer_CreateTime]
           ,[s_RecordTransfer_Updator]
           ,[d_RecordTransfer_UpdateTime])
     select
	       top 1
	       newID()
           ,@BarCode
           ,tReportInventoryCurrentDetail.n_Warehouse_Id
           ,tReportInventoryCurrentDetail.n_Shopfloor_Id
           ,tReportInventoryCurrentDetail.n_Rack_Id
           ,tReportInventoryCurrentDetail.n_Space_Id
           ,tReportInventoryCurrentDetail.n_CombinedSpace_Id
           ,tReportInventoryCurrentDetail.n_SplitSpace_Id
           ,tReportInventoryCurrentDetail.n_Bin_Id
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
           ,n_ReportInventoryCurrentDetail_Id
           ,n_ReportInventoryCurrentDetail_GoodsId
           ,@s_BillStockInOut_Code 
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,s_ReportInventoryCurrentDetail_ECN
           ,tReportInventoryCurrentDetail.n_APQPStatus_Id
           ,tReportInventoryCurrentDetail.s_APQPStatus_Name
           ,s_ReportInventoryCurrentDetail_QualityStatus
           ,s_ReportInventoryCurrentDetail_GoodsProductName
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,n_ReportInventoryCurrentDetail_Number
           ,n_ReportInventoryCurrentDetail_OKProductCou
           ,n_ReportInventoryCurrentDetail_UnOKProductCou
           ,n_ReportInventoryCurrentDetail_ReworkProductCou
           ,s_ReportInventoryCurrentDetail_SpecificationAndModel
           ,s_ReportInventoryCurrentDetail_Unit
           ,s_ReportInventoryCurrentDetail_Model
           ,s_ReportInventoryCurrentDetail_Color
           ,s_ReportInventoryCurrentDetail_BatchNumber
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
		   ,@SureAmount
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 1 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 2 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 3 then @SureAmount else 0 end) 
           ,s_ReportInventoryCurrentDetail_CustomFields1
           ,s_ReportInventoryCurrentDetail_CustomFields2
           ,s_ReportInventoryCurrentDetail_CustomFields3
           ,s_ReportInventoryCurrentDetail_CustomFields4
           ,s_ReportInventoryCurrentDetail_CustomFields5
           ,s_ReportInventoryCurrentDetail_CustomFields6
           ,s_ReportInventoryCurrentDetail_CustomFields7
           ,s_ReportInventoryCurrentDetail_CustomFields8
           ,s_ReportInventoryCurrentDetail_CustomFields9
           ,s_ReportInventoryCurrentDetail_CustomFields10
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
		   where n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id 
		   and n_ReportInventoryCurrentDetail_state = 1
		     
 

           --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060209"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 10:52:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 10:52:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 10:52:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 10:52:34
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:03:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:30
类型：Query 查询对象：SelDisplacementGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max), 
	 n_ReportInventoryCurrent_Id varchar(max),  
	 n_ReportInventoryCurrentDetail_Id varchar(max),  
	 s_SurplusAmount int
 )

 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 

 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
inner join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode =  @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 declare @n_ReportInventoryCurrent_Number int 
 declare @n_ReportInventoryCurrent_Id varchar(max)
 declare @n_ReportInventoryCurrentDetail_Id varchar(max)

 select  
 @n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
 @n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id 
 from @Tab tab
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
 on tab.s_MotherCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 where n_ReportInventoryCurrentDetail_state = 1
 and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
 and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrentDetail_Number > 0 

  select 
  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)  
 from @Tab tab
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
 on tab.s_MotherCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber 
 where n_ReportInventoryCurrentDetail_state = 1
 and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
 and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrentDetail_Number > 0 


  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
 n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id
  

  select * from @Tab
  where n_ReportInventoryCurrent_Id is not null
  or n_ReportInventoryCurrentDetail_Id is not null
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74481891911270002"
（1）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"CS060109"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:39
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请录入相关储位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_Code = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060209"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:05:44
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请录入相关储位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_Code = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060209"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:06:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:06:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:06:40
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码不存在，请在系统维护好相关库位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_Code = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060209"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:06:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:06:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:06:58
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请维护好相关库位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_Code = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060209"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:07:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:07:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:07:53
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请维护好相关库位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_Code = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060108"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:08:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:08:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:08:08
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请维护好相关库位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_Code = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS030101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:11
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请维护好相关库位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_BarCode = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS060209"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:25
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务检查：1.0.该目标库位码在系统中不存在，请维护好相关库位信息
***************************************************************************************************************
SQL:
 
 if exists(select 1
 from tSpace tSpace with(nolock)
 where s_Space_BarCode = @:NewSpaceBarCode
 and n_Space_state = 1)
 begin

    select 1

 end


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS030101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:25
类型：Business 业务对象：InsertDisplacementRecordTransfer 
说明：执行业务过程[1]：0.新增移库移位记录
***************************************************************************************************************
SQL:
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)

 select 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id
 from tSpace tSpace with(nolock)
 where s_Space_BarCode = @NewSpaceBarCode
 and n_Space_state = 1
  
  --获取到移位单据的单据编码
  declare @s_BillStockInOut_Code varchar(max)
  select top 1
  @s_BillStockInOut_Code = s_BillStockInOut_Code
  from tBillStockInOut with(nolock)
  where n_BillStockInOut_Id = @n_BillStockInOut_Id 
  and n_BillStockInOut_state = 1

declare @n_BillStockInOutDetail_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[n_BillStockInOutDetail_QualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity]
           ,[s_BillStockInOutDetail_CustomFields1]
           ,[s_BillStockInOutDetail_CustomFields2]
           ,[s_BillStockInOutDetail_CustomFields3]
           ,[s_BillStockInOutDetail_CustomFields4]
           ,[s_BillStockInOutDetail_CustomFields5]
           ,[s_BillStockInOutDetail_CustomFields6]
           ,[s_BillStockInOutDetail_CustomFields7]
           ,[s_BillStockInOutDetail_CustomFields8]
           ,[s_BillStockInOutDetail_CustomFields9]
           ,[s_BillStockInOutDetail_CustomFields10]
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime]
           ,[s_BillStockInOutDetail_ReceivePerson]
           ,[s_BillStockInOutDetail_ReceiveTime]
           ,[s_BillStockInOutDetail_RejectPerson]
           ,[s_BillStockInOutDetail_RejectTime])
     select 
	       top 1
	       @n_BillStockInOutDetail_Id
           ,@s_BillStockInOut_Code
           ,tReportInventoryCurrentDetail.n_Warehouse_Id
           ,tReportInventoryCurrentDetail.n_Shopfloor_Id
           ,tReportInventoryCurrentDetail.n_Rack_Id
           ,tReportInventoryCurrentDetail.n_Space_Id
           ,tReportInventoryCurrentDetail.n_CombinedSpace_Id
           ,tReportInventoryCurrentDetail.n_SplitSpace_Id
           ,tReportInventoryCurrentDetail.n_Bin_Id
           ,@n_BillStockInOut_Id
           ,tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
           ,@BarCode
           ,n_ReportInventoryCurrentDetail_GoodsId
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,s_ReportInventoryCurrentDetail_GoodsProductName
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,s_ReportInventoryCurrentDetail_GoodsProductName
           ,s_ReportInventoryCurrentDetail_ECN
           ,tReportInventoryCurrentDetail.n_APQPStatus_Id
           ,tReportInventoryCurrentDetail.s_APQPStatus_Name
           ,s_ReportInventoryCurrentDetail_QualityStatus
           ,@Operator
           ,''
           ,(case when DATEPART(HOUR,getdate()) >= 8 and DATEPART(HOUR,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@SureAmount
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 1 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 2 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 3 then @SureAmount else 0 end) 
           ,0
           ,s_ReportInventoryCurrentDetail_CustomFields1
           ,s_ReportInventoryCurrentDetail_CustomFields2
           ,s_ReportInventoryCurrentDetail_CustomFields3
           ,s_ReportInventoryCurrentDetail_CustomFields4
           ,s_ReportInventoryCurrentDetail_CustomFields5
           ,s_ReportInventoryCurrentDetail_CustomFields6
           ,s_ReportInventoryCurrentDetail_CustomFields7
           ,s_ReportInventoryCurrentDetail_CustomFields8
           ,s_ReportInventoryCurrentDetail_CustomFields9
           ,s_ReportInventoryCurrentDetail_CustomFields10
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           ,null
           ,null
           ,null
           ,null
from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
		    where n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id 
		   and n_ReportInventoryCurrentDetail_state = 1
		      
			   


INSERT INTO [dbo].[tRecordTransfer]
           ([n_RecordTransfer_Id]
           ,[n_RecordTransfer_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id]
           ,[n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_RecordTransfer_GoodsId]
           ,[s_BillStockInOut_Code]
           ,[s_RecordTransfer_ExternalCode]
           ,[s_RecordTransfer_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[n_RecordTransfer_QualityStatus]
           ,[s_RecordTransfer_GoodsProductName]
           ,[s_RecordTransfer_GoodsProductCode]
           ,[n_RecordTransfer_Number]
           ,[n_RecordTransfer_OKProductCou]
           ,[n_RecordTransfer_UnOKProductCou]
           ,[n_RecordTransfer_ReworkProductCou] 
           ,[s_RecordTransfer_SpecificationAndModel]
           ,[s_RecordTransfer_Unit]
           ,[s_RecordTransfer_Model]
           ,[s_RecordTransfer_Color]
           ,[s_RecordTransfer_BatchNumber]
           ,[n_TargetWarehouse_Id]
           ,[n_TargetShopfloor_Id]
           ,[n_TargetReck_Id]
           ,[n_TargetSpace_Id]
           ,[n_TargetCombinedSpace_Id]
           ,[n_TargetSplitSpace_Id]
		   ,n_TargetRecordTransfer_Number
		   ,n_TargetRecordTransfer_OKProductCou
		   ,n_TargetRecordTransfer_UnOKProductCou
		   ,n_TargetRecordTransfer_ReworkProductCou
           ,[s_RecordTransfer_CustomFields1]
           ,[s_RecordTransfer_CustomFields2]
           ,[s_RecordTransfer_CustomFields3]
           ,[s_RecordTransfer_CustomFields4]
           ,[s_RecordTransfer_CustomFields5]
           ,[s_RecordTransfer_CustomFields6]
           ,[s_RecordTransfer_CustomFields7]
           ,[s_RecordTransfer_CustomFields8]
           ,[s_RecordTransfer_CustomFields9]
           ,[s_RecordTransfer_CustomFields10]
           ,[n_RecordTransfer_state]
           ,[s_RecordTransfer_Creator]
           ,[d_RecordTransfer_CreateTime]
           ,[s_RecordTransfer_Updator]
           ,[d_RecordTransfer_UpdateTime])
     select
	       top 1
	       newID()
           ,@BarCode
           ,tReportInventoryCurrentDetail.n_Warehouse_Id
           ,tReportInventoryCurrentDetail.n_Shopfloor_Id
           ,tReportInventoryCurrentDetail.n_Rack_Id
           ,tReportInventoryCurrentDetail.n_Space_Id
           ,tReportInventoryCurrentDetail.n_CombinedSpace_Id
           ,tReportInventoryCurrentDetail.n_SplitSpace_Id
           ,tReportInventoryCurrentDetail.n_Bin_Id
           ,@n_BillStockInOut_Id
           ,@n_BillStockInOutDetail_Id
           ,tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
           ,n_ReportInventoryCurrentDetail_Id
           ,n_ReportInventoryCurrentDetail_GoodsId
           ,@s_BillStockInOut_Code 
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,s_ReportInventoryCurrentDetail_ECN
           ,tReportInventoryCurrentDetail.n_APQPStatus_Id
           ,tReportInventoryCurrentDetail.s_APQPStatus_Name
           ,s_ReportInventoryCurrentDetail_QualityStatus
           ,s_ReportInventoryCurrentDetail_GoodsProductName
           ,s_ReportInventoryCurrentDetail_GoodsProductCode
           ,n_ReportInventoryCurrentDetail_Number
           ,n_ReportInventoryCurrentDetail_OKProductCou
           ,n_ReportInventoryCurrentDetail_UnOKProductCou
           ,n_ReportInventoryCurrentDetail_ReworkProductCou
           ,s_ReportInventoryCurrentDetail_SpecificationAndModel
           ,s_ReportInventoryCurrentDetail_Unit
           ,s_ReportInventoryCurrentDetail_Model
           ,s_ReportInventoryCurrentDetail_Color
           ,s_ReportInventoryCurrentDetail_BatchNumber
           ,@n_Warehouse_Id
           ,@n_Shopfloor_Id 
           ,@n_Rack_Id 
           ,@n_Space_Id 
           ,''
           ,''
		   ,@SureAmount
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 1 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 2 then @SureAmount else 0 end)
		   ,(case isnull(s_ReportInventoryCurrentDetail_QualityStatus,0) when 3 then @SureAmount else 0 end) 
           ,s_ReportInventoryCurrentDetail_CustomFields1
           ,s_ReportInventoryCurrentDetail_CustomFields2
           ,s_ReportInventoryCurrentDetail_CustomFields3
           ,s_ReportInventoryCurrentDetail_CustomFields4
           ,s_ReportInventoryCurrentDetail_CustomFields5
           ,s_ReportInventoryCurrentDetail_CustomFields6
           ,s_ReportInventoryCurrentDetail_CustomFields7
           ,s_ReportInventoryCurrentDetail_CustomFields8
           ,s_ReportInventoryCurrentDetail_CustomFields9
           ,s_ReportInventoryCurrentDetail_CustomFields10
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
		   where n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id 
		   and n_ReportInventoryCurrentDetail_state = 1
		     
 

           --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@NewSpaceBarCode" DbType:"String" Value:"CS030101"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BarCode" DbType:"String" Value:"74481891911270002"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:"A7D42F24-3445-4CA3-A64F-60220F9A5F30"
（5）ParameterName:"@SureAmount" DbType:"String" Value:"10"
（6）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:27
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:09:34
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
and n_Bin_State = 1 
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:10:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:10:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:10:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:10:49
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
and n_Bin_State = 1 
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:12:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:12:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:12:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:12:41
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:14
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:30
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:13:46
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"Displacement"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"Displacement"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除盘点单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增移位单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertDisplacementRecordTransfer"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增移库移位记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:26
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:26
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:26
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementNewWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 11:18:26
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除移位单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:07:26
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:07:26
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:07:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"Displacement"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"Displacement"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除盘点单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增移位单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertDisplacementRecordTransfer"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增移库移位记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementNewWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除移位单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:11:15
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：9.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementSubmitBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询需提交的移位单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:23
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:23
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:23
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:24
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:29
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:29
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:33
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:39
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:43
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementSubmitBillStockInOutDetails"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:49
类型：Query 查询对象：SelDisplacementBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number,
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock) 
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id
where n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:51
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:12:57
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:10
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:14
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"1C37CF65-54C1-4005-AF97-32B0A55F782B"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:15
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:18
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"1C37CF65-54C1-4005-AF97-32B0A55F782B"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:20
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:23
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:36
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordInventoryMoveCount_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:13:56
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:54:03
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"5A6FC2A599F20E86"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:54:03
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"5A6FC2A599F20E86"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:54:10
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:54:10
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 13:54:10
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:02
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:03
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:32
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:40
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"Displacement"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:40
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"Displacement"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:40
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除盘点单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:40
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除移位单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增移位单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertDisplacementRecordTransfer"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增移库移位记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementNewWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询移位单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：9.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementSubmitBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询需提交的移位单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:18:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：10.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（4）ParameterName:"@PowerID" DbType:"String" Value:"UpdateDisplacementListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交已选择的移位单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:33
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:33
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:33
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:33
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:36
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:41
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcznew"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:42
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-ywczs"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"DelDisplacementNewBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelDisplacementSubmitBillStockInOutDetails"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:45
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：2.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"UpdateDisplacementListStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:20:50
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:21:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:21:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:21:04
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1

	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin
    
	declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and n_ReportInventoryCurrentDetail_state = 1


	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:23:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:23:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:23:15
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1

	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin
    
	declare @n_ReportInventoryCurrent_Id varchar(max) = newID()


	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1


	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:38:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:38:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:38:36
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = tReportInventoryCurrent.n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  
 
 declare @n_ReportInventoryCurrent_Id varchar(max) = newID()

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrentDetail.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
 and RC.s_RecordTransfer_BatchNumber = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1
	 

 end
 else
 begin
     

	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1



 end


 if exists(select 1 from tReportInventoryCurrent with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrent.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_state = 1)
 begin
     
	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin

 
	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:30
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:39:32
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = tReportInventoryCurrent.n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  
 
 declare @n_ReportInventoryCurrent_Id varchar(max) = newID()

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrentDetail.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
 and RC.s_RecordTransfer_BatchNumber = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1
	 

 end
 else
 begin
     

	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1



 end


 if exists(select 1 from tReportInventoryCurrent with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrent.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_state = 1)
 begin
     
	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case RC.s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case RC.s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case RC.s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin

 
	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case RC.s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:40:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:40:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:40:38
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = tReportInventoryCurrent.n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  
 
 declare @n_ReportInventoryCurrent_Id varchar(max) = newID()

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrentDetail.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
 and RC.s_RecordTransfer_BatchNumber = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1
	 

 end
 else
 begin
     

	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case RecordTransfer when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case RecordTransfer when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case RecordTransfer when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1



 end


 if exists(select 1 from tReportInventoryCurrent with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrent.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_state = 1)
 begin
     
	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case RecordTransfer when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case RecordTransfer when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case RecordTransfer when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin

 
	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case RecordTransfer when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case RecordTransfer when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case RecordTransfer when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:11
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:41:14
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = tReportInventoryCurrent.n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  
 
 declare @n_ReportInventoryCurrent_Id varchar(max) = newID()

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrentDetail.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
 and RC.s_RecordTransfer_BatchNumber = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1
	 

 end
 else
 begin
     

	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case n_RecordTransfer_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case n_RecordTransfer_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case n_RecordTransfer_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1



 end


 if exists(select 1 from tReportInventoryCurrent with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrent.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_state = 1)
 begin
     
	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case n_RecordTransfer_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case n_RecordTransfer_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case n_RecordTransfer_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin

 
	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case n_RecordTransfer_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case n_RecordTransfer_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case n_RecordTransfer_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:33
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:36
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 

 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = tReportInventoryCurrent.n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  
 
 declare @n_ReportInventoryCurrent_Id varchar(max) = newID()

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrentDetail.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
 and RC.s_RecordTransfer_BatchNumber = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1
	 

 end
 else
 begin
     

	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case s_RecordTransfer_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_RecordTransfer_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_RecordTransfer_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1



 end


 if exists(select 1 from tReportInventoryCurrent with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrent.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_state = 1)
 begin
     
	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin

 
	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:42:39
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:11
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:55:37
类型：Query 查询对象：SelDisplacementSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_ReportInventoryCurrentDetail_Id,
	RecordTransfer_Id=n_RecordTransfer_Id,
    RecordTransfer_OldSpaceCode=OldSpace.s_Space_BarCode, 
    RecordTransfer_NewSpaceCode=NewSpace.s_Space_BarCode, 
	RecordTransfer_BinCode = tBin.s_Bin_Code,
    RecordTransfer_GoodsProductCode=tRecordTransfer.s_RecordTransfer_GoodsProductCode,
    RecordTransfer_GoodsProductName=(case when len(s_RecordTransfer_GoodsProductName)>30 then SUBSTRING(s_RecordTransfer_GoodsProductName,0,30)+ '......' else s_RecordTransfer_GoodsProductName end),  
    RecordTransfer_Operator=s_RecordTransfer_Creator, 
    RecordTransfer_Time=d_RecordTransfer_CreateTime,  
    RecordTransfer_Number=n_RecordTransfer_Number, 
	ReportInventoryCurrent_Number=isnull(n_RecordTransfer_Number,0)
from tRecordTransfer tRecordTransfer with(nolock)  
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordTransfer.n_Bin_Id
and n_Bin_State = 1 
left join tSpace OldSpace with(nolock) on OldSpace.n_Space_Id = tRecordTransfer.n_Space_Id
left join tSpace NewSpace with(nolock) on NewSpace.n_Space_Id = tRecordTransfer.n_TargetSpace_Id 
where tRecordTransfer.n_BillStockInOut_Id =  @n_BillStockInOut_Id 
and n_RecordTransfer_state = 1 



 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:19
类型：Business 业务对象：UpdateDisplacementListStockInOut 
说明：执行业务过程[1]：0.提交已选择的移位单据信息
***************************************************************************************************************
SQL:
update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordTransfer set 
s_RecordTransfer_WhetherToSubmit = 1,
s_RecordTransfer_Updator = @Operator,
d_RecordTransfer_UpdateTime = getdate()
from tRecordTransfer tRecordTransfer with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1

 


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @RecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_TargetSpace_Id varchar(max),
	n_TargetRecordTransfer_Number varchar(max),
	s_RecordTransfer_GoodsProductCode varchar(max),
	s_RecordTransfer_BatchNumber varchar(max),
	s_RecordTransfer_QualityStatus varchar(max),
	s_RecordTransfer_Number int  
)

insert into @RecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	s_RecordTransfer_QualityStatus,
	s_RecordTransfer_Number  
)
select 
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_TargetSpace_Id,
	n_TargetRecordTransfer_Number,
	s_RecordTransfer_GoodsProductCode,
	s_RecordTransfer_BatchNumber,
	n_RecordTransfer_QualityStatus,
	n_RecordTransfer_Number  
from tRecordTransfer
where tRecordTransfer.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordTransfer_state = 1
 
 
 --扣减在储位信息明细表的对应原储位数量
 update tReportInventoryCurrentDetail
 set
 n_ReportInventoryCurrentDetail_Number = n_ReportInventoryCurrentDetail_Number - s_RecordTransfer_Number,
 n_ReportInventoryCurrentDetail_OKProductCou =  n_ReportInventoryCurrentDetail_OKProductCou - s_RecordTransfer_Number,
 s_ReportInventoryCurrentDetail_Updator = @Operator,
 d_ReportInventoryCurrentDetail_UpdateTime = getdate()
 from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
 
  
 declare @n_ReportInventoryCurrent_Id varchar(max) = newID()

 --新增或修改在储位信息表与在储位信息明细表的目标储位数量
 if exists(select 1 from tReportInventoryCurrentDetail with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrentDetail.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
 and RC.s_RecordTransfer_BatchNumber = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
 and n_ReportInventoryCurrentDetail_state = 1)
 begin
    
	update tReportInventoryCurrentDetail
	set n_ReportInventoryCurrentDetail_Number = n_TargetRecordTransfer_Number,
	n_ReportInventoryCurrentDetail_OKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '1' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_UnOKProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '2' then n_TargetRecordTransfer_Number else 0 end),
	n_ReportInventoryCurrentDetail_ReworkProductCou = (case s_ReportInventoryCurrentDetail_QualityStatus when '3' then n_TargetRecordTransfer_Number else 0 end),
	s_ReportInventoryCurrentDetail_Updator = @Operator,
	d_ReportInventoryCurrentDetail_UpdateTime = getdate()
	from tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
	inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
    and n_ReportInventoryCurrentDetail_state = 1
	 

 end
 else
 begin
     

	INSERT INTO [dbo].[tReportInventoryCurrentDetail]
           ([n_ReportInventoryCurrent_Id]
           ,[n_ReportInventoryCurrentDetail_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrentDetail_QualityStatus]
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,[n_ReportInventoryCurrentDetail_Number]
           ,[n_ReportInventoryCurrentDetail_OKProductCou]
           ,[n_ReportInventoryCurrentDetail_UnOKProductCou]
           ,[n_ReportInventoryCurrentDetail_ReworkProductCou]
           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,[n_ReportInventoryCurrentDetail_state]
           ,[s_ReportInventoryCurrentDetail_Creator]
           ,[d_ReportInventoryCurrentDetail_CreateTime]
           ,[s_ReportInventoryCurrentDetail_Updator]
           ,[d_ReportInventoryCurrentDetail_UpdateTime])
     select
	       @n_ReportInventoryCurrent_Id
	       ,newID() 
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrentDetail_GoodsId]
           ,[s_ReportInventoryCurrentDetail_Code]
           ,[s_ReportInventoryCurrentDetail_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_QualityStatus
           ,[s_ReportInventoryCurrentDetail_GoodsProductName]
           ,[s_ReportInventoryCurrentDetail_GoodsProductCode]
           ,[s_ReportInventoryCurrentDetail_ExternalCode]
           ,RC.n_TargetRecordTransfer_Number
           ,(case s_RecordTransfer_QualityStatus when '1' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_RecordTransfer_QualityStatus when '2' then RC.n_TargetRecordTransfer_Number else 0 end)
           ,(case s_RecordTransfer_QualityStatus when '3' then RC.n_TargetRecordTransfer_Number else 0 end)

           ,[s_ReportInventoryCurrentDetail_BatchNumber]
           ,[s_ReportInventoryCurrentDetail_SpecificationAndModel]
           ,[s_ReportInventoryCurrentDetail_Unit]
           ,[s_ReportInventoryCurrentDetail_Model]
           ,[s_ReportInventoryCurrentDetail_Color]
           ,[s_ReportInventoryCurrentDetail_CustomFields1]
           ,[s_ReportInventoryCurrentDetail_CustomFields2]
           ,[s_ReportInventoryCurrentDetail_CustomFields3]
           ,[s_ReportInventoryCurrentDetail_CustomFields4]
           ,[s_ReportInventoryCurrentDetail_CustomFields5]
           ,[s_ReportInventoryCurrentDetail_CustomFields6]
           ,[s_ReportInventoryCurrentDetail_CustomFields7]
           ,[s_ReportInventoryCurrentDetail_CustomFields8]
           ,[s_ReportInventoryCurrentDetail_CustomFields9]
           ,[s_ReportInventoryCurrentDetail_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
     
	 from  tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
	 inner join @RecordTransfer RC on RC.n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id
     and tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_state = 1



 end


 
 declare @UpRecordTransfer table(
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrent_Number int
 )

 insert into @UpRecordTransfer(
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrent_Number
 )
select 
tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock)
 on tReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id
 inner join @RecordTransfer RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 and n_ReportInventoryCurrentDetail_state = 1
 group by tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id


 --扣减在储位信息表的对应原储位数量
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = tReportInventoryCurrent.n_ReportInventoryCurrent_Number - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_OKProductCou = tReportInventoryCurrent.n_ReportInventoryCurrent_OKProductCou - UpRecordTransfer.n_ReportInventoryCurrent_Number,
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @UpRecordTransfer UpRecordTransfer 
 on UpRecordTransfer.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1  
 

 if exists(select 1 from tReportInventoryCurrent with(nolock)
 inner join @RecordTransfer RC on RC.n_TargetSpace_Id = tReportInventoryCurrent.n_Space_Id
 and RC.s_RecordTransfer_GoodsProductCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and RC.s_RecordTransfer_QualityStatus = tReportInventoryCurrent.s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_state = 1)
 begin
     
	update tReportInventoryCurrent
	set n_ReportInventoryCurrent_Number = RC.n_ReportInventoryCurrent_Number,
	n_ReportInventoryCurrent_OKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_UnOKProductCou = (case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end),
	n_ReportInventoryCurrent_ReworkProductCou = (case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end),
	s_ReportInventoryCurrent_Updator = @Operator,
	d_ReportInventoryCurrent_UpdateTime = getdate()

	from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
    and n_ReportInventoryCurrent_state = 1

 end
 else
 begin

 
	INSERT INTO [tReportInventoryCurrent]
           ([n_ReportInventoryCurrent_Id]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,[n_ReportInventoryCurrent_Number]
           ,[n_ReportInventoryCurrent_OKProductCou]
           ,[n_ReportInventoryCurrent_UnOKProductCou]
           ,[n_ReportInventoryCurrent_ReworkProductCou]
           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,[n_ReportInventoryCurrent_state]
           ,[s_ReportInventoryCurrent_Creator]
           ,[d_ReportInventoryCurrent_CreateTime]
           ,[s_ReportInventoryCurrent_Updator]
           ,[d_ReportInventoryCurrent_UpdateTime])
		   select
		   @n_ReportInventoryCurrent_Id
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id]
           ,[n_CombinedSpace_Id]
           ,[n_SplitSpace_Id]
           ,[n_Bin_Id]
           ,[n_ReportInventoryCurrent_GoodsId]
           ,[s_ReportInventoryCurrent_Code]
           ,[s_ReportInventoryCurrent_ECN]
           ,[n_APQPStatus_Id]
           ,[s_APQPStatus_Name]
           ,[s_ReportInventoryCurrent_QualityStatus]
           ,[s_ReportInventoryCurrent_GoodsProductName]
           ,[s_ReportInventoryCurrent_GoodsProductCode]
           ,[s_ReportInventoryCurrent_ExternalCode]
           ,RC.n_ReportInventoryCurrent_Number
           ,(case s_ReportInventoryCurrent_QualityStatus when '1' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '2' then RC.n_ReportInventoryCurrent_Number else 0 end)
           ,(case s_ReportInventoryCurrent_QualityStatus when '3' then RC.n_ReportInventoryCurrent_Number else 0 end)

           ,[s_ReportInventoryCurrent_BatchNumber]
           ,[s_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_ReportInventoryCurrent_Unit]
           ,[s_ReportInventoryCurrent_Model]
           ,[s_ReportInventoryCurrent_Color]
           ,[s_ReportInventoryCurrent_CustomFields1]
           ,[s_ReportInventoryCurrent_CustomFields2]
           ,[s_ReportInventoryCurrent_CustomFields3]
           ,[s_ReportInventoryCurrent_CustomFields4]
           ,[s_ReportInventoryCurrent_CustomFields5]
           ,[s_ReportInventoryCurrent_CustomFields6]
           ,[s_ReportInventoryCurrent_CustomFields7]
           ,[s_ReportInventoryCurrent_CustomFields8]
           ,[s_ReportInventoryCurrent_CustomFields9]
           ,[s_ReportInventoryCurrent_CustomFields10]
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
	       inner join @UpRecordTransfer RC on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
           and tReportInventoryCurrent.n_ReportInventoryCurrent_state = 1


 end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F0C9056C-B92D-482C-9855-607CDA9A7C94"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/12 15:56:23
类型：Query 查询对象：SelDisplacementBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YW%'
and n_BillStockInOut_Type = 5
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^