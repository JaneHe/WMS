
**************************************************************************************************************------>2020/11/5 8:39:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:14
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:19
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:19
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:20
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:20
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:25
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:26
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:26
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:27
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:34
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:34
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 8:40:34
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:33:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:33:55
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:33:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:33:56
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:01
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:01
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:01
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:02
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:05
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:05
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:05
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:06
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:08
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:34:12
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:36:41
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:36:41
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:36:48
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:36:48
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 13:36:48
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:32
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:32
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:32
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 14:27:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:14:57
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"hwweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"5FA17885786488BA"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:09
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:09
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:09
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:11
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:15:12
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:38
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:39
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:45
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:45
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:45
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:45
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:37:48
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:31
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003040107"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:35
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:44
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:38:50
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:56:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:56:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:56:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:56:58
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:03
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:25
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 15:57:33
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:02:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:02:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:02:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:02:58
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:14
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:03:54
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:04:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:04:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:04:04
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:08:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:08:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:08:07
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:42
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:09:52
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:40
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:10:45
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:11:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:11:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:11:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:11:53
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:12:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:12:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:12:03
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:15:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:15:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:15:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:15:33
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:18:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:18:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:19:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:19:00
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:19:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:19:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:19:11
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:20:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:20:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:20:37
类型：Business 业务对象：InsertOnShelfListStockInOut 
说明：执行业务过程[1]：0.新增下架操作记录
***************************************************************************************************************
SQL:
 
--当前时间
declare @NowDate varchar(20) = replace(replace(replace(replace(Convert(varchar(30),getdate(),121),'-',''),':',''),' ',''),'.','')

--查询相关的仓库信息ID,车间信息ID,货架信息ID
declare @n_Warehouse_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Rack_Id varchar(max)
select top 1 
@n_Shopfloor_Id = n_Shopfloor_Id, 
@n_Warehouse_Id = n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id 
from tSpace with(nolock) where n_Space_Id = @n_Space_Id
and n_Space_state = 1

--班次
declare @s_ListStockInOut_Team varchar(50) = (select dbo.function_GetTeamByNowDate(getdate()))
select @s_ListStockInOut_Team
 

--修正出库单明细的完成状态
update tBillStockInOutDetail set n_BillStockInOutDetail_IsFinishedState = 
(case when isnull(f_BillStockInOutDetail_FinishWorkOrderQuantity,0)+ @f_ListPutOnOff_WorkOrderQuantity >= f_BillStockInOutDetail_WorkOrderQuantity
then 4 else 1 end)
,
f_BillStockInOutDetail_FinishWorkOrderQuantity = isnull(f_BillStockInOutDetail_FinishWorkOrderQuantity,0)+ @f_ListPutOnOff_WorkOrderQuantity
where n_BillStockInOutDetail_Id = @n_BillStockInOutDetail_Id 

--下架次数序数
declare @n_ListPutOnOff_OffTheShelfSequence int
set @n_ListPutOnOff_OffTheShelfSequence =  isnull((
select top 1 n_ListPutOnOff_OffTheShelfSequence from [tListPutOnOff] with(nolock) where s_BillStockInOut_Code = @s_ReportInventoryCurrent_Code  and n_ListPutOnOff_state = 1),0) + 1


--上下架记录表ID
declare @ListPutOnOffId varchar(max)
select top 1 @ListPutOnOffId = n_ListPutOnOff_Id from tListPutOnOff with(nolock)
where s_ListPutOnOff_Code = @s_ReportInventoryCurrent_Code
and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode 
and n_ListPutOnOff_OffTheShelfNumber is null
and not exists(select 1 from tReportInventoryCurrent with(nolock) where 
n_ReportInventoryCurrent_Number = 0 and s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1)
order by d_ListPutOnOff_LaunchTime asc,n_ListPutOnOff_LaunchSequence asc



--如果有上下架记录表ID,则记录到对应的上下架记录表里的出库信息中
if(isnull(@ListPutOnOffId,'') = '')
begin
 
 --记录下架记录 

update tListPutOnOff set   
    d_ListPutOnOff_OffTheShelfTime=getdate(),
    n_ListPutOnOff_OffTheShelfNumber=@f_ListPutOnOff_WorkOrderQuantity,
    n_ListPutOnOff_OffTheShelfOKProductCou=@f_ListPutOnOff_WorkOrderQuantity,
    n_ListPutOnOff_OffTheShelfUnOKProductCou=0,
    n_ListPutOnOff_OffTheShelfReworkProductCou=0,
    s_ListPutOnOff_OffTheShelfOperator=@Operator,
    s_ListPutOnOff_OffTheShelfClasses=@s_ListStockInOut_Team,
    n_ListPutOnOffReason_Id=@s_ListPutOnOffReason_Id,
    s_ListPutOnOffReason_Reason=@s_ListPutOnOffReason_Reason, 
    n_ListPutOnOff_OffTheShelfSequence=@n_ListPutOnOff_OffTheShelfSequence, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOffId 


end
else  --如果不是,则是对在架的产品做N次下架的操作
begin

--记录该产品在该储位中最近一次操作上下架的上下架记录表ID
declare @ListPutOnOffId_Prev varchar(max)
select top 1 @ListPutOnOffId_Prev = n_ListPutOnOff_Id from tListPutOnOff with(nolock)
where s_ListPutOnOff_Code = @s_ReportInventoryCurrent_Code
and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode 
and n_ListPutOnOff_OffTheShelfNumber is null
and not exists(select 1 from tReportInventoryCurrent with(nolock) where 
n_ReportInventoryCurrent_Number = 0 and s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1)
order by d_ListPutOnOff_LaunchTime desc,n_ListPutOnOff_LaunchSequence desc


--记录N次下架操作的记录
insert into tListPutOnOff (
    n_ListPutOnOff_Id,
    n_ListPutOnOff_ParentId,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_CombinedSpace_Id,
    n_SplitSpace_Id,
    n_ListStockInOut_Id,
    n_BillStockInOutDetail_Id,
    n_Bin_Id,
    n_ListPutOnOff_GoodsId,
    s_ListPutOnOff_Code,
    s_ListPutOnOff_GoodsProductName,
    s_ListPutOnOff_GoodsProductCode,
    n_ListPutOnOff_GoodsProductId,
    s_ListPutOnOff_ExternalCode,
    s_ListPutOnOff_ExternalName,
    s_ListPutOnOff_ECN,
    n_APQPStatus_Id,
    s_APQPStatus_Name,
    n_APQPStatus_QualityStatus,
    s_ListPutOnOff_SpecificationAndModel,
    s_ListPutOnOff_Unit,
    s_ListPutOnOff_Model,
    s_ListPutOnOff_Color,
    s_ListPutOnOff_BatchNumber,
    d_ListPutOnOff_LaunchTime,
    n_ListPutOnOff_LaunchNumber,
    n_ListPutOnOff_LaunchOKProductCou,
    n_ListPutOnOff_LaunchUnOKProductCou,
    n_ListPutOnOff_LaunchReworkProductCou,
    s_ListPutOnOff_LaunchOperator,
    s_ListPutOnOff_LaunchClasses,
    n_LaunchReason_Id,
    n_LaunchReason_Name,
    n_ListPutOnOff_LaunchType,
    n_ListPutOnOff_LaunchSequence,
    d_ListPutOnOff_OffTheShelfTime,
    n_ListPutOnOff_OffTheShelfNumber,
    n_ListPutOnOff_OffTheShelfOKProductCou,
    n_ListPutOnOff_OffTheShelfUnOKProductCou,
    n_ListPutOnOff_OffTheShelfReworkProductCou,
    s_ListPutOnOff_OffTheShelfOperator,
    s_ListPutOnOff_OffTheShelfClasses,
    n_ListPutOnOffReason_Id,
    s_ListPutOnOffReason_Reason,
    n_ListPutOnOff_OffTheShelfType,
    n_ListPutOnOff_OffTheShelfSequence, 
    s_ListPutOnOff_WhetherToSubmit,
    n_ListPutOnOff_state,
    s_ListPutOnOff_Creator,
    d_ListPutOnOff_CreateTime,
    s_ListPutOnOff_Updator,
    d_ListPutOnOff_UpdateTime
)
select
newID(),
@ListPutOnOffId_Prev,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_CombinedSpace_Id,
    n_SplitSpace_Id,
    n_ListStockInOut_Id,
    n_BillStockInOutDetail_Id,
    n_Bin_Id,
    n_ListPutOnOff_GoodsId,
    s_ListPutOnOff_Code,
    s_ListPutOnOff_GoodsProductName,
    s_ListPutOnOff_GoodsProductCode,
    n_ListPutOnOff_GoodsProductId,
    s_ListPutOnOff_ExternalCode,
    s_ListPutOnOff_ExternalName,
    s_ListPutOnOff_ECN,
    n_APQPStatus_Id,
    s_APQPStatus_Name,
    n_APQPStatus_QualityStatus,
    s_ListPutOnOff_SpecificationAndModel,
    s_ListPutOnOff_Unit,
    s_ListPutOnOff_Model,
    s_ListPutOnOff_Color,
    s_ListPutOnOff_BatchNumber,
    d_ListPutOnOff_LaunchTime,
    n_ListPutOnOff_LaunchNumber,
    n_ListPutOnOff_LaunchOKProductCou,
    n_ListPutOnOff_LaunchUnOKProductCou,
    n_ListPutOnOff_LaunchReworkProductCou,
    s_ListPutOnOff_LaunchOperator,
    s_ListPutOnOff_LaunchClasses,
    n_LaunchReason_Id,
    n_LaunchReason_Name,
    n_ListPutOnOff_LaunchType,
    n_ListPutOnOff_LaunchSequence,

	getdate(),
    @f_ListPutOnOff_WorkOrderQuantity,
    @f_ListPutOnOff_WorkOrderQuantity,
    0,
    0,
    @Operator,
    @s_ListStockInOut_Team,
    @s_ListPutOnOffReason_Id,
    @s_ListPutOnOffReason_Reason,
    n_ListPutOnOff_OffTheShelfType,
    isnull(n_ListPutOnOff_OffTheShelfSequence,0) + 1, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate()
from tListPutOnOff with(nolock)
where n_ListPutOnOff_Id = @ListPutOnOffId_Prev




end
 


--修改储位货物信息已存在的信息，减掉对应的库存数量
 
update tReportInventoryCurrent set      
    n_ReportInventoryCurrent_Number =
	(
	case when isnull(n_ReportInventoryCurrent_Number - @f_ListPutOnOff_WorkOrderQuantity,0) < 0 then 0 else n_ReportInventoryCurrent_Number - @f_ListPutOnOff_WorkOrderQuantity end
	),
    n_ReportInventoryCurrent_OKProductCou = 
	(
	case when isnull(n_ReportInventoryCurrent_OKProductCou - @f_ListPutOnOff_WorkOrderQuantity,0) < 0 then 0 else n_ReportInventoryCurrent_OKProductCou - @f_ListPutOnOff_WorkOrderQuantity end
	),
    n_ReportInventoryCurrent_UnOKProductCou=0,
    n_ReportInventoryCurrent_ReworkProductCou=0,    
    s_ReportInventoryCurrent_Updator=@Operator,
    d_ReportInventoryCurrent_UpdateTime=getdate()
	where s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Space_Id" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_BillStockInOutDetail_Id" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@f_ListPutOnOff_WorkOrderQuantity" DbType:"String" Value:"0"
（5）ParameterName:"@s_ListPutOnOffReason_Id" DbType:"String" Value:""
（6）ParameterName:"@s_ListPutOnOffReason_Reason" DbType:"AnsiString" Value:"null"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010403"
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1003050024"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:29
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:37
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:23:42
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:30
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:24:34
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:50
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:31:54
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:11
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:17
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:46
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"CS010403"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:33:52
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:43:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:43:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:43:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:43:31
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:09
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:45:37
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:46:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:46:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:46:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:46:42
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:48:33
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:48:33
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 16:48:33
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:00:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:00:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:00:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:00:58
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:01:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:01:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:01:07
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:14
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:14
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:14
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:14
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:18
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:13:47
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:45
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:16:49
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:43
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:43
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:43
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:45
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:28:46
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:34
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:47
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:32:53
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
f_BillStockInOutDetail_WorkOrderQuantity as f_BillStockInOutDetail_OldWorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:15
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:28
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
f_BillStockInOutDetail_WorkOrderQuantity as f_BillStockInOutDetail_OldWorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:35:29
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
f_BillStockInOutDetail_WorkOrderQuantity as f_BillStockInOutDetail_OldWorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:44
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 17:44:51
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
f_BillStockInOutDetail_WorkOrderQuantity as f_BillStockInOutDetail_OldWorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:11
类型：Query 查询对象：SelWarehousingWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:00:16
类型：Query 查询对象：SelOnShelfWorkOrderInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--根据货物编码查询出对应的在库位信息
select 
   tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name+'的第'+tRack.s_Rack_Code+'排第'+ Convert(varchar(20),tSpace.n_Space_BayNumber)+'节第'+ Convert(varchar(20),tSpace.n_Space_LayerNumber) +'层' as s_Space_Description,
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],
   sum([n_ReportInventoryCurrent_Number]) as [n_ReportInventoryCurrent_Number],
   sum([n_ReportInventoryCurrent_OKProductCou]) as [n_ReportInventoryCurrent_OKProductCou]
from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
inner join tWarehouse tWarehouse with(nolock) on tSpace.n_Warehouse_Id = tWarehouse.n_Warehouse_Id
inner join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
where n_ReportInventoryCurrent_Number > 0
and n_ReportInventoryCurrent_state = 1
and s_ReportInventoryCurrent_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and tSpace.n_Warehouse_Id = @n_WarehouseId 
group by tSpace.n_Space_Id,
   s_Space_BarCode,
   tWarehouse.s_Warehouse_Name,tRack.s_Rack_Code,tSpace.n_Space_BayNumber,
   tSpace.n_Space_LayerNumber, 
   [s_ReportInventoryCurrent_GoodsProductName],
   [s_ReportInventoryCurrent_GoodsProductCode],n_Space_ShipmentSequence
order by n_Space_ShipmentSequence asc

--出库单明细表
declare @BillStockInOutDetail table(
     RowId int,
     n_BillStockInOut_Id varchar(max),
	 n_BillStockInOutDetail_Id varchar(max),
	 s_BillStockInOutDetail_Code varchar(500),
	 s_BillStockInOutDetail_GoodsProductCode varchar(max),
	 f_BillStockInOutDetail_WorkOrderQuantity int,
	 n_Warehouse_Id varchar(max)
)

--按照出库单申请的时间正顺序，依次查出对应产品的未完成的出库单信息
insert into @BillStockInOutDetail
(
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
)
select 
RowId = ROW_NUMBER() over(partition by isnull(n_BillStockInOutDetail_GoodsProductId,''),s_BillStockInOutDetail_GoodsProductCode
order by d_BillStockInOutDetail_CreateTime asc),
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
n_Warehouse_Id
from tBillStockInOutDetail with(nolock)
where s_BillStockInOutDetail_Code like 'CK%' and n_BillStockInOutDetail_state = 1
and isnull(n_BillStockInOutDetail_IsFinishedState,0) = 0
and isnull(n_BillStockInOutDetail_IsApproved,0) = 0
and s_BillStockInOutDetail_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode
and n_Warehouse_Id = @n_WarehouseId 
   
select 
RowId,
n_BillStockInOut_Id,
n_BillStockInOutDetail_Id,
s_BillStockInOutDetail_Code,
s_BillStockInOutDetail_GoodsProductCode,
f_BillStockInOutDetail_WorkOrderQuantity,
f_BillStockInOutDetail_WorkOrderQuantity as f_BillStockInOutDetail_OldWorkOrderQuantity,
n_Warehouse_Id
from @BillStockInOutDetail
order by RowId asc

 
  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"1003050024"
（1）ParameterName:"@n_WarehouseId" DbType:"AnsiString" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:01:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:01:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:01:01
类型：Business 业务对象：InsertOnShelfListStockInOut 
说明：执行业务过程[1]：0.新增下架操作记录
***************************************************************************************************************
SQL:
 
--当前时间
declare @NowDate varchar(20) = replace(replace(replace(replace(Convert(varchar(30),getdate(),121),'-',''),':',''),' ',''),'.','')

--查询相关的仓库信息ID,车间信息ID,货架信息ID
declare @n_Warehouse_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Rack_Id varchar(max)
select top 1 
@n_Shopfloor_Id = n_Shopfloor_Id, 
@n_Warehouse_Id = n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id 
from tSpace with(nolock) where n_Space_Id = @n_Space_Id
and n_Space_state = 1

--班次
declare @s_ListStockInOut_Team varchar(50) = (select dbo.function_GetTeamByNowDate(getdate()))
select @s_ListStockInOut_Team
 

--修正出库单明细的完成状态
update tBillStockInOutDetail set n_BillStockInOutDetail_IsFinishedState = 
(case when isnull(f_BillStockInOutDetail_FinishWorkOrderQuantity,0)+ @f_ListPutOnOff_WorkOrderQuantity >= f_BillStockInOutDetail_WorkOrderQuantity
then 4 else 1 end)
,
f_BillStockInOutDetail_FinishWorkOrderQuantity = isnull(f_BillStockInOutDetail_FinishWorkOrderQuantity,0)+ @f_ListPutOnOff_WorkOrderQuantity
where n_BillStockInOutDetail_Id = @n_BillStockInOutDetail_Id 

--下架次数序数
declare @n_ListPutOnOff_OffTheShelfSequence int
set @n_ListPutOnOff_OffTheShelfSequence =  isnull((
select top 1 n_ListPutOnOff_OffTheShelfSequence from [tListPutOnOff] with(nolock) where s_BillStockInOut_Code = @s_ReportInventoryCurrent_Code  and n_ListPutOnOff_state = 1),0) + 1


--上下架记录表ID
declare @ListPutOnOffId varchar(max)
select top 1 @ListPutOnOffId = n_ListPutOnOff_Id from tListPutOnOff with(nolock)
where s_ListPutOnOff_Code = @s_ReportInventoryCurrent_Code
and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode 
and n_ListPutOnOff_OffTheShelfNumber is null
and not exists(select 1 from tReportInventoryCurrent with(nolock) where 
n_ReportInventoryCurrent_Number = 0 and s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1)
order by d_ListPutOnOff_LaunchTime asc,n_ListPutOnOff_LaunchSequence asc



--如果有上下架记录表ID,则记录到对应的上下架记录表里的出库信息中
if(isnull(@ListPutOnOffId,'') = '')
begin
 
 --记录下架记录 

update tListPutOnOff set   
    d_ListPutOnOff_OffTheShelfTime=getdate(),
    n_ListPutOnOff_OffTheShelfNumber=@f_ListPutOnOff_WorkOrderQuantity,
    n_ListPutOnOff_OffTheShelfOKProductCou=@f_ListPutOnOff_WorkOrderQuantity,
    n_ListPutOnOff_OffTheShelfUnOKProductCou=0,
    n_ListPutOnOff_OffTheShelfReworkProductCou=0,
    s_ListPutOnOff_OffTheShelfOperator=@Operator,
    s_ListPutOnOff_OffTheShelfClasses=@s_ListStockInOut_Team,
    n_ListPutOnOffReason_Id=@s_ListPutOnOffReason_Id,
    s_ListPutOnOffReason_Reason=@s_ListPutOnOffReason_Reason, 
    n_ListPutOnOff_OffTheShelfSequence=@n_ListPutOnOff_OffTheShelfSequence, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOffId 


end
else  --如果不是,则是对在架的产品做N次下架的操作
begin

--记录该产品在该储位中最近一次操作上下架的上下架记录表ID
declare @ListPutOnOffId_Prev varchar(max)
select top 1 @ListPutOnOffId_Prev = n_ListPutOnOff_Id from tListPutOnOff with(nolock)
where s_ListPutOnOff_Code = @s_ReportInventoryCurrent_Code
and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode 
and n_ListPutOnOff_OffTheShelfNumber is null
and not exists(select 1 from tReportInventoryCurrent with(nolock) where 
n_ReportInventoryCurrent_Number = 0 and s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1)
order by d_ListPutOnOff_LaunchTime desc,n_ListPutOnOff_LaunchSequence desc


--记录N次下架操作的记录
insert into tListPutOnOff (
    n_ListPutOnOff_Id,
    n_ListPutOnOff_ParentId,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_CombinedSpace_Id,
    n_SplitSpace_Id,
    n_ListStockInOut_Id,
    n_BillStockInOutDetail_Id,
    n_Bin_Id,
    n_ListPutOnOff_GoodsId,
    s_ListPutOnOff_Code,
    s_ListPutOnOff_GoodsProductName,
    s_ListPutOnOff_GoodsProductCode,
    n_ListPutOnOff_GoodsProductId,
    s_ListPutOnOff_ExternalCode,
    s_ListPutOnOff_ExternalName,
    s_ListPutOnOff_ECN,
    n_APQPStatus_Id,
    s_APQPStatus_Name,
    n_APQPStatus_QualityStatus,
    s_ListPutOnOff_SpecificationAndModel,
    s_ListPutOnOff_Unit,
    s_ListPutOnOff_Model,
    s_ListPutOnOff_Color,
    s_ListPutOnOff_BatchNumber,
    d_ListPutOnOff_LaunchTime,
    n_ListPutOnOff_LaunchNumber,
    n_ListPutOnOff_LaunchOKProductCou,
    n_ListPutOnOff_LaunchUnOKProductCou,
    n_ListPutOnOff_LaunchReworkProductCou,
    s_ListPutOnOff_LaunchOperator,
    s_ListPutOnOff_LaunchClasses,
    n_LaunchReason_Id,
    n_LaunchReason_Name,
    n_ListPutOnOff_LaunchType,
    n_ListPutOnOff_LaunchSequence,
    d_ListPutOnOff_OffTheShelfTime,
    n_ListPutOnOff_OffTheShelfNumber,
    n_ListPutOnOff_OffTheShelfOKProductCou,
    n_ListPutOnOff_OffTheShelfUnOKProductCou,
    n_ListPutOnOff_OffTheShelfReworkProductCou,
    s_ListPutOnOff_OffTheShelfOperator,
    s_ListPutOnOff_OffTheShelfClasses,
    n_ListPutOnOffReason_Id,
    s_ListPutOnOffReason_Reason,
    n_ListPutOnOff_OffTheShelfType,
    n_ListPutOnOff_OffTheShelfSequence, 
    s_ListPutOnOff_WhetherToSubmit,
    n_ListPutOnOff_state,
    s_ListPutOnOff_Creator,
    d_ListPutOnOff_CreateTime,
    s_ListPutOnOff_Updator,
    d_ListPutOnOff_UpdateTime
)
select
newID(),
@ListPutOnOffId_Prev,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_CombinedSpace_Id,
    n_SplitSpace_Id,
    n_ListStockInOut_Id,
    n_BillStockInOutDetail_Id,
    n_Bin_Id,
    n_ListPutOnOff_GoodsId,
    s_ListPutOnOff_Code,
    s_ListPutOnOff_GoodsProductName,
    s_ListPutOnOff_GoodsProductCode,
    n_ListPutOnOff_GoodsProductId,
    s_ListPutOnOff_ExternalCode,
    s_ListPutOnOff_ExternalName,
    s_ListPutOnOff_ECN,
    n_APQPStatus_Id,
    s_APQPStatus_Name,
    n_APQPStatus_QualityStatus,
    s_ListPutOnOff_SpecificationAndModel,
    s_ListPutOnOff_Unit,
    s_ListPutOnOff_Model,
    s_ListPutOnOff_Color,
    s_ListPutOnOff_BatchNumber,
    d_ListPutOnOff_LaunchTime,
    n_ListPutOnOff_LaunchNumber,
    n_ListPutOnOff_LaunchOKProductCou,
    n_ListPutOnOff_LaunchUnOKProductCou,
    n_ListPutOnOff_LaunchReworkProductCou,
    s_ListPutOnOff_LaunchOperator,
    s_ListPutOnOff_LaunchClasses,
    n_LaunchReason_Id,
    n_LaunchReason_Name,
    n_ListPutOnOff_LaunchType,
    n_ListPutOnOff_LaunchSequence,

	getdate(),
    @f_ListPutOnOff_WorkOrderQuantity,
    @f_ListPutOnOff_WorkOrderQuantity,
    0,
    0,
    @Operator,
    @s_ListStockInOut_Team,
    @s_ListPutOnOffReason_Id,
    @s_ListPutOnOffReason_Reason,
    n_ListPutOnOff_OffTheShelfType,
    isnull(n_ListPutOnOff_OffTheShelfSequence,0) + 1, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate()
from tListPutOnOff with(nolock)
where n_ListPutOnOff_Id = @ListPutOnOffId_Prev




end
 


--修改储位货物信息已存在的信息，减掉对应的库存数量
 
update tReportInventoryCurrent set      
    n_ReportInventoryCurrent_Number =
	(
	case when isnull(n_ReportInventoryCurrent_Number - @f_ListPutOnOff_WorkOrderQuantity,0) < 0 then 0 else n_ReportInventoryCurrent_Number - @f_ListPutOnOff_WorkOrderQuantity end
	),
    n_ReportInventoryCurrent_OKProductCou = 
	(
	case when isnull(n_ReportInventoryCurrent_OKProductCou - @f_ListPutOnOff_WorkOrderQuantity,0) < 0 then 0 else n_ReportInventoryCurrent_OKProductCou - @f_ListPutOnOff_WorkOrderQuantity end
	),
    n_ReportInventoryCurrent_UnOKProductCou=0,
    n_ReportInventoryCurrent_ReworkProductCou=0,    
    s_ReportInventoryCurrent_Updator=@Operator,
    d_ReportInventoryCurrent_UpdateTime=getdate()
	where s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Space_Id" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_BillStockInOutDetail_Id" DbType:"String" Value:"7FE84D87-8A4A-48EB-8903-2C5882BA7CF1"
（4）ParameterName:"@f_ListPutOnOff_WorkOrderQuantity" DbType:"String" Value:"10"
（5）ParameterName:"@s_ListPutOnOffReason_Id" DbType:"String" Value:""
（6）ParameterName:"@s_ListPutOnOffReason_Reason" DbType:"AnsiString" Value:"null"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010403"
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1003050024"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/5 18:01:02
类型：Business 业务对象：InsertOnShelfListStockInOut 
说明：执行业务过程[1]：1.新增下架操作记录
***************************************************************************************************************
SQL:
 
--当前时间
declare @NowDate varchar(20) = replace(replace(replace(replace(Convert(varchar(30),getdate(),121),'-',''),':',''),' ',''),'.','')

--查询相关的仓库信息ID,车间信息ID,货架信息ID
declare @n_Warehouse_Id varchar(max)
declare @n_Shopfloor_Id varchar(max)
declare @n_Rack_Id varchar(max)
select top 1 
@n_Shopfloor_Id = n_Shopfloor_Id, 
@n_Warehouse_Id = n_Warehouse_Id,
@n_Rack_Id = n_Rack_Id 
from tSpace with(nolock) where n_Space_Id = @n_Space_Id
and n_Space_state = 1

--班次
declare @s_ListStockInOut_Team varchar(50) = (select dbo.function_GetTeamByNowDate(getdate()))
select @s_ListStockInOut_Team
 

--修正出库单明细的完成状态
update tBillStockInOutDetail set n_BillStockInOutDetail_IsFinishedState = 
(case when isnull(f_BillStockInOutDetail_FinishWorkOrderQuantity,0)+ @f_ListPutOnOff_WorkOrderQuantity >= f_BillStockInOutDetail_WorkOrderQuantity
then 4 else 1 end)
,
f_BillStockInOutDetail_FinishWorkOrderQuantity = isnull(f_BillStockInOutDetail_FinishWorkOrderQuantity,0)+ @f_ListPutOnOff_WorkOrderQuantity
where n_BillStockInOutDetail_Id = @n_BillStockInOutDetail_Id 

--下架次数序数
declare @n_ListPutOnOff_OffTheShelfSequence int
set @n_ListPutOnOff_OffTheShelfSequence =  isnull((
select top 1 n_ListPutOnOff_OffTheShelfSequence from [tListPutOnOff] with(nolock) where s_BillStockInOut_Code = @s_ReportInventoryCurrent_Code  and n_ListPutOnOff_state = 1),0) + 1


--上下架记录表ID
declare @ListPutOnOffId varchar(max)
select top 1 @ListPutOnOffId = n_ListPutOnOff_Id from tListPutOnOff with(nolock)
where s_ListPutOnOff_Code = @s_ReportInventoryCurrent_Code
and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode 
and n_ListPutOnOff_OffTheShelfNumber is null
and not exists(select 1 from tReportInventoryCurrent with(nolock) where 
n_ReportInventoryCurrent_Number = 0 and s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1)
order by d_ListPutOnOff_LaunchTime asc,n_ListPutOnOff_LaunchSequence asc



--如果有上下架记录表ID,则记录到对应的上下架记录表里的出库信息中
if(isnull(@ListPutOnOffId,'') = '')
begin
 
 --记录下架记录 

update tListPutOnOff set   
    d_ListPutOnOff_OffTheShelfTime=getdate(),
    n_ListPutOnOff_OffTheShelfNumber=@f_ListPutOnOff_WorkOrderQuantity,
    n_ListPutOnOff_OffTheShelfOKProductCou=@f_ListPutOnOff_WorkOrderQuantity,
    n_ListPutOnOff_OffTheShelfUnOKProductCou=0,
    n_ListPutOnOff_OffTheShelfReworkProductCou=0,
    s_ListPutOnOff_OffTheShelfOperator=@Operator,
    s_ListPutOnOff_OffTheShelfClasses=@s_ListStockInOut_Team,
    n_ListPutOnOffReason_Id=@s_ListPutOnOffReason_Id,
    s_ListPutOnOffReason_Reason=@s_ListPutOnOffReason_Reason, 
    n_ListPutOnOff_OffTheShelfSequence=@n_ListPutOnOff_OffTheShelfSequence, 
    s_ListPutOnOff_Updator=@Operator,
    d_ListPutOnOff_UpdateTime=getdate()
where n_ListPutOnOff_Id=@ListPutOnOffId 


end
else  --如果不是,则是对在架的产品做N次下架的操作
begin

--记录该产品在该储位中最近一次操作上下架的上下架记录表ID
declare @ListPutOnOffId_Prev varchar(max)
select top 1 @ListPutOnOffId_Prev = n_ListPutOnOff_Id from tListPutOnOff with(nolock)
where s_ListPutOnOff_Code = @s_ReportInventoryCurrent_Code
and s_ListPutOnOff_GoodsProductCode = @s_ReportInventoryCurrent_GoodsProductCode 
and n_ListPutOnOff_OffTheShelfNumber is null
and not exists(select 1 from tReportInventoryCurrent with(nolock) where 
n_ReportInventoryCurrent_Number = 0 and s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1)
order by d_ListPutOnOff_LaunchTime desc,n_ListPutOnOff_LaunchSequence desc


--记录N次下架操作的记录
insert into tListPutOnOff (
    n_ListPutOnOff_Id,
    n_ListPutOnOff_ParentId,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_CombinedSpace_Id,
    n_SplitSpace_Id,
    n_ListStockInOut_Id,
    n_BillStockInOutDetail_Id,
    n_Bin_Id,
    n_ListPutOnOff_GoodsId,
    s_ListPutOnOff_Code,
    s_ListPutOnOff_GoodsProductName,
    s_ListPutOnOff_GoodsProductCode,
    n_ListPutOnOff_GoodsProductId,
    s_ListPutOnOff_ExternalCode,
    s_ListPutOnOff_ExternalName,
    s_ListPutOnOff_ECN,
    n_APQPStatus_Id,
    s_APQPStatus_Name,
    n_APQPStatus_QualityStatus,
    s_ListPutOnOff_SpecificationAndModel,
    s_ListPutOnOff_Unit,
    s_ListPutOnOff_Model,
    s_ListPutOnOff_Color,
    s_ListPutOnOff_BatchNumber,
    d_ListPutOnOff_LaunchTime,
    n_ListPutOnOff_LaunchNumber,
    n_ListPutOnOff_LaunchOKProductCou,
    n_ListPutOnOff_LaunchUnOKProductCou,
    n_ListPutOnOff_LaunchReworkProductCou,
    s_ListPutOnOff_LaunchOperator,
    s_ListPutOnOff_LaunchClasses,
    n_LaunchReason_Id,
    n_LaunchReason_Name,
    n_ListPutOnOff_LaunchType,
    n_ListPutOnOff_LaunchSequence,
    d_ListPutOnOff_OffTheShelfTime,
    n_ListPutOnOff_OffTheShelfNumber,
    n_ListPutOnOff_OffTheShelfOKProductCou,
    n_ListPutOnOff_OffTheShelfUnOKProductCou,
    n_ListPutOnOff_OffTheShelfReworkProductCou,
    s_ListPutOnOff_OffTheShelfOperator,
    s_ListPutOnOff_OffTheShelfClasses,
    n_ListPutOnOffReason_Id,
    s_ListPutOnOffReason_Reason,
    n_ListPutOnOff_OffTheShelfType,
    n_ListPutOnOff_OffTheShelfSequence, 
    s_ListPutOnOff_WhetherToSubmit,
    n_ListPutOnOff_state,
    s_ListPutOnOff_Creator,
    d_ListPutOnOff_CreateTime,
    s_ListPutOnOff_Updator,
    d_ListPutOnOff_UpdateTime
)
select
newID(),
@ListPutOnOffId_Prev,
    s_BillStockInOut_Code,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_CombinedSpace_Id,
    n_SplitSpace_Id,
    n_ListStockInOut_Id,
    n_BillStockInOutDetail_Id,
    n_Bin_Id,
    n_ListPutOnOff_GoodsId,
    s_ListPutOnOff_Code,
    s_ListPutOnOff_GoodsProductName,
    s_ListPutOnOff_GoodsProductCode,
    n_ListPutOnOff_GoodsProductId,
    s_ListPutOnOff_ExternalCode,
    s_ListPutOnOff_ExternalName,
    s_ListPutOnOff_ECN,
    n_APQPStatus_Id,
    s_APQPStatus_Name,
    n_APQPStatus_QualityStatus,
    s_ListPutOnOff_SpecificationAndModel,
    s_ListPutOnOff_Unit,
    s_ListPutOnOff_Model,
    s_ListPutOnOff_Color,
    s_ListPutOnOff_BatchNumber,
    d_ListPutOnOff_LaunchTime,
    n_ListPutOnOff_LaunchNumber,
    n_ListPutOnOff_LaunchOKProductCou,
    n_ListPutOnOff_LaunchUnOKProductCou,
    n_ListPutOnOff_LaunchReworkProductCou,
    s_ListPutOnOff_LaunchOperator,
    s_ListPutOnOff_LaunchClasses,
    n_LaunchReason_Id,
    n_LaunchReason_Name,
    n_ListPutOnOff_LaunchType,
    n_ListPutOnOff_LaunchSequence,

	getdate(),
    @f_ListPutOnOff_WorkOrderQuantity,
    @f_ListPutOnOff_WorkOrderQuantity,
    0,
    0,
    @Operator,
    @s_ListStockInOut_Team,
    @s_ListPutOnOffReason_Id,
    @s_ListPutOnOffReason_Reason,
    n_ListPutOnOff_OffTheShelfType,
    isnull(n_ListPutOnOff_OffTheShelfSequence,0) + 1, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate()
from tListPutOnOff with(nolock)
where n_ListPutOnOff_Id = @ListPutOnOffId_Prev




end
 


--修改储位货物信息已存在的信息，减掉对应的库存数量
 
update tReportInventoryCurrent set      
    n_ReportInventoryCurrent_Number =
	(
	case when isnull(n_ReportInventoryCurrent_Number - @f_ListPutOnOff_WorkOrderQuantity,0) < 0 then 0 else n_ReportInventoryCurrent_Number - @f_ListPutOnOff_WorkOrderQuantity end
	),
    n_ReportInventoryCurrent_OKProductCou = 
	(
	case when isnull(n_ReportInventoryCurrent_OKProductCou - @f_ListPutOnOff_WorkOrderQuantity,0) < 0 then 0 else n_ReportInventoryCurrent_OKProductCou - @f_ListPutOnOff_WorkOrderQuantity end
	),
    n_ReportInventoryCurrent_UnOKProductCou=0,
    n_ReportInventoryCurrent_ReworkProductCou=0,    
    s_ReportInventoryCurrent_Updator=@Operator,
    d_ReportInventoryCurrent_UpdateTime=getdate()
	where s_ReportInventoryCurrent_Code=@s_ReportInventoryCurrent_Code
	and s_ReportInventoryCurrent_GoodsProductCode=@s_ReportInventoryCurrent_GoodsProductCode
	and n_ReportInventoryCurrent_state=1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Space_Id" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_BillStockInOutDetail_Id" DbType:"String" Value:"7FE84D87-8A4A-48EB-8903-2C5882BA7CF1"
（4）ParameterName:"@f_ListPutOnOff_WorkOrderQuantity" DbType:"String" Value:"10"
（5）ParameterName:"@s_ListPutOnOffReason_Id" DbType:"String" Value:""
（6）ParameterName:"@s_ListPutOnOffReason_Reason" DbType:"AnsiString" Value:"null"
（7）ParameterName:"@n_ListPutOnOff_Id" DbType:"String" Value:""
（8）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"String" Value:"CS010402"
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"1003050024"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^