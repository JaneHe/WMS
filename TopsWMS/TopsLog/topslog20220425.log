
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.0.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select COUNT(0) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(@n_Space_Id = '')
 begin
    
    set @index = @index + 1
    continue;
    
 end


 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')


 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.1.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.1.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.1.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：4.1.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：5.1.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务过程[1]：1.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select COUNT(0) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(@n_Space_Id = '')
 begin
    
    set @index = @index + 1
    continue;
    
 end


 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')


 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 16:58:23
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:31
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:36
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:42
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090303"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:48
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:08:52
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:01
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:01
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:01
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.0.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:06
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:07
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Business 业务对象：DelInventoryOperationBillStockInOutDetail 
说明：执行业务检查：1.0.该单据已被提交，该单据明细不能被停用!
***************************************************************************************************************
SQL:

declare @BillStockInOut_Id varchar(max)


select 
@BillStockInOut_Id = [n_BillStockInOut_Id] 
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@:BillStockInOutDetail_Id


if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"205FBB5B-85AF-4AB4-BC59-FB0AB83C8A66"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_RecordInventoryMoveDifferenceCount_Id" DbType:"String" Value:"D8394CF1-3FE7-4931-9E9E-C12D1E115DF3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Business 业务对象：DelInventoryOperationBillStockInOutDetail 
说明：执行业务过程[1]：0.删除盘点单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tRecordInventoryMoveCount set   
    n_RecordInventoryMoveCount_state = 2, 
    s_RecordInventoryMoveCount_Updator = @Operator,
    d_RecordInventoryMoveCount_UpdateTime = getdate()
	where n_RecordInventoryMoveDifferenceCount_Id=@n_RecordInventoryMoveDifferenceCount_Id

	
update tRecordInventoryMoveDifferenceCount set  
    n_RecordInventoryMoveDifferenceCount_state = 2, 
    s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
    d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate()
where n_RecordInventoryMoveDifferenceCount_Id=@n_RecordInventoryMoveDifferenceCount_Id

 
declare @n_BillStockInOut_Id varchar(max)
declare @n_BillStockInOutDetail_QualityStatus varchar(max)
declare @f_BillStockInOutDetail_WorkOrderQuantity varchar(max)

select 
@n_BillStockInOut_Id = [n_BillStockInOut_Id],
@n_BillStockInOutDetail_QualityStatus = [n_BillStockInOutDetail_QualityStatus],
@f_BillStockInOutDetail_WorkOrderQuantity = [f_BillStockInOutDetail_WorkOrderQuantity]
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id


update tBillStockInOut
set [f_BillStockInOut_WorkOrderQuantity] = [f_BillStockInOut_WorkOrderQuantity] - @f_BillStockInOutDetail_WorkOrderQuantity
,[f_BillStockInOut_OKProductCou] = isnull([f_BillStockInOut_OKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 1 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_UnOKProductCou] = isnull([f_BillStockInOut_UnOKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 2 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_ReworkProductCou] = isnull([f_BillStockInOut_ReworkProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 3 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
where [n_BillStockInOut_Id] = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"205FBB5B-85AF-4AB4-BC59-FB0AB83C8A66"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_RecordInventoryMoveDifferenceCount_Id" DbType:"String" Value:"D8394CF1-3FE7-4931-9E9E-C12D1E115DF3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:11
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Business 业务对象：DelInventoryOperationBillStockInOutDetail 
说明：执行业务检查：1.0.该单据已被提交，该单据明细不能被停用!
***************************************************************************************************************
SQL:

declare @BillStockInOut_Id varchar(max)


select 
@BillStockInOut_Id = [n_BillStockInOut_Id] 
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@:BillStockInOutDetail_Id


if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"6214FE62-43CC-4A20-A5A5-7C05E30A7769"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_RecordInventoryMoveDifferenceCount_Id" DbType:"String" Value:"A7CF3074-9F0F-48E2-A08A-E1E674CEE367"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Business 业务对象：DelInventoryOperationBillStockInOutDetail 
说明：执行业务过程[1]：0.删除盘点单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tRecordInventoryMoveCount set   
    n_RecordInventoryMoveCount_state = 2, 
    s_RecordInventoryMoveCount_Updator = @Operator,
    d_RecordInventoryMoveCount_UpdateTime = getdate()
	where n_RecordInventoryMoveDifferenceCount_Id=@n_RecordInventoryMoveDifferenceCount_Id

	
update tRecordInventoryMoveDifferenceCount set  
    n_RecordInventoryMoveDifferenceCount_state = 2, 
    s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
    d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate()
where n_RecordInventoryMoveDifferenceCount_Id=@n_RecordInventoryMoveDifferenceCount_Id

 
declare @n_BillStockInOut_Id varchar(max)
declare @n_BillStockInOutDetail_QualityStatus varchar(max)
declare @f_BillStockInOutDetail_WorkOrderQuantity varchar(max)

select 
@n_BillStockInOut_Id = [n_BillStockInOut_Id],
@n_BillStockInOutDetail_QualityStatus = [n_BillStockInOutDetail_QualityStatus],
@f_BillStockInOutDetail_WorkOrderQuantity = [f_BillStockInOutDetail_WorkOrderQuantity]
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id


update tBillStockInOut
set [f_BillStockInOut_WorkOrderQuantity] = [f_BillStockInOut_WorkOrderQuantity] - @f_BillStockInOutDetail_WorkOrderQuantity
,[f_BillStockInOut_OKProductCou] = isnull([f_BillStockInOut_OKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 1 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_UnOKProductCou] = isnull([f_BillStockInOut_UnOKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 2 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_ReworkProductCou] = isnull([f_BillStockInOut_ReworkProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 3 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
where [n_BillStockInOut_Id] = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"6214FE62-43CC-4A20-A5A5-7C05E30A7769"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_RecordInventoryMoveDifferenceCount_Id" DbType:"String" Value:"A7CF3074-9F0F-48E2-A08A-E1E674CEE367"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:14
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Business 业务对象：DelInventoryOperationBillStockInOutDetail 
说明：执行业务检查：1.0.该单据已被提交，该单据明细不能被停用!
***************************************************************************************************************
SQL:

declare @BillStockInOut_Id varchar(max)


select 
@BillStockInOut_Id = [n_BillStockInOut_Id] 
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@:BillStockInOutDetail_Id


if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"A93CBEA3-59C5-4CEF-BAF2-F60342CDECFA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_RecordInventoryMoveDifferenceCount_Id" DbType:"String" Value:"62F640F2-8E5A-4FDE-AC02-800D02F77698"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Business 业务对象：DelInventoryOperationBillStockInOutDetail 
说明：执行业务过程[1]：0.删除盘点单据明细信息
***************************************************************************************************************
SQL:
 
update tBillStockInOutDetail set  
    n_BillStockInOutDetail_state=2, 
    s_BillStockInOutDetail_Updator=@Operator,
    d_BillStockInOutDetail_UpdateTime=getdate()
	where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id

	 
update tRecordInventoryMoveCount set   
    n_RecordInventoryMoveCount_state = 2, 
    s_RecordInventoryMoveCount_Updator = @Operator,
    d_RecordInventoryMoveCount_UpdateTime = getdate()
	where n_RecordInventoryMoveDifferenceCount_Id=@n_RecordInventoryMoveDifferenceCount_Id

	
update tRecordInventoryMoveDifferenceCount set  
    n_RecordInventoryMoveDifferenceCount_state = 2, 
    s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
    d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate()
where n_RecordInventoryMoveDifferenceCount_Id=@n_RecordInventoryMoveDifferenceCount_Id

 
declare @n_BillStockInOut_Id varchar(max)
declare @n_BillStockInOutDetail_QualityStatus varchar(max)
declare @f_BillStockInOutDetail_WorkOrderQuantity varchar(max)

select 
@n_BillStockInOut_Id = [n_BillStockInOut_Id],
@n_BillStockInOutDetail_QualityStatus = [n_BillStockInOutDetail_QualityStatus],
@f_BillStockInOutDetail_WorkOrderQuantity = [f_BillStockInOutDetail_WorkOrderQuantity]
from tBillStockInOutDetail with(nolock)
where n_BillStockInOutDetail_Id=@BillStockInOutDetail_Id


update tBillStockInOut
set [f_BillStockInOut_WorkOrderQuantity] = [f_BillStockInOut_WorkOrderQuantity] - @f_BillStockInOutDetail_WorkOrderQuantity
,[f_BillStockInOut_OKProductCou] = isnull([f_BillStockInOut_OKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 1 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_UnOKProductCou] = isnull([f_BillStockInOut_UnOKProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 2 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
,[f_BillStockInOut_ReworkProductCou] = isnull([f_BillStockInOut_ReworkProductCou],0) - 
(
case @n_BillStockInOutDetail_QualityStatus when 3 then @f_BillStockInOutDetail_WorkOrderQuantity else 0 end
)
where [n_BillStockInOut_Id] = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOutDetail_Id" DbType:"String" Value:"A93CBEA3-59C5-4CEF-BAF2-F60342CDECFA"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_RecordInventoryMoveDifferenceCount_Id" DbType:"String" Value:"62F640F2-8E5A-4FDE-AC02-800D02F77698"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:17
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:18
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:21
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:25
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.0.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select MAX(RowId) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(isnull(@n_Space_Id,'') <> '')
 begin
     
     
 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')
		   
    
 end 

 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"80692412109060001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"8069241"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"129F8E7D-28E6-4EBC-A08D-079FDE07CE6D"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090303"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"8069241"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/前保PMA支架塑件/左"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.1.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.1.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.1.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：4.1.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：5.1.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:28
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务过程[1]：1.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select MAX(RowId) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(isnull(@n_Space_Id,'') <> '')
 begin
     
     
 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')
		   
    
 end 

 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242108300001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"CC94FB31-6543-4095-B962-653CCECA0DEF"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A090306"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:29
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:31
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:34
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:45
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:48
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:09:58
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:10:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:10:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:10:12
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:52
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:17:56
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:18:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:18:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:18:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:18:55
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:19:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:19:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:19:01
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:13
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:18
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:21:36
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:47
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:22:53
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:09
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:11
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:23:16
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:29
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:24:34
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:17
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:21
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:26
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:35
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:28:39
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:28
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:29:35
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:07
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:17
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:30:50
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:30
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:38
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:42
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:43
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:31:51
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:50
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:32:57
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:03
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:33:10
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:35:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:35:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:35:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:35:55
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:02
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:18
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:25
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:27
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:31
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:34
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:42
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:45
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A090306"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:47
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:37:53
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:38:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:38:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:38:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:38:58
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:49
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:51
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:39:59
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:12
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:14
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:30
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by GoodsBarCode asc),* from (
 select 
--[Columns]
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id, 
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode as GoodsBarCode
--[/Columns]
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:30
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
 select 
 R=1 
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Business 业务对象：DelInventoryOperationBillStockInOut 
说明：执行业务检查：1.0.该单据已经被提交，不能停用，请重新刷新确认
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Business 业务对象：DelInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.删除盘点单据记录
***************************************************************************************************************
SQL:
update tBillStockInOut set n_BillStockInOut_state = 2,
s_BillStockInOut_Updator = @Operator, 
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id

update tBillStockInOutDetail set n_BillStockInOutDetail_state = 2,
s_BillStockInOutDetail_Updator = @Operator, 
d_BillStockInOutDetail_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id


 update tRecordInventoryMoveDifferenceCount 
 set [n_RecordInventoryMoveDifferenceCount_state] = 2,
 [s_RecordInventoryMoveDifferenceCount_Updator] = @Operator,
 [d_RecordInventoryMoveDifferenceCount_UpdateTime] = getdate()
 from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id

 
 update tRecordInventoryMoveCount 
 set [n_RecordInventoryMoveCount_state] = 2,
 [s_RecordInventoryMoveCount_Updator] = @Operator,
 [d_RecordInventoryMoveCount_UpdateTime] = getdate()
 from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"F90569FC-60BA-4DC6-9363-B48F64B846FB"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:39
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:40
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:40
类型：Query 查询对象：SelInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:52
类型：Business 业务对象：InsertInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    3,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220425174040569"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Warehouse_Id" DbType:"String" Value:"15E6A121-FEEA-4DA8-A54F-E29A60A6A41C"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（8）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
（9）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:40:58
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:04
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93DE5CAC-CDA1-4B52-B2F2-7F0D357FFA21"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:07
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"93DE5CAC-CDA1-4B52-B2F2-7F0D357FFA21"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050205"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:18
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Business 业务对象：DelInventoryOperationBillStockInOut 
说明：执行业务检查：1.0.该单据已经被提交，不能停用，请重新刷新确认
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"93DE5CAC-CDA1-4B52-B2F2-7F0D357FFA21"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Business 业务对象：DelInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.删除盘点单据记录
***************************************************************************************************************
SQL:
update tBillStockInOut set n_BillStockInOut_state = 2,
s_BillStockInOut_Updator = @Operator, 
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id

update tBillStockInOutDetail set n_BillStockInOutDetail_state = 2,
s_BillStockInOutDetail_Updator = @Operator, 
d_BillStockInOutDetail_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id


 update tRecordInventoryMoveDifferenceCount 
 set [n_RecordInventoryMoveDifferenceCount_state] = 2,
 [s_RecordInventoryMoveDifferenceCount_Updator] = @Operator,
 [d_RecordInventoryMoveDifferenceCount_UpdateTime] = getdate()
 from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id

 
 update tRecordInventoryMoveCount 
 set [n_RecordInventoryMoveCount_state] = 2,
 [s_RecordInventoryMoveCount_Updator] = @Operator,
 [d_RecordInventoryMoveCount_UpdateTime] = getdate()
 from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"93DE5CAC-CDA1-4B52-B2F2-7F0D357FFA21"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:23
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:24
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:25
类型：Query 查询对象：SelInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:30
类型：Business 业务对象：InsertInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    3,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220425174124683"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Warehouse_Id" DbType:"String" Value:"3343AE8F-3C37-4991-98C9-2B1E008418F4"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（8）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
（9）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:45
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:47
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:41:49
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050205"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:49
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by GoodsBarCode asc),* from (
 select 
--[Columns]
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id, 
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode as GoodsBarCode
--[/Columns]
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"813EE00D-219E-418A-8AFF-51893E22EEE4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:49
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
 select 
 R=1 
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"813EE00D-219E-418A-8AFF-51893E22EEE4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:54
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by GoodsBarCode asc),* from (
 select 
--[Columns]
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id, 
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode as GoodsBarCode
--[/Columns]
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:42:54
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
 select 
 R=1 
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:14
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050105"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:16
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:20
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242110250001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050105"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242110250001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050105"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.0.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242110250001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050105"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242110250001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050105"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242110250001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050105"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select MAX(RowId) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(isnull(@n_Space_Id,'') <> '')
 begin
     
     
 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')
		   
    
 end 

 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242110250001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"D7D5606D-FE8E-4D91-A2C0-7B9B1A43DE0A"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050105"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：1.1.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242111040001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：2.1.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242111040001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：3.1.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242111040001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：4.1.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242111040001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务检查：5.1.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242111040001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount_Inventory 
说明：执行业务过程[1]：1.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select MAX(RowId) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(isnull(@n_Space_Id,'') <> '')
 begin
     
     
 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')
		   
    
 end 

 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BarCode" DbType:"String" Value:"74875242111040001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（5）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"98805D13-13E3-4FBB-90CE-712BE211D6F5"
（6）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（8）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（10）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（11）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（12）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:22
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:26
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:28
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:34
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:42
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E05010"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:43
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E05010"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:55
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:43:55
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:02
类型：Query 查询对象：SelInventoryOperationSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_RIMC_ReportInventoryCurrentDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
      tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:04
类型：Business 业务对象：UpdateInventoryOperationListStockInOut 
说明：执行业务检查：1.0.该单据已经被停用了,不能提交该单据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2  
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:04
类型：Business 业务对象：UpdateInventoryOperationListStockInOut 
说明：执行业务过程[1]：0.提交已选择的盘点单据信息
***************************************************************************************************************
SQL:
 
  
 update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordInventoryMoveCount set 
n_RecordInventoryMoveCount_WhetherToSubmit = 1,
s_RecordInventoryMoveCount_Updator = @Operator,
d_RecordInventoryMoveCount_UpdateTime = getdate()
from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveCount_state = 1


update tRecordInventoryMoveDifferenceCount set 
n_RecordInventoryMoveDifferenceCount_WhetherToSubmit = 1,
s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate() 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1



--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @ReportInventoryCurrent table(
    n_RecordInventoryMoveDifferenceCount_Id varchar(max),
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	n_PartDescription_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max),
    s_RecordInventoryMoveDifferenceCount_GoodsProductName varchar(max), 
    s_RecordInventoryMoveDifferenceCount_ExternalCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
	s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
    s_RecordInventoryMoveDifferenceCount_Model varchar(max),
    s_RecordInventoryMoveDifferenceCount_Color varchar(max),
	s_RecordInventoryMoveDifferenceCount_ECN varchar(max),
	s_RecordInventoryMoveDifferenceCount_QualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_Type varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_Number int, --盘点数量
	n_RIMC_ReportInventoryCurrent_Number int,  --原数量
	n_ListPutOnOff_ShelfForm int
)

insert into @ReportInventoryCurrent(
    n_RecordInventoryMoveDifferenceCount_Id,
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	n_RIMC_ReportInventoryCurrent_Number,
	n_ListPutOnOff_ShelfForm
)
select 
    tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id,
    n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	tRecordInventoryMoveDifferenceCount.n_Space_Id,
	tRecordInventoryMoveDifferenceCount.n_Bin_Id,
	tRecordInventoryMoveDifferenceCount.n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color, 
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	tRecordInventoryMoveDifferenceCount.s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Number,
	n_BillStockInOut_ShelfForm
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
on tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id
 = tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id
inner join tBillStockInOut tBillStockInOut with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
where tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1

 
 --对于单件盘点时从无盘到有，且可能存在适配的在储位信息表外键ID的记录，进行补漏操作
	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = ''
	from @ReportInventoryCurrent RC
	left join tReportInventoryCurrent with(nolock) on 
	tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and tReportInventoryCurrent.n_Space_Id = RC.n_Space_Id
	and tReportInventoryCurrent.n_Bin_Id = RC.n_Bin_Id
	and tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber = RC.s_RecordInventoryMoveDifferenceCount_BatchNumber
	and isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 

	 

--如果提交的单据里已经存在从无到有的数据 (原有数量为0，盘点数量为N,如果盘点数量为1的话则默认将其视为单件盘点)
-----------------------------
 
 --先定义好变量表里@ReportInventoryCurrent的n_ReportInventoryCurrent_Id与n_ReportInventoryCurrentDetail_Id字段
 --定义好后为后续插入tReportInventoryCurrent表和tReportInventoryCurrentDetail表数据做准备
 
 
 --汇总单件盘点的件进行n_ReportInventoryCurrent_Id字段与n_ReportInventoryCurrentDetail_Id字段的给值,
 --确保货物在储位信息表与货物在储位明细信息表的库位记录。
 -------------------------------------------------------------
 declare @ReportInventoryCurrent_GetID table ( 
    n_ReportInventoryCurrent_Id varchar(max),
    n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max), 
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max) 
)

insert into @ReportInventoryCurrent_GetID( 
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus  
)
select  
    NEWID(),
	NEWID(),
	n_Space_Id, 
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus 
from @ReportInventoryCurrent
group by n_Space_Id, 
    n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus

	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = GetID.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = GetID.n_ReportInventoryCurrentDetail_Id
	from @ReportInventoryCurrent RC
	left join @ReportInventoryCurrent_GetID GetID on 
	GetID.s_RecordInventoryMoveDifferenceCount_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and GetID.n_Space_Id = RC.n_Space_Id
	and isnull(GetID.s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = isnull(RC.s_RecordInventoryMoveDifferenceCount_BatchNumber,'')
	and isnull(GetID.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	and ISNULL(GetID.n_Bin_Id,'') = ISNULL(RC.n_Bin_Id,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and isnull(RC.n_ReportInventoryCurrent_Id,'') = ''

-----------------------------------------------------------
 
  

--如果库位中原有数量为1,而盘点数量为0的则视为进行单件录入盘无的操作

update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent RC on RC.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
and RC.s_RecordInventoryMoveDifferenceCount_GoodsBarCode = 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode
where  n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 0
 
  
   

 

-----------------------------

 
 --校正在储位信息明细表的对应储位数量,都要考虑当前库存是批量录入与单件录入相加而成的

 --首先是校正进行批量盘点的数据
 --则需要查询到该库位进行单件录入的件数
 -----------------------------------------
   


 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_OKProductCou = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),

 n_ReportInventoryCurrent_LotsizeNumber = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0), 
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select n_ReportInventoryCurrent_Id,sum(Convert(float,s_RecordInventoryMoveDifferenceCount_Number)) as s_RecordInventoryMoveDifferenceCount_Number
  from @ReportInventoryCurrent
  where n_RIMC_ReportInventoryCurrent_Number > 0
  and n_RecordInventoryMoveDifferenceCount_Type = 1
  group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 
  

 
 -----------------------------------------

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
 
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number +  
 isnull(cou,0),
 
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_Number + 
 isnull(cou,0),
  
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select 
 n_ReportInventoryCurrent_Id,
 sum((case isnull(s_RecordInventoryMoveDifferenceCount_Number,0) when 1 then 1 when 0 then -1 else 0 end)) as cou
 from @ReportInventoryCurrent 
 where n_RecordInventoryMoveDifferenceCount_Type = 2
 group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id 
 where n_ReportInventoryCurrent_state = 1   

 
      
 -----------------------------------------
  
  
 --根据变量表@ReportInventoryCurrent插入tReportInventoryCurrent表
 
insert into tReportInventoryCurrent (
    n_ReportInventoryCurrent_Id,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 

    n_Bin_Id,
    n_PartDescription_Id, 
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_ECN,  
    s_ReportInventoryCurrent_GoodsProductName,

    s_ReportInventoryCurrent_GoodsProductCode,
    s_ReportInventoryCurrent_ExternalCode,
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,

    n_ReportInventoryCurrent_ReworkProductCou,
    n_ReportInventoryCurrent_LotsizeNumber,
    n_ReportInventoryCurrent_SingleNumber,
    s_ReportInventoryCurrent_BatchNumber,
    s_ReportInventoryCurrent_SpecificationAndModel,
    s_ReportInventoryCurrent_Unit,
    s_ReportInventoryCurrent_Model,

    s_ReportInventoryCurrent_Color, 
    n_ReportInventoryCurrent_state,
    s_ReportInventoryCurrent_Creator,
    d_ReportInventoryCurrent_CreateTime,
    s_ReportInventoryCurrent_Updator,

    d_ReportInventoryCurrent_UpdateTime,
    s_ReportInventoryCurrent_QualityStatus,
	n_ReportInventoryCurrent_QCQualityStatus
)
select 
n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,
tSpace.n_Shopfloor_Id,
tSpace.n_Rack_Id,
RC.n_Space_Id,

RC.n_Bin_Id,
n_PartDescription_Id,
tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_ECN,  
s_RecordInventoryMoveDifferenceCount_GoodsProductName, 

s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_ExternalCode, 
sum(s_RecordInventoryMoveDifferenceCount_Number),
sum(s_RecordInventoryMoveDifferenceCount_Number),
0,

0,
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 2 then sum(isnull(s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 1 then sum(isnull(s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
s_RecordInventoryMoveDifferenceCount_BatchNumber,
s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,

s_RecordInventoryMoveDifferenceCount_Color, 
1,
@Operator,
getdate(),
@Operator,

getdate(),
s_RecordInventoryMoveDifferenceCount_QualityStatus,
n_RecordInventoryMoveDifferenceCount_QCQualityStatus

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and not exists(select 1 from tReportInventoryCurrent with(nolock) where n_ReportInventoryCurrent_Id = RC.n_ReportInventoryCurrent_Id)
group by n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,tSpace.n_Shopfloor_Id,tSpace.n_Rack_Id,
RC.n_Space_Id, RC.n_Bin_Id,n_PartDescription_Id,
tSpace.s_Space_BarCode,s_RecordInventoryMoveDifferenceCount_ECN,s_RecordInventoryMoveDifferenceCount_GoodsProductName,s_RecordInventoryMoveDifferenceCount_GoodsProductCode,s_RecordInventoryMoveDifferenceCount_ExternalCode, 
s_RecordInventoryMoveDifferenceCount_BatchNumber,s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,s_RecordInventoryMoveDifferenceCount_Model,s_RecordInventoryMoveDifferenceCount_Color,
s_RecordInventoryMoveDifferenceCount_QualityStatus,n_RecordInventoryMoveDifferenceCount_QCQualityStatus,s_RecordInventoryMoveDifferenceCount_Number,n_ListPutOnOff_ShelfForm

   
  


--如果库位中原有数量为0,而盘点数量为1的则视为进行单件录入盘点的操作


insert into tReportInventoryCurrentDetail_GoodsBarCodeInfo (
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id,
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
    n_Space_Id,
    n_PartDescription_Id,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductName,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_ExternalCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpecificationAndModel,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Unit,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Model,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Color,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus,

    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperatime, 
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Creator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_CreateTime,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState
)
select
newID(),
n_ReportInventoryCurrent_Id,
n_ReportInventoryCurrentDetail_Id, 
RC.n_Space_Id,
n_PartDescription_Id,

tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_GoodsProductName,  
s_RecordInventoryMoveDifferenceCount_ExternalCode,
s_RecordInventoryMoveDifferenceCount_BatchNumber,

s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,
s_RecordInventoryMoveDifferenceCount_Color, 
s_RecordInventoryMoveDifferenceCount_QualityStatus,

n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
@Operator,
getdate(),
1,

@Operator,
getdate(),
@Operator,
getdate(),
1

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 1

   
  
 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
  


 update tReportInventoryCurrent set 
n_ReportInventoryCurrent_SingleNumber = isnull(cou,0) 
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @ReportInventoryCurrent RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1   
 and n_RecordInventoryMoveDifferenceCount_Type = 2

      
 -----------------------------------------

-- -----------------------------------------
   
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8F5D0760-A8FA-4F5E-B42B-CAF6D1545E65"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:06
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:08
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:08
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:39
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"AAE8C5D7-DD0C-4888-B142-D4D730BE44BF"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/4/25 17:44:42
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^