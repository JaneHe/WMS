
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:30
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:33
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:33
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmscszycd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kccxsczd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"jus"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmsddzdcjtj"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-bqdygl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-xjcssczd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-qc"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-zxzccrk"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:37
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:44
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:44
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:10:44
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmscszycd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kccxsczd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"jus"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmsddzdcjtj"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-bqdygl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-xjcssczd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-qc"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-zxzccrk"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:23:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:01
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PurchasedInventoryOperation"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"PurchasedInventoryOperation"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelPurchasedInventoryOperationBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除盘点单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"DelPurchasedInventoryOperationBillStockInOutDetail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"删除盘点单据明细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifferenceCount_Single"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增异动盘点信息记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryOperationBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增盘点单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedRecordInventoryMoveDifferenceCount"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增异动盘点信息记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：6.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"UpdatePurchasedInventoryOperationListStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交已选择的盘点单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：7.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedDisplacementSingleBinGoodsInfo_Single"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据条码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：8.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询盘点单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：9.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据条码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：10.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryGoodsInfo_Single"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据条码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：11.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryOperationBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建盘点单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：12.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryOperationWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询盘点单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：13.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventorySubmitBillStockInOutDetails"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询需提交的盘点单据的单据明细记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：14.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryGoodsInfo_Inventory"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询在库的库位详细信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:54:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：15.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifference_Inventory"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增异动盘点信息记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:13
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:13
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.79 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:18
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:25
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:30
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 9:59:31
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:06:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:06:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:06:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:06:55
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:06:57
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:39
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:42
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B1B7BE62-8BAA-4CBA-9BA7-6434DB3C9353"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:59
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:08:59
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:00
类型：Query 查询对象：SelInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:12
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:09:13
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:31
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:32
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:54
类型：Business 业务对象：InsertPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    8,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（4）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（5）ParameterName:"@Warehouse_Id" DbType:"String" Value:"3343AE8F-3C37-4991-98C9-2B1E008418F4"
（6）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505101031733"
（7）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（8）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"2"
（9）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:10:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:11
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:16
类型：Business 业务对象：DelPurchasedInventoryOperationBillStockInOut 
说明：执行业务检查：1.0.该单据已经被提交，不能停用，请重新刷新确认
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"382BF267-F449-41CA-A361-96820A1497C3"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:16
类型：Business 业务对象：DelPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.删除盘点单据记录
***************************************************************************************************************
SQL:
update tBillStockInOut set n_BillStockInOut_state = 2,
s_BillStockInOut_Updator = @Operator, 
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id

update tBillStockInOutDetail set n_BillStockInOutDetail_state = 2,
s_BillStockInOutDetail_Updator = @Operator, 
d_BillStockInOutDetail_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id


 update tRecordInventoryMoveDifferenceCount 
 set [n_RecordInventoryMoveDifferenceCount_state] = 2,
 [s_RecordInventoryMoveDifferenceCount_Updator] = @Operator,
 [d_RecordInventoryMoveDifferenceCount_UpdateTime] = getdate()
 from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id

 
 update tRecordInventoryMoveCount 
 set [n_RecordInventoryMoveCount_state] = 2,
 [s_RecordInventoryMoveCount_Updator] = @Operator,
 [d_RecordInventoryMoveCount_UpdateTime] = getdate()
 from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"382BF267-F449-41CA-A361-96820A1497C3"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:17
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:34
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:34
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:46
类型：Business 业务对象：InsertPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    8,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（4）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（5）ParameterName:"@Warehouse_Id" DbType:"String" Value:"3343AE8F-3C37-4991-98C9-2B1E008418F4"
（6）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505101134118"
（7）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（8）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"3"
（9）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:11:56
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Business 业务对象：DelPurchasedInventoryOperationBillStockInOut 
说明：执行业务检查：1.0.该单据已经被提交，不能停用，请重新刷新确认
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"DAB46BB7-46D8-4A5B-A2DD-CE8C5AB62A34"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Business 业务对象：DelPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.删除盘点单据记录
***************************************************************************************************************
SQL:
update tBillStockInOut set n_BillStockInOut_state = 2,
s_BillStockInOut_Updator = @Operator, 
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id

update tBillStockInOutDetail set n_BillStockInOutDetail_state = 2,
s_BillStockInOutDetail_Updator = @Operator, 
d_BillStockInOutDetail_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id


 update tRecordInventoryMoveDifferenceCount 
 set [n_RecordInventoryMoveDifferenceCount_state] = 2,
 [s_RecordInventoryMoveDifferenceCount_Updator] = @Operator,
 [d_RecordInventoryMoveDifferenceCount_UpdateTime] = getdate()
 from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id

 
 update tRecordInventoryMoveCount 
 set [n_RecordInventoryMoveCount_state] = 2,
 [s_RecordInventoryMoveCount_Updator] = @Operator,
 [d_RecordInventoryMoveCount_UpdateTime] = getdate()
 from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"DAB46BB7-46D8-4A5B-A2DD-CE8C5AB62A34"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:00
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:07
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:07
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:13
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:13
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-ywcz"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmscszycd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kccxsczd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"jus"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmsddzdcjtj"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-bqdygl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-xjcssczd"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-qc"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-zxzccrk"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator



/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:22
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifference_Inventory"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifference_Inventory"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifference_Inventory"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifference_Inventory"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertPurchasedInventoryMoveDifference_Inventory"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:27
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelPurchasedInventoryGoodsInfo_Inventory"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:57
类型：Business 业务对象：InsertPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    8,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（4）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（5）ParameterName:"@Warehouse_Id" DbType:"String" Value:"3343AE8F-3C37-4991-98C9-2B1E008418F4"
（6）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505101207055"
（7）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（8）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"3"
（9）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:12:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:00
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:13
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050205"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:17
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:26
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:34
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:37
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:43
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:13:50
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:53
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:56
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:15:59
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:01
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:16:55
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:20:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:20:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:20:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:20:43
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:17
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:21:19
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:22:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:22:56
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:22:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:22:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:22:56
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:08
类型：Business 业务对象：InsertPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    8,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（4）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（5）ParameterName:"@Warehouse_Id" DbType:"String" Value:"3343AE8F-3C37-4991-98C9-2B1E008418F4"
（6）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505102256172"
（7）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（8）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"2"
（9）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:54
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @GoodsBarCodes varchar(max) = @GoodsBarCode

--截取批次号
declare @Batch varchar(max) = substring(@GoodsBarCodes,len(@GoodsBarCodes) - 9,6)
--截取产品编码
declare @ProductCode varchar(max) = substring(@GoodsBarCodes,0,len(@GoodsBarCodes) - 9)
 
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 s_CustomerCode varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max), 
	 n_ReportInventoryCurrent_Id varchar(max),  
	 n_ReportInventoryCurrentDetail_Id varchar(max), 
	 n_Bin_Id varchar(max),
	 s_SurplusAmount int
 )
  
--查询条码的对应信息
 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 s_CustomerCode,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
select 
@GoodsBarCodes,
s_PartDescription_Code,
s_PartDescription_Name,
s_PartDescription_Code,
1,
'',
'',
'',
'',
'',
@Batch,
0

from tPartDescription with(nolock)
where n_PartDescription_state = 1
and s_PartDescription_Code = @ProductCode
group by s_PartDescription_Code,
s_PartDescription_Name,
s_PartDescription_Code

 

--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = '0'

set @n_BillStockInOut_QCQualityStatus = isnull((
select 
top 1 n_BillStockInOut_QCQualityStatus 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id),'0')


------------------------------------------------------------
--根据条码与储位二维码查询在储位信息，如果是在库位，则填充剩下四个字段的信息 

 declare @n_ReportInventoryCurrent_Number int 
 declare @n_ReportInventoryCurrent_Id varchar(max)
 declare @n_ReportInventoryCurrentDetail_Id varchar(max)
 declare @n_Bin_Id varchar(max)

 select  
 @n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
 @n_ReportInventoryCurrentDetail_Id = '',
 @n_Bin_Id = isnull(tReportInventoryCurrent.n_Bin_Id,'')
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
 on tab.s_CustomerCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and isnull(n_ReportInventoryCurrent_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
 and n_ReportInventoryCurrent_Number > 0 


  select 
  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrent.n_ReportInventoryCurrent_Number)  
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
 on tab.s_CustomerCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber 
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and isnull(n_ReportInventoryCurrent_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
and isnull(tReportInventoryCurrent.n_Bin_Id,'') = @n_Bin_Id 
 and n_ReportInventoryCurrent_Number > 0 

 

--检查该库位的库存是否存在单件录入的库存，有的话需要筛选掉单件录入的库存
set @n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number - isnull((
select 
 cou
from @Tab Tab
left join (
select 
n_Space_Id,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
 and isnull(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
 and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode = @SpaceBarCode
 group by n_Space_Id,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber) tReportInventoryCurrentDetail_GoodsBarCodeInfo
on Tab.s_CustomerCode = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode
 and Tab.s_Batch = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber),0)


  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
 n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id,
 n_Bin_Id = @n_Bin_Id
 
------------------------------------------------------------




------------------------------------------------------------
--如果根据条码与储位二维码查询不到在储位信息，则是属于从无盘到有的过程，则默认填充数据

if(isnull(@n_ReportInventoryCurrent_Id,'') = '')
begin

update @Tab
 set s_SurplusAmount = 0,
 n_ReportInventoryCurrent_Id = '',
 n_ReportInventoryCurrentDetail_Id = '',
 n_Bin_Id = ''

end
 
------------------------------------------------------------
  select * from @Tab
  where n_ReportInventoryCurrent_Id is not null
  or n_ReportInventoryCurrentDetail_Id is not null


-- declare @Tab table(
--     s_LogCode varchar(max),
--     s_MotherCode varchar(max),
--     s_Mother_Desc varchar(max),
--	 s_CustomerCode varchar(max),
--	 n_ModelState varchar(max),
--	 n_PartTypeId varchar(max),
--	 s_CarColor varchar(max),
--	 s_CarBrand varchar(max),
--	 s_CarSeries varchar(max),
--	 s_CarType varchar(max),
--	 s_Batch varchar(max), 
--	 n_ReportInventoryCurrent_Id varchar(max),  
--	 n_ReportInventoryCurrentDetail_Id varchar(max), 
--	 n_Bin_Id varchar(max),
--	 s_SurplusAmount int
-- )
  
----查询条码的对应信息
-- insert into @Tab(
--     s_LogCode,
--     s_MotherCode,
--     s_Mother_Desc,
--	 s_CustomerCode,
--	 n_ModelState,
--	 n_PartTypeId,
--	 s_CarColor,
--	 s_CarBrand,
--	 s_CarSeries,
--	 s_CarType,
--	 s_Batch,
--	 s_SurplusAmount
-- )
-- select 
-- s_LogCode,s_MotherCode,
--(case when len(s_Mother_Desc) >= 30 then SUBSTRING(s_Mother_Desc,0,CHARINDEX('~',s_Mother_Desc,0)) else s_Mother_Desc end)  as s_Mother_Desc
--,s_CustomerCode,n_ModelState,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount from
-- (
-- select RowId = row_number() over(order by n_WorkLogId desc),
-- s_LogCode,s_MotherCode, 
--(case isnull(s_Mother_Desc,'') when '' then s_CarSeries + '/' + s_CarType + '/'+s_CarColor else s_Mother_Desc end) as s_Mother_Desc,
--n_ModelState,(case isnull(s_CustomerCode,'') when '' then n_PaintMCode else s_CustomerCode end) as s_CustomerCode,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0 as s_SurplusAmount
--from TopsERP_BIZ.dbo.tWorkLog with(nolock)
--left join (
--select  
--s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_CustomerCode 
--from TopsERP_BIZ.dbo.tPaintConsump_New with(nolock) where n_State = 1 and s_Bom_Type is null
--group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType,s_CustomerCode 
--) tPaintConsump_New on tWorkLog.n_PaintMCode = tPaintConsump_New.s_CustomerCode
--where s_LogCode =  @GoodsBarCode
--and tWorkLog.n_State = 1)K where RowId = 1
--group by s_LogCode,s_MotherCode,s_Mother_Desc,n_ModelState,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount,s_CustomerCode

 

----查询对应的货物可用状态
--declare @n_BillStockInOut_QCQualityStatus varchar(max) = '0'

--set @n_BillStockInOut_QCQualityStatus = isnull((
--select 
--top 1 n_BillStockInOut_QCQualityStatus 
--from tBillStockInOut with(nolock) 
--where n_BillStockInOut_Id = @n_BillStockInOut_Id),'0')


--------------------------------------------------------------
----根据条码与储位二维码查询在储位信息，如果是在库位，则填充剩下四个字段的信息 

-- declare @n_ReportInventoryCurrent_Number int 
-- declare @n_ReportInventoryCurrent_Id varchar(max)
-- declare @n_ReportInventoryCurrentDetail_Id varchar(max)
-- declare @n_Bin_Id varchar(max)

-- select  
-- @n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
-- @n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id,
-- @n_Bin_Id = isnull(tReportInventoryCurrentDetail.n_Bin_Id,'')
-- from @Tab tab
-- inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
-- on tab.s_CustomerCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
-- and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
-- where n_ReportInventoryCurrentDetail_state = 1
-- and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
-- and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and isnull(n_ReportInventoryCurrentDetail_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
-- and n_ReportInventoryCurrentDetail_Number > 0 


--  select 
--  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)  
-- from @Tab tab
-- inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
-- on tab.s_CustomerCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
-- and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber 
-- where n_ReportInventoryCurrentDetail_state = 1
-- and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
-- and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and isnull(n_ReportInventoryCurrentDetail_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
--and isnull(tReportInventoryCurrentDetail.n_Bin_Id,'') = @n_Bin_Id 
-- and n_ReportInventoryCurrentDetail_Number > 0 

 

----检查该库位的库存是否存在单件录入的库存，有的话需要筛选掉单件录入的库存
--set @n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number - isnull((
--select 
-- cou
--from @Tab Tab
--left join (
--select 
--n_Space_Id,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,
--Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
--from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
--where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
--and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
-- and isnull(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
-- and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode = @SpaceBarCode
-- group by n_Space_Id,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber) tReportInventoryCurrentDetail_GoodsBarCodeInfo
--on Tab.s_CustomerCode = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode
-- and Tab.s_Batch = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber),0)


--  update @Tab
-- set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
-- n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
-- n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id,
-- n_Bin_Id = @n_Bin_Id
 
--------------------------------------------------------------




--------------------------------------------------------------
----如果根据条码与储位二维码查询不到在储位信息，则是属于从无盘到有的过程，则默认填充数据

--if(isnull(@n_ReportInventoryCurrent_Id,'') = '')
--begin

--update @Tab
-- set s_SurplusAmount = 0,
-- n_ReportInventoryCurrent_Id = '',
-- n_ReportInventoryCurrentDetail_Id = '',
-- n_Bin_Id = ''

--end
 
--------------------------------------------------------------
--  select * from @Tab
--  where n_ReportInventoryCurrent_Id is not null
--  or n_ReportInventoryCurrentDetail_Id is not null
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74875242110260005"
（1）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（2）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"E050204"
（3）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（5）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：2.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260005"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"30"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"null"
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：3.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260005"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"30"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260005"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"30"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260005"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"30"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:23:59
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：6.0.该单据已录入对应储位的该产品的盘点操作,请重新确认!
***************************************************************************************************************
SQL:

declare @n_Space_Id varchar(max)
set @n_Space_Id = 
(select n_Space_Id from tSpace with(nolock)
where s_Space_BarCode = @:SpaceBarCode
and n_Space_State = 1)

if not exists(
select 1 
from tRecordInventoryMoveCount with(nolock) 
where s_RecordInventoryMoveCount_GoodsProductCode = @:GoodsProductCode
and n_RecordInventoryMoveCount_state = 1
and n_Space_Id = @n_Space_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260005"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"30"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:00
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------

declare @GoodsBarCodes varchar(max) = @BarCode

--截取批次号
declare @Batch varchar(max) = substring(@GoodsBarCodes,len(@GoodsBarCodes) - 9,6)
--截取产品编码
declare @ProductCode varchar(max) = substring(@GoodsBarCodes,0,len(@GoodsBarCodes) - 9)
 
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
 

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) = @Batch


 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select top 1 @WorkLogId = '',  
@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = '',
@n_GoodsName = s_Name,
@s_U9GoodsCode = s_U9_No,
@s_RecordInventoryMoveDifferenceCount_Unit = '',
@s_RecordInventoryMoveDifferenceCount_Model = '',
@s_RecordInventoryMoveDifferenceCount_Color = '',
@s_RecordInventoryMoveDifferenceCount_AI = ''
 from TopsERP_BIZ.dbo.JIT_STD_BOM with(nolock)
 where s_Part_No = @GoodsBarCodes
 and n_State = 1    
 


 --如果在BOM表里找不到对应数据，则需要在存货信息里寻找
 if(isnull(@n_GoodsName,'') = '')
 begin

 select top 1
 @n_GoodsName = s_PartDescription_Name,
 @s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_PartDescription_SpecificationAndModel,
 @s_RecordInventoryMoveDifferenceCount_Unit = s_PartDescription_Unit,
 @s_RecordInventoryMoveDifferenceCount_Model = s_PartDescription_Model,
 @s_RecordInventoryMoveDifferenceCount_Color = s_PartDescription_Color,
 @s_RecordInventoryMoveDifferenceCount_AI = '',
 @s_U9GoodsCode = s_PartDescription_CustomFields1

 from tPartDescription with(nolock)   
 where n_PartDescription_state = 1 and s_PartDescription_Code = @GoodsProductCode 


 end



 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1

 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float

 select 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 

 --如果没有储位ID信息，则说明录入的数据是盘从无到有的数据(在库位中没有的货物，要盘到库位中存在该货物)
 if(isnull(@n_Space_Id,'') = '')
 begin

 select top 1
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id
 from tSpace with(nolock) 
 where s_Space_BarCode = @SpaceBarCode
 and n_Space_State = 1

 end


 if(isnull(@n_ReportInventoryCurrent_QCQualityStatus,'') = '')
 begin
 
 --赋值单据选中的货物可用状态
 set @n_ReportInventoryCurrent_QCQualityStatus = 
 (
 select top 1 isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1
 )

 end

 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
 --如果没有储位ID信息，则说明录入的数据是盘从无到有的数据(在库位中没有的货物，要盘到库位中存在该货物)
if(isnull(@n_ReportInventoryCurrent_Id,'') <> '')
begin
  
--查看该储位对应的单件录入的数量
declare @n_ReportInventoryCurrent_SingleNumber float

set @n_ReportInventoryCurrent_SingleNumber =  
(select  
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) 
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id)

 

INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     select 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@n_Bin_Id
           ,n_ReportInventoryCurrent_Id
           ,s_ReportInventoryCurrent_Code
           ,s_ReportInventoryCurrent_ECN
           ,s_ReportInventoryCurrent_GoodsProductName
           ,s_ReportInventoryCurrent_GoodsProductCode
           ,s_ReportInventoryCurrent_GoodsProductCode
		   ,@n_ReportInventoryCurrent_SingleNumber
           ,n_ReportInventoryCurrent_Number
           ,n_ReportInventoryCurrent_OKProductCou
           ,n_ReportInventoryCurrent_UnOKProductCou
           ,n_ReportInventoryCurrent_ReworkProductCou
           ,s_ReportInventoryCurrent_BatchNumber
           ,s_ReportInventoryCurrent_SpecificationAndModel
           ,s_ReportInventoryCurrent_Unit
           ,s_ReportInventoryCurrent_Model
           ,s_ReportInventoryCurrent_Color
           ,0
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode
		   ,@BarCode
		from [dbo].[tReportInventoryCurrent] with(nolock) 
		where tReportInventoryCurrent.n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 
end
else
begin

INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')



end

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260005"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"30"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:34
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @GoodsBarCodes varchar(max) = @GoodsBarCode

--截取批次号
declare @Batch varchar(max) = substring(@GoodsBarCodes,len(@GoodsBarCodes) - 9,6)
--截取产品编码
declare @ProductCode varchar(max) = substring(@GoodsBarCodes,0,len(@GoodsBarCodes) - 9)
 
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 s_CustomerCode varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max), 
	 n_ReportInventoryCurrent_Id varchar(max),  
	 n_ReportInventoryCurrentDetail_Id varchar(max), 
	 n_Bin_Id varchar(max),
	 s_SurplusAmount int
 )
  
--查询条码的对应信息
 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 s_CustomerCode,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
select 
@GoodsBarCodes,
s_PartDescription_Code,
s_PartDescription_Name,
s_PartDescription_Code,
1,
'',
'',
'',
'',
'',
@Batch,
0

from tPartDescription with(nolock)
where n_PartDescription_state = 1
and s_PartDescription_Code = @ProductCode
group by s_PartDescription_Code,
s_PartDescription_Name,
s_PartDescription_Code

 

--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = '0'

set @n_BillStockInOut_QCQualityStatus = isnull((
select 
top 1 n_BillStockInOut_QCQualityStatus 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id),'0')


------------------------------------------------------------
--根据条码与储位二维码查询在储位信息，如果是在库位，则填充剩下四个字段的信息 

 declare @n_ReportInventoryCurrent_Number int 
 declare @n_ReportInventoryCurrent_Id varchar(max)
 declare @n_ReportInventoryCurrentDetail_Id varchar(max)
 declare @n_Bin_Id varchar(max)

 select  
 @n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
 @n_ReportInventoryCurrentDetail_Id = '',
 @n_Bin_Id = isnull(tReportInventoryCurrent.n_Bin_Id,'')
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
 on tab.s_CustomerCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and isnull(n_ReportInventoryCurrent_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
 and n_ReportInventoryCurrent_Number > 0 


  select 
  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrent.n_ReportInventoryCurrent_Number)  
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
 on tab.s_CustomerCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber 
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and isnull(n_ReportInventoryCurrent_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
and isnull(tReportInventoryCurrent.n_Bin_Id,'') = @n_Bin_Id 
 and n_ReportInventoryCurrent_Number > 0 

 

--检查该库位的库存是否存在单件录入的库存，有的话需要筛选掉单件录入的库存
set @n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number - isnull((
select 
 cou
from @Tab Tab
left join (
select 
n_Space_Id,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
 and isnull(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
 and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode = @SpaceBarCode
 group by n_Space_Id,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber) tReportInventoryCurrentDetail_GoodsBarCodeInfo
on Tab.s_CustomerCode = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode
 and Tab.s_Batch = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber),0)


  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
 n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id,
 n_Bin_Id = @n_Bin_Id
 
------------------------------------------------------------




------------------------------------------------------------
--如果根据条码与储位二维码查询不到在储位信息，则是属于从无盘到有的过程，则默认填充数据

if(isnull(@n_ReportInventoryCurrent_Id,'') = '')
begin

update @Tab
 set s_SurplusAmount = 0,
 n_ReportInventoryCurrent_Id = '',
 n_ReportInventoryCurrentDetail_Id = '',
 n_Bin_Id = ''

end
 
------------------------------------------------------------
  select * from @Tab
  where n_ReportInventoryCurrent_Id is not null
  or n_ReportInventoryCurrentDetail_Id is not null


-- declare @Tab table(
--     s_LogCode varchar(max),
--     s_MotherCode varchar(max),
--     s_Mother_Desc varchar(max),
--	 s_CustomerCode varchar(max),
--	 n_ModelState varchar(max),
--	 n_PartTypeId varchar(max),
--	 s_CarColor varchar(max),
--	 s_CarBrand varchar(max),
--	 s_CarSeries varchar(max),
--	 s_CarType varchar(max),
--	 s_Batch varchar(max), 
--	 n_ReportInventoryCurrent_Id varchar(max),  
--	 n_ReportInventoryCurrentDetail_Id varchar(max), 
--	 n_Bin_Id varchar(max),
--	 s_SurplusAmount int
-- )
  
----查询条码的对应信息
-- insert into @Tab(
--     s_LogCode,
--     s_MotherCode,
--     s_Mother_Desc,
--	 s_CustomerCode,
--	 n_ModelState,
--	 n_PartTypeId,
--	 s_CarColor,
--	 s_CarBrand,
--	 s_CarSeries,
--	 s_CarType,
--	 s_Batch,
--	 s_SurplusAmount
-- )
-- select 
-- s_LogCode,s_MotherCode,
--(case when len(s_Mother_Desc) >= 30 then SUBSTRING(s_Mother_Desc,0,CHARINDEX('~',s_Mother_Desc,0)) else s_Mother_Desc end)  as s_Mother_Desc
--,s_CustomerCode,n_ModelState,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount from
-- (
-- select RowId = row_number() over(order by n_WorkLogId desc),
-- s_LogCode,s_MotherCode, 
--(case isnull(s_Mother_Desc,'') when '' then s_CarSeries + '/' + s_CarType + '/'+s_CarColor else s_Mother_Desc end) as s_Mother_Desc,
--n_ModelState,(case isnull(s_CustomerCode,'') when '' then n_PaintMCode else s_CustomerCode end) as s_CustomerCode,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0 as s_SurplusAmount
--from TopsERP_BIZ.dbo.tWorkLog with(nolock)
--left join (
--select  
--s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_CustomerCode 
--from TopsERP_BIZ.dbo.tPaintConsump_New with(nolock) where n_State = 1 and s_Bom_Type is null
--group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType,s_CustomerCode 
--) tPaintConsump_New on tWorkLog.n_PaintMCode = tPaintConsump_New.s_CustomerCode
--where s_LogCode =  @GoodsBarCode
--and tWorkLog.n_State = 1)K where RowId = 1
--group by s_LogCode,s_MotherCode,s_Mother_Desc,n_ModelState,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount,s_CustomerCode

 

----查询对应的货物可用状态
--declare @n_BillStockInOut_QCQualityStatus varchar(max) = '0'

--set @n_BillStockInOut_QCQualityStatus = isnull((
--select 
--top 1 n_BillStockInOut_QCQualityStatus 
--from tBillStockInOut with(nolock) 
--where n_BillStockInOut_Id = @n_BillStockInOut_Id),'0')


--------------------------------------------------------------
----根据条码与储位二维码查询在储位信息，如果是在库位，则填充剩下四个字段的信息 

-- declare @n_ReportInventoryCurrent_Number int 
-- declare @n_ReportInventoryCurrent_Id varchar(max)
-- declare @n_ReportInventoryCurrentDetail_Id varchar(max)
-- declare @n_Bin_Id varchar(max)

-- select  
-- @n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
-- @n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id,
-- @n_Bin_Id = isnull(tReportInventoryCurrentDetail.n_Bin_Id,'')
-- from @Tab tab
-- inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
-- on tab.s_CustomerCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
-- and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
-- where n_ReportInventoryCurrentDetail_state = 1
-- and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
-- and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and isnull(n_ReportInventoryCurrentDetail_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
-- and n_ReportInventoryCurrentDetail_Number > 0 


--  select 
--  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)  
-- from @Tab tab
-- inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
-- on tab.s_CustomerCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
-- and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber 
-- where n_ReportInventoryCurrentDetail_state = 1
-- and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
-- and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and isnull(n_ReportInventoryCurrentDetail_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
--and isnull(tReportInventoryCurrentDetail.n_Bin_Id,'') = @n_Bin_Id 
-- and n_ReportInventoryCurrentDetail_Number > 0 

 

----检查该库位的库存是否存在单件录入的库存，有的话需要筛选掉单件录入的库存
--set @n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number - isnull((
--select 
-- cou
--from @Tab Tab
--left join (
--select 
--n_Space_Id,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,
--Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
--from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
--where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
--and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
-- and isnull(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
-- and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode = @SpaceBarCode
-- group by n_Space_Id,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber) tReportInventoryCurrentDetail_GoodsBarCodeInfo
--on Tab.s_CustomerCode = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode
-- and Tab.s_Batch = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber),0)


--  update @Tab
-- set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
-- n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
-- n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id,
-- n_Bin_Id = @n_Bin_Id
 
--------------------------------------------------------------




--------------------------------------------------------------
----如果根据条码与储位二维码查询不到在储位信息，则是属于从无盘到有的过程，则默认填充数据

--if(isnull(@n_ReportInventoryCurrent_Id,'') = '')
--begin

--update @Tab
-- set s_SurplusAmount = 0,
-- n_ReportInventoryCurrent_Id = '',
-- n_ReportInventoryCurrentDetail_Id = '',
-- n_Bin_Id = ''

--end
 
--------------------------------------------------------------
--  select * from @Tab
--  where n_ReportInventoryCurrent_Id is not null
--  or n_ReportInventoryCurrentDetail_Id is not null
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"74875242110270006"
（1）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（2）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"E050205"
（3）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（5）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：2.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110270006"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"50"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"null"
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：3.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110270006"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"50"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110270006"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"50"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110270006"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"50"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务检查：6.0.该单据已录入对应储位的该产品的盘点操作,请重新确认!
***************************************************************************************************************
SQL:

declare @n_Space_Id varchar(max)
set @n_Space_Id = 
(select n_Space_Id from tSpace with(nolock)
where s_Space_BarCode = @:SpaceBarCode
and n_Space_State = 1)

if not exists(
select 1 
from tRecordInventoryMoveCount with(nolock) 
where s_RecordInventoryMoveCount_GoodsProductCode = @:GoodsProductCode
and n_RecordInventoryMoveCount_state = 1
and n_Space_Id = @n_Space_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110270006"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"50"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:39
类型：Business 业务对象：InsertPurchasedRecordInventoryMoveDifferenceCount 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------

declare @GoodsBarCodes varchar(max) = @BarCode

--截取批次号
declare @Batch varchar(max) = substring(@GoodsBarCodes,len(@GoodsBarCodes) - 9,6)
--截取产品编码
declare @ProductCode varchar(max) = substring(@GoodsBarCodes,0,len(@GoodsBarCodes) - 9)
 
 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
 

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) = @Batch


 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select top 1 @WorkLogId = '',  
@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = '',
@n_GoodsName = s_Name,
@s_U9GoodsCode = s_U9_No,
@s_RecordInventoryMoveDifferenceCount_Unit = '',
@s_RecordInventoryMoveDifferenceCount_Model = '',
@s_RecordInventoryMoveDifferenceCount_Color = '',
@s_RecordInventoryMoveDifferenceCount_AI = ''
 from TopsERP_BIZ.dbo.JIT_STD_BOM with(nolock)
 where s_Part_No = @GoodsBarCodes
 and n_State = 1    
 


 --如果在BOM表里找不到对应数据，则需要在存货信息里寻找
 if(isnull(@n_GoodsName,'') = '')
 begin

 select top 1
 @n_GoodsName = s_PartDescription_Name,
 @s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_PartDescription_SpecificationAndModel,
 @s_RecordInventoryMoveDifferenceCount_Unit = s_PartDescription_Unit,
 @s_RecordInventoryMoveDifferenceCount_Model = s_PartDescription_Model,
 @s_RecordInventoryMoveDifferenceCount_Color = s_PartDescription_Color,
 @s_RecordInventoryMoveDifferenceCount_AI = '',
 @s_U9GoodsCode = s_PartDescription_CustomFields1

 from tPartDescription with(nolock)   
 where n_PartDescription_state = 1 and s_PartDescription_Code = @GoodsProductCode 


 end



 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1

 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float

 select 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 

 --如果没有储位ID信息，则说明录入的数据是盘从无到有的数据(在库位中没有的货物，要盘到库位中存在该货物)
 if(isnull(@n_Space_Id,'') = '')
 begin

 select top 1
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id
 from tSpace with(nolock) 
 where s_Space_BarCode = @SpaceBarCode
 and n_Space_State = 1

 end


 if(isnull(@n_ReportInventoryCurrent_QCQualityStatus,'') = '')
 begin
 
 --赋值单据选中的货物可用状态
 set @n_ReportInventoryCurrent_QCQualityStatus = 
 (
 select top 1 isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1
 )

 end

 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
 --如果没有储位ID信息，则说明录入的数据是盘从无到有的数据(在库位中没有的货物，要盘到库位中存在该货物)
if(isnull(@n_ReportInventoryCurrent_Id,'') <> '')
begin
  
--查看该储位对应的单件录入的数量
declare @n_ReportInventoryCurrent_SingleNumber float

set @n_ReportInventoryCurrent_SingleNumber =  
(select  
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) 
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id)

 

INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     select 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@n_Bin_Id
           ,n_ReportInventoryCurrent_Id
           ,s_ReportInventoryCurrent_Code
           ,s_ReportInventoryCurrent_ECN
           ,s_ReportInventoryCurrent_GoodsProductName
           ,s_ReportInventoryCurrent_GoodsProductCode
           ,s_ReportInventoryCurrent_GoodsProductCode
		   ,@n_ReportInventoryCurrent_SingleNumber
           ,n_ReportInventoryCurrent_Number
           ,n_ReportInventoryCurrent_OKProductCou
           ,n_ReportInventoryCurrent_UnOKProductCou
           ,n_ReportInventoryCurrent_ReworkProductCou
           ,s_ReportInventoryCurrent_BatchNumber
           ,s_ReportInventoryCurrent_SpecificationAndModel
           ,s_ReportInventoryCurrent_Unit
           ,s_ReportInventoryCurrent_Model
           ,s_ReportInventoryCurrent_Color
           ,0
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode
		   ,@BarCode
		from [dbo].[tReportInventoryCurrent] with(nolock) 
		where tReportInventoryCurrent.n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 
end
else
begin

INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')



end

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BinBarCode" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（4）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050205"
（5）ParameterName:"@BarCode" DbType:"String" Value:"74875242110270006"
（6）ParameterName:"@SureAmount" DbType:"String" Value:"50"
（7）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（8）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（9）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（10）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（11）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件~0"
（12）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:41
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:44
类型：Query 查询对象：SelPurchasedInventorySubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_RIMC_ReportInventoryCurrentDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
      tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:55
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务检查：1.0.该单据已经被停用了,不能提交该单据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2  
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:55
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务过程[1]：0.提交已选择的盘点单据信息
***************************************************************************************************************
SQL:
 
  
 update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordInventoryMoveCount set 
n_RecordInventoryMoveCount_WhetherToSubmit = 1,
s_RecordInventoryMoveCount_Updator = @Operator,
d_RecordInventoryMoveCount_UpdateTime = getdate()
from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveCount_state = 1


update tRecordInventoryMoveDifferenceCount set 
n_RecordInventoryMoveDifferenceCount_WhetherToSubmit = 1,
s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate() 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @ReportInventoryCurrent table(
    n_RecordInventoryMoveDifferenceCount_Id varchar(max),
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	n_PartDescription_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max),
    s_RecordInventoryMoveDifferenceCount_GoodsProductName varchar(max), 
    s_RecordInventoryMoveDifferenceCount_ExternalCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
	s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
    s_RecordInventoryMoveDifferenceCount_Model varchar(max),
    s_RecordInventoryMoveDifferenceCount_Color varchar(max),
	s_RecordInventoryMoveDifferenceCount_ECN varchar(max),
	s_RecordInventoryMoveDifferenceCount_QualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_Type varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_Number int, --盘点数量
	n_RIMC_ReportInventoryCurrent_Number int,  --原数量
	n_ListPutOnOff_ShelfForm int
)

insert into @ReportInventoryCurrent(
    n_RecordInventoryMoveDifferenceCount_Id,
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	n_RIMC_ReportInventoryCurrent_Number,
	n_ListPutOnOff_ShelfForm
)
select 
    tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id,
    n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	tRecordInventoryMoveDifferenceCount.n_Space_Id,
	tRecordInventoryMoveDifferenceCount.n_Bin_Id,
	tRecordInventoryMoveDifferenceCount.n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color, 
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	tRecordInventoryMoveDifferenceCount.s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Number,
	n_BillStockInOut_ShelfForm
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)  
on tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id
 = tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id 
inner join tBillStockInOut tBillStockInOut with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id

where tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1

 
 --对于单件盘点时从无盘到有，且可能存在适配的在储位信息表外键ID的记录，进行补漏操作
	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = ''
	from @ReportInventoryCurrent RC
	left join tReportInventoryCurrent with(nolock) on 
	tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and tReportInventoryCurrent.n_Space_Id = RC.n_Space_Id
	and tReportInventoryCurrent.n_Bin_Id = RC.n_Bin_Id
	and tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber = RC.s_RecordInventoryMoveDifferenceCount_BatchNumber
	and isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 

	 

--如果提交的单据里已经存在从无到有的数据 (原有数量为0，盘点数量为N,如果盘点数量为1的话则默认将其视为单件盘点)
-----------------------------
 
 --先定义好变量表里@ReportInventoryCurrent的n_ReportInventoryCurrent_Id与n_ReportInventoryCurrentDetail_Id字段
 --定义好后为后续插入tReportInventoryCurrent表和tReportInventoryCurrentDetail表数据做准备
 
 
 --汇总单件盘点的件进行n_ReportInventoryCurrent_Id字段与n_ReportInventoryCurrentDetail_Id字段的给值,
 --确保货物在储位信息表与货物在储位明细信息表的库位记录。
 -------------------------------------------------------------
 declare @ReportInventoryCurrent_GetID table ( 
    n_ReportInventoryCurrent_Id varchar(max),
    n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max), 
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max) 
)

insert into @ReportInventoryCurrent_GetID( 
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus  
)
select  
    NEWID(),
	NEWID(),
	n_Space_Id, 
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus 
from @ReportInventoryCurrent
group by n_Space_Id,  
    n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus

	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = GetID.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = GetID.n_ReportInventoryCurrentDetail_Id
	from @ReportInventoryCurrent RC
	left join @ReportInventoryCurrent_GetID GetID on 
	GetID.s_RecordInventoryMoveDifferenceCount_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and GetID.n_Space_Id = RC.n_Space_Id
	and isnull(GetID.s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = isnull(RC.s_RecordInventoryMoveDifferenceCount_BatchNumber,'')
	and isnull(GetID.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	and ISNULL(GetID.n_Bin_Id,'') = ISNULL(RC.n_Bin_Id,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and isnull(RC.n_ReportInventoryCurrent_Id,'') = ''

-----------------------------------------------------------
  

  

--如果库位中原有数量为1,而盘点数量为0的则视为进行单件录入盘无的操作

update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent RC on RC.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
and RC.s_RecordInventoryMoveDifferenceCount_GoodsBarCode = 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode
where  n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 0
 
  

-----------------------------

 
 --校正在储位信息明细表的对应储位数量,都要考虑当前库存是批量录入与单件录入相加而成的

 --首先是校正进行批量盘点的数据
 --则需要查询到该库位进行单件录入的件数
 -----------------------------------------
   


 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_OKProductCou = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_LotsizeNumber = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0), 
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select n_ReportInventoryCurrent_Id,sum(Convert(float,s_RecordInventoryMoveDifferenceCount_Number)) as s_RecordInventoryMoveDifferenceCount_Number
  from @ReportInventoryCurrent
  where n_RIMC_ReportInventoryCurrent_Number > 0
  and n_RecordInventoryMoveDifferenceCount_Type = 1
  group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 

  
 
 -----------------------------------------

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
 
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number +  
 isnull(cou,0),
 
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_Number + 
 isnull(cou,0),
 
-- n_ReportInventoryCurrent_LotsizeNumber = n_ReportInventoryCurrent_Number,
--n_ReportInventoryCurrent_SingleNumber = isnull(cou,0),

 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select 
 n_ReportInventoryCurrent_Id,
 sum((case isnull(s_RecordInventoryMoveDifferenceCount_Number,0) when 1 then 1 when 0 then -1 else 0 end)) as cou
 from @ReportInventoryCurrent 
 where n_RecordInventoryMoveDifferenceCount_Type = 2
 group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id 
 where n_ReportInventoryCurrent_state = 1   


 
 -----------------------------------------
  


  


 --根据变量表@ReportInventoryCurrent插入tReportInventoryCurrent表
 
insert into tReportInventoryCurrent (
    n_ReportInventoryCurrent_Id,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 

    n_Bin_Id,
    n_PartDescription_Id, 
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_ECN,  
    s_ReportInventoryCurrent_GoodsProductName,

    s_ReportInventoryCurrent_GoodsProductCode,
    s_ReportInventoryCurrent_ExternalCode,
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,

    n_ReportInventoryCurrent_ReworkProductCou,
    n_ReportInventoryCurrent_LotsizeNumber,
    n_ReportInventoryCurrent_SingleNumber,
    s_ReportInventoryCurrent_BatchNumber,
    s_ReportInventoryCurrent_SpecificationAndModel,
    s_ReportInventoryCurrent_Unit,
    s_ReportInventoryCurrent_Model,

    s_ReportInventoryCurrent_Color, 
    n_ReportInventoryCurrent_state,
    s_ReportInventoryCurrent_Creator,
    d_ReportInventoryCurrent_CreateTime,
    s_ReportInventoryCurrent_Updator,

    d_ReportInventoryCurrent_UpdateTime,
    s_ReportInventoryCurrent_QualityStatus,
	n_ReportInventoryCurrent_QCQualityStatus
)
select 
n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,
tSpace.n_Shopfloor_Id,
tSpace.n_Rack_Id,
RC.n_Space_Id,

RC.n_Bin_Id,
n_PartDescription_Id,
tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_ECN,  
s_RecordInventoryMoveDifferenceCount_GoodsProductName, 

s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_ExternalCode, 
sum(s_RecordInventoryMoveDifferenceCount_Number),
sum(s_RecordInventoryMoveDifferenceCount_Number),
0,

0,
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 2 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 1 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
s_RecordInventoryMoveDifferenceCount_BatchNumber,
s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,

s_RecordInventoryMoveDifferenceCount_Color, 
1,
@Operator,
getdate(),
@Operator,

getdate(),
s_RecordInventoryMoveDifferenceCount_QualityStatus,
n_RecordInventoryMoveDifferenceCount_QCQualityStatus

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and not exists(select 1 from tReportInventoryCurrent with(nolock) where n_ReportInventoryCurrent_Id = RC.n_ReportInventoryCurrent_Id)
group by n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,tSpace.n_Shopfloor_Id,tSpace.n_Rack_Id,
RC.n_Space_Id, RC.n_Bin_Id,n_PartDescription_Id,
tSpace.s_Space_BarCode,s_RecordInventoryMoveDifferenceCount_ECN,s_RecordInventoryMoveDifferenceCount_GoodsProductName,s_RecordInventoryMoveDifferenceCount_GoodsProductCode,s_RecordInventoryMoveDifferenceCount_ExternalCode, 
s_RecordInventoryMoveDifferenceCount_BatchNumber,s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,s_RecordInventoryMoveDifferenceCount_Model,s_RecordInventoryMoveDifferenceCount_Color,
s_RecordInventoryMoveDifferenceCount_QualityStatus,n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
RC.s_RecordInventoryMoveDifferenceCount_Number,n_ListPutOnOff_ShelfForm

   


--如果库位中原有数量为0,而盘点数量为1的则视为进行单件录入盘点的操作


insert into tReportInventoryCurrentDetail_GoodsBarCodeInfo (
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id,
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
    n_Space_Id,
    n_PartDescription_Id,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductName,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_ExternalCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpecificationAndModel,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Unit,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Model,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Color,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus,

    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperatime, 
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Creator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_CreateTime,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState
)
select
newID(),
n_ReportInventoryCurrent_Id,
n_ReportInventoryCurrentDetail_Id, 
RC.n_Space_Id,
n_PartDescription_Id,

tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_GoodsProductName,  
s_RecordInventoryMoveDifferenceCount_ExternalCode,
s_RecordInventoryMoveDifferenceCount_BatchNumber,

s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,
s_RecordInventoryMoveDifferenceCount_Color, 
s_RecordInventoryMoveDifferenceCount_QualityStatus,

n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
@Operator,
getdate(),
1,

@Operator,
getdate(),
@Operator,
getdate(),
1

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 1

 

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
  
 
 update tReportInventoryCurrent set 
n_ReportInventoryCurrent_SingleNumber = isnull(cou,0) 
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @ReportInventoryCurrent RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1   
 and n_RecordInventoryMoveDifferenceCount_Type = 2

      
 -----------------------------------------
  

-- -----------------------------------------
   
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B63884A2-DF36-401B-BA8E-6DF1DD0453B3"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:24:58
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:25:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:25:16
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:33:57
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:33:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:33:57
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:34:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:34:07
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tReportInventoryCurrent"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:34:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:34:49
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tRecordInventoryMoveDifferenceCount"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:43
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:51
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Business 业务对象：DelInventoryOperationBillStockInOut 
说明：执行业务检查：1.0.该单据已经被提交，不能停用，请重新刷新确认
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B1B7BE62-8BAA-4CBA-9BA7-6434DB3C9353"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Business 业务对象：DelInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.删除盘点单据记录
***************************************************************************************************************
SQL:
update tBillStockInOut set n_BillStockInOut_state = 2,
s_BillStockInOut_Updator = @Operator, 
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id

update tBillStockInOutDetail set n_BillStockInOutDetail_state = 2,
s_BillStockInOutDetail_Updator = @Operator, 
d_BillStockInOutDetail_UpdateTime = getdate()
where n_BillStockInOut_Id = @n_BillStockInOut_Id


 update tRecordInventoryMoveDifferenceCount 
 set [n_RecordInventoryMoveDifferenceCount_state] = 2,
 [s_RecordInventoryMoveDifferenceCount_Updator] = @Operator,
 [d_RecordInventoryMoveDifferenceCount_UpdateTime] = getdate()
 from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id

 
 update tRecordInventoryMoveCount 
 set [n_RecordInventoryMoveCount_state] = 2,
 [s_RecordInventoryMoveCount_Updator] = @Operator,
 [d_RecordInventoryMoveCount_UpdateTime] = getdate()
 from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)
 inner join tBillStockInOut tBillStockInOut with(nolock)
 on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id
 where tBillStockInOut.n_BillStockInOut_Id = @n_BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"B1B7BE62-8BAA-4CBA-9BA7-6434DB3C9353"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:58
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:59
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:41:59
类型：Query 查询对象：SelInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:11
类型：Business 业务对象：InsertInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    3,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505104159479"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Warehouse_Id" DbType:"String" Value:"15E6A121-FEEA-4DA8-A54F-E29A60A6A41C"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（8）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
（9）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:32
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by GoodsBarCode asc),* from (
 select 
--[Columns]
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id, 
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode as GoodsBarCode
--[/Columns]
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"7C16CC3F-F3EA-41FF-B2A2-42B63C04C468"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:32
类型：Query 查询对象：SelReportInventoryCurrentReportDetails 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
 select 
 R=1 
	from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
	where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
	and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
	and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id 
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"AnsiString" Value:"7C16CC3F-F3EA-41FF-B2A2-42B63C04C468"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（4）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:42:54
类型：Query 查询对象：SelInventoryGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 s_CustomerCode varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max), 
	 n_ReportInventoryCurrent_Id varchar(max),  
	 n_ReportInventoryCurrentDetail_Id varchar(max), 
	 n_Bin_Id varchar(max),
	 s_SurplusAmount int
 )
  
--查询条码的对应信息
 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 s_CustomerCode,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
 select 
 s_LogCode,s_MotherCode,
(case when len(s_Mother_Desc) >= 30 then SUBSTRING(s_Mother_Desc,0,CHARINDEX('~',s_Mother_Desc,0)) else s_Mother_Desc end)  as s_Mother_Desc
,s_CustomerCode,n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount from
 (
 select RowId = row_number() over(order by n_WorkLogId desc),
 s_LogCode,s_MotherCode, 
(case isnull(s_Mother_Desc,'') when '' then s_CarSeries + '/' + s_CarType + '/'+s_CarColor else s_Mother_Desc end) as s_Mother_Desc,
n_ModelState,(case isnull(s_CustomerCode,'') when '' then n_PaintMCode else s_CustomerCode end) as s_CustomerCode,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0 as s_SurplusAmount
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
left join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_CustomerCode 
from TopsERP_BIZ.dbo.tPaintConsump_New with(nolock) where n_State = 1 and s_Bom_Type is null
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType,s_CustomerCode 
) tPaintConsump_New on tWorkLog.n_PaintMCode = tPaintConsump_New.s_CustomerCode
where s_LogCode =  @GoodsBarCode
and tWorkLog.n_State in (1,5))K where RowId = 1
group by s_LogCode,s_MotherCode,s_Mother_Desc,n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount,s_CustomerCode

 

--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = '0'

set @n_BillStockInOut_QCQualityStatus = isnull((
select 
top 1 n_BillStockInOut_QCQualityStatus 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id),'0')


------------------------------------------------------------
--根据条码与储位二维码查询在储位信息，如果是在库位，则填充剩下四个字段的信息 

 declare @n_ReportInventoryCurrent_Number int 
 declare @n_ReportInventoryCurrent_Id varchar(max)
 declare @n_ReportInventoryCurrentDetail_Id varchar(max)
 declare @n_Bin_Id varchar(max)

 select  
 @n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
 @n_ReportInventoryCurrentDetail_Id = '',
 @n_Bin_Id = isnull(tReportInventoryCurrent.n_Bin_Id,'')
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
 on tab.s_CustomerCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and isnull(n_ReportInventoryCurrent_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
 and n_ReportInventoryCurrent_Number > 0 


  select 
  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrent.n_ReportInventoryCurrent_Number)  
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) 
 on tab.s_CustomerCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 and tab.s_Batch = tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber 
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and isnull(n_ReportInventoryCurrent_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
and isnull(tReportInventoryCurrent.n_Bin_Id,'') = @n_Bin_Id 
 and n_ReportInventoryCurrent_Number > 0 

 

--检查该库位的库存是否存在单件录入的库存，有的话需要筛选掉单件录入的库存
set @n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number - isnull((
select 
 cou
from @Tab Tab
left join (
select 
n_Space_Id,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
 and isnull(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
 and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode = @SpaceBarCode
 group by n_Space_Id,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber) tReportInventoryCurrentDetail_GoodsBarCodeInfo
on Tab.s_CustomerCode = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode
 and Tab.s_Batch = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber),0)


  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
 n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
 n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id,
 n_Bin_Id = @n_Bin_Id
 
------------------------------------------------------------




------------------------------------------------------------
--如果根据条码与储位二维码查询不到在储位信息，则是属于从无盘到有的过程，则默认填充数据

if(isnull(@n_ReportInventoryCurrent_Id,'') = '')
begin

update @Tab
 set s_SurplusAmount = 0,
 n_ReportInventoryCurrent_Id = '',
 n_ReportInventoryCurrentDetail_Id = '',
 n_Bin_Id = ''

end
 
------------------------------------------------------------
  select * from @Tab
  where n_ReportInventoryCurrent_Id is not null
  or n_ReportInventoryCurrentDetail_Id is not null


-- declare @Tab table(
--     s_LogCode varchar(max),
--     s_MotherCode varchar(max),
--     s_Mother_Desc varchar(max),
--	 s_CustomerCode varchar(max),
--	 n_ModelState varchar(max),
--	 n_PartTypeId varchar(max),
--	 s_CarColor varchar(max),
--	 s_CarBrand varchar(max),
--	 s_CarSeries varchar(max),
--	 s_CarType varchar(max),
--	 s_Batch varchar(max), 
--	 n_ReportInventoryCurrent_Id varchar(max),  
--	 n_ReportInventoryCurrentDetail_Id varchar(max), 
--	 n_Bin_Id varchar(max),
--	 s_SurplusAmount int
-- )
  
----查询条码的对应信息
-- insert into @Tab(
--     s_LogCode,
--     s_MotherCode,
--     s_Mother_Desc,
--	 s_CustomerCode,
--	 n_ModelState,
--	 n_PartTypeId,
--	 s_CarColor,
--	 s_CarBrand,
--	 s_CarSeries,
--	 s_CarType,
--	 s_Batch,
--	 s_SurplusAmount
-- )
-- select 
-- s_LogCode,s_MotherCode,
--(case when len(s_Mother_Desc) >= 30 then SUBSTRING(s_Mother_Desc,0,CHARINDEX('~',s_Mother_Desc,0)) else s_Mother_Desc end)  as s_Mother_Desc
--,s_CustomerCode,n_ModelState,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount from
-- (
-- select RowId = row_number() over(order by n_WorkLogId desc),
-- s_LogCode,s_MotherCode, 
--(case isnull(s_Mother_Desc,'') when '' then s_CarSeries + '/' + s_CarType + '/'+s_CarColor else s_Mother_Desc end) as s_Mother_Desc,
--n_ModelState,(case isnull(s_CustomerCode,'') when '' then n_PaintMCode else s_CustomerCode end) as s_CustomerCode,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0 as s_SurplusAmount
--from TopsERP_BIZ.dbo.tWorkLog with(nolock)
--left join (
--select  
--s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_CustomerCode 
--from TopsERP_BIZ.dbo.tPaintConsump_New with(nolock) where n_State = 1 and s_Bom_Type is null
--group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType,s_CustomerCode 
--) tPaintConsump_New on tWorkLog.n_PaintMCode = tPaintConsump_New.s_CustomerCode
--where s_LogCode =  @GoodsBarCode
--and tWorkLog.n_State = 1)K where RowId = 1
--group by s_LogCode,s_MotherCode,s_Mother_Desc,n_ModelState,
--n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,s_SurplusAmount,s_CustomerCode

 

----查询对应的货物可用状态
--declare @n_BillStockInOut_QCQualityStatus varchar(max) = '0'

--set @n_BillStockInOut_QCQualityStatus = isnull((
--select 
--top 1 n_BillStockInOut_QCQualityStatus 
--from tBillStockInOut with(nolock) 
--where n_BillStockInOut_Id = @n_BillStockInOut_Id),'0')


--------------------------------------------------------------
----根据条码与储位二维码查询在储位信息，如果是在库位，则填充剩下四个字段的信息 

-- declare @n_ReportInventoryCurrent_Number int 
-- declare @n_ReportInventoryCurrent_Id varchar(max)
-- declare @n_ReportInventoryCurrentDetail_Id varchar(max)
-- declare @n_Bin_Id varchar(max)

-- select  
-- @n_ReportInventoryCurrent_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrent_Id,
-- @n_ReportInventoryCurrentDetail_Id = tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Id,
-- @n_Bin_Id = isnull(tReportInventoryCurrentDetail.n_Bin_Id,'')
-- from @Tab tab
-- inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
-- on tab.s_CustomerCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
-- and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber
-- where n_ReportInventoryCurrentDetail_state = 1
-- and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
-- and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and isnull(n_ReportInventoryCurrentDetail_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
-- and n_ReportInventoryCurrentDetail_Number > 0 


--  select 
--  @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrentDetail.n_ReportInventoryCurrentDetail_Number)  
-- from @Tab tab
-- inner join tReportInventoryCurrentDetail tReportInventoryCurrentDetail with(nolock) 
-- on tab.s_CustomerCode = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_GoodsProductCode
-- and tab.s_Batch = tReportInventoryCurrentDetail.s_ReportInventoryCurrentDetail_BatchNumber 
-- where n_ReportInventoryCurrentDetail_state = 1
-- and s_ReportInventoryCurrentDetail_Code = @SpaceBarCode
-- and s_ReportInventoryCurrentDetail_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and isnull(n_ReportInventoryCurrentDetail_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
--and isnull(tReportInventoryCurrentDetail.n_Bin_Id,'') = @n_Bin_Id 
-- and n_ReportInventoryCurrentDetail_Number > 0 

 

----检查该库位的库存是否存在单件录入的库存，有的话需要筛选掉单件录入的库存
--set @n_ReportInventoryCurrent_Number = @n_ReportInventoryCurrent_Number - isnull((
--select 
-- cou
--from @Tab Tab
--left join (
--select 
--n_Space_Id,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,
--Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
--from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
--where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
--and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
-- and isnull(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,'0') = @n_BillStockInOut_QCQualityStatus
-- and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
-- and s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode = @SpaceBarCode
-- group by n_Space_Id,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
--s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber) tReportInventoryCurrentDetail_GoodsBarCodeInfo
--on Tab.s_CustomerCode = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode
-- and Tab.s_Batch = s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber),0)


--  update @Tab
-- set s_SurplusAmount = @n_ReportInventoryCurrent_Number,
-- n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id,
-- n_ReportInventoryCurrentDetail_Id = @n_ReportInventoryCurrentDetail_Id,
-- n_Bin_Id = @n_Bin_Id
 
--------------------------------------------------------------




--------------------------------------------------------------
----如果根据条码与储位二维码查询不到在储位信息，则是属于从无盘到有的过程，则默认填充数据

--if(isnull(@n_ReportInventoryCurrent_Id,'') = '')
--begin

--update @Tab
-- set s_SurplusAmount = 0,
-- n_ReportInventoryCurrent_Id = '',
-- n_ReportInventoryCurrentDetail_Id = '',
-- n_Bin_Id = ''

--end
 
--------------------------------------------------------------
--  select * from @Tab
--  where n_ReportInventoryCurrent_Id is not null
--  or n_ReportInventoryCurrentDetail_Id is not null
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"28100000012009240002"
（1）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（2）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"A340504"
（3）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（5）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount 
说明：执行业务检查：2.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@SureAmount" DbType:"String" Value:"26"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（5）ParameterName:"@GoodsProductCode" DbType:"String" Value:"2810000001"
（6）ParameterName:"@BinBarCode" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"28100000012009240002"
（8）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"null"
（10）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A340504"
（11）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（12）ParameterName:"@GoodsProductName" DbType:"String" Value:"F3XM/前杠/宝石黑"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount 
说明：执行业务检查：3.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@SureAmount" DbType:"String" Value:"26"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（5）ParameterName:"@GoodsProductCode" DbType:"String" Value:"2810000001"
（6）ParameterName:"@BinBarCode" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"28100000012009240002"
（8）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（10）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A340504"
（11）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（12）ParameterName:"@GoodsProductName" DbType:"String" Value:"F3XM/前杠/宝石黑"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@SureAmount" DbType:"String" Value:"26"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（5）ParameterName:"@GoodsProductCode" DbType:"String" Value:"2810000001"
（6）ParameterName:"@BinBarCode" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"28100000012009240002"
（8）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（10）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A340504"
（11）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（12）ParameterName:"@GoodsProductName" DbType:"String" Value:"F3XM/前杠/宝石黑"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@SureAmount" DbType:"String" Value:"26"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（5）ParameterName:"@GoodsProductCode" DbType:"String" Value:"2810000001"
（6）ParameterName:"@BinBarCode" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"28100000012009240002"
（8）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（10）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A340504"
（11）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（12）ParameterName:"@GoodsProductName" DbType:"String" Value:"F3XM/前杠/宝石黑"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount 
说明：执行业务检查：6.0.该单据已录入对应储位的该产品的盘点操作,请重新确认!
***************************************************************************************************************
SQL:

declare @n_Space_Id varchar(max)
set @n_Space_Id = 
(select n_Space_Id from tSpace with(nolock)
where s_Space_BarCode = @:SpaceBarCode
and n_Space_State = 1)

if not exists(
select 1 
from tRecordInventoryMoveCount with(nolock) 
where s_RecordInventoryMoveCount_GoodsProductCode = @:GoodsProductCode
and n_RecordInventoryMoveCount_state = 1
and n_Space_Id = @n_Space_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@SureAmount" DbType:"String" Value:"26"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（5）ParameterName:"@GoodsProductCode" DbType:"String" Value:"2810000001"
（6）ParameterName:"@BinBarCode" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"28100000012009240002"
（8）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（10）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A340504"
（11）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（12）ParameterName:"@GoodsProductName" DbType:"String" Value:"F3XM/前杠/宝石黑"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:00
类型：Business 业务对象：InsertRecordInventoryMoveDifferenceCount 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
 

 --获取喷涂下线QA的结果信息ID,批次信息
 declare @WorkLogId varchar(max),
 @s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 


 --根据货物标识编码查出对应喷涂下线QA的结果信息记录
 select top 1 @WorkLogId = n_WorkLogId, @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_Batch
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = n_PaintMCode,
@s_RecordInventoryMoveDifferenceCount_Unit = '',
@s_RecordInventoryMoveDifferenceCount_Model = s_CarSeries,
@s_RecordInventoryMoveDifferenceCount_Color = s_CarColor,
@s_RecordInventoryMoveDifferenceCount_AI = ''
 from TopsERP_BIZ.dbo.tWorkLog with(nolock)
 where s_LogCode = @BarCode
 and n_State in (1,5)   
order by n_WorkLogId desc


  --获取U9产品编码
 set @s_U9GoodsCode = (select top 1 s_MotherCode from TopsERP_BIZ.dbo.tPaintConsump_New with(nolock)
 where s_CustomerCode = @GoodsProductCode 
 and n_state = 1
 order by n_Id desc) 


 --如果在喷涂下线结果表里找不到对应数据，说明此件不是漆件，则需要在BOM里寻找
 if(isnull(@s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = '')
 begin

 select top 1
 @n_GoodsName = s_PartDescription_Name,
 @s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_PartDescription_SpecificationAndModel,
 @s_RecordInventoryMoveDifferenceCount_Unit = s_PartDescription_Unit,
 @s_RecordInventoryMoveDifferenceCount_Model = s_PartDescription_Model,
 @s_RecordInventoryMoveDifferenceCount_Color = s_PartDescription_Color,
 @s_RecordInventoryMoveDifferenceCount_AI = '',
 @s_U9GoodsCode = s_PartDescription_CustomFields1

 from tPartDescription with(nolock)   
 where n_PartDescription_state = 1 and s_PartDescription_Code = @GoodsProductCode 


 end



 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1

 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float

 select 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 

 --如果没有储位ID信息，则说明录入的数据是盘从无到有的数据(在库位中没有的货物，要盘到库位中存在该货物)
 if(isnull(@n_Space_Id,'') = '')
 begin

 select top 1
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id
 from tSpace with(nolock) 
 where s_Space_BarCode = @SpaceBarCode
 and n_Space_State = 1

 end


 if(isnull(@n_ReportInventoryCurrent_QCQualityStatus,'') = '')
 begin
 
 --赋值单据选中的货物可用状态
 set @n_ReportInventoryCurrent_QCQualityStatus = 
 (
 select top 1 isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 and n_BillStockInOut_state = 1
 )

 end

 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
 --如果没有储位ID信息，则说明录入的数据是盘从无到有的数据(在库位中没有的货物，要盘到库位中存在该货物)
if(isnull(@n_ReportInventoryCurrent_Id,'') <> '')
begin
  
--查看该储位对应的单件录入的数量
declare @n_ReportInventoryCurrent_SingleNumber float

set @n_ReportInventoryCurrent_SingleNumber =  
(select  
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) 
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id)

 

INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     select 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
           ,@n_Bin_Id
           ,n_ReportInventoryCurrent_Id
           ,s_ReportInventoryCurrent_Code
           ,s_ReportInventoryCurrent_ECN
           ,s_ReportInventoryCurrent_GoodsProductName
           ,s_ReportInventoryCurrent_GoodsProductCode
           ,s_ReportInventoryCurrent_GoodsProductCode
		   ,@n_ReportInventoryCurrent_SingleNumber
           ,n_ReportInventoryCurrent_Number
           ,n_ReportInventoryCurrent_OKProductCou
           ,n_ReportInventoryCurrent_UnOKProductCou
           ,n_ReportInventoryCurrent_ReworkProductCou
           ,s_ReportInventoryCurrent_BatchNumber
           ,s_ReportInventoryCurrent_SpecificationAndModel
           ,s_ReportInventoryCurrent_Unit
           ,s_ReportInventoryCurrent_Model
           ,s_ReportInventoryCurrent_Color
           ,0
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode
		   ,@BarCode
		from [dbo].[tReportInventoryCurrent] with(nolock) 
		where tReportInventoryCurrent.n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 
end
else
begin

INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@SureAmount
           ,(case @QualityStatus when 1 then @SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @SureAmount else 0 end)
           ,''
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,1
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')



end

		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@SureAmount" DbType:"String" Value:"26"
（4）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（5）ParameterName:"@GoodsProductCode" DbType:"String" Value:"2810000001"
（6）ParameterName:"@BinBarCode" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"28100000012009240002"
（8）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:""
（9）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（10）ParameterName:"@SpaceBarCode" DbType:"String" Value:"A340504"
（11）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（12）ParameterName:"@GoodsProductName" DbType:"String" Value:"F3XM/前杠/宝石黑"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:07
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:11
类型：Query 查询对象：SelInventoryOperationBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
    n_ReportInventoryCurrent_Id = tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:14
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:15
类型：Query 查询对象：SelInventoryOperationSubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_RIMC_ReportInventoryCurrentDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
      tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:17
类型：Business 业务对象：UpdateInventoryOperationListStockInOut 
说明：执行业务检查：1.0.该单据已经被停用了,不能提交该单据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2  
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:17
类型：Business 业务对象：UpdateInventoryOperationListStockInOut 
说明：执行业务过程[1]：0.提交已选择的盘点单据信息
***************************************************************************************************************
SQL:
 
  
 update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordInventoryMoveCount set 
n_RecordInventoryMoveCount_WhetherToSubmit = 1,
s_RecordInventoryMoveCount_Updator = @Operator,
d_RecordInventoryMoveCount_UpdateTime = getdate()
from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveCount_state = 1


update tRecordInventoryMoveDifferenceCount set 
n_RecordInventoryMoveDifferenceCount_WhetherToSubmit = 1,
s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate() 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1



--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @ReportInventoryCurrent table(
    n_RecordInventoryMoveDifferenceCount_Id varchar(max),
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	n_PartDescription_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max),
    s_RecordInventoryMoveDifferenceCount_GoodsProductName varchar(max), 
    s_RecordInventoryMoveDifferenceCount_ExternalCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
	s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
    s_RecordInventoryMoveDifferenceCount_Model varchar(max),
    s_RecordInventoryMoveDifferenceCount_Color varchar(max),
	s_RecordInventoryMoveDifferenceCount_ECN varchar(max),
	s_RecordInventoryMoveDifferenceCount_QualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_Type varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_Number int, --盘点数量
	n_RIMC_ReportInventoryCurrent_Number int,  --原数量
	n_ListPutOnOff_ShelfForm int
)

insert into @ReportInventoryCurrent(
    n_RecordInventoryMoveDifferenceCount_Id,
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	n_RIMC_ReportInventoryCurrent_Number,
	n_ListPutOnOff_ShelfForm
)
select 
    tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id,
    n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	tRecordInventoryMoveDifferenceCount.n_Space_Id,
	tRecordInventoryMoveDifferenceCount.n_Bin_Id,
	tRecordInventoryMoveDifferenceCount.n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color, 
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	tRecordInventoryMoveDifferenceCount.s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Number,
	n_BillStockInOut_ShelfForm
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
on tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id
 = tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id
inner join tBillStockInOut tBillStockInOut with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id
where tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1

 
 --对于单件盘点时从无盘到有，且可能存在适配的在储位信息表外键ID的记录，进行补漏操作
	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = ''
	from @ReportInventoryCurrent RC
	left join tReportInventoryCurrent with(nolock) on 
	tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and tReportInventoryCurrent.n_Space_Id = RC.n_Space_Id
	and tReportInventoryCurrent.n_Bin_Id = RC.n_Bin_Id
	and tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber = RC.s_RecordInventoryMoveDifferenceCount_BatchNumber
	and isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and n_ListPutOnOff_ShelfForm in (1,2)

	 

--如果提交的单据里已经存在从无到有的数据 (原有数量为0，盘点数量为N,如果盘点数量为1的话则默认将其视为单件盘点)
-----------------------------
 
 --先定义好变量表里@ReportInventoryCurrent的n_ReportInventoryCurrent_Id与n_ReportInventoryCurrentDetail_Id字段
 --定义好后为后续插入tReportInventoryCurrent表和tReportInventoryCurrentDetail表数据做准备
 
 
 --汇总单件盘点的件进行n_ReportInventoryCurrent_Id字段与n_ReportInventoryCurrentDetail_Id字段的给值,
 --确保货物在储位信息表与货物在储位明细信息表的库位记录。
 -------------------------------------------------------------
 declare @ReportInventoryCurrent_GetID table ( 
    n_ReportInventoryCurrent_Id varchar(max),
    n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max), 
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max) 
)

insert into @ReportInventoryCurrent_GetID( 
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus  
)
select  
    NEWID(),
	NEWID(),
	n_Space_Id, 
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus 
from @ReportInventoryCurrent
group by n_Space_Id, 
    n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus

	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = GetID.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = GetID.n_ReportInventoryCurrentDetail_Id
	from @ReportInventoryCurrent RC
	left join @ReportInventoryCurrent_GetID GetID on 
	GetID.s_RecordInventoryMoveDifferenceCount_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and GetID.n_Space_Id = RC.n_Space_Id
	and isnull(GetID.s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = isnull(RC.s_RecordInventoryMoveDifferenceCount_BatchNumber,'')
	and isnull(GetID.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	and ISNULL(GetID.n_Bin_Id,'') = ISNULL(RC.n_Bin_Id,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and isnull(RC.n_ReportInventoryCurrent_Id,'') = ''

-----------------------------------------------------------
 
  

--如果库位中原有数量为1,而盘点数量为0的则视为进行单件录入盘无的操作

update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent RC on RC.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
and RC.s_RecordInventoryMoveDifferenceCount_GoodsBarCode = 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode
where  n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 0
 
  
   

 

-----------------------------

 
 --校正在储位信息明细表的对应储位数量,都要考虑当前库存是批量录入与单件录入相加而成的

 --首先是校正进行批量盘点的数据
 --则需要查询到该库位进行单件录入的件数
 -----------------------------------------
   


 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_OKProductCou = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),

 n_ReportInventoryCurrent_LotsizeNumber = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0), 
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select n_ReportInventoryCurrent_Id,sum(Convert(float,s_RecordInventoryMoveDifferenceCount_Number)) as s_RecordInventoryMoveDifferenceCount_Number
  from @ReportInventoryCurrent
  where n_RIMC_ReportInventoryCurrent_Number > 0
  and n_RecordInventoryMoveDifferenceCount_Type = 1
  group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 
  

 
 -----------------------------------------

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
 
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number +  
 isnull(cou,0),
 
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_Number + 
 isnull(cou,0),
 n_ReportInventoryCurrent_SingleNumber = n_ReportInventoryCurrent_SingleNumber + 
 isnull(cou,0),
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select 
 n_ReportInventoryCurrent_Id,
 n_ListPutOnOff_ShelfForm,
 sum((case isnull(s_RecordInventoryMoveDifferenceCount_Number,0) when 1 then 1 when 0 then -1 else 0 end)) as cou
 from @ReportInventoryCurrent 
 where n_RecordInventoryMoveDifferenceCount_Type = 2
 group by n_ReportInventoryCurrent_Id,
 n_ListPutOnOff_ShelfForm
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id 
 where n_ReportInventoryCurrent_state = 1   
 and n_ListPutOnOff_ShelfForm in (1,2) 

 
      
 -----------------------------------------
  
  
 --根据变量表@ReportInventoryCurrent插入tReportInventoryCurrent表
 
insert into tReportInventoryCurrent (
    n_ReportInventoryCurrent_Id,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 

    n_Bin_Id,
    n_PartDescription_Id, 
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_ECN,  
    s_ReportInventoryCurrent_GoodsProductName,

    s_ReportInventoryCurrent_GoodsProductCode,
    s_ReportInventoryCurrent_ExternalCode,
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,

    n_ReportInventoryCurrent_ReworkProductCou,
    n_ReportInventoryCurrent_LotsizeNumber,
    n_ReportInventoryCurrent_SingleNumber,
    s_ReportInventoryCurrent_BatchNumber,
    s_ReportInventoryCurrent_SpecificationAndModel,
    s_ReportInventoryCurrent_Unit,
    s_ReportInventoryCurrent_Model,

    s_ReportInventoryCurrent_Color, 
    n_ReportInventoryCurrent_state,
    s_ReportInventoryCurrent_Creator,
    d_ReportInventoryCurrent_CreateTime,
    s_ReportInventoryCurrent_Updator,

    d_ReportInventoryCurrent_UpdateTime,
    s_ReportInventoryCurrent_QualityStatus,
	n_ReportInventoryCurrent_QCQualityStatus
)
select 
n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,
tSpace.n_Shopfloor_Id,
tSpace.n_Rack_Id,
RC.n_Space_Id,

RC.n_Bin_Id,
n_PartDescription_Id,
tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_ECN,  
s_RecordInventoryMoveDifferenceCount_GoodsProductName, 

s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_ExternalCode, 
sum(s_RecordInventoryMoveDifferenceCount_Number),
sum(s_RecordInventoryMoveDifferenceCount_Number),
0,

0,
(case ISNULL(n_RecordInventoryMoveDifferenceCount_Type,2) when 1 then sum(isnull(s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
(case ISNULL(n_RecordInventoryMoveDifferenceCount_Type,2) when 2 then sum(isnull(s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
s_RecordInventoryMoveDifferenceCount_BatchNumber,
s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,

s_RecordInventoryMoveDifferenceCount_Color, 
1,
@Operator,
getdate(),
@Operator,

getdate(),
s_RecordInventoryMoveDifferenceCount_QualityStatus,
n_RecordInventoryMoveDifferenceCount_QCQualityStatus

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and not exists(select 1 from tReportInventoryCurrent with(nolock) where n_ReportInventoryCurrent_Id = RC.n_ReportInventoryCurrent_Id)
group by n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,tSpace.n_Shopfloor_Id,tSpace.n_Rack_Id,
RC.n_Space_Id, RC.n_Bin_Id,n_PartDescription_Id,
tSpace.s_Space_BarCode,s_RecordInventoryMoveDifferenceCount_ECN,s_RecordInventoryMoveDifferenceCount_GoodsProductName,s_RecordInventoryMoveDifferenceCount_GoodsProductCode,s_RecordInventoryMoveDifferenceCount_ExternalCode, 
s_RecordInventoryMoveDifferenceCount_BatchNumber,s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,s_RecordInventoryMoveDifferenceCount_Model,s_RecordInventoryMoveDifferenceCount_Color,
s_RecordInventoryMoveDifferenceCount_QualityStatus,n_RecordInventoryMoveDifferenceCount_QCQualityStatus,s_RecordInventoryMoveDifferenceCount_Number,n_RecordInventoryMoveDifferenceCount_Type

   
  


--如果库位中原有数量为0,而盘点数量为1的则视为进行单件录入盘点的操作


insert into tReportInventoryCurrentDetail_GoodsBarCodeInfo (
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id,
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
    n_Space_Id,
    n_PartDescription_Id,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductName,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_ExternalCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpecificationAndModel,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Unit,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Model,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Color,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus,

    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperatime, 
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Creator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_CreateTime,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState
)
select
newID(),
n_ReportInventoryCurrent_Id,
n_ReportInventoryCurrentDetail_Id, 
RC.n_Space_Id,
n_PartDescription_Id,

tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_GoodsProductName,  
s_RecordInventoryMoveDifferenceCount_ExternalCode,
s_RecordInventoryMoveDifferenceCount_BatchNumber,

s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,
s_RecordInventoryMoveDifferenceCount_Color, 
s_RecordInventoryMoveDifferenceCount_QualityStatus,

n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
@Operator,
getdate(),
1,

@Operator,
getdate(),
@Operator,
getdate(),
1

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 1

   
  
 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
  


 update tReportInventoryCurrent set 
n_ReportInventoryCurrent_SingleNumber = isnull(cou,0) 
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @ReportInventoryCurrent RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1   
 and n_RecordInventoryMoveDifferenceCount_Type = 2

      
 -----------------------------------------

-- -----------------------------------------
   

--库位盘点专用
--将库位盘点的记录都盘点成为0
update tReportInventoryCurrent 
set
n_ReportInventoryCurrent_Number = 0,
n_ReportInventoryCurrent_OKProductCou = 0,
n_ReportInventoryCurrent_LotsizeNumber = 0,
n_ReportInventoryCurrent_SingleNumber = 0,
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = GETDATE()
from tReportInventoryCurrent with(nolock)
inner join @ReportInventoryCurrent ReportInventoryCurrent 
on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3


update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent ReportInventoryCurrent on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id 
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"0BB6F92B-467E-48E4-BE32-3819B20E6F2D"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:20
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:28
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A340504"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:43:28
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"A340504"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:09
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:50:24
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:13
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:24
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:27
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:27
类型：Query 查询对象：SelInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:33
类型：Business 业务对象：InsertInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    3,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505105227424"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Warehouse_Id" DbType:"String" Value:"15E6A121-FEEA-4DA8-A54F-E29A60A6A41C"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（7）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（8）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
（9）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:36
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"D5E672AE-D4D6-4196-905B-BDE9D942D510"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:40
类型：Query 查询对象：SelInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"D5E672AE-D4D6-4196-905B-BDE9D942D510"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:42
类型：Query 查询对象：SelInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 3
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：1.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：2.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：3.0.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：4.0.该单据已被提交，该单据不能再录入数据!
***************************************************************************************************************
SQL:

if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 1 and s_BillStockInOut_WhetherToSubmit = '1'
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：5.0.该单据已被停用，该单据不能再录入数据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2 and 
n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务过程[1]：0.新增异动盘点信息记录
***************************************************************************************************************
SQL:
 
 -----------------------------------------------------------
 declare @tab table(
 RowId int,
 n_ReportInventoryCurrent_Id varchar(max),
 s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
 s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
 s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
 s_RecordInventoryMoveDifferenceCount_Model varchar(max),
 s_RecordInventoryMoveDifferenceCount_Color varchar(max),
 s_RecordInventoryMoveDifferenceCount_AI varchar(max),
 s_U9GoodsCode varchar(max),
 n_Warehouse_Id varchar(max),
 n_Shopfloor_Id varchar(max),
 n_Rack_Id varchar(max),
 n_Space_Id varchar(max),
 n_ReportInventoryCurrent_QCQualityStatus float,
 n_SureAmount float
 )
 
 --新增批量录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 1,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_LotsizeNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_LotsizeNumber > 0
 
 
 --新增单件录入的盘空记录
 insert into @tab(
    RowId,
    n_ReportInventoryCurrent_Id,
    s_RecordInventoryMoveDifferenceCount_BatchNumber,
    s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
    s_RecordInventoryMoveDifferenceCount_AI,
    s_U9GoodsCode,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id,
    n_ReportInventoryCurrent_QCQualityStatus,
    n_SureAmount
 )
 select 
 2,
 n_ReportInventoryCurrent_Id,
 s_ReportInventoryCurrent_BatchNumber,
 s_ReportInventoryCurrent_SpecificationAndModel,
 s_ReportInventoryCurrent_Unit,
 s_ReportInventoryCurrent_Model,
 s_ReportInventoryCurrent_Color,
 s_ReportInventoryCurrent_ECN,
 s_ReportInventoryCurrent_CustomFields1,
 n_Warehouse_Id,
 n_Shopfloor_Id,
 n_Rack_Id,
 n_Space_Id,
 n_ReportInventoryCurrent_QCQualityStatus,
 n_ReportInventoryCurrent_SingleNumber
 
 from tReportInventoryCurrent with(nolock)
 where n_ReportInventoryCurrent_Id = @n_ReportInventoryCurrent_Id
 and n_ReportInventoryCurrent_state = 1
 and n_ReportInventoryCurrent_SingleNumber > 0


declare @index int = 1
declare @Cou int = (select MAX(RowId) from @tab)

while(@index <= @Cou)
begin

 
--查询出货物标识基础表外键ID,货物名称,规格型号，单位，车型，颜色
declare @n_GoodsId varchar(max) = '',
@n_GoodsName varchar(max) = ''
,@s_U9GoodsCode varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Unit varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Model varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_Color varchar(max) = ''
,@s_RecordInventoryMoveDifferenceCount_AI varchar(max) = ''
,@n_SureAmount varchar(max)
,@RowId int

 
--获取喷涂下线QA的结果信息ID,批次信息
declare @WorkLogId varchar(max),
@s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max) 
 
 
 --根据在储位信息表外键ID查询对应的库位，车间，货架，储位ID,可用状态
 declare @n_Warehouse_Id varchar(max)
 declare @n_Shopfloor_Id varchar(max)
 declare @n_Rack_Id varchar(max)
 declare @n_Space_Id varchar(max)
 declare @n_ReportInventoryCurrent_QCQualityStatus float


 
 select top 1 @WorkLogId = '', 
 @s_RecordInventoryMoveDifferenceCount_BatchNumber = s_RecordInventoryMoveDifferenceCount_BatchNumber
,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel = s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
@s_RecordInventoryMoveDifferenceCount_Unit = s_RecordInventoryMoveDifferenceCount_Unit,
@s_RecordInventoryMoveDifferenceCount_Model = s_RecordInventoryMoveDifferenceCount_Model,
@s_RecordInventoryMoveDifferenceCount_Color = s_RecordInventoryMoveDifferenceCount_Color,
@s_RecordInventoryMoveDifferenceCount_AI = s_RecordInventoryMoveDifferenceCount_AI, 
 @n_Warehouse_Id = n_Warehouse_Id,
 @n_Shopfloor_Id = n_Shopfloor_Id,
 @n_Rack_Id = n_Rack_Id,
 @n_Space_Id = n_Space_Id,
 @n_ReportInventoryCurrent_QCQualityStatus = n_ReportInventoryCurrent_QCQualityStatus,
 @n_SureAmount = n_SureAmount,
 @RowId = RowId
 from @tab
 where RowId = @index
 
 if(isnull(@n_Space_Id,'') <> '')
 begin
     
     
 --根据器具编码查询器具ID
 declare @n_Bin_Id varchar(max)

 select @n_Bin_Id = n_Bin_Id from tBin with(nolock)
 where s_Bin_Code = @BinBarCode
 and n_Bin_state = 1
  
 
 
 --查询单据编码
 declare @s_BillStockInOutDetail_Code varchar(max)
 declare @n_BillStockInOut_ShelfForm int

 select @s_BillStockInOutDetail_Code = s_BillStockInOut_Code,
 @n_BillStockInOut_ShelfForm = n_BillStockInOut_ShelfForm,
 @n_ReportInventoryCurrent_QCQualityStatus = isnull(n_BillStockInOut_QCQualityStatus,'0') 
 from tBillStockInOut with(nolock)
 where n_BillStockInOut_Id = @n_BillStockInOut_Id
 
 
 --获取存货信息主键ID
 declare @n_PartDescription_Id varchar(max)

 select top 1 @n_PartDescription_Id = n_PartDescription_Id
 from tPartDescription with(nolock)
 where s_PartDescription_Code = @s_ReportInventoryCurrent_GoodsProductCode
 and n_PartDescription_State = 1

 -----------------------------------------------------------
 
declare @n_BillStockInOutDetail_Id varchar(max) = newID()
declare @n_RecordInventoryMoveDifferenceCount_Id varchar(max) = newID()


INSERT INTO [dbo].[tBillStockInOutDetail]
           ([n_BillStockInOutDetail_Id]
           ,[s_BillStockInOutDetail_Code]
           ,[n_Warehouse_Id]
           ,[n_Shopfloor_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_ReportInventoryCurrent_Id]
		   ,n_PartDescription_Id
           ,[s_BillStockInOutDetail_BarCode]
           ,[n_BillStockInOutDetail_GoodsProductId]
           ,[s_BillStockInOutDetail_GoodsProductCode]
           ,[s_BillStockInOutDetail_GoodsProductName]
           ,[s_BillStockInOutDetail_ExternalCode]
           ,[s_BillStockInOutDetail_ExternalName]
           ,[s_BillStockInOutDetail_ECN] 
           ,[n_BillStockInOutDetail_QualityStatus]
		   ,[n_BillStockInOutDetail_QCQualityStatus]
           ,[s_BillStockInOutDetail_Operator]
           ,[s_BillStockInOutDetail_Department]
           ,[s_BillStockInOutDetail_Team]
           ,[d_BillStockInOutDetail_OperateTime]
           ,[s_BillStockInOutDetail_Remark]
           ,[s_BillStockInOutDetail_WhetherToSubmit]
           ,[f_BillStockInOutDetail_WorkOrderQuantity]
           ,[f_BillStockInOutDetail_OKProductCou]
           ,[f_BillStockInOutDetail_UnOKProductCou]
           ,[f_BillStockInOutDetail_ReworkProductCou]
           ,[f_BillStockInOutDetail_FinishWorkOrderQuantity] 
           ,[n_BillStockInOutDetail_IsApproved]
           ,[n_BillStockInOutDetail_IsFinishedState]
           ,[n_BillStockInOutDetail_state]
           ,[s_BillStockInOutDetail_Creator]
           ,[d_BillStockInOutDetail_CreateTime]
           ,[s_BillStockInOutDetail_Updator]
           ,[d_BillStockInOutDetail_UpdateTime])
     VALUES
           (@n_BillStockInOutDetail_Id
           ,@s_BillStockInOutDetail_Code 
           ,@n_Warehouse_Id
		   ,@n_Shopfloor_Id
           ,@n_Rack_Id
           ,@n_Space_Id  
           ,@n_Bin_Id
           ,@n_BillStockInOut_Id 
           ,@n_ReportInventoryCurrent_Id
		   ,@n_PartDescription_Id
           ,@s_BillStockInOutDetail_Code
           ,@n_GoodsId
           ,@GoodsProductCode
           ,@GoodsProductName
           ,@s_U9GoodsCode
           ,@GoodsProductName
           ,''
           ,@QualityStatus
		   ,@n_ReportInventoryCurrent_QCQualityStatus
           ,@Operator
           ,''
           ,(case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end)
           ,getdate()
           ,''
           ,0
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,0
           ,0
           ,0
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
           )
 
  


INSERT INTO [dbo].[tRecordInventoryMoveDifferenceCount]
           ([n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
		   ,n_BillStockInOut_Id
		   ,n_BillStockInOutDetail_Id
		   ,n_ReportInventoryCurrent_Id
		   ,n_ReportInventoryCurrentDetail_Id
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveDifferenceCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductName]
           ,[s_RecordInventoryMoveDifferenceCount_GoodsProductCode]
           ,[s_RecordInventoryMoveDifferenceCount_ExternalCode]
           ,[s_RecordInventoryMoveDifferenceCount_ECN] 
           ,[s_RecordInventoryMoveDifferenceCount_QualityStatus]
           ,[s_RecordInventoryMoveDifferenceCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveDifferenceCount_Unit]
           ,[s_RecordInventoryMoveDifferenceCount_Model]
           ,[s_RecordInventoryMoveDifferenceCount_Color]
           ,[s_RecordInventoryMoveDifferenceCount_BatchNumber]
           ,[s_RecordInventoryMoveDifferenceCount_Number]
           ,[n_RecordInventoryMoveDifferenceCount_OKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_UnOKProductCou]
           ,[n_RecordInventoryMoveDifferenceCount_ReworkProductCou] 
           ,[n_RecordInventoryMoveDifferenceCount_Type]
           ,[n_RecordInventoryMoveDifferenceCount_state]
           ,[s_RecordInventoryMoveDifferenceCount_Creator]
           ,[d_RecordInventoryMoveDifferenceCount_CreateTime]
           ,[s_RecordInventoryMoveDifferenceCount_Updator]
           ,[d_RecordInventoryMoveDifferenceCount_UpdateTime]
		   ,n_RecordInventoryMoveDifferenceCount_QCQualityStatus
		   ,s_RecordInventoryMoveDifferenceCount_GoodsBarCode)
     VALUES
           (@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_ReportInventoryCurrent_Id
		   ,@n_ReportInventoryCurrentDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,@BarCode)
 
 
 
INSERT INTO [dbo].[tRecordInventoryMoveCount]
           ([n_RecordInventoryMoveCount_Id]
           ,[n_RecordInventoryMoveDifferenceCount_Id]
           ,[n_Warehouse_Id]
           ,[n_Rack_Id]
           ,[n_Space_Id] 
           ,[n_Bin_Id]
           ,[n_BillStockInOut_Id]
           ,[n_BillStockInOutDetail_Id] 
		   ,n_PartDescription_Id
           ,[n_RecordInventoryMoveCount_Time]
           ,[s_BillStockInOut_Code]
           ,[s_RecordInventoryMoveCount_GoodsProductName]
           ,[s_RecordInventoryMoveCount_GoodsProductCode]
           ,[s_RecordInventoryMoveCount_ExternalCode]
           ,[s_RecordInventoryMoveCount_ECN] 
           ,[n_RecordInventoryMoveCount_QualityStatus]
           ,[s_RecordInventoryMoveCount_SpecificationAndModel]
           ,[s_RecordInventoryMoveCount_Unit]
           ,[s_RecordInventoryMoveCount_Model]
           ,[s_RecordInventoryMoveCount_Color]
           ,[s_RecordInventoryMoveCount_BatchNumber]
           ,[n_RecordInventoryMoveCount_Number]
           ,[n_RecordInventoryMoveCount_OKProductCou]
           ,[n_RecordInventoryMoveCount_UnOKProductCou]
           ,[n_RecordInventoryMoveCount_ReworkProductCou]
           ,[n_RIMC_ReportInventoryCurrent_Id]
           ,[n_RIMC_ReportInventoryCurrentDetail_Id]
           ,[n_RIMC_ReportInventoryCurrentBin_Id]
           ,[n_RIMC_ReportInventoryCurrent_GoodsId]
           ,[n_RIMC_ReportInventoryCurrent_Code]
           ,[n_RIMC_ReportInventoryCurrents_ECN] 
           ,[s_RIMC_ReportInventoryCurrent_GoodsProductName]
           ,[s_RIMC_ReportInventoryCurrents_GoodsProductCode]
           ,[s_RIMC_ReportInventoryCurrent_ExternalCode]
		   ,[n_RIMC_ReportInventoryCurrent_SingleNumber]
           ,[n_RIMC_ReportInventoryCurrent_Number]
           ,[n_RIMC_ReportInventoryCurrent_OKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_UnOKProductCou]
           ,[n_RIMC_ReportInventoryCurrent_ReworkProductCou]
           ,[s_RIMC_ReportInventoryCurrent_BatchNumber]
           ,[s_RIMC_ReportInventoryCurrent_SpecificationAndModel]
           ,[s_RIMC_ReportInventoryCurrent_Unit]
           ,[s_RIMC_ReportInventoryCurrent_Model]
           ,[s_RIMC_ReportInventoryCurrent_Color]
           ,[n_RecordInventoryMoveCount_AreDifferencesCorrected] 
           ,[n_RecordInventoryMoveCount_Type]
           ,[n_RecordInventoryMoveCount_state]
           ,[s_RecordInventoryMoveCount_Creator]
           ,[d_RecordInventoryMoveCount_CreateTime]
           ,[s_RecordInventoryMoveCount_Updator]
           ,[d_RecordInventoryMoveCount_UpdateTime]
           ,n_RecordInventoryMoveCount_QCQualityStatus
           ,n_RecordInventoryMoveCount_RIMC_QCQualityStatus
		   ,s_RecordInventoryMoveCount_GoodsBarCode
		   ,s_RIMC_RecordInventoryMoveCount_GoodsBarCode)
     values( 
	       newID()
           ,@n_RecordInventoryMoveDifferenceCount_Id
           ,@n_Warehouse_Id
           ,@n_Rack_Id
           ,@n_Space_Id 
           ,@n_Bin_Id
		   ,@n_BillStockInOut_Id
		   ,@n_BillStockInOutDetail_Id
		   ,@n_PartDescription_Id
           ,getdate()
           ,@s_BillStockInOutDetail_Code
           ,@GoodsProductName
           ,@GoodsProductCode
           ,@s_U9GoodsCode
           ,''
           ,@QualityStatus
           ,@s_RecordInventoryMoveDifferenceCount_SpecificationAndModel
           ,@s_RecordInventoryMoveDifferenceCount_Unit
           ,@s_RecordInventoryMoveDifferenceCount_Model
           ,@s_RecordInventoryMoveDifferenceCount_Color
           ,@s_RecordInventoryMoveDifferenceCount_BatchNumber
           ,@n_SureAmount
           ,(case @QualityStatus when 1 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 2 then @n_SureAmount else 0 end)
           ,(case @QualityStatus when 3 then @n_SureAmount else 0 end)
           ,@n_ReportInventoryCurrent_Id
		   ,''
           ,@n_Bin_Id
           ,''
           ,@SpaceBarCode 
           ,''
           ,''
           ,''
           ,''
           ,0
           ,0
           ,0
           ,0
           ,0
           ,''
           ,''
           ,''
           ,''
           ,''
           ,0
           ,@RowId
           ,1
           ,@Operator
           ,getdate()
           ,@Operator
           ,getdate()
		   ,@n_ReportInventoryCurrent_QCQualityStatus
		   ,''
		   ,@BarCode
		   ,'')
		   
    
 end 

 
 set @index = @index + 1
  

end



		   --修正单据总数量
		   update tBillStockInOut 
		   set f_BillStockInOut_WorkOrderQuantity = isnull(f_BillStockInOut_WorkOrderQuantity,0)+ @SureAmount
		   ,f_BillStockInOut_OKProductCou = isnull(f_BillStockInOut_OKProductCou,0) + (case when isnull(@QualityStatus,1) = 1 then @SureAmount else 0 end)
		   ,f_BillStockInOut_UnOKProductCou = isnull(f_BillStockInOut_UnOKProductCou,0) + (case when isnull(@QualityStatus,1) = 2 then @SureAmount else 0 end)
		   ,f_BillStockInOut_ReworkProductCou = isnull(f_BillStockInOut_ReworkProductCou,0)+ (case when isnull(@QualityStatus,1) = 3 then @SureAmount else 0 end)
		   ,s_BillStockInOut_Updator = @Operator
		   ,d_BillStockInOut_UpdateTime = getdate()
		   where n_BillStockInOut_Id = @n_BillStockInOut_Id 

  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:55
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:52:59
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:05
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:12
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：1.0.该库位已存放不同产品，请重新输入
***************************************************************************************************************
SQL:

--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该库位是否
--已经存放了相同产品编码的货物
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 from tReportInventoryCurrent with(nolock)
where s_ReportInventoryCurrent_Code = @:SpaceBarCode
and s_ReportInventoryCurrent_GoodsProductCode <> @:GoodsProductCode
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
)
))
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:12
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：2.0.该单据已存在该库位不同产品的盘点信息，请确认
***************************************************************************************************************
SQL:
--查看储位是否是溢出库位
declare @s_Space_OverflowLocation varchar(max)
select 
@s_Space_OverflowLocation = isnull(s_Space_OverflowLocation,'否')
from tSpace tSpace with(nolock) 
where tSpace.s_Space_BarCode = @:SpaceBarCode
 

--如果该储位是溢出库位，则让其通过盘点，如果不是溢出库位，则需要判断该单据是否已经
--对该储位进行不同产品的盘点
if(@s_Space_OverflowLocation = '是' or (@s_Space_OverflowLocation = '否' and not exists
(
select 1 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock) 
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tRecordInventoryMoveDifferenceCount.n_Space_Id
where n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1
and s_Space_BarCode = @:SpaceBarCode
and s_RecordInventoryMoveDifferenceCount_GoodsProductCode <> @:GoodsProductCode
)
))
begin

select 1

end

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:12
类型：Business 业务对象：InsertPurchasedInventoryMoveDifference_Inventory 
说明：执行业务检查：3.0.该单据已存在该储位该产品的盘空记录，请重新输入
***************************************************************************************************************
SQL:
if not exists(select 1 from tRecordInventoryMoveDifferenceCount with(nolock)
where n_ReportInventoryCurrent_Id = @:n_ReportInventoryCurrent_Id
and n_BillStockInOut_Id = @:n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1)
begin

select 1

end


 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"String" Value:"7487524"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@GoodsProductCode" DbType:"String" Value:"7487524"
（4）ParameterName:"@GoodsProductName" DbType:"String" Value:"G18/后保Z向支撑件塑件"
（5）ParameterName:"@QualityStatus" DbType:"String" Value:"1"
（6）ParameterName:"@n_ReportInventoryCurrentDetail_Id" DbType:"String" Value:""
（7）ParameterName:"@BarCode" DbType:"String" Value:"74875242110260001"
（8）ParameterName:"@SpaceBarCode" DbType:"String" Value:"E050204"
（9）ParameterName:"@SureAmount" DbType:"String" Value:"0"
（10）ParameterName:"@n_ReportInventoryCurrent_Id" DbType:"String" Value:"6C6B3BE8-CDFA-41CE-8E6F-20C97D7640C5"
（11）ParameterName:"@BinBarCode" DbType:"String" Value:"null"
（12）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:18
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:19
类型：Query 查询对象：SelPurchasedInventoryBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:41
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:43
类型：Query 查询对象：SelPurchasedInventoryBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:48
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050204"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:53:48
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:"E050204"
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:00
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"7487524"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:00
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"7487524"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:06
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:08
类型：Query 查询对象：SelPurchasedInventorySubmitBillStockInOutDetails 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
    BillStockInOutDetail_Id=tBillStockInOutDetail.n_BillStockInOutDetail_Id,
	n_ReportInventoryCurrent_Id=n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id=n_RIMC_ReportInventoryCurrentDetail_Id,
	RecordInventoryMoveDifferenceCount_Id=tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id,
      tRecordInventoryMoveCount.s_RecordInventoryMoveCount_GoodsBarCode,
    RecordInventoryMoveDifferenceCount_Code=tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Code, 
	RecordInventoryMoveDifferenceCount_BinCode = tBin.s_Bin_Code,
    RecordInventoryMoveDifferenceCount_GoodsProductCode=s_RecordInventoryMoveCount_GoodsProductCode,
    RecordInventoryMoveDifferenceCount_GoodsProductName=(case when len(s_RecordInventoryMoveCount_GoodsProductName)>30 then SUBSTRING(s_RecordInventoryMoveCount_GoodsProductName,0,30)+ '......' else s_RecordInventoryMoveCount_GoodsProductName end),  
    RecordInventoryMoveDifferenceCount_Operator=s_RecordInventoryMoveCount_Creator, 
    RecordInventoryMoveDifferenceCount_Time=d_RecordInventoryMoveCount_CreateTime,  
	--n_RecordInventoryMoveCount_Type 为1 批量录入,需要原数量扣减掉单件录入的数量，为2 单件录入，则直接取该字段
	(case n_RecordInventoryMoveCount_Type when 1 then n_RIMC_ReportInventoryCurrent_Number - isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0)
	when 2 then isnull(n_RIMC_ReportInventoryCurrent_SingleNumber,0) else 0 end) as n_RIMC_ReportInventoryCurrent_SingleNumber,
    RecordInventoryMoveDifferenceCount_Number=n_RecordInventoryMoveCount_Number,
	ReportInventoryCurrent_Number=isnull(n_RIMC_ReportInventoryCurrent_Number,0)
from tBillStockInOutDetail with(nolock) 
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) on
tRecordInventoryMoveCount.n_BillStockInOutDetail_Id
= tBillStockInOutDetail.n_BillStockInOutDetail_Id
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tRecordInventoryMoveCount.n_Bin_Id
and n_Bin_State = 1 
where tBillStockInOutDetail.n_BillStockInOut_Id =  @n_BillStockInOut_Id
and n_BillStockInOutDetail_state = 1 
and n_RecordInventoryMoveCount_state = 1 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:10
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务检查：1.0.该单据已经被停用了,不能提交该单据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2  
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:10
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务过程[1]：0.提交已选择的盘点单据信息
***************************************************************************************************************
SQL:
 
  
 update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordInventoryMoveCount set 
n_RecordInventoryMoveCount_WhetherToSubmit = 1,
s_RecordInventoryMoveCount_Updator = @Operator,
d_RecordInventoryMoveCount_UpdateTime = getdate()
from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveCount_state = 1


update tRecordInventoryMoveDifferenceCount set 
n_RecordInventoryMoveDifferenceCount_WhetherToSubmit = 1,
s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate() 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @ReportInventoryCurrent table(
    n_RecordInventoryMoveDifferenceCount_Id varchar(max),
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	n_PartDescription_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max),
    s_RecordInventoryMoveDifferenceCount_GoodsProductName varchar(max), 
    s_RecordInventoryMoveDifferenceCount_ExternalCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
	s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
    s_RecordInventoryMoveDifferenceCount_Model varchar(max),
    s_RecordInventoryMoveDifferenceCount_Color varchar(max),
	s_RecordInventoryMoveDifferenceCount_ECN varchar(max),
	s_RecordInventoryMoveDifferenceCount_QualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_Type varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_Number int, --盘点数量
	n_RIMC_ReportInventoryCurrent_Number int,  --原数量
	n_ListPutOnOff_ShelfForm int
)

insert into @ReportInventoryCurrent(
    n_RecordInventoryMoveDifferenceCount_Id,
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	n_RIMC_ReportInventoryCurrent_Number,
	n_ListPutOnOff_ShelfForm
)
select 
    tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id,
    n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	tRecordInventoryMoveDifferenceCount.n_Space_Id,
	tRecordInventoryMoveDifferenceCount.n_Bin_Id,
	tRecordInventoryMoveDifferenceCount.n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color, 
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	tRecordInventoryMoveDifferenceCount.s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Number,
	n_BillStockInOut_ShelfForm
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)  
on tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id
 = tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id 
inner join tBillStockInOut tBillStockInOut with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id

where tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1

 
 --对于单件盘点时从无盘到有，且可能存在适配的在储位信息表外键ID的记录，进行补漏操作
	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = ''
	from @ReportInventoryCurrent RC
	left join tReportInventoryCurrent with(nolock) on 
	tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and tReportInventoryCurrent.n_Space_Id = RC.n_Space_Id
	and tReportInventoryCurrent.n_Bin_Id = RC.n_Bin_Id
	and tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber = RC.s_RecordInventoryMoveDifferenceCount_BatchNumber
	and isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and n_ListPutOnOff_ShelfForm in (1,2)

	 

--如果提交的单据里已经存在从无到有的数据 (原有数量为0，盘点数量为N,如果盘点数量为1的话则默认将其视为单件盘点)
-----------------------------
 
 --先定义好变量表里@ReportInventoryCurrent的n_ReportInventoryCurrent_Id与n_ReportInventoryCurrentDetail_Id字段
 --定义好后为后续插入tReportInventoryCurrent表和tReportInventoryCurrentDetail表数据做准备
 
 
 --汇总单件盘点的件进行n_ReportInventoryCurrent_Id字段与n_ReportInventoryCurrentDetail_Id字段的给值,
 --确保货物在储位信息表与货物在储位明细信息表的库位记录。
 -------------------------------------------------------------
 declare @ReportInventoryCurrent_GetID table ( 
    n_ReportInventoryCurrent_Id varchar(max),
    n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max), 
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max) 
)

insert into @ReportInventoryCurrent_GetID( 
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus  
)
select  
    NEWID(),
	NEWID(),
	n_Space_Id, 
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus 
from @ReportInventoryCurrent
group by n_Space_Id,  
    n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus

	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = GetID.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = GetID.n_ReportInventoryCurrentDetail_Id
	from @ReportInventoryCurrent RC
	left join @ReportInventoryCurrent_GetID GetID on 
	GetID.s_RecordInventoryMoveDifferenceCount_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and GetID.n_Space_Id = RC.n_Space_Id
	and isnull(GetID.s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = isnull(RC.s_RecordInventoryMoveDifferenceCount_BatchNumber,'')
	and isnull(GetID.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	and ISNULL(GetID.n_Bin_Id,'') = ISNULL(RC.n_Bin_Id,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and isnull(RC.n_ReportInventoryCurrent_Id,'') = ''

-----------------------------------------------------------
  

  

--如果库位中原有数量为1,而盘点数量为0的则视为进行单件录入盘无的操作

update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent RC on RC.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
and RC.s_RecordInventoryMoveDifferenceCount_GoodsBarCode = 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode
where  n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 0
 
  

-----------------------------

 
 --校正在储位信息明细表的对应储位数量,都要考虑当前库存是批量录入与单件录入相加而成的

 --首先是校正进行批量盘点的数据
 --则需要查询到该库位进行单件录入的件数
 -----------------------------------------
   


 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_OKProductCou = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_LotsizeNumber = isnull(RC.n_ReportInventoryCurrent_LotsizeNumber,0) + isnull(cou,0), 
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select n_ReportInventoryCurrent_Id,sum(Convert(float,s_RecordInventoryMoveDifferenceCount_Number)) as s_RecordInventoryMoveDifferenceCount_Number
  from @ReportInventoryCurrent
  where n_RIMC_ReportInventoryCurrent_Number > 0
  and n_RecordInventoryMoveDifferenceCount_Type = 1
  group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 

  
 
 -----------------------------------------

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
 
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number +  
 isnull(cou,0),
 
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_Number + 
 isnull(cou,0),
  
 n_ReportInventoryCurrent_SingleNumber = n_ReportInventoryCurrent_SingleNumber + isnull(cou,0),

 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select 
 n_ReportInventoryCurrent_Id,
 sum((case isnull(s_RecordInventoryMoveDifferenceCount_Number,0) when 1 then 1 when 0 then -1 else 0 end)) as cou
 from @ReportInventoryCurrent 
 where n_RecordInventoryMoveDifferenceCount_Type = 2
 group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id 
 where n_ReportInventoryCurrent_state = 1 
 and n_ListPutOnOff_ShelfForm in (1,2)   


 
 -----------------------------------------
  


  


 --根据变量表@ReportInventoryCurrent插入tReportInventoryCurrent表
 
insert into tReportInventoryCurrent (
    n_ReportInventoryCurrent_Id,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 

    n_Bin_Id,
    n_PartDescription_Id, 
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_ECN,  
    s_ReportInventoryCurrent_GoodsProductName,

    s_ReportInventoryCurrent_GoodsProductCode,
    s_ReportInventoryCurrent_ExternalCode,
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,

    n_ReportInventoryCurrent_ReworkProductCou,
    n_ReportInventoryCurrent_LotsizeNumber,
    n_ReportInventoryCurrent_SingleNumber,
    s_ReportInventoryCurrent_BatchNumber,
    s_ReportInventoryCurrent_SpecificationAndModel,
    s_ReportInventoryCurrent_Unit,
    s_ReportInventoryCurrent_Model,

    s_ReportInventoryCurrent_Color, 
    n_ReportInventoryCurrent_state,
    s_ReportInventoryCurrent_Creator,
    d_ReportInventoryCurrent_CreateTime,
    s_ReportInventoryCurrent_Updator,

    d_ReportInventoryCurrent_UpdateTime,
    s_ReportInventoryCurrent_QualityStatus,
	n_ReportInventoryCurrent_QCQualityStatus
)
select 
n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,
tSpace.n_Shopfloor_Id,
tSpace.n_Rack_Id,
RC.n_Space_Id,

RC.n_Bin_Id,
n_PartDescription_Id,
tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_ECN,  
s_RecordInventoryMoveDifferenceCount_GoodsProductName, 

s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_ExternalCode, 
sum(s_RecordInventoryMoveDifferenceCount_Number),
sum(s_RecordInventoryMoveDifferenceCount_Number),
0,

0,
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 2 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 1 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
s_RecordInventoryMoveDifferenceCount_BatchNumber,
s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,

s_RecordInventoryMoveDifferenceCount_Color, 
1,
@Operator,
getdate(),
@Operator,

getdate(),
s_RecordInventoryMoveDifferenceCount_QualityStatus,
n_RecordInventoryMoveDifferenceCount_QCQualityStatus

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and not exists(select 1 from tReportInventoryCurrent with(nolock) where n_ReportInventoryCurrent_Id = RC.n_ReportInventoryCurrent_Id)
group by n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,tSpace.n_Shopfloor_Id,tSpace.n_Rack_Id,
RC.n_Space_Id, RC.n_Bin_Id,n_PartDescription_Id,
tSpace.s_Space_BarCode,s_RecordInventoryMoveDifferenceCount_ECN,s_RecordInventoryMoveDifferenceCount_GoodsProductName,s_RecordInventoryMoveDifferenceCount_GoodsProductCode,s_RecordInventoryMoveDifferenceCount_ExternalCode, 
s_RecordInventoryMoveDifferenceCount_BatchNumber,s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,s_RecordInventoryMoveDifferenceCount_Model,s_RecordInventoryMoveDifferenceCount_Color,
s_RecordInventoryMoveDifferenceCount_QualityStatus,n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
RC.s_RecordInventoryMoveDifferenceCount_Number,n_ListPutOnOff_ShelfForm

   


--如果库位中原有数量为0,而盘点数量为1的则视为进行单件录入盘点的操作


insert into tReportInventoryCurrentDetail_GoodsBarCodeInfo (
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id,
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
    n_Space_Id,
    n_PartDescription_Id,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductName,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_ExternalCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpecificationAndModel,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Unit,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Model,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Color,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus,

    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperatime, 
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Creator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_CreateTime,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState
)
select
newID(),
n_ReportInventoryCurrent_Id,
n_ReportInventoryCurrentDetail_Id, 
RC.n_Space_Id,
n_PartDescription_Id,

tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_GoodsProductName,  
s_RecordInventoryMoveDifferenceCount_ExternalCode,
s_RecordInventoryMoveDifferenceCount_BatchNumber,

s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,
s_RecordInventoryMoveDifferenceCount_Color, 
s_RecordInventoryMoveDifferenceCount_QualityStatus,

n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
@Operator,
getdate(),
1,

@Operator,
getdate(),
@Operator,
getdate(),
1

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 1

 

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
  
 
 update tReportInventoryCurrent set 
n_ReportInventoryCurrent_SingleNumber = isnull(cou,0) 
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @ReportInventoryCurrent RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1   
 and n_RecordInventoryMoveDifferenceCount_Type = 2

      
 -----------------------------------------
  

-- -----------------------------------------
   
   
   
--库位盘点专用
--将库位盘点的记录都盘点成为0
update tReportInventoryCurrent 
set
n_ReportInventoryCurrent_Number = 0,
n_ReportInventoryCurrent_OKProductCou = 0,
n_ReportInventoryCurrent_LotsizeNumber = 0,
n_ReportInventoryCurrent_SingleNumber = 0,
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = GETDATE()
from tReportInventoryCurrent with(nolock)
inner join @ReportInventoryCurrent ReportInventoryCurrent 
on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3


update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent ReportInventoryCurrent on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id 
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:13
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"7487524"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:13
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"7487524"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:17
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务检查：1.0.该单据已经被停用了,不能提交该单据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2  
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 10:54:17
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务过程[1]：0.提交已选择的盘点单据信息
***************************************************************************************************************
SQL:
 
  
 update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordInventoryMoveCount set 
n_RecordInventoryMoveCount_WhetherToSubmit = 1,
s_RecordInventoryMoveCount_Updator = @Operator,
d_RecordInventoryMoveCount_UpdateTime = getdate()
from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveCount_state = 1


update tRecordInventoryMoveDifferenceCount set 
n_RecordInventoryMoveDifferenceCount_WhetherToSubmit = 1,
s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate() 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @ReportInventoryCurrent table(
    n_RecordInventoryMoveDifferenceCount_Id varchar(max),
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	n_PartDescription_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max),
    s_RecordInventoryMoveDifferenceCount_GoodsProductName varchar(max), 
    s_RecordInventoryMoveDifferenceCount_ExternalCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
	s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
    s_RecordInventoryMoveDifferenceCount_Model varchar(max),
    s_RecordInventoryMoveDifferenceCount_Color varchar(max),
	s_RecordInventoryMoveDifferenceCount_ECN varchar(max),
	s_RecordInventoryMoveDifferenceCount_QualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_Type varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_Number int, --盘点数量
	n_RIMC_ReportInventoryCurrent_Number int,  --原数量
	n_ListPutOnOff_ShelfForm int
)

insert into @ReportInventoryCurrent(
    n_RecordInventoryMoveDifferenceCount_Id,
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	n_RIMC_ReportInventoryCurrent_Number,
	n_ListPutOnOff_ShelfForm
)
select 
    tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id,
    n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	tRecordInventoryMoveDifferenceCount.n_Space_Id,
	tRecordInventoryMoveDifferenceCount.n_Bin_Id,
	tRecordInventoryMoveDifferenceCount.n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color, 
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	tRecordInventoryMoveDifferenceCount.s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Number,
	n_BillStockInOut_ShelfForm
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)  
on tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id
 = tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id 
inner join tBillStockInOut tBillStockInOut with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id

where tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1

 
 --对于单件盘点时从无盘到有，且可能存在适配的在储位信息表外键ID的记录，进行补漏操作
	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = ''
	from @ReportInventoryCurrent RC
	left join tReportInventoryCurrent with(nolock) on 
	tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and tReportInventoryCurrent.n_Space_Id = RC.n_Space_Id
	and tReportInventoryCurrent.n_Bin_Id = RC.n_Bin_Id
	and tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber = RC.s_RecordInventoryMoveDifferenceCount_BatchNumber
	and isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and n_ListPutOnOff_ShelfForm in (1,2)

	 

--如果提交的单据里已经存在从无到有的数据 (原有数量为0，盘点数量为N,如果盘点数量为1的话则默认将其视为单件盘点)
-----------------------------
 
 --先定义好变量表里@ReportInventoryCurrent的n_ReportInventoryCurrent_Id与n_ReportInventoryCurrentDetail_Id字段
 --定义好后为后续插入tReportInventoryCurrent表和tReportInventoryCurrentDetail表数据做准备
 
 
 --汇总单件盘点的件进行n_ReportInventoryCurrent_Id字段与n_ReportInventoryCurrentDetail_Id字段的给值,
 --确保货物在储位信息表与货物在储位明细信息表的库位记录。
 -------------------------------------------------------------
 declare @ReportInventoryCurrent_GetID table ( 
    n_ReportInventoryCurrent_Id varchar(max),
    n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max), 
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max) 
)

insert into @ReportInventoryCurrent_GetID( 
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus  
)
select  
    NEWID(),
	NEWID(),
	n_Space_Id, 
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus 
from @ReportInventoryCurrent
group by n_Space_Id,  
    n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus

	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = GetID.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = GetID.n_ReportInventoryCurrentDetail_Id
	from @ReportInventoryCurrent RC
	left join @ReportInventoryCurrent_GetID GetID on 
	GetID.s_RecordInventoryMoveDifferenceCount_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and GetID.n_Space_Id = RC.n_Space_Id
	and isnull(GetID.s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = isnull(RC.s_RecordInventoryMoveDifferenceCount_BatchNumber,'')
	and isnull(GetID.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	and ISNULL(GetID.n_Bin_Id,'') = ISNULL(RC.n_Bin_Id,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and isnull(RC.n_ReportInventoryCurrent_Id,'') = ''

-----------------------------------------------------------
  

  

--如果库位中原有数量为1,而盘点数量为0的则视为进行单件录入盘无的操作

update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent RC on RC.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
and RC.s_RecordInventoryMoveDifferenceCount_GoodsBarCode = 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode
where  n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 0
 
  

-----------------------------

 
 --校正在储位信息明细表的对应储位数量,都要考虑当前库存是批量录入与单件录入相加而成的

 --首先是校正进行批量盘点的数据
 --则需要查询到该库位进行单件录入的件数
 -----------------------------------------
   


 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_OKProductCou = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_LotsizeNumber = isnull(RC.n_ReportInventoryCurrent_LotsizeNumber,0) + isnull(cou,0), 
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select n_ReportInventoryCurrent_Id,sum(Convert(float,s_RecordInventoryMoveDifferenceCount_Number)) as s_RecordInventoryMoveDifferenceCount_Number
  from @ReportInventoryCurrent
  where n_RIMC_ReportInventoryCurrent_Number > 0
  and n_RecordInventoryMoveDifferenceCount_Type = 1
  group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 

  
 
 -----------------------------------------

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
 
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number +  
 isnull(cou,0),
 
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_Number + 
 isnull(cou,0),
  
 n_ReportInventoryCurrent_SingleNumber = n_ReportInventoryCurrent_SingleNumber + isnull(cou,0),

 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select 
 n_ReportInventoryCurrent_Id,
 sum((case isnull(s_RecordInventoryMoveDifferenceCount_Number,0) when 1 then 1 when 0 then -1 else 0 end)) as cou
 from @ReportInventoryCurrent 
 where n_RecordInventoryMoveDifferenceCount_Type = 2
 group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id 
 where n_ReportInventoryCurrent_state = 1 
 and n_ListPutOnOff_ShelfForm in (1,2)   


 
 -----------------------------------------
  


  


 --根据变量表@ReportInventoryCurrent插入tReportInventoryCurrent表
 
insert into tReportInventoryCurrent (
    n_ReportInventoryCurrent_Id,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 

    n_Bin_Id,
    n_PartDescription_Id, 
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_ECN,  
    s_ReportInventoryCurrent_GoodsProductName,

    s_ReportInventoryCurrent_GoodsProductCode,
    s_ReportInventoryCurrent_ExternalCode,
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,

    n_ReportInventoryCurrent_ReworkProductCou,
    n_ReportInventoryCurrent_LotsizeNumber,
    n_ReportInventoryCurrent_SingleNumber,
    s_ReportInventoryCurrent_BatchNumber,
    s_ReportInventoryCurrent_SpecificationAndModel,
    s_ReportInventoryCurrent_Unit,
    s_ReportInventoryCurrent_Model,

    s_ReportInventoryCurrent_Color, 
    n_ReportInventoryCurrent_state,
    s_ReportInventoryCurrent_Creator,
    d_ReportInventoryCurrent_CreateTime,
    s_ReportInventoryCurrent_Updator,

    d_ReportInventoryCurrent_UpdateTime,
    s_ReportInventoryCurrent_QualityStatus,
	n_ReportInventoryCurrent_QCQualityStatus
)
select 
n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,
tSpace.n_Shopfloor_Id,
tSpace.n_Rack_Id,
RC.n_Space_Id,

RC.n_Bin_Id,
n_PartDescription_Id,
tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_ECN,  
s_RecordInventoryMoveDifferenceCount_GoodsProductName, 

s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_ExternalCode, 
sum(s_RecordInventoryMoveDifferenceCount_Number),
sum(s_RecordInventoryMoveDifferenceCount_Number),
0,

0,
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 2 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 1 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
s_RecordInventoryMoveDifferenceCount_BatchNumber,
s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,

s_RecordInventoryMoveDifferenceCount_Color, 
1,
@Operator,
getdate(),
@Operator,

getdate(),
s_RecordInventoryMoveDifferenceCount_QualityStatus,
n_RecordInventoryMoveDifferenceCount_QCQualityStatus

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and not exists(select 1 from tReportInventoryCurrent with(nolock) where n_ReportInventoryCurrent_Id = RC.n_ReportInventoryCurrent_Id)
group by n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,tSpace.n_Shopfloor_Id,tSpace.n_Rack_Id,
RC.n_Space_Id, RC.n_Bin_Id,n_PartDescription_Id,
tSpace.s_Space_BarCode,s_RecordInventoryMoveDifferenceCount_ECN,s_RecordInventoryMoveDifferenceCount_GoodsProductName,s_RecordInventoryMoveDifferenceCount_GoodsProductCode,s_RecordInventoryMoveDifferenceCount_ExternalCode, 
s_RecordInventoryMoveDifferenceCount_BatchNumber,s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,s_RecordInventoryMoveDifferenceCount_Model,s_RecordInventoryMoveDifferenceCount_Color,
s_RecordInventoryMoveDifferenceCount_QualityStatus,n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
RC.s_RecordInventoryMoveDifferenceCount_Number,n_ListPutOnOff_ShelfForm

   


--如果库位中原有数量为0,而盘点数量为1的则视为进行单件录入盘点的操作


insert into tReportInventoryCurrentDetail_GoodsBarCodeInfo (
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id,
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
    n_Space_Id,
    n_PartDescription_Id,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductName,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_ExternalCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpecificationAndModel,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Unit,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Model,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Color,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus,

    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperatime, 
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Creator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_CreateTime,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState
)
select
newID(),
n_ReportInventoryCurrent_Id,
n_ReportInventoryCurrentDetail_Id, 
RC.n_Space_Id,
n_PartDescription_Id,

tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_GoodsProductName,  
s_RecordInventoryMoveDifferenceCount_ExternalCode,
s_RecordInventoryMoveDifferenceCount_BatchNumber,

s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,
s_RecordInventoryMoveDifferenceCount_Color, 
s_RecordInventoryMoveDifferenceCount_QualityStatus,

n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
@Operator,
getdate(),
1,

@Operator,
getdate(),
@Operator,
getdate(),
1

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 1

 

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
  
 
 update tReportInventoryCurrent set 
n_ReportInventoryCurrent_SingleNumber = isnull(cou,0) 
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @ReportInventoryCurrent RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1   
 and n_RecordInventoryMoveDifferenceCount_Type = 2

      
 -----------------------------------------
  

-- -----------------------------------------
   
   
   
--库位盘点专用
--将库位盘点的记录都盘点成为0
update tReportInventoryCurrent 
set
n_ReportInventoryCurrent_Number = 0,
n_ReportInventoryCurrent_OKProductCou = 0,
n_ReportInventoryCurrent_LotsizeNumber = 0,
n_ReportInventoryCurrent_SingleNumber = 0,
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = GETDATE()
from tReportInventoryCurrent with(nolock)
inner join @ReportInventoryCurrent ReportInventoryCurrent 
on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3


update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent ReportInventoryCurrent on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id 
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:53
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务检查：1.0.该单据已经被停用了,不能提交该单据!
***************************************************************************************************************
SQL:
if not exists(select 1 from tBillStockInOut with(nolock)
where n_BillStockInOut_state = 2  
and n_BillStockInOut_Id = @:n_BillStockInOut_Id)
begin

select 1

end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:53
类型：Business 业务对象：UpdatePurchasedInventoryOperationListStockInOut 
说明：执行业务过程[1]：0.提交已选择的盘点单据信息
***************************************************************************************************************
SQL:
 
  
 update tBillStockInOut set 
s_BillStockInOut_WhetherToSubmit = 1,
s_BillStockInOut_Updator = @Operator,
d_BillStockInOut_UpdateTime = getdate()
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_BillStockInOut_state = 1


update tRecordInventoryMoveCount set 
n_RecordInventoryMoveCount_WhetherToSubmit = 1,
s_RecordInventoryMoveCount_Updator = @Operator,
d_RecordInventoryMoveCount_UpdateTime = getdate()
from tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock) 
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveCount_state = 1


update tRecordInventoryMoveDifferenceCount set 
n_RecordInventoryMoveDifferenceCount_WhetherToSubmit = 1,
s_RecordInventoryMoveDifferenceCount_Updator = @Operator,
d_RecordInventoryMoveDifferenceCount_UpdateTime = getdate() 
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
where n_BillStockInOut_Id  = @n_BillStockInOut_Id
and n_RecordInventoryMoveDifferenceCount_state = 1


--获取需要进行盘点数量纠正的货物信息，进行在储位信息的更正
declare @ReportInventoryCurrent table(
    n_RecordInventoryMoveDifferenceCount_Id varchar(max),
    n_ReportInventoryCurrent_Id varchar(max),
	n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	n_PartDescription_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max),
    s_RecordInventoryMoveDifferenceCount_GoodsProductName varchar(max), 
    s_RecordInventoryMoveDifferenceCount_ExternalCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel varchar(max),
	s_RecordInventoryMoveDifferenceCount_Unit varchar(max),
    s_RecordInventoryMoveDifferenceCount_Model varchar(max),
    s_RecordInventoryMoveDifferenceCount_Color varchar(max),
	s_RecordInventoryMoveDifferenceCount_ECN varchar(max),
	s_RecordInventoryMoveDifferenceCount_QualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max),
	n_RecordInventoryMoveDifferenceCount_Type varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode varchar(max),
	s_RecordInventoryMoveDifferenceCount_Number int, --盘点数量
	n_RIMC_ReportInventoryCurrent_Number int,  --原数量
	n_ListPutOnOff_ShelfForm int
)

insert into @ReportInventoryCurrent(
    n_RecordInventoryMoveDifferenceCount_Id,
    n_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color,
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	n_RIMC_ReportInventoryCurrent_Number,
	n_ListPutOnOff_ShelfForm
)
select 
    tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id,
    n_RIMC_ReportInventoryCurrent_Id,
	n_ReportInventoryCurrentDetail_Id,
	tRecordInventoryMoveDifferenceCount.n_Space_Id,
	tRecordInventoryMoveDifferenceCount.n_Bin_Id,
	tRecordInventoryMoveDifferenceCount.n_PartDescription_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode,
    s_RecordInventoryMoveDifferenceCount_GoodsProductName, 
    s_RecordInventoryMoveDifferenceCount_ExternalCode,
	s_RecordInventoryMoveDifferenceCount_BatchNumber,
	s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
    s_RecordInventoryMoveDifferenceCount_Unit,
    s_RecordInventoryMoveDifferenceCount_Model,
    s_RecordInventoryMoveDifferenceCount_Color, 
	s_RecordInventoryMoveDifferenceCount_ECN,
	s_RecordInventoryMoveDifferenceCount_QualityStatus,
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
	n_RecordInventoryMoveDifferenceCount_Type,
	tRecordInventoryMoveDifferenceCount.s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
	s_RecordInventoryMoveDifferenceCount_Number,
	tRecordInventoryMoveCount.n_RIMC_ReportInventoryCurrent_Number,
	n_BillStockInOut_ShelfForm
from tRecordInventoryMoveDifferenceCount tRecordInventoryMoveDifferenceCount with(nolock)
inner join tRecordInventoryMoveCount tRecordInventoryMoveCount with(nolock)  
on tRecordInventoryMoveCount.n_RecordInventoryMoveDifferenceCount_Id
 = tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_Id 
inner join tBillStockInOut tBillStockInOut with(nolock)
on tBillStockInOut.n_BillStockInOut_Id = tRecordInventoryMoveCount.n_BillStockInOut_Id

where tRecordInventoryMoveDifferenceCount.n_BillStockInOut_Id  = @n_BillStockInOut_Id
and tRecordInventoryMoveDifferenceCount.n_RecordInventoryMoveDifferenceCount_state = 1
and tRecordInventoryMoveCount.n_RecordInventoryMoveCount_state = 1

 
 --对于单件盘点时从无盘到有，且可能存在适配的在储位信息表外键ID的记录，进行补漏操作
	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = ''
	from @ReportInventoryCurrent RC
	left join tReportInventoryCurrent with(nolock) on 
	tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and tReportInventoryCurrent.n_Space_Id = RC.n_Space_Id
	and tReportInventoryCurrent.n_Bin_Id = RC.n_Bin_Id
	and tReportInventoryCurrent.s_ReportInventoryCurrent_BatchNumber = RC.s_RecordInventoryMoveDifferenceCount_BatchNumber
	and isnull(tReportInventoryCurrent.n_ReportInventoryCurrent_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and n_ListPutOnOff_ShelfForm in (1,2)

	 

--如果提交的单据里已经存在从无到有的数据 (原有数量为0，盘点数量为N,如果盘点数量为1的话则默认将其视为单件盘点)
-----------------------------
 
 --先定义好变量表里@ReportInventoryCurrent的n_ReportInventoryCurrent_Id与n_ReportInventoryCurrentDetail_Id字段
 --定义好后为后续插入tReportInventoryCurrent表和tReportInventoryCurrentDetail表数据做准备
 
 
 --汇总单件盘点的件进行n_ReportInventoryCurrent_Id字段与n_ReportInventoryCurrentDetail_Id字段的给值,
 --确保货物在储位信息表与货物在储位明细信息表的库位记录。
 -------------------------------------------------------------
 declare @ReportInventoryCurrent_GetID table ( 
    n_ReportInventoryCurrent_Id varchar(max),
    n_ReportInventoryCurrentDetail_Id varchar(max),
	n_Space_Id varchar(max),
	n_Bin_Id varchar(max),
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode varchar(max), 
	s_RecordInventoryMoveDifferenceCount_BatchNumber varchar(max),  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus varchar(max) 
)

insert into @ReportInventoryCurrent_GetID( 
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
	n_Space_Id,
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus  
)
select  
    NEWID(),
	NEWID(),
	n_Space_Id, 
	n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus 
from @ReportInventoryCurrent
group by n_Space_Id,  
    n_Bin_Id,
	s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
	s_RecordInventoryMoveDifferenceCount_BatchNumber,  
	n_RecordInventoryMoveDifferenceCount_QCQualityStatus

	update @ReportInventoryCurrent
	set n_ReportInventoryCurrent_Id = GetID.n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id = GetID.n_ReportInventoryCurrentDetail_Id
	from @ReportInventoryCurrent RC
	left join @ReportInventoryCurrent_GetID GetID on 
	GetID.s_RecordInventoryMoveDifferenceCount_GoodsProductCode = RC.s_RecordInventoryMoveDifferenceCount_GoodsProductCode
	and GetID.n_Space_Id = RC.n_Space_Id
	and isnull(GetID.s_RecordInventoryMoveDifferenceCount_BatchNumber,'') = isnull(RC.s_RecordInventoryMoveDifferenceCount_BatchNumber,'')
	and isnull(GetID.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'') = isnull(RC.n_RecordInventoryMoveDifferenceCount_QCQualityStatus,'')
	and ISNULL(GetID.n_Bin_Id,'') = ISNULL(RC.n_Bin_Id,'')
	where n_RIMC_ReportInventoryCurrent_Number = 0 
	and isnull(RC.n_ReportInventoryCurrent_Id,'') = ''

-----------------------------------------------------------
  

  

--如果库位中原有数量为1,而盘点数量为0的则视为进行单件录入盘无的操作

update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent RC on RC.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
and RC.s_RecordInventoryMoveDifferenceCount_GoodsBarCode = 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode
where  n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 0
 
  

-----------------------------

 
 --校正在储位信息明细表的对应储位数量,都要考虑当前库存是批量录入与单件录入相加而成的

 --首先是校正进行批量盘点的数据
 --则需要查询到该库位进行单件录入的件数
 -----------------------------------------
   


 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_OKProductCou = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0),
 n_ReportInventoryCurrent_LotsizeNumber = isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0) + isnull(cou,0), 
 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select n_ReportInventoryCurrent_Id,sum(Convert(float,s_RecordInventoryMoveDifferenceCount_Number)) as s_RecordInventoryMoveDifferenceCount_Number
  from @ReportInventoryCurrent
  where n_RIMC_ReportInventoryCurrent_Number > 0
  and n_RecordInventoryMoveDifferenceCount_Type = 1
  group by n_ReportInventoryCurrent_Id
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1 

  
 
 -----------------------------------------

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
 
 update tReportInventoryCurrent
 set n_ReportInventoryCurrent_Number = n_ReportInventoryCurrent_Number +  
 isnull(cou,0),
 
 n_ReportInventoryCurrent_OKProductCou = n_ReportInventoryCurrent_Number + 
 isnull(cou,0),
  
 n_ReportInventoryCurrent_SingleNumber = n_ReportInventoryCurrent_SingleNumber + isnull(cou,0),

 s_ReportInventoryCurrent_Updator = @Operator,
 d_ReportInventoryCurrent_UpdateTime = getdate()
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join (
 select 
 n_ReportInventoryCurrent_Id,
 n_ListPutOnOff_ShelfForm,
 sum((case isnull(s_RecordInventoryMoveDifferenceCount_Number,0) when 1 then 1 when 0 then -1 else 0 end)) as cou
 from @ReportInventoryCurrent 
 where n_RecordInventoryMoveDifferenceCount_Type = 2
 group by n_ReportInventoryCurrent_Id,
n_ListPutOnOff_ShelfForm
 ) RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id 
 where n_ReportInventoryCurrent_state = 1 
 and n_ListPutOnOff_ShelfForm in (1,2)   


 
 -----------------------------------------
  


  


 --根据变量表@ReportInventoryCurrent插入tReportInventoryCurrent表
 
insert into tReportInventoryCurrent (
    n_ReportInventoryCurrent_Id,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 

    n_Bin_Id,
    n_PartDescription_Id, 
    s_ReportInventoryCurrent_Code,
    s_ReportInventoryCurrent_ECN,  
    s_ReportInventoryCurrent_GoodsProductName,

    s_ReportInventoryCurrent_GoodsProductCode,
    s_ReportInventoryCurrent_ExternalCode,
    n_ReportInventoryCurrent_Number,
    n_ReportInventoryCurrent_OKProductCou,
    n_ReportInventoryCurrent_UnOKProductCou,

    n_ReportInventoryCurrent_ReworkProductCou,
    n_ReportInventoryCurrent_LotsizeNumber,
    n_ReportInventoryCurrent_SingleNumber,
    s_ReportInventoryCurrent_BatchNumber,
    s_ReportInventoryCurrent_SpecificationAndModel,
    s_ReportInventoryCurrent_Unit,
    s_ReportInventoryCurrent_Model,

    s_ReportInventoryCurrent_Color, 
    n_ReportInventoryCurrent_state,
    s_ReportInventoryCurrent_Creator,
    d_ReportInventoryCurrent_CreateTime,
    s_ReportInventoryCurrent_Updator,

    d_ReportInventoryCurrent_UpdateTime,
    s_ReportInventoryCurrent_QualityStatus,
	n_ReportInventoryCurrent_QCQualityStatus
)
select 
n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,
tSpace.n_Shopfloor_Id,
tSpace.n_Rack_Id,
RC.n_Space_Id,

RC.n_Bin_Id,
n_PartDescription_Id,
tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_ECN,  
s_RecordInventoryMoveDifferenceCount_GoodsProductName, 

s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_ExternalCode, 
sum(s_RecordInventoryMoveDifferenceCount_Number),
sum(s_RecordInventoryMoveDifferenceCount_Number),
0,

0,
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 2 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
(case ISNULL(n_ListPutOnOff_ShelfForm,2) when 1 then sum(isnull(RC.s_RecordInventoryMoveDifferenceCount_Number,0)) else 0 end),
s_RecordInventoryMoveDifferenceCount_BatchNumber,
s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,

s_RecordInventoryMoveDifferenceCount_Color, 
1,
@Operator,
getdate(),
@Operator,

getdate(),
s_RecordInventoryMoveDifferenceCount_QualityStatus,
n_RecordInventoryMoveDifferenceCount_QCQualityStatus

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and not exists(select 1 from tReportInventoryCurrent with(nolock) where n_ReportInventoryCurrent_Id = RC.n_ReportInventoryCurrent_Id)
group by n_ReportInventoryCurrent_Id,
tSpace.n_Warehouse_Id,tSpace.n_Shopfloor_Id,tSpace.n_Rack_Id,
RC.n_Space_Id, RC.n_Bin_Id,n_PartDescription_Id,
tSpace.s_Space_BarCode,s_RecordInventoryMoveDifferenceCount_ECN,s_RecordInventoryMoveDifferenceCount_GoodsProductName,s_RecordInventoryMoveDifferenceCount_GoodsProductCode,s_RecordInventoryMoveDifferenceCount_ExternalCode, 
s_RecordInventoryMoveDifferenceCount_BatchNumber,s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,s_RecordInventoryMoveDifferenceCount_Model,s_RecordInventoryMoveDifferenceCount_Color,
s_RecordInventoryMoveDifferenceCount_QualityStatus,n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
RC.s_RecordInventoryMoveDifferenceCount_Number,n_ListPutOnOff_ShelfForm

   


--如果库位中原有数量为0,而盘点数量为1的则视为进行单件录入盘点的操作


insert into tReportInventoryCurrentDetail_GoodsBarCodeInfo (
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id,
    n_ReportInventoryCurrent_Id,
    n_ReportInventoryCurrentDetail_Id,
    n_Space_Id,
    n_PartDescription_Id,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpaceBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsProductName,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_ExternalCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_BatchNumber,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_SpecificationAndModel,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Unit,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Model,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Color,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QualityStatus,

    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_QCQualityStatus,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_GoodsBarCode,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_PutOnOffOperatime, 
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state,

    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Creator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_CreateTime,
    s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator,
    d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime,
    n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState
)
select
newID(),
n_ReportInventoryCurrent_Id,
n_ReportInventoryCurrentDetail_Id, 
RC.n_Space_Id,
n_PartDescription_Id,

tSpace.s_Space_BarCode,
s_RecordInventoryMoveDifferenceCount_GoodsProductCode, 
s_RecordInventoryMoveDifferenceCount_GoodsProductName,  
s_RecordInventoryMoveDifferenceCount_ExternalCode,
s_RecordInventoryMoveDifferenceCount_BatchNumber,

s_RecordInventoryMoveDifferenceCount_SpecificationAndModel,
s_RecordInventoryMoveDifferenceCount_Unit,
s_RecordInventoryMoveDifferenceCount_Model,
s_RecordInventoryMoveDifferenceCount_Color, 
s_RecordInventoryMoveDifferenceCount_QualityStatus,

n_RecordInventoryMoveDifferenceCount_QCQualityStatus,
s_RecordInventoryMoveDifferenceCount_GoodsBarCode,
@Operator,
getdate(),
1,

@Operator,
getdate(),
@Operator,
getdate(),
1

from @ReportInventoryCurrent RC
left join tSpace tSpace with(nolock) on tSpace.n_Space_Id = RC.n_Space_Id
where n_RIMC_ReportInventoryCurrent_Number = 0
and n_RecordInventoryMoveDifferenceCount_Type = 2
and s_RecordInventoryMoveDifferenceCount_Number = 1

 

 --其次是校正单件盘点的数据,则是对当前库位的库存进行加1或者减1的操作
 --当确认数量为1时，则是在库位的数量上加1
 --当确认数量为0时，则是在库位的数量上减1
 
 -----------------------------------------
 
  
 
 update tReportInventoryCurrent set 
n_ReportInventoryCurrent_SingleNumber = isnull(cou,0) 
 from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
 inner join @ReportInventoryCurrent RC 
 on RC.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
  left join (
 
select 
n_ReportInventoryCurrent_Id, 
Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1 
 group by n_ReportInventoryCurrent_Id

 ) tReportInventoryCurrentDetail_GoodsBarCodeInfo  
 on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id = 
 tReportInventoryCurrent.n_ReportInventoryCurrent_Id
 where n_ReportInventoryCurrent_state = 1   
 and n_RecordInventoryMoveDifferenceCount_Type = 2

      
 -----------------------------------------
  

-- -----------------------------------------
   
   
   
--库位盘点专用
--将库位盘点的记录都盘点成为0
update tReportInventoryCurrent 
set
n_ReportInventoryCurrent_Number = 0,
n_ReportInventoryCurrent_OKProductCou = 0,
n_ReportInventoryCurrent_LotsizeNumber = 0,
n_ReportInventoryCurrent_SingleNumber = 0,
s_ReportInventoryCurrent_Updator = @Operator,
d_ReportInventoryCurrent_UpdateTime = GETDATE()
from tReportInventoryCurrent with(nolock)
inner join @ReportInventoryCurrent ReportInventoryCurrent 
on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3


update tReportInventoryCurrentDetail_GoodsBarCodeInfo
set 
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_OnShelfOperatime=getdate(),
s_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Updator=@Operator,
d_ReportInventoryCurrentDetail_GoodsBarCodeInfo_UpdateTime=getdate(),
n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState=2
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
left join @ReportInventoryCurrent ReportInventoryCurrent on ReportInventoryCurrent.n_ReportInventoryCurrent_Id = 
tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id 
where ReportInventoryCurrent.n_ListPutOnOff_ShelfForm = 3
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"String" Value:"8A100D73-658B-4F87-AB2B-DCF5149A79A4"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:00:56
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:01:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:01:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:01:00
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select * from ( select RowNumber=row_number() over(order by s_ReportInventoryCurrent_Code asc),* from (
select 
--[Columns]
tReportInventoryCurrent.n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
tBin.s_Bin_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName,
s_ReportInventoryCurrent_ExternalCode,
(case isnull(n_ReportInventoryCurrent_QCQualityStatus,'') when '' then ''
when 1 then '合格'
when 2 then '待定'
when 3 then '报废'
when 4 then '返工'
else '' end) as n_ReportInventoryCurrent_QCQualityStatus,
n_ReportInventoryCurrent_Number,
s_ReportInventoryCurrent_SpecificationAndModel,
s_ReportInventoryCurrent_Unit,
s_ReportInventoryCurrent_Model,
s_ReportInventoryCurrent_Color,
s_ReportInventoryCurrent_BatchNumber,
isnull(cou,0) as cou --用于判定该库位是否有单件录入的条码
--[/Columns]
from
tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
left join (select 
n_ReportInventoryCurrent_Id,Count(n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_Id) as cou
from tReportInventoryCurrentDetail_GoodsBarCodeInfo with(nolock)
where n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_IsExistsState = 1
and n_ReportInventoryCurrentDetail_GoodsBarCodeInfo_state = 1
group by n_ReportInventoryCurrent_Id
) tReportInventoryCurrentDetail_GoodsBarCodeInfo on tReportInventoryCurrentDetail_GoodsBarCodeInfo.n_ReportInventoryCurrent_Id
= tReportInventoryCurrent.n_ReportInventoryCurrent_Id
where n_ReportInventoryCurrent_state = 1
and n_Warehouse_Id = (case isnull(@n_Warehouse_Id,'0') when '0' then n_Warehouse_Id else @n_Warehouse_Id end)
and isnull(s_ReportInventoryCurrent_Code,'') like (case isnull(@s_ReportInventoryCurrent_Code,'') when '' then isnull(s_ReportInventoryCurrent_Code,'')
else '%'+ @s_ReportInventoryCurrent_Code +'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductCode,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductCode,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductCode,'') else '%'+@s_ReportInventoryCurrent_GoodsProductCode+'%' end)
and isnull(s_ReportInventoryCurrent_GoodsProductName,'') like (case isnull(@s_ReportInventoryCurrent_GoodsProductName,'') when '' 
then isnull(s_ReportInventoryCurrent_GoodsProductName,'') else '%'+@s_ReportInventoryCurrent_GoodsProductName+'%' end)
and isnull(s_ReportInventoryCurrent_ExternalCode,'') like (case isnull(@s_ReportInventoryCurrent_ExternalCode,'') when '' 
then isnull(s_ReportInventoryCurrent_ExternalCode,'') else '%'+@s_ReportInventoryCurrent_ExternalCode+'%' end)
and isnull(n_ReportInventoryCurrent_Number,0) > 0
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"7487524"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:01:01
类型：Query 查询对象：SelReportInventoryCurrentReportList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ReportInventoryCurrent_GoodsProductCode" DbType:"AnsiString" Value:"7487524"
（3）ParameterName:"@s_ReportInventoryCurrent_GoodsProductName" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_ReportInventoryCurrent_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"50"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:40:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:40:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:40:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:40:01
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:40:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:41:30
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 11:41:30
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-fzzpdcz"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:37
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Mobile Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:38
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:42
类型：Query 查询对象：SelSiteLoginUsers 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
n_Id,
s_UserNO,
s_UserName
from tUser with(nolock)
where s_UserNO <> 'admin'
and n_State = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:54
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:27:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:04
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:10
类型：Query 查询对象：SelWarehouseForUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @s_WorkingProcedure varchar(max)

--员工有指定的库区进行绑定，则默认选择该库区
select top 1
@s_WorkingProcedure = s_WorkingProcedure
from tUser with(nolock)
where s_UserNO = @Operator
and n_state = 1

declare @Warehouse table(
n_Warehouse_Id varchar(max),
s_Warehouse_Code varchar(max),
s_Warehouse_Name varchar(max)
)

insert into @Warehouse
(
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name 
)
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
and s_Warehouse_Code = @s_WorkingProcedure

--查询员工绑定的指定库区，没有则不默认选中
select * from @Warehouse

--查询单据货物可用状态
select '0' as keys,'' as value
union all
select '1','合格'
union all
select '2','待定'
union all
select '3','报废'
union all
select '4','返工'
union all
select '5','待退'
 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:10
类型：Query 查询对象：SelPurchasedInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
--查询盘点单的可选仓库信息
select 
n_Warehouse_Id,s_Warehouse_Name,isnull(s_Warehouse_ShelfForm,'2') as s_Warehouse_ShelfForm
from tWarehouse with(nolock)
where n_Warehouse_state = 1


--查询盘点方式信息
declare @tab table
(
   keys varchar(max),
   Forms varchar(max) 
)

insert into @tab
(
keys,
Forms 
)
select 1,'单件盘点' 
union all
select 2,'批量盘点' 
union all
select 3,'库位盘空' 
 
 select * from @tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:18
类型：Business 业务对象：InsertPurchasedInventoryOperationBillStockInOut 
说明：执行业务过程[1]：0.新增盘点单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1

declare @BillStockInOut_Id varchar(max) = newID()

insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
	n_BillStockInOut_QCQualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
	n_BillStockInOut_ShelfForm,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    @BillStockInOut_Id,
    @BillStockInOut_Code,
    8,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
	@n_BillStockInOut_QCQualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
	@n_BillStockInOut_ShelfForm,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)

select n_BillStockInOut_Id = @BillStockInOut_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
（4）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"null"
（5）ParameterName:"@Warehouse_Id" DbType:"String" Value:"15E6A121-FEEA-4DA8-A54F-E29A60A6A41C"
（6）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"YDPD20220505152810622"
（7）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（8）ParameterName:"@n_BillStockInOut_ShelfForm" DbType:"String" Value:"3"
（9）ParameterName:"@n_BillStockInOut_QCQualityStatus" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:28:21
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:35:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:35:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:35:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:35:53
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:47
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:48
类型：Query 查询对象：SelPurchasedInventoryOperationBillStockInOut 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,[tBillStockInOut].n_Warehouse_Id
	  ,tWarehouse.s_Warehouse_Name
	  ,tBillStockInOut.n_BillStockInOut_ShelfForm as s_Warehouse_ShelfForm
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = [tBillStockInOut].n_Warehouse_Id
  and tWarehouse.n_Warehouse_state = 1
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'YDPD%'
and n_BillStockInOut_Type = 8
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:50
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 15:38:53
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:01:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:01:58
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Mobile Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:01:58
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:01:58
类型：Query 查询对象：SelSiteLoginUsers 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select
n_Id,
s_UserNO,
s_UserName
from tUser with(nolock)
where s_UserNO <> 'admin'
and n_State = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,tSessionStateRecord.d_LoginTime,GETDATE())
< tSessionStateRecord.n_HoldingTime then 0 else 1 end),
UserNO = tSessionStateRecord.s_UserNO,
UserName = tUser.s_UserName
 from tSessionStateRecord tSessionStateRecord with(nolock)
 left join tUser tUser with(nolock) on tSessionStateRecord.s_UserNO = tUser.s_UserNO
where tSessionStateRecord.s_IPAddress = @IPAddress 
and tSessionStateRecord.s_UserAgent = @UserAgent
and tSessionStateRecord.s_UserNO <> ''
and tUser.n_state = 1
order by tSessionStateRecord.d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"::1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:09
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2022/5/5 16:02:44
类型：Query 查询对象：SelPurchasedInventoryGoodsInfo_Inventory 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:


--查询对应的货物可用状态
declare @n_BillStockInOut_QCQualityStatus varchar(max) = ''
declare @n_Warehouse_Id varchar(max) = ''

select 
top 1 
@n_BillStockInOut_QCQualityStatus = n_BillStockInOut_QCQualityStatus,
@n_Warehouse_Id = n_Warehouse_Id 
from tBillStockInOut with(nolock) 
where n_BillStockInOut_Id = @n_BillStockInOut_Id


select 
n_ReportInventoryCurrent_Id,
s_ReportInventoryCurrent_Code,
s_ReportInventoryCurrent_GoodsProductCode,
s_ReportInventoryCurrent_GoodsProductName=(case when CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0) > 0
then SUBSTRING(s_ReportInventoryCurrent_GoodsProductName,0,CHARINDEX('~',s_ReportInventoryCurrent_GoodsProductName,0)) 
else s_ReportInventoryCurrent_GoodsProductName end), 
s_Bin_Code,
s_ReportInventoryCurrent_BatchNumber,
n_ReportInventoryCurrent_Number 

from tReportInventoryCurrent tReportInventoryCurrent with(nolock)
left join tBin tBin with(nolock) on tBin.n_Bin_Id = tReportInventoryCurrent.n_Bin_Id
inner join tSpace tSpace with(nolock) on tSpace.n_Space_Id = tReportInventoryCurrent.n_Space_Id
where n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and s_ReportInventoryCurrent_Code = (case isnull(@s_ReportInventoryCurrent_Code,'')
when '' then s_ReportInventoryCurrent_Code else @s_ReportInventoryCurrent_Code end)
and n_ReportInventoryCurrent_QCQualityStatus = @n_BillStockInOut_QCQualityStatus
and n_ReportInventoryCurrent_state = 1
and n_ReportInventoryCurrent_Number > 0
and tReportInventoryCurrent.n_Warehouse_Id = @n_Warehouse_Id
order by n_Space_ShipmentSequence asc,s_ReportInventoryCurrent_Code asc
 
  
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_BillStockInOut_Id" DbType:"AnsiString" Value:"365D4FF4-9E03-4CC3-8541-3687632554D6"
（1）ParameterName:"@s_ReportInventoryCurrent_Code" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^