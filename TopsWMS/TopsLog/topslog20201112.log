
**************************************************************************************************************------>2020/11/12 9:16:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:03
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:07
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:14
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:14
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:14
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:15
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:18
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:20
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:20
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:21
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:16:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:21:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:21:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:21:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 9:21:22
类型：Query 查询对象：SelBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:14
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:15
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:20
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:20
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:20
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:20
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:01:21
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:32
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
and (isnull(@s_BillStockInOut_ExternalCode,'') <> '' and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end) or (isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
  and (isnull(@s_BillStockInOut_ExternalName,'') <> '' and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end) or (isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  --and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  --then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/12 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（8）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（9）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（10）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:32
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
and (isnull(@s_BillStockInOut_ExternalCode,'') <> '' and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end) or (isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
  and (isnull(@s_BillStockInOut_ExternalName,'') <> '' and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end) or (isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  --and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  --then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/12 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（8）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（9）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（10）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:56
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:56
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:17:56
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:37:09
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:37:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:37:10
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOutDetail"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:38:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:38:52
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut_Cache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:21
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:21
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut_Cache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:34
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"出入库单表主键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_BillStockInOut_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tBillStockInOut_Cache"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:"货物出入库单表"
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货物出入库单表_缓存区所用表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:34
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:39:34
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tBillStockInOut_Cache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 10:59:27
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 11:23:46
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 11:23:46
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 11:23:47
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 11:25:31
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 11:27:44
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 11:31:43
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:06:47
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:06:47
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:06:47
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:07:56
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:07
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:18
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:19
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:24
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:24
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:24
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:24
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:25
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:26
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:48
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:50
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:50
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:09:59
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:00
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:01
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:10
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:12
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:13
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:21
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:22
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:23
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:54
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut_Cache] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
and (isnull(@s_BillStockInOut_ExternalCode,'') <> '' and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end) or (isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
  and (isnull(@s_BillStockInOut_ExternalName,'') <> '' and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end) or (isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  --and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  --then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/12 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（8）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（9）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（10）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:10:54
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut_Cache] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
and (isnull(@s_BillStockInOut_ExternalCode,'') <> '' and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end) or (isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
  and (isnull(@s_BillStockInOut_ExternalName,'') <> '' and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end) or (isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  --and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  --then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/11/12 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（8）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（9）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（10）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:21:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 13:21:25
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:35
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:35
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:35
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:02:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:15
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:16
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:22
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:22
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:22
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:23
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:09:24
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:24
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"home"
（5）ParameterName:"@PowerName" DbType:"String" Value:"系统首页"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"home"
（5）ParameterName:"@PowerName" DbType:"String" Value:"系统首页"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelAllChildServerModule"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询所有的子模块的操作说明文档数据"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelModuleFather"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据相应信息查询选项信息"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPowersByModuleID"
（5）ParameterName:"@PowerName" DbType:"String" Value:"通过模块ID获取相关权限"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"selSendEmail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"邮件发送"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:39:41
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelIMWarehousingCacheData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询前一天的注塑缓存区的进出存数据（看板）"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"home"
（5）ParameterName:"@PowerName" DbType:"String" Value:"系统首页"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"home"
（5）ParameterName:"@PowerName" DbType:"String" Value:"系统首页"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelAllChildServerModule"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询所有的子模块的操作说明文档数据"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelModuleFather"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据相应信息查询选项信息"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPowersByModuleID"
（5）ParameterName:"@PowerName" DbType:"String" Value:"通过模块ID获取相关权限"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"selSendEmail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"邮件发送"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:07
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelIMWarehousingCacheData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"(注塑缓存区进出存看板)查询前一天的注塑缓存区的进出存数据（看板）"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"home"
（5）ParameterName:"@PowerName" DbType:"String" Value:"系统首页"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"home"
（5）ParameterName:"@PowerName" DbType:"String" Value:"系统首页"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelAllChildServerModule"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询所有的子模块的操作说明文档数据"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelModuleFather"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据相应信息查询选项信息"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelPowersByModuleID"
（5）ParameterName:"@PowerName" DbType:"String" Value:"通过模块ID获取相关权限"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"selSendEmail"
（5）ParameterName:"@PowerName" DbType:"String" Value:"邮件发送"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:21
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"True"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"_Default_Role"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelIMWarehousingCacheData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"(注塑缓存区进出存看板)查询"
（6）ParameterName:"@PowerType" DbType:"Int32" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:26
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:27
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:31
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:31
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:31
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:31
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:32
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:40:34
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:42:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:42:07
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:42:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:42:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:42:08
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:48:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:48:37
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:48:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:48:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:48:37
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:52:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:52:11
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:53:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:53:17
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:03
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:04
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:40
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 14:56:41
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:03:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:03:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:04:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:04:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:04:00
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:10
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:11
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:40
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:05:41
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:06:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:06:09
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:06:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:06:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:06:13
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:27
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:28
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:07:35
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:09:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:09:05
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:09:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:09:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:09:06
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:12:49
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:12:49
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:12:49
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:48
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:49
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:53
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:53
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:53
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:53
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:18:54
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:19:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:19:02
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:19:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:19:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:19:02
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:21:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:21:10
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:21:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:21:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:21:12
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:49
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:50
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:22:59
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:28:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:28:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:28:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:28:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:28:08
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:04
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:06
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:22
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:32:23
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:34:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:34:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:34:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:34:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:34:59
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:35:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:35:06
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:35:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:35:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:35:06
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:18
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:39
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:40:40
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:41:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:41:36
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:41:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:41:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:41:37
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:09
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:10
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:36
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:42:37
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:43:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:43:41
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:43:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:43:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:43:42
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:49:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:49:07
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:49:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:49:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:49:08
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:50:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:50:57
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:50:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:50:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:50:58
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:23
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:24
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:51:51
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:22
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:23
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:23
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:54
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:54:54
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:54
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:55:59
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:51
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:57
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:57:57
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:58:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:58:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:58:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:58:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 15:58:08
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:03:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:03:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:03:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:03:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:03:09
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:20
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:23
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:28
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:29
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:58
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:04:58
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:41
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:41
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:41
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:43
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:43
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:43
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:43
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:50
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:50
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:54
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:05:54
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:06:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:06:50
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:06:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:06:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:06:51
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:10:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:10:50
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:10:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:10:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:10:51
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:11:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:11:48
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:11:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:11:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:11:49
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:14:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:14:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:14:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:14:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:14:51
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:15:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:15:05
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:15:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:15:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:15:05
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:16:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:16:24
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:16:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:16:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:16:25
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:20:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:20:21
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:20:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:20:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:20:22
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:22:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:22:48
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:22:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:22:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:22:49
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:05
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:06
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:27
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:28
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 3 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:38
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:38
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:23:52
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:24:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:24:17
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:24:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:24:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:24:17
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:25:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:25:04
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:25:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:25:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:25:05
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:05
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:06
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:25
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:28:25
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:33:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:33:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:33:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:33:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:33:34
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:34:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:34:09
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:34:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:34:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:34:11
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:21
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:23
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:33
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:35:46
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:43:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:43:40
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:43:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:43:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:43:41
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:44:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:44:23
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:44:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:44:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:44:24
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:56:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:56:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:57:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:57:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 16:57:00
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:08:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:08:25
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:08:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:08:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:08:26
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:10:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:10:57
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:10:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:10:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:10:58
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:11:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:11:37
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:11:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:11:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:11:38
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:19:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:19:26
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:19:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:19:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:19:26
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:20:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:20:48
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:20:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:20:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:20:49
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:21:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:21:05
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:21:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:21:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:21:06
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:31
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:32
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:32
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:31:54
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:10
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:11
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:21
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:21
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:33:21
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:05
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:39
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:40
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:44
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:45
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:35:45
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:19
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:19
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:30
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:38:31
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:39:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:39:47
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:39:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:39:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:39:48
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:40:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:40:01
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:40:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:40:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:40:02
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:42:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:42:17
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:42:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:42:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:42:18
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,getdate()),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),getdate(),120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:52:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:52:02
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:52:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:52:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:52:15
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:52:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:09
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:09
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:09
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:10
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:32
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:33
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:53:51
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:09
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:09
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:11
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-10"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:52
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:52
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:54
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:54:57
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-10"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:55:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:55:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:55:01
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-09"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:29
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:29
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:33
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-10"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:56:37
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-06"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:59:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:59:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:59:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:59:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 17:59:35
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:00:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:00:07
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:00:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:00:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:00:08
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:11
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:14
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:14
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:32
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:33
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:39
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:05:40
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:09:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:09:52
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:09:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:09:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:09:53
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:10:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:10:20
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:10:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:10:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:10:20
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:46
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:47
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-11"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:52
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-01"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:11:59
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-10-31"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:01
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-10-22"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:07
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-04"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:11
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:11
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-29"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:18
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:18
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-10-28"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:24
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-09-26"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:34
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:34
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-10-30"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/11/12 18:12:58
类型：Query 查询对象：SelIMWarehousingCacheData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,-1,@Date),120)+' 00:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),@Date,120)+' 00:00:00'

--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
 


 
select top 10 * from @Infotable order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"AnsiString" Value:"2020-11-07"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^