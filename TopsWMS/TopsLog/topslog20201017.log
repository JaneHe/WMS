
**************************************************************************************************************------>2020/10/17 10:01:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:01:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:00
类型：Query 查询对象：SelNewProjectUpdateLogNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

select Top 1 s_no from tProjectUpdateLog where s_no <> '--' order by d_createtime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:15
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:16
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:28
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:34
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:35
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:02:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:04:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:06:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:14:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:22:53
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:22:54
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:22:54
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:23:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:23:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:23:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:23:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:23:16
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:23:20
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:27:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:27:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:27:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelBillStockInOutAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区入出库单信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:27:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelListPutOnOffAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区上下架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:27:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelListStockInOutAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区入出库记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:27:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交与撤销提交单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:36
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:36
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:36
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelBillStockInOutAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区入出库单信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:36
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelListPutOnOffAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区上下架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:37
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelListStockInOutAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区入出库记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:37
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交与撤销提交单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:30:41
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:31:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:31:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:31:02
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:31:20
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:38
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:38
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:38
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交与撤销提交单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:38
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelBillStockInOutAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区入出库单信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:38
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelListPutOnOffAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区上下架记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:38
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelListStockInOutAssemblyCacheList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询装配缓存区入出库记录信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:33:39
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：5.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitListPutOnOffAssemblyCache"
（5）ParameterName:"@PowerName" DbType:"String" Value:"提交与撤销提交入库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:09
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:10
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:11
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:50
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:52
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:36:55
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:32
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:35
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:37:36
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:50
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:54
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:54
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:54
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:54
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:38:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:12
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:15
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:26
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:49
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:39:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:40:30
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:40:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:41:28
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:41:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:41:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:41:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:41:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:41:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:43:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:43:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:44:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:43
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:43
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:51
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:46:52
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:16
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:"n_BillStockInOut_Id"
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:16
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:"n_BillStockInOut_Id"
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:39
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:39
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"10"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:44
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"21"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"40"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:44
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"21"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"40"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:47
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by Field desc),* from (
SELECT  
--[Columns]
    ID=n_ID,
    Field=s_Field,
    Scene=s_Scene,
    Location=s_Location,
    Caption=s_Caption,
    Type=s_Type,
    Format=s_Format,
    CommonID=s_CommonID,
    Width=s_Width,
    Sql=s_Sql
--[/Columns]
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"41"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"60"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:48:47
类型：Query 查询对象：Tool_SelDictionarys 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT  
 R=1 
from tDictionary
where s_Location=case isnull(@Location,'') when '' then s_Location
                                                               else @Location end
and isnull(s_Field,'') like '%'+isnull(@Field,'')+'%'
and isnull(s_Caption,'') like '%'+isnull(@Caption,'') +'%'

 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Field" DbType:"AnsiString" Value:""
（1）ParameterName:"@Caption" DbType:"AnsiString" Value:""
（2）ParameterName:"@Location" DbType:"AnsiString" Value:"chs"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"41"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"60"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:51:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:51:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:51:40
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:51:40
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:52:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:52:42
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:52:42
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/1 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 10:52:42
类型：Query 查询对象：SelBillStockInOutList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/1 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:06:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:07:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:07:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:08:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:08:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:24
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:24
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:32
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:44
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitBillStockInOutAssemblyCache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"AddSubmitListPutOnOffAssemblyCache"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：2.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelBillStockInOutAssemblyCacheList"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：3.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelListPutOnOffAssemblyCacheList"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:09:55
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：4.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelListStockInOutAssemblyCacheList"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:10:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:11:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:11:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:11:03
类型：Query 查询对象：SelBillStockInOutAssemblyCacheList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 11:11:04
类型：Query 查询对象：SelBillStockInOutAssemblyCacheList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:47
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:52
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:03:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:30
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:31
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:32
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:33
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:34
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:36
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:36
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:37
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:57
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:58
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:04:59
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:09
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:""
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:09
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:10
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:10
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:10
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:13
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:14
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:15
类型：Business 业务对象：UpdateRespondTime 
说明：执行业务过程[1]：0.更新报道时间
***************************************************************************************************************
SQL:
declare @codeNum int=@NumCode
if(@codeNum =1)
    begin
        update tUser set d_RespondTime=GETDATE() where s_UserNO=@UserNo
    end
else if(@codeNum=2)
    begin
        update tUser set d_QuitTime=GETDATE() where s_UserNO=@UserNo
    end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@NumCode" DbType:"Int32" Value:"2"
（3）ParameterName:"@UserNo" DbType:"String" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:16
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:16
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:16
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:17
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:19
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:20
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:20
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:21
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:22
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:41
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:41
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Warehouse_Id asc),* from (
SELECT 
--[Columns]      
      [n_Warehouse_Id]
      ,tBlock.s_Block_Name
      ,tShopfloor.s_Shopfloor_Name
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose]
      ,[s_Warehouse_Remark]
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[n_Warehouse_state]=(case n_Warehouse_state when 1 then '正常' else '停用' end)
      ,[s_Warehouse_Creator]
      ,[d_Warehouse_CreateTime]
      ,[s_Warehouse_Updator]
      ,[d_Warehouse_UpdateTime]
--[/Columns]     
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:05:42
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1      
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
 ) T_RowsCount  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:07:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:07:27
类型：Query 查询对象：SelWarehouseNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select distinct n_Block_Id,n_Shopfloor_Id from tShopfloor with(nolock)
where n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr


--储位码
select top 1 s_Space_BarCode from tSpace with(nolock)
where n_Space_state = 1 and n_Rack_Id = isnull(@Sel_Id,'')
order by d_Space_CreateTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:29
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:42
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:43
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:57:45
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:58:58
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:58:58
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:58:58
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:58:59
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:01
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:01
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:01
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:02
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:08
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:10
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:11
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:11
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:11
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:11
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:13
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:14
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:15
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:16
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:36
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Warehouse_Id asc),* from (
SELECT 
--[Columns]      
      [n_Warehouse_Id]
      ,tBlock.s_Block_Name
      ,tShopfloor.s_Shopfloor_Name
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose]
      ,[s_Warehouse_Remark]
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[n_Warehouse_state]=(case n_Warehouse_state when 1 then '正常' else '停用' end)
      ,[s_Warehouse_Creator]
      ,[d_Warehouse_CreateTime]
      ,[s_Warehouse_Updator]
      ,[d_Warehouse_UpdateTime]
--[/Columns]     
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:37
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1      
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
 ) T_RowsCount  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:42
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:50
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:50
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Rack_Id asc),* from (
SELECT 
--[Columns]
      n_Rack_Id
      ,[s_Block_Name]
      ,[s_Warehouse_Name]
      ,[s_Rack_StorageType]
      ,s_Rack_CodePrefix
      ,[s_Rack_Code]
      ,[n_Rack_SpaceCapacity]
      ,[n_Rack_LayerCapacity] 
      ,[n_Rack_MaximumStorageCapacity]
      ,[n_Rack_QualityLevel]=
      (case isnull([n_Rack_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[f_Rack_Width]
      ,[f_Rack_Height]
      ,[f_Rack_Length]
      ,(case isnull([n_Rack_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) as n_Rack_UsageStatus
      ,[s_Rack_CustomFields1]
      ,[s_Rack_CustomFields2]
      ,[s_Rack_CustomFields3]
      ,[s_Rack_CustomFields4]
      ,[s_Rack_CustomFields5]
      ,[s_Rack_CustomFields6]
      ,[s_Rack_CustomFields7]
      ,[s_Rack_CustomFields8]
      ,[s_Rack_CustomFields9]
      ,[s_Rack_CustomFields10]
      ,[n_Rack_state]=(case n_Rack_state when 1 then '正常' else '停用' end)
      ,[s_Rack_Creator]
      ,[d_Rack_CreateTime]
      ,[s_Rack_Updator]
      ,[d_Rack_UpdateTime]
--[/Columns]
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"173E4AFC-2513-4B63-94E1-A200703DF3F5"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:50
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"173E4AFC-2513-4B63-94E1-A200703DF3F5"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:55
类型：Query 查询对象：SelWarehouseNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select distinct n_Block_Id,n_Shopfloor_Id from tShopfloor with(nolock)
where n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr


--储位码
select top 1 s_Space_BarCode from tSpace with(nolock)
where n_Space_state = 1 and n_Rack_Id = isnull(@Sel_Id,'')
order by d_Space_CreateTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"String" Value:"173E4AFC-2513-4B63-94E1-A200703DF3F5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 15:59:58
类型：Query 查询对象：SelWarehouse 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_Warehouse_Id]
      ,[n_Block_Id] as [n_Warehouse_Block_Id]
      ,[n_Shopfloor_Id] as [n_Warehouse_Shopfloor_Id]
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose] 
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[s_Warehouse_Remark]
      ,[n_Warehouse_state] 
  FROM [dbo].[tWarehouse] with(nolock)
  where [n_Warehouse_Id] = @n_Warehouse_Id
 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"173E4AFC-2513-4B63-94E1-A200703DF3F5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:01
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:04
类型：Query 查询对象：SelWarehouseNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select distinct n_Block_Id,n_Shopfloor_Id from tShopfloor with(nolock)
where n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr


--储位码
select top 1 s_Space_BarCode from tSpace with(nolock)
where n_Space_state = 1 and n_Rack_Id = isnull(@Sel_Id,'')
order by d_Space_CreateTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:10
类型：Query 查询对象：SelWarehouseCodeList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Shopfloor_Code,
s_Block_Code
from tWarehouse tWarehouse with(nolock)
left join tShopfloor tShopfloor with(nolock)
on tWarehouse.n_Shopfloor_Id = tShopfloor.n_Shopfloor_Id
left join tBlock tBlock with(nolock)
on tBlock.n_Block_Id = tWarehouse.n_Block_Id


--查询当前仓库的货架编码最大值
declare @Warehouse table(
    n_Warehouse_Id varchar(max),
    s_Rack_Code int
) 

insert into @Warehouse
select 
tWarehouse.n_Warehouse_Id,
(case when max(Convert(int,s_Rack_Code)) IS null then 1 else max(Convert(int,s_Rack_Code))+1 end) as s_Rack_Code 
from 
tWarehouse with(nolock) 
left join tRack with(nolock) on tWarehouse.n_Warehouse_Id = tRack.n_Warehouse_Id
where isnull(n_Rack_state,1) = 1 and n_Warehouse_state = 1
group by tWarehouse.n_Warehouse_Id

select * from @Warehouse



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:58
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:58
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Rack_Id asc),* from (
SELECT 
--[Columns]
      n_Rack_Id
      ,[s_Block_Name]
      ,[s_Warehouse_Name]
      ,[s_Rack_StorageType]
      ,s_Rack_CodePrefix
      ,[s_Rack_Code]
      ,[n_Rack_SpaceCapacity]
      ,[n_Rack_LayerCapacity] 
      ,[n_Rack_MaximumStorageCapacity]
      ,[n_Rack_QualityLevel]=
      (case isnull([n_Rack_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[f_Rack_Width]
      ,[f_Rack_Height]
      ,[f_Rack_Length]
      ,(case isnull([n_Rack_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) as n_Rack_UsageStatus
      ,[s_Rack_CustomFields1]
      ,[s_Rack_CustomFields2]
      ,[s_Rack_CustomFields3]
      ,[s_Rack_CustomFields4]
      ,[s_Rack_CustomFields5]
      ,[s_Rack_CustomFields6]
      ,[s_Rack_CustomFields7]
      ,[s_Rack_CustomFields8]
      ,[s_Rack_CustomFields9]
      ,[s_Rack_CustomFields10]
      ,[n_Rack_state]=(case n_Rack_state when 1 then '正常' else '停用' end)
      ,[s_Rack_Creator]
      ,[d_Rack_CreateTime]
      ,[s_Rack_Updator]
      ,[d_Rack_UpdateTime]
--[/Columns]
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"173E4AFC-2513-4B63-94E1-A200703DF3F5"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:04:58
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"173E4AFC-2513-4B63-94E1-A200703DF3F5"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:07:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:07:58
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:01
类型：Query 查询对象：SelWarehouseNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select distinct n_Block_Id,n_Shopfloor_Id from tShopfloor with(nolock)
where n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr


--储位码
select top 1 s_Space_BarCode from tSpace with(nolock)
where n_Space_state = 1 and n_Rack_Id = isnull(@Sel_Id,'')
order by d_Space_CreateTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"String" Value:"A786004C-A176-4AC8-B075-C7C92A7AD232"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:06
类型：Query 查询对象：SelWarehouseCodeList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Shopfloor_Code,
s_Block_Code
from tWarehouse tWarehouse with(nolock)
left join tShopfloor tShopfloor with(nolock)
on tWarehouse.n_Shopfloor_Id = tShopfloor.n_Shopfloor_Id
left join tBlock tBlock with(nolock)
on tBlock.n_Block_Id = tWarehouse.n_Block_Id


--查询当前仓库的货架编码最大值
declare @Warehouse table(
    n_Warehouse_Id varchar(max),
    s_Rack_Code int
) 

insert into @Warehouse
select 
tWarehouse.n_Warehouse_Id,
(case when max(Convert(int,s_Rack_Code)) IS null then 1 else max(Convert(int,s_Rack_Code))+1 end) as s_Rack_Code 
from 
tWarehouse with(nolock) 
left join tRack with(nolock) on tWarehouse.n_Warehouse_Id = tRack.n_Warehouse_Id
where isnull(n_Rack_state,1) = 1 and n_Warehouse_state = 1
group by tWarehouse.n_Warehouse_Id

select * from @Warehouse



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:07
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:07
类型：Query 查询对象：SelRack 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT  
      [n_Warehouse_Id] as s_Rack_Warehouse_Name
      ,[s_Rack_Code]
      ,s_Rack_CodePrefix
      ,[s_Rack_StorageType] 
      ,[n_Rack_LayerCapacity]
      ,[n_Rack_SpaceCapacity]
      ,[n_Rack_MaximumStorageCapacity]
      ,[n_Rack_QualityLevel]
      ,[f_Rack_Width]
      ,[f_Rack_Height]
      ,[f_Rack_Length] 
      ,[s_Rack_CustomFields1]
      ,[s_Rack_CustomFields2]
      ,[s_Rack_CustomFields3]
      ,[s_Rack_CustomFields4]
      ,[s_Rack_CustomFields5]
      ,[s_Rack_CustomFields6]
      ,[s_Rack_CustomFields7]
      ,[s_Rack_CustomFields8]
      ,[s_Rack_CustomFields9]
      ,[s_Rack_CustomFields10]
      ,[n_Rack_state]  
  FROM [dbo].[tRack] with(nolock)
where n_Rack_Id = @n_Rack_Id 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"A786004C-A176-4AC8-B075-C7C92A7AD232"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:53
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:08:55
类型：Query 查询对象：SelRackSpacePrintList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @SQL varchar(max) = 'select 
tWarehouse.s_Warehouse_Name,
''货架''+tRack.s_Rack_Code + ''的第''+Convert(varchar(20),tSpace.n_Space_BayNumber)+''列的第'' + Convert(varchar(20),tSpace.n_Space_LayerNumber) + ''层'' as s_Rack_Code,
s_Space_BarCode 
from tSpace tSpace with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tRack.n_Warehouse_Id
where tRack.n_Rack_state = 1 and tWarehouse.n_Warehouse_state = 1 and tSpace.n_Space_state = 1
and tRack.n_Rack_Id in ('+@n_Rack_Id+')'

exec(@SQL)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"'A786004C-A176-4AC8-B075-C7C92A7AD232'"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:13:05
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:13:05
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:13:05
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:07
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:54
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:22:54
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:23:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:23:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:23:05
类型：Query 查询对象：SelSpaceList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_Space_BarCode asc),* from (
SELECT 
--[Columns]
      [tSpace].[n_Space_Id]
      ,[tSpace].[n_CombinedSpace_Id]  
      ,n_SplitSpace_Id
      ,(case when ISNULL(tCombinedSpace.n_CombinedSpace_Id,'') = '' then 0 else 1 end) as n_CombinedSpace_State
      ,tWarehouse.s_Warehouse_Name
      ,tRack.s_Rack_Code
      ,[s_Space_Code]
      ,[s_Space_BarCode]
      ,[n_Space_BayNumber]
      ,[n_Space_LayerNumber] 
      ,[n_Space_Position]
      ,[n_Space_MaxPosition]
      ,[s_Space_StorageType]
      ,[n_Space_Warehouse]
      ,[n_Space_Width]
      ,[n_Space_Height]
      ,[n_Space_Length]
      ,[n_Space_ShipmentSequence]
      ,[n_Space_QualityLevel]=
      (case isnull([n_Space_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[n_Space_UsageStatus]=(case n_Space_UsageStatus when 1 then '已占用' when 2 then '未完全占用' else '空闲' end)
      ,[s_Space_LocationLock]
      ,[s_Space_OverflowLocation]
      ,[n_Space_RestrictedStorageMaterialType]
      ,[s_Space_CustomFields1]
      ,[s_Space_CustomFields2]
      ,[s_Space_CustomFields3]
      ,[s_Space_CustomFields4]
      ,[s_Space_CustomFields5]
      ,[s_Space_CustomFields6]
      ,[s_Space_CustomFields7]
      ,[s_Space_CustomFields8]
      ,[s_Space_CustomFields9]
      ,[s_Space_CustomFields10]
      ,[n_Space_state]=(case n_Space_state when 1 then '正常' else '停用' end)
      ,[s_Space_Creator]
      ,[d_Space_CreateTime]
      ,[s_Space_Updator]
      ,[d_Space_UpdateTime]
--[/Columns]
  FROM [dbo].[tSpace] with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tSpace.n_Warehouse_Id
left join tCombinedSpace tCombinedSpace with(nolock) on tCombinedSpace.n_Space_Id = tSpace.n_Space_Id
and tCombinedSpace.n_CombinedSpace_state = 1
where tSpace.n_Rack_Id = @n_Rack_Id
and n_Space_BayNumber = (case when isnull(@Space_BayNumber,'') = '' then n_Space_BayNumber else @Space_BayNumber end) 
and [n_Space_LayerNumber] = (case when isnull(@Space_LayerNumber,'') = '' then [n_Space_LayerNumber] else @Space_LayerNumber end) 
and [s_Space_BarCode] like (case when isnull(@Space_BarCode,'') = '' then [s_Space_BarCode] else '%'+@Space_BarCode+'%' end) 
and n_Space_state = (case when isnull(@Space_state,0) = 0 then n_Space_state else @Space_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"A786004C-A176-4AC8-B075-C7C92A7AD232"
（1）ParameterName:"@Space_BayNumber" DbType:"AnsiString" Value:""
（2）ParameterName:"@Space_LayerNumber" DbType:"AnsiString" Value:""
（3）ParameterName:"@Space_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@Space_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:23:05
类型：Query 查询对象：SelSpaceList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tSpace] with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tSpace.n_Warehouse_Id
left join tCombinedSpace tCombinedSpace with(nolock) on tCombinedSpace.n_Space_Id = tSpace.n_Space_Id
and tCombinedSpace.n_CombinedSpace_state = 1
where tSpace.n_Rack_Id = @n_Rack_Id
and n_Space_BayNumber = (case when isnull(@Space_BayNumber,'') = '' then n_Space_BayNumber else @Space_BayNumber end) 
and [n_Space_LayerNumber] = (case when isnull(@Space_LayerNumber,'') = '' then [n_Space_LayerNumber] else @Space_LayerNumber end) 
and [s_Space_BarCode] like (case when isnull(@Space_BarCode,'') = '' then [s_Space_BarCode] else '%'+@Space_BarCode+'%' end) 
and n_Space_state = (case when isnull(@Space_state,0) = 0 then n_Space_state else @Space_state end)
 ) T_RowsCount 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"A786004C-A176-4AC8-B075-C7C92A7AD232"
（1）ParameterName:"@Space_BayNumber" DbType:"AnsiString" Value:""
（2）ParameterName:"@Space_LayerNumber" DbType:"AnsiString" Value:""
（3）ParameterName:"@Space_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@Space_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:23:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:23:57
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:01
类型：Query 查询对象：SelSpaceNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

--基础数据关联查询
  
select top 1 
 s_Block_Code,
 s_Shopfloor_Code,
 s_Warehouse_Code,
 s_Rack_Code
from tRack tRack with(nolock)
left join tWarehouse tWarehouse with(nolock) on tRack.n_Warehouse_Id = tRack.n_Warehouse_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tRack.n_Block_Id
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = tRack.n_Shopfloor_Id
where tRack.n_Rack_Id = @n_Rack_Id 
and n_Warehouse_state = 1 and tRack.n_Rack_state = 1
and n_Block_state = 1 and n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr

--储位编码最大值
declare @Space_MaxCode varchar(max)

select top 1 @Space_MaxCode = s_Space_Code from tSpace with(nolock)
where n_Rack_Id = @n_Rack_Id and n_Space_state = 1
order by Convert(int,s_Space_Code) desc

select Space_MaxCode = isnull(@Space_MaxCode,0) + 1
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"String" Value:"A786004C-A176-4AC8-B075-C7C92A7AD232"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:39
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:42
类型：Query 查询对象：SelSpaceNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

--基础数据关联查询
  
select top 1 
 s_Block_Code,
 s_Shopfloor_Code,
 s_Warehouse_Code,
 s_Rack_Code
from tRack tRack with(nolock)
left join tWarehouse tWarehouse with(nolock) on tRack.n_Warehouse_Id = tRack.n_Warehouse_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tRack.n_Block_Id
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = tRack.n_Shopfloor_Id
where tRack.n_Rack_Id = @n_Rack_Id 
and n_Warehouse_state = 1 and tRack.n_Rack_state = 1
and n_Block_state = 1 and n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr

--储位编码最大值
declare @Space_MaxCode varchar(max)

select top 1 @Space_MaxCode = s_Space_Code from tSpace with(nolock)
where n_Rack_Id = @n_Rack_Id and n_Space_state = 1
order by Convert(int,s_Space_Code) desc

select Space_MaxCode = isnull(@Space_MaxCode,0) + 1
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"String" Value:"A786004C-A176-4AC8-B075-C7C92A7AD232"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:24:44
类型：Query 查询对象：SelSpace 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT  [tSpace].[n_Rack_Id] 
      ,[s_Space_Code]
      ,tRack.s_Rack_CodePrefix
      ,[s_Space_BarCode]
      ,[n_Space_LayerNumber]
      ,[n_Space_BayNumber]
      ,[n_Space_Position]
      ,[n_Space_MaxPosition]
      ,[s_Space_StorageType]
      ,[n_Space_Warehouse]
      ,[n_Space_Width]
      ,[n_Space_Height]
      ,[n_Space_Length]
      ,[n_Space_ShipmentSequence]
      ,[n_Space_QualityLevel] 
      ,[s_Space_LocationLock]
      ,[s_Space_OverflowLocation]
      ,[n_Space_RestrictedStorageMaterialType]
      ,[s_Space_CustomFields1]
      ,[s_Space_CustomFields2]
      ,[s_Space_CustomFields3]
      ,[s_Space_CustomFields4]
      ,[s_Space_CustomFields5]
      ,[s_Space_CustomFields6]
      ,[s_Space_CustomFields7]
      ,[s_Space_CustomFields8]
      ,[s_Space_CustomFields9]
      ,[s_Space_CustomFields10] 
  FROM [dbo].[tSpace] with(nolock)
  left join tRack tRack with(nolock) on tRack.n_Rack_Id = [tSpace].n_Rack_Id 
  where [n_Space_Id] = @Sel_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"AnsiString" Value:"F37C4180-B6C4-4DED-B535-D5AFA37DD956"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:25:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:25:20
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:25:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:25:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:25:22
类型：Query 查询对象：SelSpacePrintList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @SQL varchar(max) = 'select 
tWarehouse.s_Warehouse_Name,
''货架''+tRack.s_Rack_Code + ''的第''+Convert(varchar(20),tSpace.n_Space_BayNumber)+''列的第'' + Convert(varchar(20),tSpace.n_Space_LayerNumber) + ''层'' as s_Rack_Code,
s_Space_BarCode 
from tSpace tSpace with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tRack.n_Warehouse_Id
where tRack.n_Rack_state = 1 and tWarehouse.n_Warehouse_state = 1 and tSpace.n_Space_state = 1
and tSpace.n_Space_Id in ('+@n_Space_Id+')'

exec(@SQL)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Space_Id" DbType:"AnsiString" Value:"'F37C4180-B6C4-4DED-B535-D5AFA37DD956'"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:40
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:40
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:40
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:41
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:41
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:52
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:26:52
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ckjcxxgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:22
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:24
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:24
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:25
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:33
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:33
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:33
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:34
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:36
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:37
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:38
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:38
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:39
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:46:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:51:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:51:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:51:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:51:35
类型：Query 查询对象：SelBillStockInOutAssemblyCacheList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by d_BillStockInOut_CreateTime desc),* from (
SELECT 
--[Columns]
      [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]
      ,[n_Warehouse_Id]
      ,[n_Shopfloor_Id]
      ,[n_Rack_Id]
      ,[n_Space_Id]
      ,[n_CombinedSpace_Id]
      ,[n_SplitSpace_Id]
      ,[n_Bin_Id]
      ,[n_ReportInventoryCurrent_Id]
      ,[s_BillStockInOut_BarCode]
      ,[s_BillStockInOut_ExternalCode]
      ,[s_BillStockInOut_ExternalName]
      ,[s_BillStockInOut_ECN]
      ,[n_APQPStatus_Id]
      ,[s_APQPStatus_Name]
      ,(case [n_BillStockInOut_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as [n_BillStockInOut_QualityStatus]
      ,[s_BillStockInOut_Operator]
      ,[s_BillStockInOut_Department]
      ,(case [s_BillStockInOut_Team] when 1 then '白班'
      when 2 then '夜班' else '' end) as [s_BillStockInOut_Team]
      ,Convert(varchar(20),[d_BillStockInOut_OperateTime],120) as [d_BillStockInOut_OperateTime]
      ,[s_BillStockInOut_Remark]
      ,[s_BillStockInOut_WhetherToSubmit]=(case s_BillStockInOut_WhetherToSubmit when 0 then '否' else '是' end)
      ,[f_BillStockInOut_WorkOrderQuantity]
      ,[f_BillStockInOut_OKProductCou]
      ,[f_BillStockInOut_UnOKProductCou]
      ,[f_BillStockInOut_ReworkProductCou]
      ,[s_BillStockInOut_CustomFields1]
      ,[s_BillStockInOut_CustomFields2]
      ,[s_BillStockInOut_CustomFields3]
      ,[s_BillStockInOut_CustomFields4]
      ,[s_BillStockInOut_CustomFields5]
      ,[s_BillStockInOut_CustomFields6]
      ,[s_BillStockInOut_CustomFields7]
      ,[s_BillStockInOut_CustomFields8]
      ,[s_BillStockInOut_CustomFields9]
      ,[s_BillStockInOut_CustomFields10]
      ,[n_BillStockInOut_state]=(case n_BillStockInOut_state when 1 then '正常' else '停用' end)
      ,[s_BillStockInOut_Creator]
      ,[d_BillStockInOut_CreateTime]
      ,[s_BillStockInOut_Updator]
      ,[d_BillStockInOut_UpdateTime]
--[/Columns]
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 16:51:35
类型：Query 查询对象：SelBillStockInOutAssemblyCacheList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [tBillStockInOut] with(nolock)
  where d_BillStockInOut_OperateTime >= (case isnull(@BeginTime,'') when '' then d_BillStockInOut_OperateTime else @BeginTime end)
  and d_BillStockInOut_OperateTime <= (case isnull(@EndTime,'') when '' then d_BillStockInOut_OperateTime else @EndTime end)
  and [s_BillStockInOut_Code] like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then [s_BillStockInOut_Code] else '%'+@s_BillStockInOut_Code+'%' end)
  and [s_BillStockInOut_BarCode] like (case when ISNULL(@s_BillStockInOut_BarCode,'') = ''
  then [s_BillStockInOut_BarCode] else '%'+@s_BillStockInOut_BarCode+'%' end)
  and s_BillStockInOut_ExternalCode like (case when ISNULL(@s_BillStockInOut_ExternalCode,'') = ''
  then s_BillStockInOut_ExternalCode else '%'+@s_BillStockInOut_ExternalCode+'%' end)
  and s_BillStockInOut_ExternalName like (case when ISNULL(@s_BillStockInOut_ExternalName,'') = ''
  then s_BillStockInOut_ExternalName else '%'+@s_BillStockInOut_ExternalName+'%' end)
  and n_BillStockInOut_state = (case isnull(@n_BillStockInOut_state,0) when 0
  then n_BillStockInOut_state else @n_BillStockInOut_state end)
  and [s_BillStockInOut_WhetherToSubmit] = (case isnull(@s_BillStockInOut_WhetherToSubmit,0) when 0
  then [s_BillStockInOut_WhetherToSubmit] else @s_BillStockInOut_WhetherToSubmit end)
  and [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
 ) T_RowsCount 




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@BeginTime" DbType:"DateTime" Value:"2020/10/17 0:00:00"
（1）ParameterName:"@EndTime" DbType:"DateTime" Value:"9999/12/31 23:59:59"
（2）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（3）ParameterName:"@s_BillStockInOut_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（5）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（6）ParameterName:"@n_BillStockInOut_state" DbType:"Int32" Value:"1"
（7）ParameterName:"@s_BillStockInOut_WhetherToSubmit" DbType:"Int32" Value:"0"
（8）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（9）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（10）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（11）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:00:26
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:00:26
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:00:26
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:01:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:01:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:01:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:01:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:01:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:02:01
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:02:01
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqjccgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:02:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:02:05
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ckjcxxgl"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:06:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:06:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:06:25
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:06:25
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:06:25
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Warehouse_Id asc),* from (
SELECT 
--[Columns]      
      [n_Warehouse_Id]
      ,tBlock.s_Block_Name
      ,tShopfloor.s_Shopfloor_Name
      ,[s_Warehouse_Name]
      ,[s_Warehouse_Code]
      ,[s_Warehouse_Address]
      ,[s_Warehouse_Phone]
      ,[s_Warehouse_Purpose]
      ,[s_Warehouse_Remark]
      ,[s_Warehouse_StorageType]
      ,[s_Warehouse_CustomFields1]
      ,[s_Warehouse_CustomFields2]
      ,[s_Warehouse_CustomFields3]
      ,[s_Warehouse_CustomFields4]
      ,[s_Warehouse_CustomFields5]
      ,[s_Warehouse_CustomFields6]
      ,[s_Warehouse_CustomFields7]
      ,[s_Warehouse_CustomFields8]
      ,[s_Warehouse_CustomFields9]
      ,[s_Warehouse_CustomFields10]
      ,[n_Warehouse_state]=(case n_Warehouse_state when 1 then '正常' else '停用' end)
      ,[s_Warehouse_Creator]
      ,[d_Warehouse_CreateTime]
      ,[s_Warehouse_Updator]
      ,[d_Warehouse_UpdateTime]
--[/Columns]     
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:06:25
类型：Query 查询对象：SelWarehouseList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1      
  FROM [dbo].[tWarehouse] [tWarehouse] with(nolock)
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = [tWarehouse].n_Shopfloor_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tWarehouse.n_Block_Id
where s_Block_Name like (case when isnull(@Block_Name,'') = '' then s_Block_Name else '%'+@Block_Name+'%' end)
and s_Shopfloor_Name like (case when isnull(@Shopfloor_Name,'') = '' then s_Shopfloor_Name else '%'+@Shopfloor_Name+'%' end)
and s_Warehouse_Name like (case when isnull(@Warehouse_Name,'') = '' then s_Warehouse_Name else '%'+@Warehouse_Name+'%' end)
and s_Warehouse_Code like (case when isnull(@Warehouse_Code,'') = '' then s_Warehouse_Code else '%'+@Warehouse_Code+'%' end)
and n_Warehouse_state = (case when isnull(@Warehouse_state,0) = 0 then n_Warehouse_state else @Warehouse_state end)
 ) T_RowsCount  


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Block_Name" DbType:"AnsiString" Value:""
（1）ParameterName:"@Shopfloor_Name" DbType:"AnsiString" Value:""
（2）ParameterName:"@Warehouse_Name" DbType:"AnsiString" Value:""
（3）ParameterName:"@Warehouse_Code" DbType:"AnsiString" Value:""
（4）ParameterName:"@Warehouse_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:07:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:07:51
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:07:54
类型：Query 查询对象：SelWarehouseNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select distinct n_Block_Id,n_Shopfloor_Id from tShopfloor with(nolock)
where n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr


--储位码
select top 1 s_Space_BarCode from tSpace with(nolock)
where n_Space_state = 1 and n_Rack_Id = isnull(@Sel_Id,'')
order by d_Space_CreateTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:07:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:07:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:07:59
类型：Query 查询对象：SelWarehouseCodeList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,
s_Warehouse_Code,
s_Shopfloor_Code,
s_Block_Code
from tWarehouse tWarehouse with(nolock)
left join tShopfloor tShopfloor with(nolock)
on tWarehouse.n_Shopfloor_Id = tShopfloor.n_Shopfloor_Id
left join tBlock tBlock with(nolock)
on tBlock.n_Block_Id = tWarehouse.n_Block_Id


--查询当前仓库的货架编码最大值
declare @Warehouse table(
    n_Warehouse_Id varchar(max),
    s_Rack_Code int
) 

insert into @Warehouse
select 
tWarehouse.n_Warehouse_Id,
(case when max(Convert(int,s_Rack_Code)) IS null then 1 else max(Convert(int,s_Rack_Code))+1 end) as s_Rack_Code 
from 
tWarehouse with(nolock) 
left join tRack with(nolock) on tWarehouse.n_Warehouse_Id = tRack.n_Warehouse_Id
where isnull(n_Rack_state,1) = 1 and n_Warehouse_state = 1
group by tWarehouse.n_Warehouse_Id

select * from @Warehouse



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:08
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:12
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by n_Rack_Id asc),* from (
SELECT 
--[Columns]
      n_Rack_Id
      ,[s_Block_Name]
      ,[s_Warehouse_Name]
      ,[s_Rack_StorageType]
      ,s_Rack_CodePrefix
      ,[s_Rack_Code]
      ,[n_Rack_SpaceCapacity]
      ,[n_Rack_LayerCapacity] 
      ,[n_Rack_MaximumStorageCapacity]
      ,[n_Rack_QualityLevel]=
      (case isnull([n_Rack_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[f_Rack_Width]
      ,[f_Rack_Height]
      ,[f_Rack_Length]
      ,(case isnull([n_Rack_UsageStatus],3) when 1 then '已占用' when 2 then '未完全占用' else '空闲' end) as n_Rack_UsageStatus
      ,[s_Rack_CustomFields1]
      ,[s_Rack_CustomFields2]
      ,[s_Rack_CustomFields3]
      ,[s_Rack_CustomFields4]
      ,[s_Rack_CustomFields5]
      ,[s_Rack_CustomFields6]
      ,[s_Rack_CustomFields7]
      ,[s_Rack_CustomFields8]
      ,[s_Rack_CustomFields9]
      ,[s_Rack_CustomFields10]
      ,[n_Rack_state]=(case n_Rack_state when 1 then '正常' else '停用' end)
      ,[s_Rack_Creator]
      ,[d_Rack_CreateTime]
      ,[s_Rack_Updator]
      ,[d_Rack_UpdateTime]
--[/Columns]
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"B2709B9A-06C1-4A3E-99DB-A56692B4D0A7"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:12
类型：Query 查询对象：SelRackList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tRack] with(nolock)
where [s_Rack_Code] like (case when isnull(@Rack_Code,'') = '' then [s_Rack_Code] else '%'+@Rack_Code+'%' end)
and n_Rack_state = (case when isnull(@Rack_state,0) = 0 then n_Rack_state else @Rack_state end)
and n_Warehouse_Id = @n_Warehouse_Id
 ) T_RowsCount 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Rack_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@Rack_state" DbType:"Int32" Value:"1"
（2）ParameterName:"@n_Warehouse_Id" DbType:"AnsiString" Value:"B2709B9A-06C1-4A3E-99DB-A56692B4D0A7"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:15
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:20
类型：Query 查询对象：SelSpaceList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_Space_BarCode asc),* from (
SELECT 
--[Columns]
      [tSpace].[n_Space_Id]
      ,[tSpace].[n_CombinedSpace_Id]  
      ,n_SplitSpace_Id
      ,(case when ISNULL(tCombinedSpace.n_CombinedSpace_Id,'') = '' then 0 else 1 end) as n_CombinedSpace_State
      ,tWarehouse.s_Warehouse_Name
      ,tRack.s_Rack_Code
      ,[s_Space_Code]
      ,[s_Space_BarCode]
      ,[n_Space_BayNumber]
      ,[n_Space_LayerNumber] 
      ,[n_Space_Position]
      ,[n_Space_MaxPosition]
      ,[s_Space_StorageType]
      ,[n_Space_Warehouse]
      ,[n_Space_Width]
      ,[n_Space_Height]
      ,[n_Space_Length]
      ,[n_Space_ShipmentSequence]
      ,[n_Space_QualityLevel]=
      (case isnull([n_Space_QualityLevel],-1) when -1 then '' when 1 then '优等品' when 2 then '一等品' when 3 then '合格品' else '' end) 
      ,[n_Space_UsageStatus]=(case n_Space_UsageStatus when 1 then '已占用' when 2 then '未完全占用' else '空闲' end)
      ,[s_Space_LocationLock]
      ,[s_Space_OverflowLocation]
      ,[n_Space_RestrictedStorageMaterialType]
      ,[s_Space_CustomFields1]
      ,[s_Space_CustomFields2]
      ,[s_Space_CustomFields3]
      ,[s_Space_CustomFields4]
      ,[s_Space_CustomFields5]
      ,[s_Space_CustomFields6]
      ,[s_Space_CustomFields7]
      ,[s_Space_CustomFields8]
      ,[s_Space_CustomFields9]
      ,[s_Space_CustomFields10]
      ,[n_Space_state]=(case n_Space_state when 1 then '正常' else '停用' end)
      ,[s_Space_Creator]
      ,[d_Space_CreateTime]
      ,[s_Space_Updator]
      ,[d_Space_UpdateTime]
--[/Columns]
  FROM [dbo].[tSpace] with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tSpace.n_Warehouse_Id
left join tCombinedSpace tCombinedSpace with(nolock) on tCombinedSpace.n_Space_Id = tSpace.n_Space_Id
and tCombinedSpace.n_CombinedSpace_state = 1
where tSpace.n_Rack_Id = @n_Rack_Id
and n_Space_BayNumber = (case when isnull(@Space_BayNumber,'') = '' then n_Space_BayNumber else @Space_BayNumber end) 
and [n_Space_LayerNumber] = (case when isnull(@Space_LayerNumber,'') = '' then [n_Space_LayerNumber] else @Space_LayerNumber end) 
and [s_Space_BarCode] like (case when isnull(@Space_BarCode,'') = '' then [s_Space_BarCode] else '%'+@Space_BarCode+'%' end) 
and n_Space_state = (case when isnull(@Space_state,0) = 0 then n_Space_state else @Space_state end)
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"2F88BBA6-2481-46E9-82F7-8E5E78949F8B"
（1）ParameterName:"@Space_BayNumber" DbType:"AnsiString" Value:""
（2）ParameterName:"@Space_LayerNumber" DbType:"AnsiString" Value:""
（3）ParameterName:"@Space_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@Space_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:20
类型：Query 查询对象：SelSpaceList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1 
  FROM [dbo].[tSpace] with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tSpace.n_Warehouse_Id
left join tCombinedSpace tCombinedSpace with(nolock) on tCombinedSpace.n_Space_Id = tSpace.n_Space_Id
and tCombinedSpace.n_CombinedSpace_state = 1
where tSpace.n_Rack_Id = @n_Rack_Id
and n_Space_BayNumber = (case when isnull(@Space_BayNumber,'') = '' then n_Space_BayNumber else @Space_BayNumber end) 
and [n_Space_LayerNumber] = (case when isnull(@Space_LayerNumber,'') = '' then [n_Space_LayerNumber] else @Space_LayerNumber end) 
and [s_Space_BarCode] like (case when isnull(@Space_BarCode,'') = '' then [s_Space_BarCode] else '%'+@Space_BarCode+'%' end) 
and n_Space_state = (case when isnull(@Space_state,0) = 0 then n_Space_state else @Space_state end)
 ) T_RowsCount 

 

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"AnsiString" Value:"2F88BBA6-2481-46E9-82F7-8E5E78949F8B"
（1）ParameterName:"@Space_BayNumber" DbType:"AnsiString" Value:""
（2）ParameterName:"@Space_LayerNumber" DbType:"AnsiString" Value:""
（3）ParameterName:"@Space_BarCode" DbType:"AnsiString" Value:""
（4）ParameterName:"@Space_state" DbType:"Int32" Value:"1"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:23
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:26
类型：Query 查询对象：SelSpaceNeedInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

--基础数据关联查询
  
select top 1 
 s_Block_Code,
 s_Shopfloor_Code,
 s_Warehouse_Code,
 s_Rack_Code
from tRack tRack with(nolock)
left join tWarehouse tWarehouse with(nolock) on tRack.n_Warehouse_Id = tRack.n_Warehouse_Id
left join tBlock tBlock with(nolock) on tBlock.n_Block_Id = tRack.n_Block_Id
left join tShopfloor tShopfloor with(nolock) on tShopfloor.n_Shopfloor_Id = tRack.n_Shopfloor_Id
where tRack.n_Rack_Id = @n_Rack_Id 
and n_Warehouse_state = 1 and tRack.n_Rack_state = 1
and n_Block_state = 1 and n_Shopfloor_state = 1

--分隔符规则
declare @SplitStr varchar(50)
set @SplitStr = (select top 1 s_SysParameter_value1 from tSysParameter with(nolock)
where s_SysParameter_Name = '储位码规则-分隔符' and n_SysParameter_state = 1)

select SplitStr = @SplitStr

--储位编码最大值
declare @Space_MaxCode varchar(max)

select top 1 @Space_MaxCode = s_Space_Code from tSpace with(nolock)
where n_Rack_Id = @n_Rack_Id and n_Space_state = 1
order by Convert(int,s_Space_Code) desc

select Space_MaxCode = isnull(@Space_MaxCode,0) + 1
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Rack_Id" DbType:"String" Value:"2F88BBA6-2481-46E9-82F7-8E5E78949F8B"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:28
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:08:28
类型：Query 查询对象：SelSpace 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT  [tSpace].[n_Rack_Id] 
      ,[s_Space_Code]
      ,tRack.s_Rack_CodePrefix
      ,[s_Space_BarCode]
      ,[n_Space_LayerNumber]
      ,[n_Space_BayNumber]
      ,[n_Space_Position]
      ,[n_Space_MaxPosition]
      ,[s_Space_StorageType]
      ,[n_Space_Warehouse]
      ,[n_Space_Width]
      ,[n_Space_Height]
      ,[n_Space_Length]
      ,[n_Space_ShipmentSequence]
      ,[n_Space_QualityLevel] 
      ,[s_Space_LocationLock]
      ,[s_Space_OverflowLocation]
      ,[n_Space_RestrictedStorageMaterialType]
      ,[s_Space_CustomFields1]
      ,[s_Space_CustomFields2]
      ,[s_Space_CustomFields3]
      ,[s_Space_CustomFields4]
      ,[s_Space_CustomFields5]
      ,[s_Space_CustomFields6]
      ,[s_Space_CustomFields7]
      ,[s_Space_CustomFields8]
      ,[s_Space_CustomFields9]
      ,[s_Space_CustomFields10] 
  FROM [dbo].[tSpace] with(nolock)
  left join tRack tRack with(nolock) on tRack.n_Rack_Id = [tSpace].n_Rack_Id 
  where [n_Space_Id] = @Sel_Id
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sel_Id" DbType:"AnsiString" Value:"031B53F3-5EB8-4A5C-91DC-09EE2158BAC9"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:11:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:11:01
类型：Query 查询对象：SelSessionState 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select top 1 LoginState = 
(case when 
DATEDIFF(MINUTE,d_LoginTime,GETDATE())
< n_HoldingTime then 0 else 1 end),
UserNO = s_UserNO
 from tSessionStateRecord 
where [s_IPAddress] = @IPAddress 
and [s_UserAgent] = @UserAgent
and s_UserNO <> ''
order by d_LoginTime desc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:11:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:11:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:11:02
类型：Query 查询对象：SelSpacePrintList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @SQL varchar(max) = 'select 
tWarehouse.s_Warehouse_Name,
''货架''+tRack.s_Rack_Code + ''的第''+Convert(varchar(20),tSpace.n_Space_BayNumber)+''列的第'' + Convert(varchar(20),tSpace.n_Space_LayerNumber) + ''层'' as s_Rack_Code,
s_Space_BarCode 
from tSpace tSpace with(nolock)
left join tRack tRack with(nolock) on tRack.n_Rack_Id = tSpace.n_Rack_Id
left join tWarehouse tWarehouse with(nolock) on tWarehouse.n_Warehouse_Id = tRack.n_Warehouse_Id
where tRack.n_Rack_state = 1 and tWarehouse.n_Warehouse_state = 1 and tSpace.n_Space_state = 1
and tSpace.n_Space_Id in ('+@n_Space_Id+')'

exec(@SQL)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@n_Space_Id" DbType:"AnsiString" Value:"'031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:17:35
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:17:35
类型：Query 查询对象：Tool_GetAllTable 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select TableName=name from sysobjects where xtype='U' order by name
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:18:12
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:18:13
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:18:14
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tRecordInventoryMoveDifferenceCount"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:18:16
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:18:17
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tRack"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：1.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"仓库基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Warehouse_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：2.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"厂房基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Block_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：3.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"车间基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Shopfloor_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：4.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"厂房名称"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Block_Name"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：5.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"仓库名称"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Warehouse_Name"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:41
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：6.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"存放类型"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_StorageType"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：7.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架编码前缀"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CodePrefix"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：8.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架编码"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_Code"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：9.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架层数"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_LayerCapacity"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：10.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"每层储位数"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_SpaceCapacity"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：11.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"每个储位最大的存放量"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_MaximumStorageCapacity"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：12.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"质量级别"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_QualityLevel"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:42
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：13.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架宽度"
（4）ParameterName:"@Column" DbType:"String" Value:"f_Rack_Width"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:43
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：14.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架高度"
（4）ParameterName:"@Column" DbType:"String" Value:"f_Rack_Height"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:43
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：15.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架长度"
（4）ParameterName:"@Column" DbType:"String" Value:"f_Rack_Length"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:43
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：16.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架状态 1 已占用 2 未完全占用 3 空闲"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_UsageStatus"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:43
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：17.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段1"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields1"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:44
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：18.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段2"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields2"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:44
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：19.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段3"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields3"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:44
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：20.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段4"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields4"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:44
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：21.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段5"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields5"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:44
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：22.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段6"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields6"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:45
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：23.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段7"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields7"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:45
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：24.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段8"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields8"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:45
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：25.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段9"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields9"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:45
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：26.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段10"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_CustomFields10"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:45
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：27.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"状态"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_state"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:45
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：28.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"创建人"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_Creator"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:46
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：29.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"创建时间"
（4）ParameterName:"@Column" DbType:"String" Value:"d_Rack_CreateTime"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:46
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：30.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"修改人"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Rack_Updator"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:46
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：31.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"修改时间"
（4）ParameterName:"@Column" DbType:"String" Value:"d_Rack_UpdateTime"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tRack"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:47
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:24:47
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tRack"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:27:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:27:19
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tSpace"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:22
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：0.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架储位ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：1.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架合并储位基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_CombinedSpace_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：2.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架拆分储位基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_SplitSpace_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：3.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Rack_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：4.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"仓库基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Warehouse_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：5.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"厂房基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Block_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：6.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"车间基础信息表外键ID"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Shopfloor_Id"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：7.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"储位编码"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_Code"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：8.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"储位条码"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_BarCode"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:23
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：9.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"所在货架中所属层"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_LayerNumber"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：10.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"所属列"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_BayNumber"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：11.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"所在层列中的位置"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_Position"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：12.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"最大储位数"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_MaxPosition"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：13.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"存放状态"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_StorageType"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：14.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"所属仓库"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_Warehouse"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：15.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"储位宽度"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_Width"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:24
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：16.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"储位高度"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_Height"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：17.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"储位长度"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_Length"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：18.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"货架储位出货顺序序数"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_ShipmentSequence"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：19.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"质量级别"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_QualityLevel"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：20.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"储位状态 1 已占用 2 未完全占用 3 空闲"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_UsageStatus"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：21.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"库位锁定"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_LocationLock"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：22.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"溢出库位"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_OverflowLocation"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:25
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：23.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"限制存放物料类型"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_RestrictedStorageMaterialType"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：24.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段1"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields1"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：25.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段2"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields2"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：26.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段3"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields3"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：27.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段4"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields4"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：28.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段5"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields5"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：29.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段6"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields6"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:26
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：30.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段7"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields7"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：31.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段8"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields8"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：32.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段9"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields9"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：33.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"自定义字段10"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_CustomFields10"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：34.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"状态"
（4）ParameterName:"@Column" DbType:"String" Value:"n_Space_state"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：35.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"创建人"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_Creator"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：36.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"创建时间"
（4）ParameterName:"@Column" DbType:"String" Value:"d_Space_CreateTime"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：37.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"修改人"
（4）ParameterName:"@Column" DbType:"String" Value:"s_Space_Updator"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:27
类型：Business 业务对象：UpdateColumnDescribe 
说明：执行业务过程[1]：38.修改数据表中的字段描述
***************************************************************************************************************
SQL:
exec [up_UpdateColumnDescribe] @OldSheetDescribe,@SheetDescribe,@OldDescribe,@Describe,@Column,@Sheet
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@OldDescribe" DbType:"String" Value:""
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@Describe" DbType:"String" Value:"修改时间"
（4）ParameterName:"@Column" DbType:"String" Value:"d_Space_UpdateTime"
（5）ParameterName:"@Sheet" DbType:"String" Value:"tSpace"
（6）ParameterName:"@OldSheetDescribe" DbType:"String" Value:""
（7）ParameterName:"@SheetDescribe" DbType:"String" Value:"货架储位基础信息表"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:28
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:29
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/10/17 17:44:29
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tSpace"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^