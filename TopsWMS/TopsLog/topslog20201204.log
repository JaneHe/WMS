
**************************************************************************************************************------>2020/12/4 9:21:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:48
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:48
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:48
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:49
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:50
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:50
类型：Query 查询对象：SelBoardModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_Url from tModule where s_ModuleName like '%看板%' and n_IsLeaf = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:53
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:54
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:55
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:56
类型：Query 查询对象：SelAllChildServerModule 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select s_ModuleID,s_ModuleName,s_PDFFileUrl from tModuleFileInfo 
where n_state = 1 and s_ParentModuleID <> '0'
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:21:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:25:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:25:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:25:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:25:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:25:32
类型：Query 查询对象：SelIMWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:26:21
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"5A6FC2A599F20E86"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:26:21
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"5A6FC2A599F20E86"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:26:28
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:26:28
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 9:26:28
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:09:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:09:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:09:17
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:09:17
类型：Query 查询对象：SelIMWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:10:15
类型：Query 查询对象：SelIMWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:10:15
类型：Query 查询对象：SelIMWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:13:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:13:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:13:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:13:03
类型：Query 查询对象：SelIMWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:54:06
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:54:06
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 10:54:07
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:31
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:32
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:00:33
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:39
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:39
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:39
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:40
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:41
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:44
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:44
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:44
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:45
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:02:46
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:03:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:03:08
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:03:08
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:03:08
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:03:40
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList_ExcelCols 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:03:40
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:04:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:04:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:04:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:04:06
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:04:38
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList_ExcelCols 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:04:39
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:05:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:05:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:05:39
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:05:39
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:05:46
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList_ExcelCols 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:05:46
类型：Query 查询对象：SelSprayOnlineWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '5D203266-22F4-434F-8E7E-ABF04E3A2A37'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:18:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:18:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:18:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 11:18:26
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:27
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:28
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:29
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:14:30
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:18
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:18
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:18
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:19
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:21:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:27
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:27
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:22:59
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:34:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:34:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:34:55
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:34:55
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:35:04
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList_Columns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:35:04
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList_Data 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:41
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:41
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:41
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:42
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:46
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:53
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:53
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:54
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList_Columns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 13:58:54
类型：Query 查询对象：SelSprayOfflineWarehousingCacheTongJiList_Data 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '322A95CB-3CDC-4B7B-A82F-B86C1593435F'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:00:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:01:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:01:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:01:00
类型：Query 查询对象：SelAssemblyWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'


--获取最新一个版本的BOM
declare @s_Month varchar(20)  

select top 1 @s_Month = s_Month from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
where n_State = 1 order by replace(s_Month,'-','') desc


--当天装配缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天装配缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天装配缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的装配缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天装配缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable 
inner join @Infotable_Update Infotable_Update on (Infotable.s_BillStockInOut_ExternalCode <> '' and Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode)
or Infotable.s_BillStockInOut_ExternalName = Infotable_Update.s_BillStockInOut_ExternalName

  
--查出指定日期内的装配缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_CustomerCode as s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 

 select 
tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
inner join [TopsERP_BIZ].dbo.tPaintConsump_New tPaintConsump_New with(nolock) on 
tPBOM.s_MotherCode = tPaintConsump_New.s_MotherCode
where s_Month = @s_Month and tPBOM.n_State = 1
and tPaintConsump_New.n_State = 1
group by tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
) tPBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPBOM.s_MotherCode 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

  
 
  

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:39:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:39:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 14:39:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:22
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:22
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:22
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:23
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:24
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:24
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:24
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:24
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:25
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:25
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:03:25
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:57
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:57
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:57
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:57
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:57
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:06:58
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:02
类型：Query 查询对象：SelAssemblyWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'


--获取最新一个版本的BOM
declare @s_Month varchar(20)  

select top 1 @s_Month = s_Month from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
where n_State = 1 order by replace(s_Month,'-','') desc


--当天装配缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天装配缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天装配缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的装配缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天装配缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable 
inner join @Infotable_Update Infotable_Update on (Infotable.s_BillStockInOut_ExternalCode <> '' and Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode)
or Infotable.s_BillStockInOut_ExternalName = Infotable_Update.s_BillStockInOut_ExternalName

  
--查出指定日期内的装配缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_CustomerCode as s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 

 select 
tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
inner join [TopsERP_BIZ].dbo.tPaintConsump_New tPaintConsump_New with(nolock) on 
tPBOM.s_MotherCode = tPaintConsump_New.s_MotherCode
where s_Month = @s_Month and tPBOM.n_State = 1
and tPaintConsump_New.n_State = 1
group by tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
) tPBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPBOM.s_MotherCode 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

  
 
  

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:31
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:31
类型：Query 查询对象：SelAssemblyWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'


--获取最新一个版本的BOM
declare @s_Month varchar(20)  

select top 1 @s_Month = s_Month from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
where n_State = 1 order by replace(s_Month,'-','') desc


--当天装配缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天装配缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天装配缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的装配缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天装配缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable 
inner join @Infotable_Update Infotable_Update on (Infotable.s_BillStockInOut_ExternalCode <> '' and Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode)
or Infotable.s_BillStockInOut_ExternalName = Infotable_Update.s_BillStockInOut_ExternalName

  
--查出指定日期内的装配缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_CustomerCode as s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 

 select 
tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
inner join [TopsERP_BIZ].dbo.tPaintConsump_New tPaintConsump_New with(nolock) on 
tPBOM.s_MotherCode = tPaintConsump_New.s_MotherCode
where s_Month = @s_Month and tPBOM.n_State = 1
and tPaintConsump_New.n_State = 1
group by tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
) tPBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPBOM.s_MotherCode 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

  
 
  

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:32
类型：Query 查询对象：SelAssemblyWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:32
类型：Query 查询对象：SelAssemblyWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'


--获取最新一个版本的BOM
declare @s_Month varchar(20)  

select top 1 @s_Month = s_Month from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
where n_State = 1 order by replace(s_Month,'-','') desc


--当天装配缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天装配缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天装配缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的装配缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天装配缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable 
inner join @Infotable_Update Infotable_Update on (Infotable.s_BillStockInOut_ExternalCode <> '' and Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode)
or Infotable.s_BillStockInOut_ExternalName = Infotable_Update.s_BillStockInOut_ExternalName

  
--查出指定日期内的装配缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 

 select 
tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
inner join [TopsERP_BIZ].dbo.tPaintConsump_New tPaintConsump_New with(nolock) on 
tPBOM.s_MotherCode = tPaintConsump_New.s_MotherCode
where s_Month = @s_Month and tPBOM.n_State = 1
and tPaintConsump_New.n_State = 1
group by tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
) tPBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPBOM.s_MotherCode 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

  
 
  

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:07:37
类型：Query 查询对象：SelAssemblyWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'


--获取最新一个版本的BOM
declare @s_Month varchar(20)  

select top 1 @s_Month = s_Month from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
where n_State = 1 order by replace(s_Month,'-','') desc


--当天装配缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天装配缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天装配缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的装配缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = 'F37C4180-B6C4-4DED-B535-D5AFA37DD956'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 and
((isnull(@s_BillStockInOut_ExternalCode,'') <> '' 
and isnull(s_BillStockInOut_ExternalCode,'') like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then isnull(s_BillStockInOut_ExternalCode,'') else '%'+ @s_BillStockInOut_ExternalCode +'%' end))
or ( isnull(@s_BillStockInOut_ExternalCode,'') = '' and 1=1))
and
((isnull(@s_BillStockInOut_ExternalName,'') <> '' 
and isnull(s_BillStockInOut_ExternalName,'') like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then isnull(s_BillStockInOut_ExternalName,'') else '%'+ @s_BillStockInOut_ExternalName +'%' end))
or ( isnull(@s_BillStockInOut_ExternalName,'') = '' and 1=1))
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天装配缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable 
inner join @Infotable_Update Infotable_Update on (Infotable.s_BillStockInOut_ExternalCode <> '' and Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode)
or Infotable.s_BillStockInOut_ExternalName = Infotable_Update.s_BillStockInOut_ExternalName

  
--查出指定日期内的装配缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_CustomerCode as s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 

 select 
tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
from [TopsERP_BIZ].dbo.tPBOM with(nolock) 
inner join [TopsERP_BIZ].dbo.tPaintConsump_New tPaintConsump_New with(nolock) on 
tPBOM.s_MotherCode = tPaintConsump_New.s_MotherCode
where s_Month = @s_Month and tPBOM.n_State = 1
and tPaintConsump_New.n_State = 1
group by tPBOM.s_MotherCode,
tPBOM.s_Mother_Desc,
tPBOM.s_Brand,
tPBOM.s_Series,
tPBOM.s_PartType,
tPBOM.s_PartType_Desc,
tPaintConsump_New.s_CustomerCode
) tPBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPBOM.s_MotherCode 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

  
 
  

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:08:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:08:03
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:08:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:08:04
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:03
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"IMWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:03
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"IMWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:03
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelIMWarehousingCacheTongJiList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的注塑缓存区的进出存数据"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:03
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelIMWarehousingCacheTongJiList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的注塑缓存区的进出存数据（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:03
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelIMWarehousingCacheTongJiList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的注塑缓存区的进出存数据的列名（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:20
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayOnlineWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayOnlineWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOnlineWarehousingCacheTongJiList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂上线缓存区的进出存数据"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOnlineWarehousingCacheTongJiList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂上线缓存区的进出存数据（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:09:49
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOnlineWarehousingCacheTongJiList_ExcelCols"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂上线缓存区的进出存数据的列名（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayOnlineWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayOnlineWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOnlineWarehousingCacheTongJiList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂上线缓存区的进出存数据"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOnlineWarehousingCacheTongJiList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询喷涂上线缓存区的进出存数据（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:06
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptsxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOnlineWarehousingCacheTongJiList_ExcelCols"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询喷涂上线缓存区的进出存数据的列名（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:43
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:44
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:47
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:10:48
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:48
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayOfflineWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:48
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayOfflineWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:48
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOfflineWarehousingCacheTongJiList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂下线缓存区的进出存数据"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:48
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOfflineWarehousingCacheTongJiList_Data"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询喷涂下线缓存区的进出存数据的列名（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:48
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"ptxxhcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayOfflineWarehousingCacheTongJiList_Columns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询喷涂下线缓存区的进出存数据(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:59
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:11:59
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:10
类型：Query 查询对象：SelIMWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天注塑缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天注塑缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天注塑缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的注塑缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '031B53F3-5EB8-4A5C-91DC-09EE2158BAC9'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天注塑缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的注塑缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:10
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:12:11
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:33
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:33
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SprayWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:33
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayWarehousingCacheTongJiList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂缓存区的进出存数据"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:33
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayWarehousingCacheTongJiList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂缓存区的进出存数据的列名（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:33
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelSprayWarehousingCacheTongJiList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的喷涂缓存区的进出存数据（下载）"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:36
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:36
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:37
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:37
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"pthcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:16:38
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zshcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:18:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:18:05
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:21:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:21:24
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:21:24
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"AssemblyWarehousingCacheReportForm"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:21:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelAssemblyWarehousingCacheTongJiList"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的装配缓存区的进出存数据"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:21:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelAssemblyWarehousingCacheTongJiList_ExcelData"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的装配缓存区的进出存数据(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:21:25
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"zphcqkctjbb"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelAssemblyWarehousingCacheTongJiList_ExcelColumns"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询指定日期的装配缓存区的进出存数据的列名(下载)"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:15
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:16
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:20
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:26:20
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:29:48
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:29:48
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:30:15
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:30:16
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:34
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:34
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:34
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:35
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:38
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:38
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:38
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:39
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:40
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:40
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:32:40
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:33:07
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:33:12
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:36
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:39
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:46
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:46
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:47
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:47
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:51
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:51
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:51
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:53
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:37:53
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:44
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:47
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:47
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as s_BillStockInOut_PlasticGoodsCode,
    s_BillStockInOut_ExternalName as s_BillStockInOut_PlasticGoodsName,
	s_Brand,
	s_Series,
	s_PartType,
	s_PartType_Desc,
	s_PlasticParts_CustomerCode,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Date" DbType:"DateTime" Value:"2020/12/3 0:00:00"
（1）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"AnsiString" Value:""
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（5）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（6）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:52
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'工件编码',15
union all
select 2,'工件名称',25
union all
select 3,'品牌',15
union all
select 4,'一级车型',15
union all
select 5,'产品大类',15
union all
select 6,'装车位置',15
union all
select 7,'工件客户料号',15
union all
select 8,'入库数',15
union all
select 9,'出库数',15
union all
select 10,'库存数',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:46:52
类型：Query 查询对象：SelSprayWarehousingCacheTongJiList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @BeginTime varchar(20) = Convert(varchar(10),dateadd(day,0,@Date),120)+' 08:00:00'
declare @EndTime varchar(20) = Convert(varchar(10),dateadd(day,1,@Date),120)+' 08:00:00'



--当天喷涂缓存区的入出库信息
declare @Infotable table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)
--需修改的缓存区记录
declare @Infotable_Update table(
    s_BillStockInOut_ExternalCode varchar(max),
    s_BillStockInOut_ExternalName varchar(max),
    f_BillStockInOut_WarehousingWorkOrderQuantity float,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity float, 
	f_BillStockInOut_SurplusWorkOrderQuantity float
)

--加入当天喷涂缓存区入库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity),
0,
sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('RK',s_BillStockInOut_Code,0) > 0
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--加入当天喷涂缓存区出库信息
insert into @Infotable(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    f_BillStockInOut_WarehousingWorkOrderQuantity,
	f_BillStockInOut_WarehouseOutWorkOrderQuantity, 
	f_BillStockInOut_SurplusWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
0,
sum(f_BillStockInOut_WorkOrderQuantity),
0 - sum(f_BillStockInOut_WorkOrderQuantity)
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and not exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName

--插入需修改的喷涂缓存区出库记录
insert into @Infotable_Update(
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName, 
	f_BillStockInOut_WarehouseOutWorkOrderQuantity
)
select 
s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName,
sum(f_BillStockInOut_WorkOrderQuantity) 
from [dbo].[tBillStockInOut_Cache] Cache with(nolock)
where [n_Space_Id] = '0FC27277-50B3-4D73-AE8E-B57A6BBEA250'
and d_BillStockInOut_CreateTime between @BeginTime and @EndTime
and n_BillStockInOut_state = 1 
and s_BillStockInOut_ExternalCode like (case when isnull(@s_BillStockInOut_ExternalCode,'') = '' then s_BillStockInOut_ExternalCode else '%'+ @s_BillStockInOut_ExternalCode +'%' end)
and s_BillStockInOut_ExternalName like (case when isnull(@s_BillStockInOut_ExternalName,'') = '' then s_BillStockInOut_ExternalName else '%'+ @s_BillStockInOut_ExternalName +'%' end)
and charindex('CK',s_BillStockInOut_Code,0) > 0
and exists(select 1 from [tBillStockInOut_Cache] with(nolock) where s_BillStockInOut_ExternalCode = Cache.s_BillStockInOut_ExternalCode
and n_BillStockInOut_state = 1
and charindex('RK',s_BillStockInOut_Code,0) > 0
and Convert(varchar(10),d_BillStockInOut_OperateTime,120) = Convert(varchar(10),Cache.d_BillStockInOut_OperateTime,120) )
group by s_BillStockInOut_ExternalCode,
s_BillStockInOut_ExternalName


--修改当天喷涂缓存区库存信息

update @Infotable 
set f_BillStockInOut_WarehouseOutWorkOrderQuantity = Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity,
f_BillStockInOut_SurplusWorkOrderQuantity = Infotable.f_BillStockInOut_SurplusWorkOrderQuantity - Infotable_Update.f_BillStockInOut_WarehouseOutWorkOrderQuantity
from @Infotable Infotable
inner join @Infotable_Update Infotable_Update on Infotable.s_BillStockInOut_ExternalCode = Infotable_Update.s_BillStockInOut_ExternalCode
  
  
--查出指定日期内的喷涂缓存区库存统计报表  

select 
    s_BillStockInOut_ExternalCode as '工件编码',
    s_BillStockInOut_ExternalName as '工件名称',
	s_Brand as '品牌',
	s_Series as '一级车型',
	s_PartType as '产品大类',
	s_PartType_Desc as '装车位置',
	s_PlasticParts_CustomerCode as '工件客户料号',
    f_BillStockInOut_WarehousingWorkOrderQuantity as '入库数',
	f_BillStockInOut_WarehouseOutWorkOrderQuantity as '出库数', 
	f_BillStockInOut_SurplusWorkOrderQuantity as '库存数'
from @Infotable Infotable
left join ( 
SELECT [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
  FROM [TopsERP_BIZ].[dbo].[tPlasticPart_PBOM] with(nolock) where n_State = 1
  group by [s_PlasticParts_Code]
      ,[s_PlasticParts_Desc] 
      ,[s_Brand]
      ,[s_Series]
      ,[s_PartType]
      ,[s_PartType_Desc] 
      ,[s_PlasticParts_CustomerCode] 
) tPlasticPart_PBOM on Infotable.s_BillStockInOut_ExternalCode
 = tPlasticPart_PBOM.s_PlasticParts_Code 
order by f_BillStockInOut_WarehousingWorkOrderQuantity desc 

 




 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@datetime" DbType:"String" Value:"2020-12-03"
（1）ParameterName:"@Date" DbType:"String" Value:"2020-12-03"
（2）ParameterName:"@s_BillStockInOut_ExternalCode" DbType:"String" Value:""
（3）ParameterName:"@s_BillStockInOut_ExternalName" DbType:"String" Value:""
（4）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:49:59
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:03
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator]
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（4）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:03
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（4）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:05
类型：Query 查询对象：SelPutOnRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15
union all
select 14,'上架时间',25
union all
select 15,'上架数量',15
union all
select 16,'上架良品数',15
union all
select 17,'上架不良品数',15
union all
select 18,'上架返工数',15
union all
select 19,'上架操作人',15
union all
select 20,'上架操作人所属班次',20
union all
select 21,'上架原因',20
union all
select 22,'上架次数序数',15 
union all
select 23,'是否已提交',15
union all
select 24,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:05
类型：Query 查询对象：SelPutOnRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号'
      ,Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120) as '上架时间'
      ,[n_ListPutOnOff_LaunchNumber] as '上架数量'
      ,[n_ListPutOnOff_LaunchOKProductCou] as '上架良品数'
      ,[n_ListPutOnOff_LaunchUnOKProductCou] as '上架不良品数'
      ,[n_ListPutOnOff_LaunchReworkProductCou] as '上架返工数'
      ,[s_ListPutOnOff_LaunchOperator] as '上架操作人'
      ,[s_ListPutOnOff_LaunchClasses] as '上架操作人所属班次'
      ,[n_LaunchReason_Name] as '上架原因'
      ,[n_ListPutOnOff_LaunchSequence] as '上架次数序数' 
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_OffTheShelfTime] is null



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（4）ParameterName:"@_txt_val" DbType:"String" Value:","
（5）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（6）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:49
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:49
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select * from ( select RowNumber=row_number() over(order by s_BillStockInOut_Code asc),* from (
SELECT 
--[Columns]   
	  [s_BillStockInOut_Code] 
      ,[n_ListPutOnOff_GoodsId]
      ,[s_ListPutOnOff_Code]
      ,[s_ListPutOnOff_GoodsProductName]
      ,[s_ListPutOnOff_GoodsProductCode]
      ,[n_ListPutOnOff_GoodsProductId]
      ,[s_ListPutOnOff_ExternalCode]
      ,[s_ListPutOnOff_ExternalName]
      ,[s_ListPutOnOff_ECN] 
      ,[s_APQPStatus_Name]
      ,[n_ListPutOnOff_QualityStatus]=(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end)
      ,[s_ListPutOnOff_SpecificationAndModel]
      ,[s_ListPutOnOff_Unit]
      ,[s_ListPutOnOff_Model]
      ,[s_ListPutOnOff_Color]
      ,[s_ListPutOnOff_BatchNumber]
      ,[d_ListPutOnOff_LaunchTime] = Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120)
      ,[n_ListPutOnOff_LaunchNumber]
      ,[n_ListPutOnOff_LaunchOKProductCou]
      ,[n_ListPutOnOff_LaunchUnOKProductCou]
      ,[n_ListPutOnOff_LaunchReworkProductCou]
      ,[s_ListPutOnOff_LaunchOperator]
      ,[s_ListPutOnOff_LaunchClasses] 
      ,[n_LaunchReason_Name]
      ,[n_ListPutOnOff_LaunchType]
      ,[n_ListPutOnOff_LaunchSequence]
 
      ,[s_ListPutOnOff_WhetherToSubmit]=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,[n_ListPutOnOff_state]=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
      ,[s_ListPutOnOff_Creator]
      ,[d_ListPutOnOff_CreateTime]
      ,[s_ListPutOnOff_Updator]
      ,[d_ListPutOnOff_UpdateTime]
--[/Columns] 
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
) T_pagenation  ) TT_pagenation  where RowNumber between @beginIndex and @endIndex 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（4）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:49
类型：Query 查询对象：SelPutOnRecordList 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
 select RowsCount=COUNT(1) from ( 
SELECT 
 R=1  
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and d_ListPutOnOff_OffTheShelfTime is null
 ) T_RowsCount 



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"AnsiString" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"AnsiString" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"AnsiString" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"Int32" Value:"1"
（4）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"Int32" Value:"0"
（5）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（6）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（7）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（8）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:52
类型：Query 查询对象：SelPutOnRecordList_ExcelColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 1,'货物标识编码',15
union all
select 2,'储位二维码',15
union all
select 3,'货物产品名称',25
union all
select 4,'货物产品编码',15
union all
select 5,'U9工件编码',15
union all
select 6,'U9工件名称',25
union all
select 7,'APQP阶段',15
union all
select 8,'质量状态',15
union all
select 9,'规格型号',15
union all
select 10,'单位',15
union all
select 11,'车型',15
union all
select 12,'颜色',15
union all
select 13,'批次号',15
union all
select 14,'上架时间',25
union all
select 15,'上架数量',15
union all
select 16,'上架良品数',15
union all
select 17,'上架不良品数',15
union all
select 18,'上架返工数',15
union all
select 19,'上架操作人',15
union all
select 20,'上架操作人所属班次',20
union all
select 21,'上架原因',20
union all
select 22,'上架次数序数',15 
union all
select 23,'是否已提交',15
union all
select 24,'状态',15 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"" DbType:"String" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:50:52
类型：Query 查询对象：SelPutOnRecordList_ExcelData 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 
SELECT    
	  [s_BillStockInOut_Code] as '货物标识编码'
      ,[s_ListPutOnOff_Code] as '储位二维码'
      ,[s_ListPutOnOff_GoodsProductName] as '货物产品名称'
      ,[s_ListPutOnOff_GoodsProductCode] as '货物产品编码' 
      ,[s_ListPutOnOff_ExternalCode] as 'U9工件编码'
      ,[s_ListPutOnOff_ExternalName] as 'U9工件名称' 
      ,[s_APQPStatus_Name] as 'APQP阶段'
      ,(case [n_ListPutOnOff_QualityStatus] when 1 then '合格'
      when 2 then '待定'
      when 3 then '报废'
      when 4 then '返工'
      else '' end) as '质量状态'
      ,[s_ListPutOnOff_SpecificationAndModel] as '规格型号'
      ,[s_ListPutOnOff_Unit] as '单位'
      ,[s_ListPutOnOff_Model] as '车型'
      ,[s_ListPutOnOff_Color] as '颜色'
      ,[s_ListPutOnOff_BatchNumber] as '批次号'
      ,Convert(varchar(20),[d_ListPutOnOff_LaunchTime],120) as '上架时间'
      ,[n_ListPutOnOff_LaunchNumber] as '上架数量'
      ,[n_ListPutOnOff_LaunchOKProductCou] as '上架良品数'
      ,[n_ListPutOnOff_LaunchUnOKProductCou] as '上架不良品数'
      ,[n_ListPutOnOff_LaunchReworkProductCou] as '上架返工数'
      ,[s_ListPutOnOff_LaunchOperator] as '上架操作人'
      ,[s_ListPutOnOff_LaunchClasses] as '上架操作人所属班次'
      ,[n_LaunchReason_Name] as '上架原因'
      ,[n_ListPutOnOff_LaunchSequence] as '上架次数序数' 
      ,'是否已提交'=(case [s_ListPutOnOff_WhetherToSubmit] when 0 then '否' else '是' end)
      ,'状态'=(case [n_ListPutOnOff_state] when 1 then '正常' else '停用' end)
 
  FROM [dbo].[tListPutOnOff] with(nolock)
  where  isnull([s_BillStockInOut_Code],0) like (case when ISNULL(@s_BillStockInOut_Code,'') = ''
  then isnull([s_BillStockInOut_Code],0) else '%'+@s_BillStockInOut_Code+'%' end)
  and isnull([s_ListPutOnOff_GoodsProductCode],0) like (case when ISNULL(@s_ListPutOnOff_GoodsProductCode,'') = ''
  then isnull([s_ListPutOnOff_GoodsProductCode],0) else '%'+@s_ListPutOnOff_GoodsProductCode+'%' end)
  and s_ListPutOnOff_GoodsProductName like (case when ISNULL(@s_ListPutOnOff_GoodsProductName,'') = ''
  then s_ListPutOnOff_GoodsProductName else '%'+@s_ListPutOnOff_GoodsProductName+'%' end)
  and n_ListPutOnOff_state = (case isnull(@n_ListPutOnOff_state,0) when 0
  then n_ListPutOnOff_state else @n_ListPutOnOff_state end)
  and s_ListPutOnOff_WhetherToSubmit = (case isnull(@s_ListPutOnOff_WhetherToSubmit,0) when 0
  then s_ListPutOnOff_WhetherToSubmit else @s_ListPutOnOff_WhetherToSubmit end)
  and [d_ListPutOnOff_OffTheShelfTime] is null



^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@s_BillStockInOut_Code" DbType:"String" Value:""
（1）ParameterName:"@s_ListPutOnOff_GoodsProductCode" DbType:"String" Value:""
（2）ParameterName:"@s_ListPutOnOff_GoodsProductName" DbType:"String" Value:""
（3）ParameterName:"@n_ListPutOnOff_state" DbType:"String" Value:"1"
（4）ParameterName:"@_txt_val" DbType:"String" Value:","
（5）ParameterName:"@s_ListPutOnOff_WhetherToSubmit" DbType:"String" Value:"0"
（6）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 15:53:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:01:55
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:01:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"null"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:01
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:01
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:01
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:""
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:01
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:02
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:02
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:03
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:03
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:05
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:05
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:05
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:06
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:06
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:07
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:07
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:07
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:07
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:08
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:08
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:08
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:09
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:10
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:10
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:10
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:10
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:10
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:11
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:12
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:12
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:12
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:12
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:12
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:13
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:13
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:13
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:13
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:13
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:14
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:14
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:14
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:15
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:15
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:15
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:16
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:16
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:17
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:17
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:17
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:17
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:17
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:19
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:20
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:20
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:20
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:20
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:21
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:23
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:24
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:24
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:24
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:25
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:25
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:25
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:26
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:26
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:27
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:27
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:27
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:27
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:27
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:28
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:29
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:29
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:29
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:29
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:30
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:31
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:31
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:31
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:31
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:31
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:32
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:33
类型：Business 业务对象：UserLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:33
类型：Business 业务对象：UserLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from tUser where s_UserNO=@:UserNO and s_Password=@:Password
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:33
类型：Business 业务对象：UserLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from tUser where s_UserNO=@UserNO
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（1）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
（4）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（5）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:33
类型：Business 业务对象：UpdateSessionState 
说明：执行业务过程[1]：0.更新最新的Session状态
***************************************************************************************************************
SQL:

if not exists(select 1 from tSessionStateRecord where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent and s_UserNO = @UserNO)
begin

INSERT INTO [tSessionStateRecord]
           ([s_IPAddress]
           ,[s_UserAgent]
           ,s_UserNO
           ,[d_LoginTime]
           ,n_HoldingTime)
     VALUES
           (@IPAddress
           ,@UserAgent
           ,@UserNO
           ,GETDATE()
           ,30) 

end
else
begin

update [tSessionStateRecord] set [d_LoginTime] = GETDATE(),n_HoldingTime = 30
where [s_IPAddress] = @IPAddress and [s_UserAgent] = @UserAgent
and s_UserNO = @UserNO



end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Password" DbType:"AnsiString" Value:"D63901D9A1C3CC97"
（2）ParameterName:"@IPAddress" DbType:"AnsiString" Value:"127.0.0.1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@UserAgent" DbType:"AnsiString" Value:"Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:02:34
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：1.*.用户不存在
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @:UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务检查：2.*.用户密码错误
***************************************************************************************************************
SQL:
select 1 from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and s_EncryptionCipher = @:Password and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:""
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:01
类型：Business 业务对象：UserToolsLogin 
说明：执行业务过程[1]：0.查询用户名
***************************************************************************************************************
SQL:
select UserName = s_UserName from [TopsWMS_FRM].[dbo].[FRM_Developer] where s_UserNO = @UserNO and n_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"heweijian"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@Password" DbType:"AnsiString" Value:"F7D46DABEE7173DB"
（3）ParameterName:"@UserName" DbType:"AnsiString" Value:"null"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:04
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:05
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:06
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:19:33
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-sjczdr"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:44
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"null"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:56
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InventoryOperation"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:56
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InventoryOperation"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:56
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:20:56
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryOperationBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建盘点单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[1]：0.先删除相关的权限
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
   delete from tPower where n_Type=1
end
else
begin
   delete from tPower
   where s_PowerID in (
      select s_PowerID from tModulePower where s_ModuleID=@ModuleID
   )
   delete from tModulePower where s_ModuleID=@ModuleID
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InventoryOperation"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：0.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InventoryOperation"
（5）ParameterName:"@PowerName" DbType:"String" Value:"进入权限"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"2"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：1.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryGoodsInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"根据喷涂下线QA码查询到相应的货物信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：2.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryOperationBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询未提交的新建盘点单据信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：3.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryOperationWarehouseInfo"
（5）ParameterName:"@PowerName" DbType:"String" Value:"查询盘点单的可选仓库信息"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"4"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:36:57
类型：Business 业务对象：SaveModulePower 
说明：执行业务过程[2]：4.添加权限及添加模块权限关联
***************************************************************************************************************
SQL:
if @ModuleID='_Default_Role'
begin
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		1,
        isnull(@IsPublic,0)
	)
end
else
begin
   if not exists(select 1 from tModulePower with(nolock)
   where s_ModuleID=@ModuleID and s_PowerID=@PowerID)
   begin
   
    delete from tPower where s_PowerID=@PowerID
	insert into tPower (
		s_PowerID,
		s_PowerName,
		n_Type,
        b_IsPublic
	)values (
		@PowerID,
		@PowerName,
		@PowerType,
        isnull(@IsPublic,0)
	)
    delete from tModulePower where s_ModuleID=@ModuleID and s_PowerID=@PowerID
	insert into tModulePower (
		s_ModuleID,
		s_PowerID
	)values (
		@ModuleID,
		@PowerID
	)
	
	end
end
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsPublic" DbType:"Boolean" Value:"False"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（4）ParameterName:"@PowerID" DbType:"String" Value:"InsertInventoryOperationBillStockInOut"
（5）ParameterName:"@PowerName" DbType:"String" Value:"新增盘点单据记录"
（6）ParameterName:"@PowerType" DbType:"Int64" Value:"3"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:39:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:39:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:39:47
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:39:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:39:48
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:00
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:41:05
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'CK%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:22
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:22
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:22
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'PD%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:29
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:33
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:33
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:



SELECT * from (
SELECT  
    RowNumber=ROW_NUMBER() OVER (order by s_RoleID),
    RoleID=s_RoleID,
    RoleName=s_RoleName
from tRole
) T
WHERE T.RowNumber BETWEEN @beginIndex and @endIndex
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:33
类型：Query 查询对象：SelRoles 
说明：执行查询对象查询(合计查询)
***************************************************************************************************************
SQL:
select
   RowsCount= Count(1)
from tRole
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@beginIndex" DbType:"Int32" Value:"1"
（3）ParameterName:"@endIndex" DbType:"Int32" Value:"20"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:35
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:35
类型：Query 查询对象：SelPowersByRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT distinct PowerID=rp.s_PowerID,PowerName=s_PowerName FROM tRolePower rp
join tPower p on rp.s_PowerID=p.s_PowerID
where rp.s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"cfjcxxgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmshcqkcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:36
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-kcgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-crkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmskb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wms-pdgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmstjbb"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"wmssczdcrkgl"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:37
类型：Query 查询对象：SelModules 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

declare @pID varchar(50)
select @pID=@ParentID
create table #t1(RoleID varchar(50),PowerID varchar(50))
if @pID ='0' or @IsCheckPower=0
begin
	insert into #t1(PowerID)
	select PowerID='1'
end 
else
begin
	insert into #t1(RoleID,PowerID)
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@Operator
/*
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  
	from tPower where n_Type=1
*/
--防止与默认权限重复2016-12-07 rolin
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=p.s_PowerID  
	from tPower p
	right join #t1 t on p.s_PowerID=t.PowerID
	where p.n_Type=1
	and p.s_PowerID is null
end



SELECT
ModuleID=s_ModuleID,
ModuleName=s_ModuleName,
Tag=n_Tag,
ParentID=s_ParentID,
--Controller=(select top 1 Value from SplitString(s_Url,'/',1)),
IsCom=b_IsCom,
Url=s_Url,
IconUrl=s_IconUrl,
IsLeaf=n_IsLeaf
FROM tModule m
right join #t1 t on t.PowerID=case 
								when @pID  ='0' then t.PowerID
								when @IsCheckPower=0 then t.PowerID
								else (select top 1 Value from SplitString(s_Url,'/',1))
						end
where s_ParentID=@pID 
AND n_Tag&1=0    --位运算1为删除
AND (
	select COUNT(1) from tModulePower mp 
	join #t1 rp on mp.s_PowerID=rp.PowerID 
	where mp.s_ModuleID=m.s_ModuleID)> 
		case when m.n_IsLeaf=1 and @IsCheckPower=1 then 0
		else -1
    end
ORDER BY n_No


drop table #t1




^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ParentID" DbType:"AnsiString" Value:"SysMg"
（1）ParameterName:"@IsCheckPower" DbType:"Boolean" Value:"0"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:43
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:43
类型：Query 查询对象：SelPowersByModuleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
-- if @ModuleID='_Default_Role'
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic
--   from tPower p
--  where p.n_Type=1--默认权限
--   order by p.n_Type ,p.s_PowerID
--else
--   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type  ,IsPublic=p.b_IsPublic
--   from tModulePower mp
--   join tPower p on mp.s_PowerID=p.s_PowerID
--  where mp.s_ModuleID=@ModuleID
--   order by p.n_Type ,p.s_PowerID


if @ModuleID='_Default_Role'
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=b_IsPublic,IsCheck=1
   from tPower p
  where p.n_Type=1--默认权限
   order by p.n_Type ,p.s_PowerID
else
   select PowerID=p.s_PowerID,PowerName=p.s_PowerName,PowerType=p.n_Type ,IsPublic=p.b_IsPublic,
IsCheck=(case isnull(tRolePower.s_RoleID,'') when '' then 0 else 1 end)
   from tModulePower mp with(nolock)
  left join tPower p with(nolock) on mp.s_PowerID=p.s_PowerID
  left join  tRolePower with(nolock) on tRolePower.s_PowerID = mp.s_PowerID
  and s_RoleID = @RoleID
  where mp.s_ModuleID=@ModuleID
   order by p.n_Type ,p.s_PowerID

 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@ModuleID" DbType:"AnsiString" Value:"wms-pdcz"
（1）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：1.*.角色编码已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleID=@:RoleID)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertInventoryOperationBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Business 业务对象：SaveRolePower 
说明：执行业务检查：2.*.角色名称已经存在
***************************************************************************************************************
SQL:
if @:UpdateFlag='add'
begin
   if not exists( select 1 from tRole where s_RoleName=@:RoleName)
      select 1
end
else
   select 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertInventoryOperationBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[1]：0.添加角色
***************************************************************************************************************
SQL:
if @UpdateFlag='add'
insert into tRole (
    s_RoleID,
    s_RoleName
)values (
    @RoleID,
    @RoleName
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertInventoryOperationBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[2]：0.删除角色与权限关系
***************************************************************************************************************
SQL:
 --delete from tRolePower where s_RoleID=@RoleID
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertInventoryOperationBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：0.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"InsertInventoryOperationBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:48
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：1.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryOperationBillStockInOut"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:49
类型：Business 业务对象：SaveRolePower 
说明：执行业务过程[3]：2.更新角色与权限关系
***************************************************************************************************************
SQL:
 
--insert into tRolePower (
--    s_RoleID,
--    s_PowerID
--)values (
--    @RoleID,
--    @PowerID
--)


delete from tRolePower where s_RoleID=@RoleID and s_PowerID = @PowerID


if(@PowerState = '1')
begin

insert into tRolePower (
    s_RoleID,
    s_PowerID
)values (
    @RoleID,
    @PowerID
)
  
end  

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@PowerID" DbType:"String" Value:"SelInventoryOperationWarehouseInfo"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@RoleID" DbType:"AnsiString" Value:"001"
（4）ParameterName:"@RoleName" DbType:"AnsiString" Value:"超级管理员"
（5）ParameterName:"@UpdateFlag" DbType:"AnsiString" Value:"update"
（6）ParameterName:"@PowerState" DbType:"String" Value:"1"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:53
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:54
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:54
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'PD%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:56
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:56
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:42:56
类型：Query 查询对象：SelInventoryOperationWarehouseInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select 
n_Warehouse_Id,s_Warehouse_Name
from tWarehouse with(nolock)
where n_Warehouse_state = 1
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:03
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:03
类型：Business 业务对象：InsertPackingOnShelfSingleBillStockInOut 
说明：执行业务过程[1]：0.新增打包下架单据记录
***************************************************************************************************************
SQL:
declare @Shopfloor_Id varchar(max)

select top 1 @Shopfloor_Id = n_Shopfloor_Id from tWarehouse where n_Warehouse_Id = @Warehouse_Id
and n_Warehouse_state = 1


insert into tBillStockInOut (
    n_BillStockInOut_Id,
    s_BillStockInOut_Code,
    n_BillStockInOut_Type,
    n_Warehouse_Id,
    n_Shopfloor_Id,
    n_Rack_Id,
    n_Space_Id, 
    n_Bin_Id,
    n_ReportInventoryCurrent_Id,
    s_BillStockInOut_BarCode,
    s_BillStockInOut_ExternalCode,
    s_BillStockInOut_ExternalName,
    s_BillStockInOut_ECN, 
    n_BillStockInOut_QualityStatus,
    s_BillStockInOut_Operator,
    s_BillStockInOut_Department,
    s_BillStockInOut_Team,
    d_BillStockInOut_OperateTime,
    s_BillStockInOut_Remark,
    s_BillStockInOut_WhetherToSubmit,
    f_BillStockInOut_WorkOrderQuantity,
    f_BillStockInOut_OKProductCou, 
    f_BillStockInOut_FinishWorkOrderQuantity, 
    n_BillStockInOut_IsApproved,
    n_BillStockInOut_state,
    s_BillStockInOut_Creator,
    d_BillStockInOut_CreateTime,
    s_BillStockInOut_Updator,
    d_BillStockInOut_UpdateTime 
)values (
    newID(),
    @BillStockInOut_Code,
    2,
    @Warehouse_Id,
    @Shopfloor_Id,
    '',
    '', 
    '',
    '',
    '',
    '',
    '',
    '', 
    @BillStockInOut_QualityStatus,
    @Operator,
    '',
    (case when datepart(hour,getdate()) >= 8 and datepart(hour,getdate()) < 20 then 1 else 2 end),
    getdate(),
    @BillStockInOut_Remark,
    0,
    @BillStockInOut_WorkOrderQuantity,
    @BillStockInOut_WorkOrderQuantity, 
    0, 
    0,
    1,
    @Operator,
    getdate(),
    @Operator,
    getdate() 
)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Warehouse_Id" DbType:"String" Value:"5D5EFEB1-CA50-4677-A94F-605FECD259D0"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
（3）ParameterName:"@BillStockInOut_Code" DbType:"String" Value:"PD20201204164256346"
（4）ParameterName:"@BillStockInOut_QualityStatus" DbType:"String" Value:"1"
（5）ParameterName:"@BillStockInOut_Remark" DbType:"String" Value:"测试"
（6）ParameterName:"@BillStockInOut_WorkOrderQuantity" DbType:"String" Value:"0"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:06
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:06
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'PD%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:33
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:38
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:38
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:38
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'PD%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:42
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:43
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:44
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:44
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:44
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:45
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:46
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:46
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:43:47
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"1"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:""
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:01
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:02
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:02
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:02
类型：Query 查询对象：SelModuleFather 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
declare @IsExistsSonModule nvarchar(50) = @IsExistsSonModules
declare @ParentId nvarchar(50) = @ParentIds
declare @Opetions nvarchar(50) = @Operator

select [Id] = n_Id,[Name] = s_Name,[Route] = s_Route,[IsExistsSonModule] = n_IsExistsSonModule,n_Sequence
into #ModuleFather
from tModuleFather with(nolock) where n_state = 1
and ISNULL(n_IsExistsSonModule,'') = (case ISNULL(@IsExistsSonModule,'') when '' then 0 else @IsExistsSonModule end)
and ISNULL(n_ParentId,'') = (case ISNULL(@ParentId,'') when '' then ISNULL(n_ParentId,'') else @ParentId end)
order by n_ParentId,n_Sequence

if(@IsExistsSonModule = '0')
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherOne
	from #ModuleFather ModuleFather
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		inner join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',ModuleFather.[Route]) when 0 then substring(ModuleFather.[Route],1,len(ModuleFather.[Route])) else substring(ModuleFather.[Route],1,len(ModuleFather.[Route])-len(substring(ModuleFather.[Route],charindex('?',ModuleFather.[Route]),len(ModuleFather.[Route])))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherOne order by n_Sequence
	
	drop table #ModuleFatherOne
end
else
begin
	select distinct ModuleFather.Id,ModuleFather.Name,ModuleFather.[Route],ModuleFather.IsExistsSonModule,ModuleFather.n_Sequence
	into #ModuleFatherTon
	from #ModuleFather ModuleFather
	inner join tModuleFather tModuleFather with(nolock) on tModuleFather.n_ParentId = ModuleFather.Id
		and tModuleFather.n_state = 1 and tModuleFather.n_IsExistsSonModule = 0
	left join (
		select distinct s_ModuleName,s_Url from tModule tModule with(nolock)
		left join tModulePower tModulePower with(nolock) on tModulePower.s_ModuleID = tModule.s_ModuleID
		left join (
			select tRolePower.s_RoleID,tPower.s_PowerName,tRolePower.s_PowerID
			from tRolePower tRolePower with(nolock)
			inner join tPower tPower with(nolock) on tPower.s_PowerID = tRolePower.s_PowerID
				and tPower.n_Type = 2
			inner join (
				select s_UserID,s_RoleID from tUserRole with(nolock)
				group by s_UserID,s_RoleID
			) tUserRole on tUserRole.s_RoleID = tRolePower.s_RoleID
			inner join tUser tUser with(nolock) on tUser.s_UserNO = tUserRole.s_UserID and tUser.n_State = 1
			where tUser.s_UserNO = @Opetions
		) Data on Data.s_PowerID = tModulePower.s_PowerID
		--where tModule.s_ParentID = (select top 1 s_ModuleID from tModule where s_ModuleName like '%手持终端%')
	) ModulePower on '..' + (case charindex('?',ModulePower.s_Url) when 0 then substring(ModulePower.s_Url,1,len(ModulePower.s_Url)) else substring(ModulePower.s_Url,1,len(ModulePower.s_Url)-len(substring(ModulePower.s_Url,charindex('?',ModulePower.s_Url),len(ModulePower.s_Url)))) end) = (case charindex('?',tModuleFather.s_Route) when 0 then substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)) else substring(tModuleFather.s_Route,1,len(tModuleFather.s_Route)-len(substring(tModuleFather.s_Route,charindex('?',tModuleFather.s_Route),len(tModuleFather.s_Route)))) end)
	where ModulePower.s_Url is not null
	
	select * from #ModuleFatherTon order by n_Sequence
	
	drop table #ModuleFatherTon
end

drop table #ModuleFather
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@IsExistsSonModules" DbType:"AnsiString" Value:"0"
（1）ParameterName:"@ParentIds" DbType:"AnsiString" Value:"4C44C33F-A790-472B-8F5F-8DBE506A10B1"
（2）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（3）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:04
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:05
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:05
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:05
类型：Query 查询对象：SelPackingOnShelfBillStockInOutSingle 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
SELECT [n_BillStockInOut_Id]
      ,[s_BillStockInOut_Code]    
	  ,n_Warehouse_Id
      ,tUser.s_UserName as [s_BillStockInOut_Operator] 
      ,[d_BillStockInOut_OperateTime]  
      ,[f_BillStockInOut_WorkOrderQuantity]  
  FROM [dbo].[tBillStockInOut] with(nolock)
  left join tUser tUser with(nolock) on tUser.s_UserNO = tBillStockInOut.s_BillStockInOut_Operator
  where [n_BillStockInOut_state] = 1
  and isnull([n_BillStockInOut_IsApproved],0) = 0
  and isnull([s_BillStockInOut_WhetherToSubmit],0) = 0
and s_BillStockInOut_Code like 'PD%'
and n_BillStockInOut_Type = 2
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:09
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:44:14
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:46:06
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:46:15
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:46:15
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:46:15
类型：Query 查询对象：SelInventoryGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max),
	 s_SurplusAmount int
 )

 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 

 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
inner join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode =  @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 declare @n_ReportInventoryCurrent_Number int

 select @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrent.n_ReportInventoryCurrent_Number)
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on tab.s_MotherCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_Number > 0

  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number
  
  select * from @Tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"CS060101"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:58:18
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:58:49
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:59:00
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:59:00
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 16:59:00
类型：Query 查询对象：SelInventoryGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max),
	 s_SurplusAmount int
 )

 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 

 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
inner join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode =  @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 declare @n_ReportInventoryCurrent_Number int

 select @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrent.n_ReportInventoryCurrent_Number)
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on tab.s_MotherCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_Number > 0

  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number
  
  select * from @Tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"CS060101"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:02:20
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:02:37
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:02:52
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:03:03
类型：Query 查询对象：SelPowersByUserNO 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
if exists(
	select 1 from tUser where s_UserNO=@UserNO
)
--如果是登录用户
begin
	select RoleID=ur.s_RoleID,PowerID=rp.s_PowerID 
	into #t1
	from 
	tUser u
	join tUserRole ur on u.s_UserNO=ur.s_UserID
	join tRolePower rp on rp.s_RoleID=ur.s_RoleID
	where s_UserNO=@UserNO
	
	insert into #t1 (RoleID,PowerID) 
	select RoleID='defaule',PowerID=s_PowerID  from tPower where n_Type=1
	
	select * from #t1
drop table #t1
end
else
	--如果是非登录用户，只获取公开权限
	select RoleID='public',PowerID=s_PowerID  from tPower where b_IsPublic=1

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:03:04
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:03:04
类型：Query 查询对象：SelInventoryGoodsInfo 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
 declare @Tab table(
     s_LogCode varchar(max),
     s_MotherCode varchar(max),
     s_Mother_Desc varchar(max),
	 n_ModelState varchar(max),
	 n_PartTypeId varchar(max),
	 s_CarColor varchar(max),
	 s_CarBrand varchar(max),
	 s_CarSeries varchar(max),
	 s_CarType varchar(max),
	 s_Batch varchar(max),
	 s_SurplusAmount int
 )

 declare @Month varchar(20)
 select top 1 @Month = s_Month from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1 order by replace(s_Month,'-','') desc 

 insert into @Tab(
     s_LogCode,
     s_MotherCode,
     s_Mother_Desc,
	 n_ModelState,
	 n_PartTypeId,
	 s_CarColor,
	 s_CarBrand,
	 s_CarSeries,
	 s_CarType,
	 s_Batch,
	 s_SurplusAmount
 )
 select  
 s_LogCode,s_MotherCode, 
s_CarSeries + '/' + s_CarType + '/'+s_CarColor as s_Mother_Desc,
n_ModelState,
n_PartTypeId,s_CarColor,s_CarBrand,s_CarSeries,s_CarType,s_Batch,0
from TopsERP_BIZ.dbo.tWorkLog with(nolock)
inner join (
select  
s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series 
from TopsERP_BIZ.dbo.tPBOM with(nolock) where n_State = 1  and s_Month = @Month
group by s_MotherCode,s_Mother_Desc,s_PartType,s_Color,s_Brand,s_Series,s_PartType 
) tPBOM on tPBOM.s_Brand = tWorkLog.s_CarBrand
and tPBOM.s_Series = tWorkLog.s_CarSeries
and charindex(tWorkLog.s_CarType,replace(tPBOM.s_PartType,'保险',''),0) > 0
and tPBOM.s_Color = tWorkLog.s_CarColor
where s_LogCode =  @GoodsBarCode
and tWorkLog.n_State = 1
order by n_WorkLogId desc

 declare @n_ReportInventoryCurrent_Number int

 select @n_ReportInventoryCurrent_Number = sum(tReportInventoryCurrent.n_ReportInventoryCurrent_Number)
 from @Tab tab
 inner join tReportInventoryCurrent tReportInventoryCurrent with(nolock) on tab.s_MotherCode = tReportInventoryCurrent.s_ReportInventoryCurrent_GoodsProductCode
 where n_ReportInventoryCurrent_state = 1
 and s_ReportInventoryCurrent_Code = @SpaceBarCode
 and s_ReportInventoryCurrent_QualityStatus = @s_ReportInventoryCurrent_QualityStatus
 and n_ReportInventoryCurrent_Number > 0

  update @Tab
 set s_SurplusAmount = @n_ReportInventoryCurrent_Number
  
  select * from @Tab
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@GoodsBarCode" DbType:"AnsiString" Value:"84917882009240001"
（1）ParameterName:"@SpaceBarCode" DbType:"AnsiString" Value:"CS060101"
（2）ParameterName:"@s_ReportInventoryCurrent_QualityStatus" DbType:"AnsiString" Value:"1"
（3）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（4）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:12
类型：Query 查询对象：SelAllSheet 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT name = tbs.name ,value = isnull(ds.value,'') 
FROM sysobjects tbs
LEFT JOIN sys.extended_properties ds ON ds.major_id=tbs.id and ds.minor_id=0 
WHERE  xtype='u' and tbs.name not like 'MSmerge_conflict%' order by tbs.name asc

--select name from sys.sysobjects  where xtype='u' order by name asc
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"SysParamId" DbType:"String" Value:"5"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:12
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:12
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"AssemblingFinalInspectionRFIDDataIntermediate"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:19
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:19
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"IMRFIDDataIntermediate"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:26
类型：Query 查询对象：SelOperatorRoleID 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:
select OperatorRoleID=s_RoleID from tRole where s_RoleID in( select s_RoleID from tUserRole where s_UserID=@UserNO)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@UserNO" DbType:"AnsiString" Value:"admin"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
**************************************************************************************************************------>2020/12/4 17:21:26
类型：Query 查询对象：SelAllColumns 
说明：执行查询对象查询(1)
***************************************************************************************************************
SQL:

SELECT  表名 = CASE WHEN a.colorder=1 THEN d.name
                  ELSE ''
             END,表说明 = CASE WHEN a.colorder=1 THEN ISNULL(f.value,'')
                            ELSE ''
                       END,--字段序号 = a.colorder,
                       字段名 = a.name,
        --标识 = CASE WHEN COLUMNPROPERTY(a.id,a.name,'IsIdentity')=1 THEN '√' ELSE '×' END,
        主键 = CASE WHEN EXISTS ( SELECT  1
                                FROM    sysobjects
                                WHERE   xtype='PK'
                                        AND name IN (
                                        SELECT  name
                                        FROM    sysindexes
                                        WHERE   indid IN (
                                                SELECT  indid
                                                FROM    sysindexkeys
                                                WHERE   id=a.id
                                                        AND colid=a.colid)) )
                  THEN '√'
                  ELSE ''
             END,
             类型 = b.name,--占用字节数 = a.length,
        长度 = COLUMNPROPERTY(a.id,a.name,'PRECISION'),
        --小数位数 = ISNULL(COLUMNPROPERTY(a.id,a.name,'Scale'),0),
        允许空 = CASE WHEN a.isnullable=1 THEN '√'
                   ELSE ''
              END,默认值 = ISNULL(e.text,''),字段说明 = ISNULL(g.[value],'')
FROM    syscolumns a
LEFT   JOIN systypes b
        ON a.xusertype=b.xusertype
INNER   JOIN sysobjects d
        ON a.id=d.id
           AND d.xtype='U'
           AND d.name<>'dtproperties'
LEFT   JOIN syscomments e
        ON a.cdefault=e.id
LEFT   JOIN sys.extended_properties g
        ON a.id=g.major_id
           AND a.colid=g.minor_id
LEFT   JOIN sys.extended_properties f
        ON d.id=f.major_id
           AND f.minor_id=0 where d.name=(case isnull(@Sheet,'') when '' then d.name else @Sheet end)       --如果只查询指定表,加上此条件
ORDER   BY a.id,a.colorder
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
参数：
（0）ParameterName:"@Sheet" DbType:"AnsiString" Value:"tRecordInventoryMoveCount"
（1）ParameterName:"@Operator" DbType:"AnsiString" Value:"admin"
（2）ParameterName:"@OperatorRoleID" DbType:"AnsiString" Value:"001"
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^